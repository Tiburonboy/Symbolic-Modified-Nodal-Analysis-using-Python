# Klon Centaur, part 1

:::{.callout-note}  
- Some of the narration in the Introduction was generated by Google's NotebookLM and Gemini, then modified by me.  
- This chapter is an early draft document
  - spell and grammar checking has not been done, many sections are incomplete  
  - posted for test purposes  
  - some cross references can't be resolved until parts 2 and 3 are completed
:::  

![Klon Centaur, photo from Wikipedia, ArtBrom from Seattle, CC BY-SA 2.0](Klon_Centaur.jpg){#fig-klon-centaur}

## Introduction
This analysis will illustrate the application of MNA, Python programming and LTSpice to an interesting circuit called the [Klon Centaur](https://en.wikipedia.org/wiki/Klon_Centaur). The schematics shown in this notebook were drawn using LTSpice and from those schematics, LTSpice was used to generated the netlists. Python and the MNA code was be used to generate network equations from the netlists and obtain solutions for unknown voltages and currents. Transient analysis of the circuit was performed using LTSpice using device models for the diodes and Op Amps. This notebook will attempt to analyze and describe the operation of the various parts of the circuit, with the exception of the power supply.

As an electrical engineer, I've been curious about the workings of the electric guitar and the operation of the effects boxes. My motivation in writing this paper was to learn a little about the topic. I don't play the guitar and I'm not a musician, so I'll be looking at this topic from the point of view of signals and circuits. 

Following the introduction section about the characteristics the electric guitar and associated equipment, a description of the electrical schematic and the interfaces to the circuit (knobs and jacks) is provided. There are some on-line sources that are referenced which provide an analysis of the circuit, primarily utilizing LTSpice. These analysis are interesting since the perspective is somewhat different than what is provided in this notebook. A few words are provided about current price and availability of the pedal, the Klon KTR and Klon Centaur clones.

The analysis provided in this notebook is a deep dive into the operation of the circuit from the perspective of traditional linear circuit analysis taught in electrical engineering schools. The focus is on circuit analysis and not circuit design. This means looking at how the circuit works, since this is what circuit analysis is all about. The designers of the Klon Centaur were looking for a particular sound or tone profile and in some places I'll comment on reasons why the designers might have developed these circuits; but for the most part I'll not be looking at why the circuit works in a particular way, but how it works. 

The Klon Centaur is an overdrive pedal and the top of the pedal is shown in @fig-klon-centaur. The Klon Centaur is widely used in many genres of music, including blues, rock and country. An overdrive pedal is a piece of electronic equipment used by guitarists to alter the sound of the guitar. It's essentially a box containing a circuit that is connected between the guitar and the amplifier, often with other pedals in series, and these pedals control the amount of gain, distortion, tone and output level delivered to the amplifier.  

Bill Finnegan, owner of Klon LLC, and the Klon Centaur creator, wanted to make a pedal that would recreate the sound of a guitar amplifier's distortion at high volume. Finnegan wasn't a fan of the sound of the popular [Ibanez Tube Screamer](https://www.ibanez.com/usa/products/model/tube_screamer/), which many guitarists use for overdrive. He felt it sounded too artificial and buzzy. So he set out to create a pedal that would deliver a more natural, tube-like overdrive sound with rich harmonics. The pedal was designed to have a "big, open" sound with "a hint of tube clipping" that wouldn't sound like it was made by a pedal. Just to clarify, Klon is the company name and Centuar is the name of the pedal and since the Klon only had one product, the product became known as the Klon Centaur. Over the production life of the Centaur, the color of the case and the centaur logo has changed.

Finnegan worked with MIT graduate Fred Fenning and other electrical engineer friends for four and a half years to create prototype pedals. A Germanium diode was chosen by Finnegan for the circuit and he bought as many as he could, since these were a special type that he determined sounded more musical than others he tested. These diodes are no longer in production. The components of the circuit were coated in epoxy resin to make reverse engineering of the circuit more difficult. The Klon Centaur was first sold in late 1994. Finnegan personally built, tested and shipped the pedals from his house, where he was inundated with orders. Many of the components, including the cast enclosure and knobs were custom manufactured. Over the course of 15 years, Finnegan sold about 8,000 pedals. See [The Klon Centaur Guide](https://decibelics.com/klon-guide/) for a thorougal and informative history of the Klon.

:::{.callout-note}  
Notebook organization: The analysis of the Klon Centaur circuits ended up being rather long. Navigating and rendering of the notebook became a bit sluggish on my laptop, so I decided to break up the notebook into three parts.

- Klon Centaur, part 1: Introduction and Effects path linear analysis
- Klon Centaur, part 2: Effects path non-linear analysis
- Klon Centaur, part 3: Design Review and Reactive branch analysis

:::  

## Electric guitar characteristics
An electric guitar is a type of guitar that relies on electrical amplification to produce sound. Electric guitars are known for the wide variety of tones they can produce. By using effects pedals and manipulating the knobs on the guitar and amplifier, musicians can create sounds ranging from clean and bright to distorted and heavy. This versatility has made the electric guitar a popular instrument in many genres of music, including rock, blues, country and jazz. 

An electric guitar isn't just the guitar. While the wooden body, neck and strings are essential components, they only produce a very faint sound on their own. The essential parts for the electric guitar are:

1. The Guitar: This is where the musical performance originates. The player's technique, the strings' vibration and the guitar's construction all contribute to the initial sound. However, the sound produced by the guitar alone is very quiet and lacks the power and character we associate with electric guitars.
2. The Amplifier: This electronic device takes the tiny electrical signals from the guitar's pickups and boosts them to a much higher volume level. It also shapes the sound, adding characteristics like warmth, brightness, or distortion.
3. The Speaker: This is the final link in the chain, converting the amplified electrical signal into sound waves that we can hear. Different speakers produce different tones and the size and design of the speaker cabinet significantly impacts the overall sound.

In essence, the electric guitar, amplifier and speaker work together as a system to produce the rich, varied and powerful sounds that define this instrument. Each component plays a crucial role in shaping the final sound. The combination of these elements is what makes the electric guitar such a versatile and expressive instrument.

The componets of an electric guitar, all of which contribute to the tone are described below in more detail:

### Body
The electric guitar body is the foundation of the instrument, providing a sturdy platform for attaching the neck, strings, pickups, electronics and bridge. Electric guitar bodies come in a wide variety of shapes, each with its own distinct look and tonal characteristics. Some of the most popular and iconic shapes include:

- Stratocaster: Contoured double-cutaway body with three pickups. Known for its bright, twangy sound and versatility across various genres.
- Telecaster: Solid body with a single-cutaway design and typically two pickups. Known for its twangy, bright tone and bite.
- Les Paul: Solid body with a carved top, typically two humbucker pickups. Known for its warm, thick and sustain-rich tone.
- Gibson SG: Solid body with a "horns" design and typically two humbucker pickups. Known for its comfortable, lightweight design and bright, punchy tone.

The type of wood used for the guitar body plays a significant role in its tone. Some of the most common body woods include:

- Mahogany: A popular choice for both solid and semi-hollow bodies, known for its warm, woody tone with good sustain.
- Alder: A popular choice for Stratocasters and Telecasters, known for its bright, balanced tone.
- Ash: Lighter than mahogany with a brighter, more scooped tone. Often used on Fender guitars.
- Basswood: A lightweight wood often used on budget guitars, with a neutral tone that can take EQ well.
- Poplar: Another affordable wood with a neutral tone, commonly used on budget guitars.

Electric guitar bodies can be constructed in two main ways:

- Solid body: The most common type, made from a single piece of wood or laminated pieces of wood. Offers good sustain and resonance.
- Semi-hollow body: Has a hollow core with solid wood tops and backs. Offers a warmer, more resonant tone than solid bodies, but with less sustain.

### Strings
The electric guitar uses pickups to convert the vibrations of the steel strings into electrical signals. There are many different types of electric guitar strings available, each with its own unique sound. Some of the most common types of strings include:

- Roundwound strings: These are the most popular type of electric guitar string. They have a bright, clear sound and are very versatile.
- Flatwound strings: These strings have a smooth, mellow sound. They are often used by jazz guitarists.
- Nickel-plated steel strings: These strings are bright and warm-sounding. They are a popular choice for many different genres of music.
- Stainless steel strings: These strings are bright and have a long lifespan. They are often used by rock and metal guitarists.

When a string is strummed or plucked, it vibrates and interactacts with the magnetic field of the pickup. The vibrations and movement of the steel string in close proximity to the ends of the magnets in the pickup cause the vibrations to be impressed on the magnetic field which causes a voltage to be induced in the wire wound around the magnets. The strings vibrate at different frequencies depending on their thickness, length and tension. The thicker the string, the lower the pitch and frequency. An electric guitar typically has six strings. The thickest string is the low E string and the thinnest string is the high E string. The fundamental of the low E string is about 80 Hz. The frequency range of interest would start at 80 Hz and go up to the sixth harmonic of highest note on the high E string, or about 7.8kHz. [Guitar Frequency Range Chart](https://www.musicguymixing.com/guitar-frequency-range/) talks about using an equalized frequency range of 150 Hz up to 5 to 8 kHz. In the analysis that follows an audio range of 80 to 8kHz will be highlighted as the electric guitar audio band.

### Pickups
There are different types of pickups, each with its own sound. There are two main types of electric guitar pickups: single-coil and humbucker.

- Single-coil pickups are known for their bright, clear and often chimey sound. However, they are also susceptible to electrical hum, which is a low-level buzzing sound that can be caused by electromagnetic interference.
- Humbucker pickups are made with two coils that are wired out of phase with each other. This helps to cancel out the hum that is common with single-coil pickups. Humbuckers tend to have a thicker, fuller sound than single-coils.   
    
The position of a pickup in the guitar also affects its sound. Pickups that are closer to the bridge tend to have a brighter sound, while pickups that are closer to the neck tend to have a warmer, fuller sound. Electric guitar pickups come in a wide variety of styles and designs, each with its own unique sound. Some of the most popular brands of electric guitar pickups include Seymour Duncan, DiMarzio, EMG and Fender.

Electric guitar pickups typically have a high impedance, around 10kΩ, which can make them susceptible to noise pickup over long cables. Most electric guitars use passive pickups, which rely on the vibration of the strings to induce a current in the pickup coil. This results in a relatively weak signal with low output voltage.

### Controls
Electric guitars typically have pickup selector switches and tone/volume knobs.

- Pickup selector switch:  This switch allows you to select which pickups will be active and sent to the amplifier. The most common types of pickup selector switches are 3-way and 5-way switches.
  - 3-way switch: This is commonly found on Gibson Les Paul guitars. It typically has positions for the bridge pickup only, neck pickup only and both pickups combined.
  - 5-way switch: This is commonly found on Fender Stratocaster guitars. It typically has positions for the bridge pickup only, bridge and middle pickups combined, middle pickup only, neck and middle pickups combined and neck pickup only.
- Tone/Volume knobs: These are knobs that allow you to control the volume and tone of the signal sent from the pickups to the amplifier.
  - Volume knob: This knob controls the overall output level of the guitar. Turning it up increases the volume and turning it down decreases the volume.
  - Tone knob: This knob controls the treble (high frequencies) of the signal. Turning it up allows more treble to pass through, resulting in a brighter sound. Turning it down cuts the treble, resulting in a warmer sound. Some guitars may have multiple tone knobs, allowing for independent control over the treble of different pickups.

These switches and knobs are crucial for shaping the electric guitar's sound. By manipulating the pickup selection and tone/volume controls, guitarists can create a wide variety of tones, from bright and twangy to warm and thick.

### Amplifier
An electric guitar amplifier, often simply called an amp, is an electronic device that takes the weak electrical signal produced by an electric guitar's pickups and amplifies the signal such that it can be heard through a speaker. There are two main types of electric guitar amplifiers:

- Tube amplifiers: These classic amps use vacuum tubes to pre-amplify and power the signal. Tube amps are prized for their warm, rich sound and responsiveness to playing dynamics. However, they tend to be more expensive, heavier and more delicate than solid-state amps.
- Solid-state amplifiers: These amps use transistors to amplify the signal. Solid-state amps are generally more affordable, lighter and more durable than tube amps. They can also produce a wide variety of tones, making them versatile for many genres of music.
- Modeling amps: These amps use digital technology to model the sound of classic tube amps and other effects pedals. Modeling amps are very versatile and can be a great way to get a wide variety of tones without having to buy a lot of equipment.
- Combo amps: These amps combine the amplifier and speaker in a single unit. They are typically more portable and affordable than stacks, making them a good choice for beginners and practice.

### Cabnet
An electric guitar cabinet, also known as a speaker cabinet or simply a cab, is an enclosure that houses one or more loudspeakers. It is an essential component of an electric guitar amplifier setup.
The Cabinet is the housing that encloses the speakers. The cabinet is typically made of wood, such as plywood or MDF (medium-density fiberboard) and is designed to resonate at certain frequencies to color the sound of the speakers. There are Open-back and Closed-back cabinets. Open-back cabinets tend to produce a brighter, more airy sound, while closed-back cabinets produce a tighter, more focused sound with more bass. The number of speakers in a cabinet affects its overall volume and tone.  A 4x12 cabinet with four 12-inch speakers is a popular choice for rock and metal guitarists who need a lot of volume and bottom end. A 1x12 cabinet with a single 12-inch speaker is a more portable option that is still loud enough for practice and small gigs.

### Tone
The electric guitar tone is the overall sound produced by the instrument, influenced by a combination of factors including:

- Electric guitar components:
  - Pickups: These magnetic devices convert the vibrations of the strings into an electrical signal.
  - Effects: Electric guitar effects are electronic devices that modify the sound of an electric guitar. They can be used to create a wide variety of tones, from subtle to extreme. Effects pedals are typically individual units that are controlled by footswitches. They can be chained together to create complex effects. Multi-effects processors combine the functionality of many different pedals into a single unit.
  - Amp: Tube amps are known for their warm, rich sound and responsiveness to playing dynamics, while solid-state amps are more versatile and can produce a wider variety of tones. The settings on the amplifier, such as gain, EQ and reverb, will significantly impact the overall tone.
  - Cabnet: An electric guitar cabinet, also known as a speaker cabinet or simply a cab, is a wooden enclosure that houses one or more loudspeakers. It is designed to project the amplified sound of an electric guitar. Guitar cabinets are passive devices, meaning that they don't require their own power source to function. Instead, they rely on the power from an electric guitar amplifier.
- Playing technique:
  - Picking technique: How you pick the strings (pickups closer to the bridge or neck, pick attack strength) can affect the brightness, attack and overall character of the tone.
  - String bending: Bending strings adds pitch variations and vibrato to your sound.
  - Effects pedals: These electronic devices can add a wide variety of effects to your tone, such as distortion, overdrive, chorus, delay and reverb.
- Microphone: Miking an electric guitar cab involves placing a microphone in front of the speaker cabinet to capture the sound of the amplified guitar. This technique is commonly used in live performances and studio recordings to capture the full body and character of the electric guitar tone.
- Mixing console: Live performance mixing consoles, also known as live sound mixers, are electronic devices used to control and manipulate the sounds of multiple microphones and instruments during a live performance. They are the central hub of a sound system for concerts, public speeches, theatrical productions and other live events.

Here are some common electric guitar tones and how they are achieved:

- Clean tone: A bright, clear tone with minimal distortion or amplification. Achieved with low gain settings on the amp and single-coil pickups.
- Overdrive: A warmer, more saturated tone than clean, with a slight amount of grit and breakup. Achieved with higher gain settings on the amp or with overdrive pedals.
- Distortion: A heavily amplified and distorted sound, often used for rock and metal music. Achieved with high gain settings on the amp or with distortion pedals.
- Blues tone: Often characterized by a clean or slightly overdriven tone with a warm midrange emphasis. Achieved with single-coil pickups and tube amps with moderate gain settings.

### Effects
Electric guitar effects pedals are electronic devices that alter the electrical signal of the guitar to create new and unique sounds. They are inserted between the guitar and your amplifier, allowing modification of the basic sound of the instrument in a variety of ways. There are a vast number of different effects pedals available, but some of the most common and popular types include:

- Distortion and overdrive pedals: These pedals add grit, saturation and sustain to the guitar sound. Distortion is generally heavier than overdrive, but both can be used to create a wide range of rock and metal tones.
- Fuzz pedals: These pedals create a thick, fuzzy distortion sound that is often associated with psychedelic rock and garage rock.
- Wah-wah pedals: These pedals create a vocal-like "wah-wah" sound by sweeping a band of frequencies up and down as the pedal is rocked.  They are often used in funk, blues and rock music.
- Delay pedals: These pedals create echo effects by recording a short sample of the signal and then playing it back a few milliseconds later. Delay pedals can be used to add depth, space and atmosphere to the sound.
- Reverb pedals: These pedals simulate the natural reverberation of sound in a room or hall. Reverb can add depth, ambience and atmosphere to the sound.
- Chorus pedals: These pedals create a lush, shimmering sound by duplicating the signal and slightly detuning it. Chorus is often used to add thickness and body to clean tones.
- Flanger pedals: These pedals create a swirling, jet-like sound by splitting your signal and delaying one side slightly. Flangers are often used to add texture and movement to the sound.
- Phaser pedals: These pedals create a phasing effect by splitting the signal and feeding it through two slightly out-of-phase filters. Phasers can create a subtle warbling or pulsating sound.
- Equalizer (EQ) pedals: These pedals allow you to boost or cut specific frequencies in your signal. EQ pedals can be used to shape the tone and correct for tonal imbalances.

The Klon Centaur is a type of distortion pedal. Disportion is usually achieved by some type of nonlinear signal processings such as clipping or limiting the amplitude of the guitar signal, which creates harmonic overtones. The amount of distortion that a pedal creates puts it into a typical category or type. An overdrive pedal creates a relatively moderate amount of distortion. A pedal producing a bit more distortion is called a distortion pedal and a pedal producing an extreme amount of distortion is called a fuzz pedal.

## Klon Centaur schematic
The Klon Centaur circuit board was originally covered with a black epoxy resin to prevent people from replicating it. The community at [freestompboxes.org](https://www.freestompboxes.org/) bought a Centaur and sent it to Martin Chittum to analyze. Martin was able to remove the black epoxy resin, trace the circuit and identify all of the components. The schematic was publicly released online in April 2008. Several modifications needed to be made to the schematic, with a final corrected version released in May 2009. Martin Chittum’s [Klon Centaur schematic](https://guitargearfinder.com/wp-content/uploads/2018/11/klon-centaur-schematic-high-res.jpg) is regarded as accurate. Production of the Klon Centaur stopped soon after Martin Chittum's schematic was published and clones became available.

![Martin Chittum’s Klon Centaur schematic](klon-centaur-schematic-high-res.jpg){#fig-Chittum_Klon_sch}

The Op Amp U2A is configured as a summing amplifier that combines the signal from two clean paths and the path containing the diodes, D2 and D3. The paths have reactive components that are shaping the frequency response of the signal and it is not obvious how these circuits are shaping the tone. This is one reason why this pedal has a mystic surrounding it and almost a cult following.  

### Klon Centaur interface
The Klon Centaur has a simple yet effective control layout.

- Knobs, these correspond to P1, P2 and P3 in the schematic, @fig-Chittum_Klon_sch.  
  - GAIN: This control significantly influences the pedal's tone and character. At low gain settings provides clean boost. At medium Gain Settings the overdrive is increased. At high gain setting the overdrive is more aggressive.
  - TREBLE: The treble control boosts or cuts frequencies above 200Hz.
  - OUTPUT: The output control on a Klon Centaur is primarily used to adjust the overall volume level of the pedal. 
- Switch S1 is the bypass ON or effects ON switch. 
- Red LED, D1 in the schematic: illumanated when the effect is on.

The Klon Centaur uses a standard 9-volt battery as the internal power source, but also has a jack for external 9 volt power. This is indicated as BAT1 in the schematic.

There are three jacks on the Klon Centuar chassis, these are: 

- IN (J1 in the schematic): The signal input. This is a standard 1/4-inch guitar input jack.
- OUT (J2 in the schematic): This is also a standard 1/4-inch output jack, used to connect the pedal to the amplifier or other effects.
- 9V (The DC jack in the schematic): The Klon Centaur uses a unique 1/8" (3.5mm) mini jack power connector for external power (if a battery is not used). This is different from the standard center-negative 2.1mm barrel jack found on most pedals.

## Klon Centaur Circuit analysis, blog/forum pages {#sec-web_circuit_analysis}
There are a variety of online sites that explain how the circuit operates, among these are:

- [ElectroSmash](https://www.electrosmash.com/klon-centaur-analysis): This website provides a detailed breakdown of the Klon Centaur circuit, highlighting unique features and explaining how different sections contribute to the overall sound.
- [Klon Centaur circuit analysis](https://www.coda-effects.com/p/klon-centaur-circuit-analysis.html): Circuit description.
- [DIYstompboxes forum](https://www.freestompboxes.org/viewtopic.php?t=31222): While discussions here acknowledge the complexity of the circuit and the lack of a purely mathematical approach, some users delve into specific aspects and component functions.
- [Builder Profile: Klon's Bill Finnegan](https://www.premierguitar.com/gear/bill-finnegan-klon): Interview and design history.

The Klon Centaur's design is thought to be a mixture of basic circuit design ~~known for its blend of theoretical understanding~~and "ear-based" adjustments. So, while the resources above offer valuable insights, the complete picture might involve a combination of electrical theory and the designer's experimentation. I could not find a good description of the signal path for what I'm calling the clean tone path 2, see @sec-clean_tone_path2. 

## Klon Centaur price and availability
The initial price of a Klon Centaur in 1994 was 225 dollars. The price increased over time and by 2007 a Klon Centaur cost 329 dollars. The price of used Klon Centaur pedals began to increase because people did not want to wait for a new one. Currently used Klon Centaurs are selling for thousands of dollars on eBay.

## The Klon KTR: A Pedalboard-Friendly Redesign
The Klon KTR is a redesigned version of the Klon Centaur overdrive pedal, released in 2014 by Bill Finnegan. Finnegan's aim with the KTR was to create a pedal that retained the sound of the original Centaur while addressing some of the production and practicality issues of the original design. One of his main goals was to make the KTR easier to manufacture, so he opted for a design that could be built by a contracted manufacturing firm. This involved using surface-mount components for most of the parts, with the exception of the germanium clipping diodes. He also wanted to make the KTR more pedalboard-friendly, so he chose a smaller enclosure than the original Centaur. The KTR features a standard DC jack and a switchable buffer bypass. Importantly, Finnegan maintained the use of the original Klon Centaur germanium clipping diodes in the KTR. The KTR initially sold for $269.  Finnegan included the text "Kindly remember: The ridiculous hype that offends so many is not of my making" on the pedal. The Klon KTR is no longer in production.

## Klon Centaur clones
The Klon Centaur is a legendary overdrive pedal widely regarded as the "holy grail" of overdrive by many guitarists. There are many Klon Centaur clones available on the market that try to capture the sound of the original. Here are some of the popular Klon Centaur clones:

- [Mosky Silver Horse Overdrive Boost-Function](https://moskyaudio.com/product/products-8-4.html): This is a budget-friendly option that captures the Klon Centaur's warm overdrive sound. It has gain and sustain, making it great for solos. Prices are typically \$48.
- [Warm Audio Centavo Overdrive Pedal](https://warmaudio.com/centavo/): This clone is known for its high quality and accurate reproduction of the Klon Centaur sound. It also includes a mod switch for extending the low-end response. It currently costs \$179.
- [Tone City Bad Horse Overdrive](https://www.tonepedia.com/catalog/effects-and-pedals/overdrive-and-boost/bad-horse-overdrive/): This is another well-regarded Klon clone that is known for its accurate sound and small size. It has a rating of 4.80 out of 5 based on 51 user reviews and currently costs \$54.
- [StewMac Ghost Drive Pedal Kit](https://www.stewmac.com/kits-and-projects/electronic-kits/pedals-and-mod-kits/stewmac-ghost-drive-pedal-kit/): This is a great option for those who want to build their own Klon clone. It has a rating of 4.91 out of 5 based on 210 user reviews and costs \$125.
- [Mosky Golden Horse](https://www.moskyaudio.com/product/product-22-912.html): This is a popular Klon clone that is known for its transparent overdrive sound and ease of use. It is also very compact. Prices typically are around \$39.
- [Clown Centurion](https://bentfishbowl.wixsite.com/electronics/post/clown-centurion): A DIY implimentation with some circuit simplification.
- [NOTAKLÖN](https://jhspedals.info/products/notaklon): A kit for a no-solder clone for $99.

## Analysis methodology
$\large{\color {red} {\text{update this narrative last}}}$  

![Schematic used for the Python analysis](Klon-Centaur_v1.png){#fig-Klon-Centaur_sch}

- circuit description, where did the schematic used for analysi come from? I redrew the schematic using LTSpice and omitted parts of the circuit not related to my analysis. Omitted are the power supply and V+ is drawn as a ground since it is an AC ground. nodes are labeled. Op Amps are ideal, Pots P1 and P2 are drawn as individual resistors. Drawn for analysis, no power supply, v+, the 4.5V virtual ground replaced by the AC ground, Ideal Op Amp, diode model from the internet.
  - description
    - overview, power supply, Op Amps, Diodes, circuit paths
    - same ref resignators as in orginal schematic, except for pots which are named as Rp1a for value between terminals 1 and 2 for example.
    - mysterious path, see @sec-clean_tone_path2
- circuit analysis steps: What about Op Amps and diodes?
  - draw circuit in LTSpice: original schematic source (see reference)
    - explain the LTSpice schematic and derived from the Martin Chittum’s Klon Centaur schematic
    - Klon-Centaur.asc - fix schematic, add labels
  - ideal Op Amps and no diodes, looking at just the effects of the passive components, in the frequency domain
  - replace split rail 9V with AC ground
  - MNA
    - linear analysis
    - symbolic analysis
    - Numerical analysis
    - What are these and why are they used?: Bode, impulse, step, poles and zeros, group delay
- Signal paths
  - bypass
    - isolation between bypass and effects
  - effect
    - output
    - treble
    - clean tone paths
    - distortion path
  - nonlinear analysis
    - Op Amp and diode model
    - AC analysis
    - transient analysis
      - sinusodal
      - step
    - Op Amp signal levels
  - MNA and LTSpce results comparison, @sec-Comparison_of_MNA_and_LTSpice_results
  - subcircuit analysis, @sec-Analysis_of_reactive_branches
    - U1b filter network
    - diode filtering
    - clean path 1
    - clean path 2 
- Summary
  - uniqueness
  - design reciew comments
  - inspired by circuits

### Frequency Response Plot

A [frequency response](https://en.wikipedia.org/wiki/Frequency_response) plot is a graphical representation of how a system responds to different input frequencies. It's a valuable tool in various fields, including engineering, audio, and signal processing. Typically, a frequency response plot shows two key characteristics of a system:

1. Magnitude Response: This indicates how much the system amplifies or attenuates different frequencies. It's often plotted in decibels (dB) on a logarithmic scale.
2. Phase Response: This shows the phase shift introduced by the system at different frequencies. It's usually plotted in degrees or radians.

By analyzing a frequency response plot, you can determine:

- Bandwidth: The range of frequencies a system can process effectively.
- Gain: The amount of amplification or attenuation at specific frequencies.
- Phase shift: The delay introduced by the system at different frequencies.
- Resonance: Peaks in the magnitude response indicating frequencies where the system amplifies strongly.
- Stability: Whether a system is stable or unstable based on the phase margin.

### The Complex Frequency Plane
The [complex frequency](https://en.wikipedia.org/wiki/Complex_plane) plane is a two-dimensional space where complex numbers represent frequency. Unlike the real-world concept of frequency, which is a scalar value representing the rate of oscillation, complex frequency adds a dimension of complexity. It's represented by the symbol $s$ and is defined as:

$s=\sigma+j\omega$

Where:

- $\sigma$ is the real part, representing exponential growth or decay.
- $j$ is the imaginary unit $\sqrt{-1}$.
- $\omega$ is the imaginary part, representing the angular frequency (related to the frequency in Hertz).

The complex frequency plane is divided into four quadrants:

- Right half-plane (RHP): $\sigma \gt 0$, representing exponentially growing signals.
- Left half-plane (LHP): $\sigma \lt 0$, representing exponentially decaying signals.
- Imaginary axis: $\sigma = 0$, representing sinusoidal signals with constant amplitude.

The complex frequency plane is crucial in various fields, including:

- Control systems: Analyzing system stability, designing controllers.
- Signal processing: Representing signals and systems in the frequency domain.
- Electrical engineering: Analyzing circuits and systems.
- Physics: Describing damped oscillations and resonances.

By plotting poles and zeros of a system on this plane, you can gain insights into its behavior, stability, and frequency response.

### Pole-Zero Diagram

A [pole–zero plot](https://en.wikipedia.org/wiki/Pole%E2%80%93zero_plot) is a graphical representation of a system's transfer function in the complex plane. It provides valuable insights into the system's behavior, stability, and frequency response. The diagram is plotted on the complex plane, with the real part on the horizontal axis ($\sigma$) and the imaginary part on the vertical axis ($j\omega$).

- Poles: These are the values of the complex variable 's' that make the transfer function infinite. They are represented by 'x' on the diagram.
- Zeros: These are the values of 's' that make the transfer function zero. They are represented by 'o' on the diagram.

#### Relative Count of Zeros vs. Poles

The relative count of zeros and poles in a transfer function significantly impacts the shape of the frequency response.

- Poles:
  - Each pole introduces a downward slope of -20 dB/decade. Multiple poles at the same frequency amplify this effect.
  - Each pole contributes a phase shift of -90 degrees. Multiple poles at the same frequency amplify this effect.  
- Zeros:
  - Each zero introduces an upward slope of +20 dB/decade. Multiple zeros at the same frequency amplify this effect.
  - Each zero contributes a phase shift of +90 degrees. Multiple zeros at the same frequency amplify this effect.
- Overall Slope:
  - If the number of zeros exceeds the number of poles, the magnitude plot will have a net upward slope.
  - If the number of poles exceeds the number of zeros, the magnitude plot will have a net downward slope.
  - A balanced number of zeros and poles can lead to a flat magnitude plot over certain frequency ranges.
- High-Frequency Asymptote:
  - The high-frequency asymptote of the magnitude plot is determined by the difference between the number of zeros and poles.
  - A larger number of zeros compared to poles will result in a steeper upward slope at high frequencies.
  - A larger number of poles compared to zeros will result in a steeper downward slope at high frequencies.
- Phase Shift:
  - The total phase shift at any frequency is the sum of the phase shifts contributed by each pole and zero.
  - A larger number of zeros compared to poles will result in a larger positive phase shift.
  - A larger number of poles compared to zeros will result in a larger negative phase shift.

The location of poles and zeros on the complex plane provides information about:

- Stability: If all poles are in the left half of the plane (LHP), the system is stable. If any pole is in the right half of the plane (RHP), the system is unstable.
- Frequency response: The distance of poles and zeros from the imaginary axis affects the system's gain and phase response at different frequencies.
- Time-domain behavior: The location of poles and zeros can influence the system's transient response and steady-state behavior.

### Step response

The [step response](https://en.wikipedia.org/wiki/Step_response) of a system is its output when the input is a sudden change from zero to a constant value. This constant value is often referred to as a "step" input. The system's behavior as it transitions from its initial state to a new steady-state condition is captured by the step response.

Several parameters are used to characterize a step response:

- Rise time: The time it takes for the output to go from 10% to 90% of its final value.
- Overshoot: The maximum amount by which the output exceeds the final value.
- Settling time: The time it takes for the output to settle within a specified percentage (e.g., 2%) of the final value.
- Steady-state error: The difference between the final value of the output and the desired output.

The step response provides valuable insights into a system's behavior:

- Stability: A stable system will eventually reach a steady-state value.
- Speed of response: The rise time indicates how quickly the system reacts to changes.
- Damping: Overshoot and settling time reveal information about the system's damping characteristics.

The step response is calculated by using the SciPy function [lsim](https://docs.scipy.org/doc/scipy/reference/generated/scipy.signal.lsim.html), which can be used to simulate output of a continuous-time linear system from the continuous-time linear time invariant system base class. The function lsim allows us to evaluate the performance characteristics of the circuit to square wave or arbitrary input signal input.  

### Group Delay {#sec-Group_delay}

[Group delay](https://en.wikipedia.org/wiki/Group_delay_and_phase_delay#) is a measure of the time delay experienced by a group of frequencies as they pass through a system. It's essentially the rate of change of the phase response with respect to frequency. Group Delay is important for the following reasons: 

- Signal distortion: Variations in group delay across different frequencies can cause signal distortion, affecting the quality of audio, video, and data transmission.
- System design: Understanding group delay is crucial for designing systems with linear phase characteristics, which minimize distortion.
- Pulse propagation: In fields like optics and telecommunications, group delay affects the shape and timing of pulses.

Group delay ($\tau_g$) is calculated as the negative derivative of the phase response ($\phi$) with respect to angular frequency ($\omega$):

$\tau _{g}(\omega )=-\frac  {d\phi (\omega)}{d\omega}$

A system with a constant group delay is called a linear phase system. These systems introduce a pure time delay to all frequency components without altering their relative phase relationships, preserving the original waveform shape. According to [Audibility of Group-Delay Equalization](https://acris.aalto.fi/ws/portalfiles/portal/66449704/Audibility_of_Group_Delay_Equalization.pdf), the threshold is 2 ms. The abstract for the paper states: 

> The audibility thresholds for group-delay variation from several previous related studies are shown in Fig. 1. If not otherwise stated, these studies have been conducted using headphones. Green applied Huffman sequences, or truncated impulse responses of second-order allpass filters, to study the audibility of phase distortion. He found a threshold value for the peak group delay of about 2 ms for center frequencies of 625 Hz, 1875 Hz, and 4062 Hz.

## Bypass path {#sec-Bypass_path}
The bypass path is controlled by the effect on/off switch S1A and S1B. The effect on/off switch is a DPDT (double pole, double throw, On-On, type, which are two switches operated by the same actuator). @fig-klon-centaur-schematic-high-res_w_bypass_highlight shows the bypass signal path highlighted. When switch S1A is in the effect-on postion, R27 is shorted and the wiper contact of P3 is directly connected to the output jack J2. Switch and S1B controls the current in D1, a red LED (Light Emmiting Diode) that indicates the postion of S1A. S1B also grounds the distortion diodes D2 and D3 when the switch is in the effects off (bypass) position. However, the effects signal can still travel to the output via the connections to U2A, see @sec-clean_tone_path1 and @sec-clean_tone_path2. When S1A is in the bypass postion, R26 is shorted and the bypass signal is directly conneted to the output jack.

This is not a true bypass, since the signal is buffered by Op Amp U1A and AC coupled by C1 and C2. The bypass signal is resistively summed with the signal from the wiper terminal of P3, the output level potentiomiter. S1A either shorts R26 or R27. In either case, the bypass signal or the effects signal is attenuated by 20dB or more depending on the rotational position of P3.  

The analysis below will look at: 

  - bypass path frequency response
  - effect signal leakage into bypass path
  - effects path frequency response from U2B to the output
  - bypass signal leakage into effects path

![Schematic of klon-centaur-schematic-high-res_w_bypass_highlight](klon-centaur-schematic-high-res_w_bypass_highlight.png){#fig-klon-centaur-schematic-high-res_w_bypass_highlight}

### Bypass path frequency response
The schematic below, @fig-Klon-Centaur_bypass_v1_sch shows the essential parts of the bypass circuit. We can look at this path independently of the rest of the circuit because the Op Amps, U1A and U2B, control the voltage at circuit nodes connected to their output terminals.  The circuit branches that start with components C3 and R5 || C4 can be ignored when analyzing the bypass path since the voltage at this node is controlled by the output of U1A. The current from the output of U1A is the sum of currents in the branched connected to the node. Superposition allows us to analyze these other currents independently. Since we are only interested in the bypass path we can ignore the other paths while keeping in mind that when we do this the current from U1A is missing the current from the other paths, but the voltage at this node is correct. Op Amp U2B can be replaced with the voltage source, V2.

The signal path, either the bypass signal or the effects signal, is a high pass filter with a very low corner frequency, which essentially blocks DC and passes audio frequencies higher than about 3 Hz. 

The operation of S1A is accounted for by changing the values of R26 and R27. Depending on the position of S1A, the value of R26 and R27 are alternatively either 0.01 or 68K $\Omega$. V1 is the bypass signal and V2 is the effects signal. From the way the schematic has been re-drawn, it should be clear that both the bypass and the effects signal are always connected to the output, by either 68k or the on position switch resistance, modeled here as a 0.01 $\Omega$ resistor.

R1 is a 10K $\Omega$ resistor and in some builds of the Klon Centaur, R1 is a wire jumper, and R2 is a 1000K $\Omega$ and connects the non-inverting input of Op Amp U1A to the virtual ground $V_g=4.5 V_{dc}$ and biases the input signal to the mid point of U1A's power supply rails. C1 is a 100n Farad capacitor who's function in the circuit is to block bias voltage from the virtual ground or any residual DC voltage present at the input jack, J1. R1, C1 and R2 form a high pass filter. C1 will prevent the bias voltage, $V_g$, from getting to J1 and adversely affecting any equipment that plugs into J1. The Centaur schematic indicates the value of R1 as 10k $\Omega$, but the value of 10k or sometimes zero if it is a jumper, is small when compared to the value of R2, which is 1000K $\Omega$, and the high pass corner frequency controlled by the value of R1, R2 and C1 is not influenced significantly by the value of R1.    

V1 is a voltage source that represents the input signal from the guitar or another pedal. The amplitude of this signal from the guitar pickups can range from almost zero to 0.5 Volts peak to peak depending on how the guitar's strings are strummed or plucked. The frequency range is from 80 Hz to 8 kHz. 

U1A is an TL072 Op Amp described in @sec-nonlinear_analysis and modeled in this section as an ideal Op Amp. The output of U1A is connected to C2, which continues the bypass path. C2 is a 4.7$\mu$ Farad capacitor together with R3, a 100k $\Omega$ resistor, forms a high pass filter who's corner frequency is $\omega=\frac{1}{R_3C_3}$.

The output of Op Amp U1A is also connected to the circuit branches of C3 and R5||C4 (|| is used to denote the parallel connection of the components) as well as C2. Since the Op Amp output is modeled as a voltage source, each of the connecting branches sees the same node voltage, labeled as node 5 below. We can employ the principle of superposition and ignore the branch currents in C3 and R5||C4. While U1A will source current equal to the sum of the connecting branch currents, the current in branches of C3 and R5||C4 don't effect the node voltages along the path starting with the C2 branch. The principle of superposition is described in more detail in @sec-effects_paths_linear_analysis.   

The output control, P3, is modeled as a voltage divider consisting of resistors with reference designators of Rp3a and Rp3b. The value of Rp3a is controlled by the equation $Rp3a=100k-R_{output}$ and the value of Rp3b is controlled by the equation $Rp3b=R_{output}$, with the variable $R_{output}$ indicating the value of the potentiometer set by the rotational position of the knob. 

R4 is a 560 $\Omega$ resistor that isolates the output of U1A from any short circuits to ground that might inadvertently be connected to the output jack, J2. R28 is a 100k $\Omega$ resistor used to provide a DC path to ground to discharge any stray voltage that might be present on the output jack from external equipment. It also prevents transients from occurring when S1A is toggled. R26 and R27 are 68k $\Omega$ resistors that are alternately shorted by S1A. When the pedal is is bypass mode, R26 is shorted and in the equations below, the value of R26 is set to 0.01 $\Omega$, which is the value being used in this analysis for the On resistance of S1A. In the bypass mode, R27 isolates the effects signal present at the wiper contact of P3. As described below, there is a small amount of signal leakage from the effects path into the bypass path.

The Output level is controlled by P3, a 100k $\Omega$ potentiometer.  In the circuit analysis presented below, I'm assuming that P3 has an audio taper, also described below. This makes the output level somewhat linear to the ear as P3 is rotated. R25 is a 560 $\Omega$ resistor that isolates the output of U2B from any short circuits to ground that might inadvertently be connected to the output jack, J2. C15 is a 4.7$\mu$ Farad capacitor together with R25 and P3, form a high pass filter who's corner frequency is $\omega=\frac{1}{R_{25} P_3 C_3}$. V2 is a voltage source that represents the effects signal from the pedal. 

The output of Op Amp U2B is the final amplifier in the effects signal path. In @fig-Klon-Centaur_bypass_v1_sch, the output of U2B is replaced by V2 for analysis. The output of U2B is a voltage source and controls the voltage at node 11. When analyzing the bypass path, V2 is set to zero. Later I'll look at the leakage of the effects signal into the bypass path by setting V1 to zero and examining the transfer function from V2 to node 2, the output.

![Schematic of bypass path](Klon-Centaur_bypass_v1.png){#fig-Klon-Centaur_bypass_v1_sch}

## more to come
6 Dec 2024 - this chapter is a work in progress. I'm estimating that I can upload a more complete version by mid Jan 2025. Most of the JupyterLab code is completed; I'm working on the narration.

