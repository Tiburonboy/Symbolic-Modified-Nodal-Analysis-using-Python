---
title: ""
format:
  html:
    code-fold: true
jupyter: python3
---
# Introduction {#sec-Introduction}    
Electrical circuit analysis and circuit theory is fundamental to electrical engineering and is usually one of the first courses taught to engineering students.  The purpose of this book is to describe a circuit analysis method called [Modified Nodal Analysis](https://en.wikipedia.org/wiki/Modified_nodal_analysis) (MNA) implemented in Python that can provide symbolic solutions for circuit analysis problems. The Python programming language along with its packages and libraries provide powerful computational tools that make solving math problems extremely easy with just a few lines of code. The Python library, SymPy, is used for symbolic mathematics and is the main library used to perform the types of circuit analysis problems described in this book.

For example, the following system of equations,

$- C_{1} s v_{2} + v_{1} \left(C_{1} s + C_{2} s + \frac{1}{R_{3}}\right) = 0$  
$- C_{1} s v_{1} + v_{2} \left(C_{1} s + \frac{1}{R_{2}}\right) - \frac{v_{3}}{R_{2}} = 0$  
$I_{V1} - \frac{v_{2}}{R_{2}} + \frac{v_{3}}{R_{2}} = 0$  
$v_{3} = V_{1}$ 

can be entered into Python to get the equations in matrix form:

```{python}
from sympy import *
import numpy as np
init_printing()

R2, C2, v1, C1, s, v3, v2, V1, R3, I_V1 = symbols(' R2  C2  v1  C1  s  v3  v2  V1  R3  I_V1 ')
A = Matrix([[C1*s + C2*s + 1/R3, -C1*s, 0, 0], [-C1*s, C1*s + 1/R2, -1/R2, 0], [0, -1/R2, 1/R2, 1], [0, 0, 1, 0]])
X = Matrix( [v1, v2, v3, I_V1] )
Z = Matrix( [0, 0, 0, V1] )

equ = Eq(A*X,Z)
equ
```

The matrix can be easily solved to obtain a solution in symbolic form:

```{python}
solve(equ,X)
```
The numeric values for the components can be substituted for the symbols (reference designators) and the following solution is obtained, where s is the Laplace variable:

```{python}
Values = {R2:1000, R3:1000, C1:1e-6, C2:10e-6, V1:1}
equ1a = equ.subs(Values)
solve(equ1a,X)
```

## JupyterLab
All the Python code is presented in JupyterLab notebooks. 

## Practical network size for symbolic solution
Test circuit 4 has 26 branches, 13 nodes, 18 resistors, 4 independent sources and 4 dependent sources. A symbolic solution for this problem was taking too long on my i3 computer, so I interrupted the kernel, and proceeded with a numerical solution, which can be solved quite quickly. Another circuit, shown below, that needed to be interrupted during the symbolic solution was the 100 Hz low pass elliptic function VCVS filter which contains zeros and poles. 

![Elliptic function VCVS LPF](Elliptic-function-VCVS-LPF.png)  

The net list for this circuit is:  
```
* Elliptic function VCVS LPF
R3 3 0 4750
R4 5 0 73.2e3
R1 4 1 9530
R2 5 4 9530
R7 2 7 10e3
C1 3 1 0.05e-6
C2 5 3 0.05e-6
C3 7 4 0.1e-6
C4 5 0 0.22e-6
C5 2 0 0.18e-6
O1 6 5 7
V1 1 0 1
R5 6 0 10e3
R6 7 6 44.2e3
```
The following circuit equations were generated by the MNA code: 

$- C_{1} s v_{3} + I_{V1} + v_{1} \left(C_{1} s + \frac{1}{R_{1}}\right) - \frac{v_{4}}{R_{1}} = 0$  
$v_{2} \left(C_{5} s + \frac{1}{R_{7}}\right) - \frac{v_{7}}{R_{7}} = 0$  
$- C_{1} s v_{1} - C_{2} s v_{5} + v_{3} \left(C_{1} s + C_{2} s + \frac{1}{R_{3}}\right) = 0$  
$- C_{3} s v_{7} + v_{4} \left(C_{3} s + \frac{1}{R_{2}} + \frac{1}{R_{1}}\right) - \frac{v_{5}}{R_{2}} - \frac{v_{1}}{R_{1}} = 0$  
$- C_{2} s v_{3} + v_{5} \left(C_{2} s + C_{4} s + \frac{1}{R_{4}} + \frac{1}{R_{2}}\right) - \frac{v_{4}}{R_{2}} = 0$  
$v_{6} \cdot \left(\frac{1}{R_{6}} + \frac{1}{R_{5}}\right) - \frac{v_{7}}{R_{6}} = 0$  
$- C_{3} s v_{4} + I_{O} + v_{7} \left(C_{3} s + \frac{1}{R_{7}} + \frac{1}{R_{6}}\right) - \frac{v_{2}}{R_{7}} - \frac{v_{6}}{R_{6}} = 0$  
$v_{1} = V_{1}$  
$- v_{5} + v_{6} = 0$  

After substituting numerical values for the components, the following solution for the voltage at node 2 was obtained.

$\frac{4.30028181226968 \cdot \left(1.0784981875 \cdot 10^{-10} s^{3} + 2.263375 \cdot 10^{-7} s^{2} + 0.000474999999999999 s + 1.0\right)}{1.50943922351291 \cdot 10^{-12} s^{4} + 4.7350839034956 \cdot 10^{-9} s^{3} + 4.53071325287237 \cdot 10^{-6} s^{2} + 0.00311443743767615 s + 1.0}$  


