<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.537">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Symbolic Modified Nodal Analysisusing Python - 37&nbsp; Klon Centaur, part 1</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Klon Centaur part 2 temp.html" rel="next">
<link href="./mech-sys.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Example-problems.html">Example problems</a></li><li class="breadcrumb-item"><a href="./Klon Centaur part 1.html"><span class="chapter-number">37</span>&nbsp; <span class="chapter-title">Klon Centaur, part 1</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Symbolic Modified Nodal Analysis<br>using Python</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About this book</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Theory.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Theory</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./SMNA_example.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">SMNA Example</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./SMNA-function.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">SMNA function</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./Validation-tests.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Validation tests</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./test_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Test 1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./test_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Test 2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./test_3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Test 3</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./test_4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Test 4</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./test_5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Test 5</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./test_6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Test 6</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./test_7.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Test 7</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./test_8.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Test 8</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./test_9.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Test 9</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./test_10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Test 10</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./test_11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Test 11</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./test_12.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Test 12</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./test_13.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Test 13</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./test_14.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Test 14</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./test_15.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Test 15</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./Example-problems.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Example problems</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Two amplifier RIAA Phono Preamp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Two amplifier RIAA phono preamp</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Two port parameters.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Two port parameters</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Thevenin equivalent circuit.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Thevenin equivalent circuit</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./State-variable-filter.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">State Variable Filter</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Superposition.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Superposition</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2nd_order_BRF.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">2nd Order BRF</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Elliptic-function-LPF.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Elliptic Function LPF</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Initial_conditions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Initial conditions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Transient_circuit.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Transient circuit</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Bridge-T.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Bridge-T</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Pi-Filter.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Pi Filter</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./SIDO-low-pass-filter.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">SIDO-low-pass-filter</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Super-node.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">Super node</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Phasor-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Phasor analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Modeling Op Amps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">Modeling Op Amps</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Op Amp circuits.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Op Amp circuits</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mech-sys.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title">Mechanical systems</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Klon Centaur part 1.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">37</span>&nbsp; <span class="chapter-title">Klon Centaur, part 1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Klon Centaur part 2 temp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">38</span>&nbsp; <span class="chapter-title">Klon Centaur, part 2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Klon Centaur part 3 temp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">39</span>&nbsp; <span class="chapter-title">Klon Centaur, part 3</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Wien bridge oscillator.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">40</span>&nbsp; <span class="chapter-title">Wien bridge oscillator</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Flyback circuit.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">41</span>&nbsp; <span class="chapter-title">Flyback circuit</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Diode circuit.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">42</span>&nbsp; <span class="chapter-title">Diode circuit</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Transistor circuit.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">43</span>&nbsp; <span class="chapter-title">Transistor circuit</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Bridged T-coil.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">44</span>&nbsp; <span class="chapter-title">Bridged T-coil</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./References.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./SymMNA_py.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">SymMNA.py</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Change-log.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Change Log</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Google Colab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Google Colab</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./SMNA_mobile.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">SMNA mobile</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./EasyEDA_schematic_editor.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">E</span>&nbsp; <span class="chapter-title">EasyEDA</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">37.1</span> Introduction</a></li>
  <li><a href="#electric-guitar-characteristics" id="toc-electric-guitar-characteristics" class="nav-link" data-scroll-target="#electric-guitar-characteristics"><span class="header-section-number">37.2</span> Electric guitar characteristics</a>
  <ul class="collapse">
  <li><a href="#body" id="toc-body" class="nav-link" data-scroll-target="#body"><span class="header-section-number">37.2.1</span> Body</a></li>
  <li><a href="#strings" id="toc-strings" class="nav-link" data-scroll-target="#strings"><span class="header-section-number">37.2.2</span> Strings</a></li>
  <li><a href="#pickups" id="toc-pickups" class="nav-link" data-scroll-target="#pickups"><span class="header-section-number">37.2.3</span> Pickups</a></li>
  <li><a href="#controls" id="toc-controls" class="nav-link" data-scroll-target="#controls"><span class="header-section-number">37.2.4</span> Controls</a></li>
  <li><a href="#amplifier" id="toc-amplifier" class="nav-link" data-scroll-target="#amplifier"><span class="header-section-number">37.2.5</span> Amplifier</a></li>
  <li><a href="#cabinet" id="toc-cabinet" class="nav-link" data-scroll-target="#cabinet"><span class="header-section-number">37.2.6</span> Cabinet</a></li>
  <li><a href="#tone" id="toc-tone" class="nav-link" data-scroll-target="#tone"><span class="header-section-number">37.2.7</span> Tone</a></li>
  <li><a href="#effects" id="toc-effects" class="nav-link" data-scroll-target="#effects"><span class="header-section-number">37.2.8</span> Effects</a></li>
  </ul></li>
  <li><a href="#klon-centaur-schematic" id="toc-klon-centaur-schematic" class="nav-link" data-scroll-target="#klon-centaur-schematic"><span class="header-section-number">37.3</span> Klon Centaur schematic</a>
  <ul class="collapse">
  <li><a href="#klon-centaur-interface" id="toc-klon-centaur-interface" class="nav-link" data-scroll-target="#klon-centaur-interface"><span class="header-section-number">37.3.1</span> Klon Centaur interface</a></li>
  </ul></li>
  <li><a href="#sec-web_circuit_analysis" id="toc-sec-web_circuit_analysis" class="nav-link" data-scroll-target="#sec-web_circuit_analysis"><span class="header-section-number">37.4</span> Klon Centaur Circuit analysis, blog/forum pages</a></li>
  <li><a href="#klon-centaur-price-and-availability" id="toc-klon-centaur-price-and-availability" class="nav-link" data-scroll-target="#klon-centaur-price-and-availability"><span class="header-section-number">37.5</span> Klon Centaur price and availability</a></li>
  <li><a href="#the-klon-ktr-a-pedalboard-friendly-redesign" id="toc-the-klon-ktr-a-pedalboard-friendly-redesign" class="nav-link" data-scroll-target="#the-klon-ktr-a-pedalboard-friendly-redesign"><span class="header-section-number">37.6</span> The Klon KTR: A Pedalboard-Friendly Redesign</a></li>
  <li><a href="#klon-centaur-clones" id="toc-klon-centaur-clones" class="nav-link" data-scroll-target="#klon-centaur-clones"><span class="header-section-number">37.7</span> Klon Centaur clones</a></li>
  <li><a href="#analysis-methodology" id="toc-analysis-methodology" class="nav-link" data-scroll-target="#analysis-methodology"><span class="header-section-number">37.8</span> Analysis methodology</a>
  <ul class="collapse">
  <li><a href="#frequency-response-plot" id="toc-frequency-response-plot" class="nav-link" data-scroll-target="#frequency-response-plot"><span class="header-section-number">37.8.1</span> Frequency Response Plot</a></li>
  <li><a href="#the-complex-frequency-plane" id="toc-the-complex-frequency-plane" class="nav-link" data-scroll-target="#the-complex-frequency-plane"><span class="header-section-number">37.8.2</span> The Complex Frequency Plane</a></li>
  <li><a href="#pole-zero-diagram" id="toc-pole-zero-diagram" class="nav-link" data-scroll-target="#pole-zero-diagram"><span class="header-section-number">37.8.3</span> Pole-Zero Diagram</a></li>
  <li><a href="#impulse-response" id="toc-impulse-response" class="nav-link" data-scroll-target="#impulse-response"><span class="header-section-number">37.8.4</span> Impulse Response</a></li>
  <li><a href="#step-response" id="toc-step-response" class="nav-link" data-scroll-target="#step-response"><span class="header-section-number">37.8.5</span> Step response</a></li>
  <li><a href="#sec-Group_delay" id="toc-sec-Group_delay" class="nav-link" data-scroll-target="#sec-Group_delay"><span class="header-section-number">37.8.6</span> Group Delay</a></li>
  </ul></li>
  <li><a href="#sec-Bypass_path" id="toc-sec-Bypass_path" class="nav-link" data-scroll-target="#sec-Bypass_path"><span class="header-section-number">37.9</span> Bypass path</a>
  <ul class="collapse">
  <li><a href="#bypass-path-frequency-response" id="toc-bypass-path-frequency-response" class="nav-link" data-scroll-target="#bypass-path-frequency-response"><span class="header-section-number">37.9.1</span> Bypass path frequency response</a></li>
  <li><a href="#effects-path-output-frequency-response" id="toc-effects-path-output-frequency-response" class="nav-link" data-scroll-target="#effects-path-output-frequency-response"><span class="header-section-number">37.9.2</span> Effects path output frequency response</a></li>
  </ul></li>
  <li><a href="#treble-control" id="toc-treble-control" class="nav-link" data-scroll-target="#treble-control"><span class="header-section-number">37.10</span> Treble control</a>
  <ul class="collapse">
  <li><a href="#symbolic-solution-1" id="toc-symbolic-solution-1" class="nav-link" data-scroll-target="#symbolic-solution-1"><span class="header-section-number">37.10.1</span> Symbolic solution</a></li>
  <li><a href="#transfer-function" id="toc-transfer-function" class="nav-link" data-scroll-target="#transfer-function"><span class="header-section-number">37.10.2</span> Transfer function</a></li>
  <li><a href="#dc-gain" id="toc-dc-gain" class="nav-link" data-scroll-target="#dc-gain"><span class="header-section-number">37.10.3</span> DC gain</a></li>
  <li><a href="#solve-p2-position-for-flat-treble-response" id="toc-solve-p2-position-for-flat-treble-response" class="nav-link" data-scroll-target="#solve-p2-position-for-flat-treble-response"><span class="header-section-number">37.10.4</span> Solve P2 position for flat treble response</a></li>
  <li><a href="#frequency-response-vs-p2" id="toc-frequency-response-vs-p2" class="nav-link" data-scroll-target="#frequency-response-vs-p2"><span class="header-section-number">37.10.5</span> Frequency response vs P2</a></li>
  <li><a href="#step-response-at-p250" id="toc-step-response-at-p250" class="nav-link" data-scroll-target="#step-response-at-p250"><span class="header-section-number">37.10.6</span> Step response at P2=50%</a></li>
  <li><a href="#polezero-locus-plot" id="toc-polezero-locus-plot" class="nav-link" data-scroll-target="#polezero-locus-plot"><span class="header-section-number">37.10.7</span> Pole/zero locus plot</a></li>
  </ul></li>
  <li><a href="#sec-effects_paths_linear_analysis" id="toc-sec-effects_paths_linear_analysis" class="nav-link" data-scroll-target="#sec-effects_paths_linear_analysis"><span class="header-section-number">37.11</span> Effects path linear analysis</a>
  <ul class="collapse">
  <li><a href="#sec-clean_tone_path1" id="toc-sec-clean_tone_path1" class="nav-link" data-scroll-target="#sec-clean_tone_path1"><span class="header-section-number">37.11.1</span> Clean tone path 1</a></li>
  <li><a href="#sec-clean_tone_path2" id="toc-sec-clean_tone_path2" class="nav-link" data-scroll-target="#sec-clean_tone_path2"><span class="header-section-number">37.11.2</span> Clean tone path 2</a></li>
  <li><a href="#sec-Distortion_path_part_A" id="toc-sec-Distortion_path_part_A" class="nav-link" data-scroll-target="#sec-Distortion_path_part_A"><span class="header-section-number">37.11.3</span> Distortion path part A</a></li>
  <li><a href="#sec-Distortion_path_part_B" id="toc-sec-Distortion_path_part_B" class="nav-link" data-scroll-target="#sec-Distortion_path_part_B"><span class="header-section-number">37.11.4</span> Distortion path part B</a></li>
  </ul></li>
  <li><a href="#overlay-amplitude-response-for-the-paths" id="toc-overlay-amplitude-response-for-the-paths" class="nav-link" data-scroll-target="#overlay-amplitude-response-for-the-paths"><span class="header-section-number">37.12</span> Overlay amplitude response for the paths</a>
  <ul class="collapse">
  <li><a href="#gain-setting-of-1" id="toc-gain-setting-of-1" class="nav-link" data-scroll-target="#gain-setting-of-1"><span class="header-section-number">37.12.1</span> Gain setting of 1%</a></li>
  <li><a href="#gain-setting-2.5" id="toc-gain-setting-2.5" class="nav-link" data-scroll-target="#gain-setting-2.5"><span class="header-section-number">37.12.2</span> gain setting 2.5%</a></li>
  <li><a href="#gain-setting-9.75" id="toc-gain-setting-9.75" class="nav-link" data-scroll-target="#gain-setting-9.75"><span class="header-section-number">37.12.3</span> gain setting 9.75%</a></li>
  <li><a href="#gain-setting-25" id="toc-gain-setting-25" class="nav-link" data-scroll-target="#gain-setting-25"><span class="header-section-number">37.12.4</span> gain setting 25%</a></li>
  <li><a href="#gain-setting-50" id="toc-gain-setting-50" class="nav-link" data-scroll-target="#gain-setting-50"><span class="header-section-number">37.12.5</span> gain setting 50%</a></li>
  <li><a href="#gain-setting-75" id="toc-gain-setting-75" class="nav-link" data-scroll-target="#gain-setting-75"><span class="header-section-number">37.12.6</span> gain setting 75%</a></li>
  <li><a href="#gain-setting-99" id="toc-gain-setting-99" class="nav-link" data-scroll-target="#gain-setting-99"><span class="header-section-number">37.12.7</span> gain setting 99%</a></li>
  </ul></li>
  <li><a href="#summary-for-part-1" id="toc-summary-for-part-1" class="nav-link" data-scroll-target="#summary-for-part-1"><span class="header-section-number">37.13</span> Summary for part 1</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Example-problems.html">Example problems</a></li><li class="breadcrumb-item"><a href="./Klon Centaur part 1.html"><span class="chapter-number">37</span>&nbsp; <span class="chapter-title">Klon Centaur, part 1</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">37</span>&nbsp; <span class="chapter-title">Klon Centaur, part 1</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>last update: 14 Mar 2025</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Some of the narration in the Introduction was generated by Google’s NotebookLM and Gemini, then modified by me.<br>
</li>
<li>This chapter is an early draft document
<ul>
<li>spell and grammar checking has not been completed</li>
<li>posted for test purposes<br>
</li>
<li>some cross references can’t be resolved until parts 2 and 3 are completed</li>
<li>text in bold red are notes for the author</li>
<li>The Quarto directive <code>code-fold</code> is set to true, which means that the Python code cells are not expanded. This makes the narrative stand out and easier to check for gaps in the written explanation. The cells containing code can be displayed by clicking on the <strong>Code</strong> button. In the header of this page the <strong>Code</strong> menu provides options for displaying or hiding all the code. When the code is hidden, only the output from the code is displayed. As you can see in this draft version, the written narrative is a bit sparse and the flow is broken up since when the code is displayed it provides the illusion of being self explanatory. I’m going to try to fix this as I continue to edit the document.</li>
</ul></li>
</ul>
</div>
</div>
<div id="fig-klon-centaur" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-klon-centaur-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Klon_Centaur.jpg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-klon-centaur-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;37.1: Klon Centaur, photo from Wikipedia, ArtBrom from Seattle, CC BY-SA 2.0
</figcaption>
</figure>
</div>
<!--

ToDo

- why Python?
  - plots 
  - analysis and calculations vs simulation as in LTSpice
  - what is happening and why (purpose) 
  - symbolic analysis of subcircuits
  - What LTSpice can't do
    - pole/zero analysis
- ~~check frequency response plot form, clarify notation and use of 'mag @ 1%'~~ 
- check format and axis labels of pole zero plot, make same as used in textbooks
- ~~state purpose and utility of IR, step response and group delay~~
- rename clean_path_v3 schematic to something like effect_path
  - rename schematics and move not used schematics to backup
- ~~think about doing analysis at gain setting of 50%~~
- change variable for real part of complex plane to $\sigma$ from $\alpha$
- need to fix the CW end of P1 pot, make this the 'a' end. 
- ~~re-check LTSpice results and plots~~
- update all schematics, rename some and move old schematics to backup folder
- ~~add comments to group delay plots~~
- render with code-fold: true to gauge how dialog flows w/ output only

Version history:

- 8/9/2024: finished with preliminary calculations and sections. Need to start working on dialog and cleaning up plots and calculations.
- 8/11/2024: writing dialog for bypass path
- 10/17/2024: Notebook divided into three parts, the file was getting too big for smooth editing and rendering.
- 11/3/2024: moving files to laptop for Bliss Nov 2024 cruise
- 12/1/2024: moving files to Crucial X9 and laptop for K-Dam Dec 2024 cruise 
- 12/3/2024: edits on HPL pre travel testing
- 1/xx/2025: moving files to laptop for Seattle travel 

-->
<section id="introduction" class="level2" data-number="37.1">
<h2 data-number="37.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">37.1</span> Introduction</h2>
<p>This analysis will illustrate the application of MNA, Python programming and LTSpice to an interesting circuit called the <a href="https://en.wikipedia.org/wiki/Klon_Centaur">Klon Centaur</a>. The schematics shown in this notebook were drawn using LTSpice and from those schematics, LTSpice was used to generate the netlists. Python and the MNA code was used to generate network equations from the netlists and obtain solutions for unknown voltages and currents. Transient analysis of the circuit was performed using LTSpice using device models for the diodes and Op Amps. This notebook will attempt to analyze and describe the operation of the various parts of the circuit, with the exception of the power supply.</p>
<p>As an electrical engineer, I’ve been curious about the workings of the electric guitar and the operation of the effects boxes. My motivation in writing this paper was to learn a little about the topic. I don’t play the guitar and I’m not a musician, so I’ll be looking at this topic from the point of view of signals and circuits.</p>
<p>Following the introduction section about the characteristics of the electric guitar and associated equipment, a description of the electrical schematic and the interfaces to the circuit (knobs and jacks) is provided. There are some on-line sources that are referenced which provide an analysis of the circuit, primarily utilizing LTSpice. These analyses are interesting since the perspective is somewhat different from what is provided in this notebook. A few words are provided about current price and availability of the pedal, the Klon KTR and Klon Centaur clones.</p>
<p>The analysis provided in this notebook is a deep dive into the operation of the circuit from the perspective of traditional linear circuit analysis taught in electrical engineering schools. The focus is on circuit analysis and not circuit design. This means looking at how the circuit works, since this is what circuit analysis is all about. The designers of the Klon Centaur were looking for a particular sound or tone profile and in some places I’ll comment on reasons why the designers might have developed these circuits; but for the most part I’ll not be looking at why the circuit works in a particular way, but how it works.</p>
<!--
~~A combination of Python and LTSpice will be used in the analysis.~~ 
~~The use of Python and MNA allows symbolic solutions for small sub-circuits of the Klon Centaur to be obtained. From the symbolic solutions, the circuit components can be related to the pole/zero analysis of the sub-circuits. This provides a some insight to the operation of the circuit.~~ 
-->
<p>The Klon Centaur is an overdrive pedal and the top of the pedal is shown in <a href="#fig-klon-centaur" class="quarto-xref">Figure&nbsp;<span>37.1</span></a>. The Klon Centaur is widely used in many genres of music, including blues, rock and country. An overdrive pedal is a piece of electronic equipment used by guitarists to alter the sound of the guitar. It’s essentially a box containing a circuit that is connected between the guitar and the amplifier, often with other pedals in series, and these pedals control the amount of gain, distortion, tone and output level delivered to the amplifier.<br>
Bill Finnegan, owner of Klon LLC, and the Klon Centaur creator, wanted to make a pedal that would recreate the sound of a guitar amplifier’s distortion at high volume. Finnegan wasn’t a fan of the sound of the popular <a href="https://www.ibanez.com/usa/products/model/tube_screamer/">Ibanez Tube Screamer</a>, which many guitarists use for overdrive. He felt it sounded too artificial and buzzy. So he set out to create a pedal that would deliver a more natural, tube-like overdrive sound with rich harmonics. The pedal was designed to have a “big, open” sound with “a hint of tube clipping” that wouldn’t sound like it was made by a pedal. Just to clarify, Klon is the company name and Centuar is the name of the pedal and since the Klon only had one product, the product became known as the Klon Centaur. Over the production life of the Centaur, the color of the case and the centaur logo has changed.</p>
<p>Finnegan worked with MIT graduate Fred Fenning and other electrical engineer friends for four and a half years to create prototype pedals. A Germanium diode was chosen by Finnegan for the circuit and he bought as many as he could, since these were a special type that he determined sounded more musical than others he tested. These diodes are no longer in production. The components of the circuit were coated in epoxy resin to make reverse engineering of the circuit more difficult. The Klon Centaur was first sold in late 1994. Finnegan personally built, tested and shipped the pedals from his house, where he was inundated with orders. Many of the components, including the cast enclosure and knobs were custom manufactured. Over the course of 15 years, Finnegan sold about 8,000 pedals. See <a href="https://decibelics.com/klon-guide/">The Klon Centaur Guide</a> for a thorough and informative history of the Klon.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Notebook organization: The analysis of the Klon Centaur circuits ended up being rather long. Navigating and rendering of the notebook became a bit sluggish on my laptop, so I decided to break up the notebook into three parts.</p>
<ul>
<li>Klon Centaur, part 1: Introduction and Effects path linear analysis</li>
<li>Klon Centaur, part 2: Effects path nonlinear analysis</li>
<li>Klon Centaur, part 3: Design Review and Reactive branch analysis</li>
</ul>
</div>
</div>
</section>
<section id="electric-guitar-characteristics" class="level2" data-number="37.2">
<h2 data-number="37.2" class="anchored" data-anchor-id="electric-guitar-characteristics"><span class="header-section-number">37.2</span> Electric guitar characteristics</h2>
<p>An electric guitar is a type of guitar that relies on electrical amplification to produce sound. Electric guitars are known for the wide variety of tones they can produce. By using effects pedals and manipulating the knobs on the guitar and amplifier, musicians can create sounds ranging from clean and bright to distorted and heavy. This versatility has made the electric guitar a popular instrument in many genres of music, including rock, blues, country and jazz.</p>
<p>An electric guitar isn’t just the guitar. While the wooden body, neck and strings are essential components, they only produce a very faint sound on their own. The essential parts for the electric guitar are:</p>
<ol type="1">
<li>The Guitar: This is where the musical performance originates. The player’s technique, the strings’ vibration and the guitar’s construction all contribute to the initial sound. However, the sound produced by the guitar alone is very quiet and lacks the power and character we associate with electric guitars.</li>
<li>The Amplifier: This electronic device takes the tiny electrical signals from the guitar’s pickups and boosts them to a much higher volume level. It also shapes the sound, adding characteristics like warmth, brightness, or distortion.</li>
<li>The Speaker: This is the final link in the chain, converting the amplified electrical signal into sound waves that we can hear. Different speakers produce different tones and the size and design of the speaker cabinet significantly impacts the overall sound.</li>
</ol>
<p>In essence, the electric guitar, amplifier and speaker work together as a system to produce the rich, varied and powerful sounds that define this instrument. Each component plays a crucial role in shaping the final sound. The combination of these elements is what makes the electric guitar such a versatile and expressive instrument.</p>
<p>The components of an electric guitar, all of which contribute to the tone are described below in more detail:</p>
<section id="body" class="level3" data-number="37.2.1">
<h3 data-number="37.2.1" class="anchored" data-anchor-id="body"><span class="header-section-number">37.2.1</span> Body</h3>
<p>The electric guitar body is the foundation of the instrument, providing a sturdy platform for attaching the neck, strings, pickups, electronics and bridge. Electric guitar bodies come in a wide variety of shapes, each with its own distinct look and tonal characteristics. Some of the most popular and iconic shapes include:</p>
<ul>
<li>Stratocaster: Contoured double-cutaway body with three pickups. Known for its bright, twangy sound and versatility across various genres.</li>
<li>Telecaster: Solid body with a single-cutaway design and typically two pickups. Known for its twangy, bright tone and bite.</li>
<li>Les Paul: Solid body with a carved top, typically two humbucker pickups. Known for its warm, thick and sustain-rich tone.</li>
<li>Gibson SG: Solid body with a “horns” design and typically two humbucker pickups. Known for its comfortable, lightweight design and bright, punchy tone.</li>
</ul>
<p>The type of wood used for the guitar body plays a significant role in its tone. Some of the most common body woods include:</p>
<ul>
<li>Mahogany: A popular choice for both solid and semi-hollow bodies, known for its warm, woody tone with good sustain.</li>
<li>Alder: A popular choice for Stratocasters and Telecasters, known for its bright, balanced tone.</li>
<li>Ash: Lighter than mahogany with a brighter, more scooped tone. Often used on Fender guitars.</li>
<li>Basswood: A lightweight wood often used on budget guitars, with a neutral tone that can take EQ well.</li>
<li>Poplar: Another affordable wood with a neutral tone, commonly used on budget guitars.</li>
</ul>
<p>Electric guitar bodies can be constructed in two main ways:</p>
<ul>
<li>Solid body: The most common type, made from a single piece of wood or laminated pieces of wood. Offers good sustain and resonance.</li>
<li>Semi-hollow body: Has a hollow core with solid wood tops and backs. Offers a warmer, more resonant tone than solid bodies, but with less sustain.</li>
</ul>
</section>
<section id="strings" class="level3" data-number="37.2.2">
<h3 data-number="37.2.2" class="anchored" data-anchor-id="strings"><span class="header-section-number">37.2.2</span> Strings</h3>
<p>The electric guitar uses pickups to convert the vibrations of the steel strings into electrical signals. There are many different types of electric guitar strings available, each with its own unique sound. Some of the most common types of strings include:</p>
<ul>
<li>Round wound strings: These are the most popular type of electric guitar string. They have a bright, clear sound and are very versatile.</li>
<li>Flat wound strings: These strings have a smooth, mellow sound. They are often used by jazz guitarists.</li>
<li>Nickel-plated steel strings: These strings are bright and warm-sounding. They are a popular choice for many different genres of music.</li>
<li>Stainless steel strings: These strings are bright and have a long lifespan. They are often used by rock and metal guitarists.</li>
</ul>
<p>When a string is strummed or plucked, it vibrates and interactacts with the magnetic field of the pickup. The vibrations and movement of the steel string in close proximity to the ends of the magnets in the pickup cause the vibrations to be impressed on the magnetic field which causes a voltage to be induced in the wire wound around the magnets. The strings vibrate at different frequencies depending on their thickness, length and tension. The thicker the string, the lower the pitch and frequency. An electric guitar typically has six strings. The thickest string is the low E string and the thinnest string is the high E string. The fundamental of the low E string is about 80 Hz. The frequency range of interest would start at 80 Hz and go up to the sixth harmonic of the highest note on the high E string, or about 7.8kHz. <a href="https://www.musicguymixing.com/guitar-frequency-range/">Guitar Frequency Range Chart</a> talks about using an equalized frequency range of 150 Hz up to 5 to 8 kHz. In the analysis that follows an audio range of 80 to 8kHz will be highlighted as the electric guitar audio band.</p>
</section>
<section id="pickups" class="level3" data-number="37.2.3">
<h3 data-number="37.2.3" class="anchored" data-anchor-id="pickups"><span class="header-section-number">37.2.3</span> Pickups</h3>
<p>There are different types of pickups, each with its own sound. There are two main types of electric guitar pickups: single-coil and Humbucker.</p>
<ul>
<li>Single-coil pickups are known for their bright, clear and often crisp sound. However, they are also susceptible to electrical hum, which is a low-level buzzing sound that can be caused by electromagnetic interference.</li>
<li>Humbucker pickups are made with two coils that are wired out of phase with each other. This helps to cancel out the hum that is common with single-coil pickups. Humbuckers tend to have a thicker, fuller sound than single-coils.</li>
</ul>
<p>The position of a pickup in the guitar also affects its sound. Pickups that are closer to the bridge tend to have a brighter sound, while pickups that are closer to the neck tend to have a warmer, fuller sound. Electric guitar pickups come in a wide variety of styles and designs, each with its own unique sound. Some of the most popular brands of electric guitar pickups include Seymour Duncan, DiMarzio, EMG and Fender.</p>
<p>Electric guitar pickups typically have a high impedance, around 10kΩ, which can make them susceptible to noise pickup over long cables. Most electric guitars use passive pickups, which rely on the vibration of the strings to induce a current in the pickup coil. This results in a relatively weak signal with low output voltage.</p>
</section>
<section id="controls" class="level3" data-number="37.2.4">
<h3 data-number="37.2.4" class="anchored" data-anchor-id="controls"><span class="header-section-number">37.2.4</span> Controls</h3>
<p>Electric guitars typically have pickup selector switches and tone/volume knobs.</p>
<ul>
<li>Pickup selector switch: This switch allows you to select which pickups will be active and sent to the amplifier. The most common types of pickup selector switches are 3-way and 5-way switches.
<ul>
<li>3-way switch: This is commonly found on Gibson Les Paul guitars. It typically has positions for the bridge pickup only, neck pickup only and both pickups combined.</li>
<li>5-way switch: This is commonly found on Fender Stratocaster guitars. It typically has positions for the bridge pickup only, bridge and middle pickups combined, middle pickup only, neck and middle pickups combined and neck pickup only.</li>
</ul></li>
<li>Tone/Volume knobs: These are knobs that allow you to control the volume and tone of the signal sent from the pickups to the amplifier.
<ul>
<li>Volume knob: This knob controls the overall output level of the guitar. Turning it up increases the volume and turning it down decreases the volume.</li>
<li>Tone knob: This knob controls the treble (high frequencies) of the signal. Turning it up allows more treble to pass through, resulting in a brighter sound. Turning it down cuts the treble, resulting in a warmer sound. Some guitars may have multiple tone knobs, allowing for independent control over the treble of different pickups.</li>
</ul></li>
</ul>
<p>These switches and knobs are crucial for shaping the electric guitar’s sound. By manipulating the pickup selection and tone/volume controls, guitarists can create a wide variety of tones, from bright and twangy to warm and thick.</p>
</section>
<section id="amplifier" class="level3" data-number="37.2.5">
<h3 data-number="37.2.5" class="anchored" data-anchor-id="amplifier"><span class="header-section-number">37.2.5</span> Amplifier</h3>
<p>An electric guitar amplifier, often simply called an amp, is an electronic device that takes the weak electrical signal produced by an electric guitar’s pickups and amplifies the signal such that it can be heard through a speaker. There are two main types of electric guitar amplifiers:</p>
<ul>
<li>Tube amplifiers: These classic amps use vacuum tubes to pre-amplify and power the signal. Tube amps are prized for their warm, rich sound and responsiveness to playing dynamics. However, they tend to be more expensive, heavier and more delicate than solid-state amps.</li>
<li>Solid-state amplifiers: These amps use transistors to amplify the signal. Solid-state amps are generally more affordable, lighter and more durable than tube amps. They can also produce a wide variety of tones, making them versatile for many genres of music.</li>
<li>Modeling amps: These amps use digital technology to model the sound of classic tube amps and other effects pedals. Modeling amps are very versatile and can be a great way to get a wide variety of tones without having to buy a lot of equipment.</li>
<li>Combo amps: These amps combine the amplifier and speaker in a single unit. They are typically more portable and affordable than stacks, making them a good choice for beginners and practice.</li>
</ul>
</section>
<section id="cabinet" class="level3" data-number="37.2.6">
<h3 data-number="37.2.6" class="anchored" data-anchor-id="cabinet"><span class="header-section-number">37.2.6</span> Cabinet</h3>
<p>An electric guitar cabinet, also known as a speaker cabinet or simply a cab, is an enclosure that houses one or more loudspeakers. It is an essential component of an electric guitar amplifier setup. The Cabinet is the housing that encloses the speakers. The cabinet is typically made of wood, such as plywood or MDF (medium-density fiberboard) and is designed to resonate at certain frequencies to color the sound of the speakers. There are Open-back and Closed-back cabinets. Open-back cabinets tend to produce a brighter, more airy sound, while closed-back cabinets produce a tighter, more focused sound with more bass. The number of speakers in a cabinet affects its overall volume and tone. A 4x12 cabinet with four 12-inch speakers is a popular choice for rock and metal guitarists who need a lot of volume and bottom end. A 1x12 cabinet with a single 12-inch speaker is a more portable option that is still loud enough for practice and small gigs.</p>
</section>
<section id="tone" class="level3" data-number="37.2.7">
<h3 data-number="37.2.7" class="anchored" data-anchor-id="tone"><span class="header-section-number">37.2.7</span> Tone</h3>
<p>The electric guitar tone is the overall sound produced by the instrument, influenced by a combination of factors including:</p>
<ul>
<li>Electric guitar components:
<ul>
<li>Pickups: These magnetic devices convert the vibrations of the strings into an electrical signal.</li>
<li>Effects: Electric guitar effects are electronic devices that modify the sound of an electric guitar. They can be used to create a wide variety of tones, from subtle to extreme. Effects pedals are typically individual units that are controlled by foot switches. They can be chained together to create complex effects. Multi-effects processors combine the functionality of many different pedals into a single unit.</li>
<li>Amp: Tube amps are known for their warm, rich sound and responsiveness to playing dynamics, while solid-state amps are more versatile and can produce a wider variety of tones. The settings on the amplifier, such as gain, EQ and reverb, will significantly impact the overall tone.</li>
<li>Cabinet: An electric guitar cabinet, also known as a speaker cabinet or simply a cab, is a wooden enclosure that houses one or more loudspeakers. It is designed to project the amplified sound of an electric guitar. Guitar cabinets are passive devices, meaning that they don’t require their own power source to function. Instead, they rely on the power from an electric guitar amplifier.</li>
</ul></li>
<li>Playing technique:
<ul>
<li>Picking technique: How you pick the strings (pickups closer to the bridge or neck, pick attack strength) can affect the brightness, attack and overall character of the tone.</li>
<li>String bending: Bending strings adds pitch variations and vibrato to your sound.</li>
<li>Effects pedals: These electronic devices can add a wide variety of effects to your tone, such as distortion, overdrive, chorus, delay and reverb.</li>
</ul></li>
<li>Microphone: Miking an electric guitar cab involves placing a microphone in front of the speaker cabinet to capture the sound of the amplified guitar. This technique is commonly used in live performances and studio recordings to capture the full body and character of the electric guitar tone.</li>
<li>Mixing console: Live performance mixing consoles, also known as live sound mixers, are electronic devices used to control and manipulate the sounds of multiple microphones and instruments during a live performance. They are the central hub of a sound system for concerts, public speeches, theatrical productions and other live events.</li>
</ul>
<p>Here are some common electric guitar tones and how they are achieved:</p>
<ul>
<li>Clean tone: A bright, clear tone with minimal distortion or amplification. Achieved with low gain settings on the amp and single-coil pickups.</li>
<li>Overdrive: A warmer, more saturated tone than clean, with a slight amount of grit and breakup. Achieved with higher gain settings on the amp or with overdrive pedals.</li>
<li>Distortion: A heavily amplified and distorted sound, often used for rock and metal music. Achieved with high gain settings on the amp or with distortion pedals.</li>
<li>Blues tone: Often characterized by a clean or slightly overdriven tone with a warm midrange emphasis. Achieved with single-coil pickups and tube amps with moderate gain settings.</li>
</ul>
</section>
<section id="effects" class="level3" data-number="37.2.8">
<h3 data-number="37.2.8" class="anchored" data-anchor-id="effects"><span class="header-section-number">37.2.8</span> Effects</h3>
<p>Electric guitar effects pedals are electronic devices that alter the electrical signal of the guitar to create new and unique sounds. They are inserted between the guitar and your amplifier, allowing modification of the basic sound of the instrument in a variety of ways. There are a vast number of different effects pedals available, but some of the most common and popular types include:</p>
<ul>
<li>Distortion and overdrive pedals: These pedals add grit, saturation and sustain to the guitar sound. Distortion is generally heavier than overdrive, but both can be used to create a wide range of rock and metal tones.</li>
<li>Fuzz pedals: These pedals create a thick, fuzzy distortion sound that is often associated with psychedelic rock and garage rock.</li>
<li>Wah-wah pedals: These pedals create a vocal-like “wah-wah” sound by sweeping a band of frequencies up and down as the pedal is rocked. They are often used in funk, blues and rock music.</li>
<li>Delay pedals: These pedals create echo effects by recording a short sample of the signal and then playing it back a few milliseconds later. Delay pedals can be used to add depth, space and atmosphere to the sound.</li>
<li>Reverb pedals: These pedals simulate the natural reverberation of sound in a room or hall. Reverb can add depth, ambience and atmosphere to the sound.</li>
<li>Chorus pedals: These pedals create a lush, shimmering sound by duplicating the signal and slightly detuning it. Chorus is often used to add thickness and body to clean tones.</li>
<li>Flanger pedals: These pedals create a swirling, jet-like sound by splitting your signal and delaying one side slightly. Flangers are often used to add texture and movement to the sound.</li>
<li>Phaser pedals: These pedals create a phasing effect by splitting the signal and feeding it through two slightly out-of-phase filters. Phasers can create a subtle warbling or pulsating sound.</li>
<li>Equalizer (EQ) pedals: These pedals allow you to boost or cut specific frequencies in your signal. EQ pedals can be used to shape the tone and correct for tonal imbalances.</li>
</ul>
<p>The Klon Centaur is a type of distortion pedal. Distortion is usually achieved by some type of nonlinear signal processing such as clipping or limiting the amplitude of the guitar signal, which creates harmonic overtones. The amount of distortion that a pedal creates puts it into a typical category or type. An overdrive pedal creates a relatively moderate amount of distortion. A pedal producing a bit more distortion is called a distortion pedal and a pedal producing an extreme amount of distortion is called a fuzz pedal.</p>
</section>
</section>
<section id="klon-centaur-schematic" class="level2" data-number="37.3">
<h2 data-number="37.3" class="anchored" data-anchor-id="klon-centaur-schematic"><span class="header-section-number">37.3</span> Klon Centaur schematic</h2>
<p>The Klon Centaur circuit board was originally covered with a black epoxy resin to prevent people from replicating it. The community at <a href="https://www.freestompboxes.org/">freestompboxes.org</a> bought a Centaur and sent it to Martin Chittum to analyze. Martin was able to remove the black epoxy resin, trace the circuit and identify all of the components. The schematic was publicly released online in April 2008. Several modifications needed to be made to the schematic, with a final corrected version released in May 2009. Martin Chittum’s <a href="https://guitargearfinder.com/wp-content/uploads/2018/11/klon-centaur-schematic-high-res.jpg">Klon Centaur schematic</a> is regarded as accurate. Production of the Klon Centaur stopped soon after Martin Chittum’s schematic was published and clones became available.</p>
<div id="fig-Chittum_Klon_sch" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-Chittum_Klon_sch-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="klon-centaur-schematic-high-res.jpg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-Chittum_Klon_sch-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;37.2: Martin Chittum’s Klon Centaur schematic
</figcaption>
</figure>
</div>
<p>The Op Amp U2A is configured as a summing amplifier that combines the signal from two clean paths and the path containing the diodes, D2 and D3. The paths have reactive components that are shaping the frequency response of the signal and it is not obvious how these circuits are shaping the tone. This is one reason why this pedal has a mystic surrounding it and almost a cult following.</p>
<section id="klon-centaur-interface" class="level3" data-number="37.3.1">
<h3 data-number="37.3.1" class="anchored" data-anchor-id="klon-centaur-interface"><span class="header-section-number">37.3.1</span> Klon Centaur interface</h3>
<p>The Klon Centaur has a simple yet effective control layout.</p>
<ul>
<li>Knobs, these correspond to P1, P2 and P3 in the schematic, <a href="#fig-Chittum_Klon_sch" class="quarto-xref">Figure&nbsp;<span>37.2</span></a>.
<ul>
<li>GAIN: This control significantly influences the pedal’s tone and character. At low gain settings it provides clean boost. At medium Gain Settings the overdrive is increased. At high gain setting the overdrive is more aggressive.</li>
<li>TREBLE: The treble control boosts or cuts frequencies above 200Hz.</li>
<li>OUTPUT: The output control on a Klon Centaur is primarily used to adjust the overall volume level of the pedal.</li>
</ul></li>
<li>Switch S1 is the bypass ON or effects ON switch.</li>
<li>Red LED, D1 in the schematic: illuminated when the effect is on.</li>
</ul>
<p>The Klon Centaur uses a standard 9-volt battery as the internal power source, but also has a jack for external 9 volt power. This is indicated as BAT1 in the schematic.</p>
<p>There are three jacks on the Klon Centaur chassis, these are:</p>
<ul>
<li>IN (J1 in the schematic): The signal input. This is a standard 1/4-inch guitar input jack.</li>
<li>OUT (J2 in the schematic): This is also a standard 1/4-inch output jack, used to connect the pedal to the amplifier or other effects.</li>
<li>9V (The DC jack in the schematic): The Klon Centaur uses a unique 1/8” (3.5mm) mini jack power connector for external power (if a battery is not used). This is different from the standard center-negative 2.1mm barrel jack found on most pedals.</li>
</ul>
</section>
</section>
<section id="sec-web_circuit_analysis" class="level2" data-number="37.4">
<h2 data-number="37.4" class="anchored" data-anchor-id="sec-web_circuit_analysis"><span class="header-section-number">37.4</span> Klon Centaur Circuit analysis, blog/forum pages</h2>
<p>There are a variety of online sites that explain how the circuit operates, among these are:</p>
<ul>
<li><a href="https://www.electrosmash.com/klon-centaur-analysis">ElectroSmash</a>: This website provides a detailed breakdown of the Klon Centaur circuit, highlighting unique features and explaining how different sections contribute to the overall sound.</li>
<li><a href="https://www.coda-effects.com/p/klon-centaur-circuit-analysis.html">Klon Centaur circuit analysis</a>: Circuit description.</li>
<li><a href="https://www.freestompboxes.org/viewtopic.php?t=31222">DIYstompboxes forum</a>: While discussions here acknowledge the complexity of the circuit and the lack of a purely mathematical approach, some users delve into specific aspects and component functions.</li>
<li><a href="https://www.premierguitar.com/gear/bill-finnegan-klon">Builder Profile: Klon’s Bill Finnegan</a>: Interview and design history.</li>
</ul>
<p>The Klon Centaur’s design is thought to be a mixture of basic circuit design <del>known for its blend of theoretical understanding</del>and “ear-based” adjustments. So, while the resources above offer valuable insights, the complete picture might involve a combination of electrical theory and the designer’s experimentation. I could not find a good description of the signal path for what I’m calling the clean tone path 2, see <a href="#sec-clean_tone_path2" class="quarto-xref"><span>Section 37.11.2</span></a>.</p>
</section>
<section id="klon-centaur-price-and-availability" class="level2" data-number="37.5">
<h2 data-number="37.5" class="anchored" data-anchor-id="klon-centaur-price-and-availability"><span class="header-section-number">37.5</span> Klon Centaur price and availability</h2>
<p>The initial price of a Klon Centaur in 1994 was 225 dollars. The price increased over time and by 2007 a Klon Centaur cost 329 dollars. The price of used Klon Centaur pedals began to increase because people did not want to wait for a new one. Currently used Klon Centaurs are selling for thousands of dollars on eBay.</p>
</section>
<section id="the-klon-ktr-a-pedalboard-friendly-redesign" class="level2" data-number="37.6">
<h2 data-number="37.6" class="anchored" data-anchor-id="the-klon-ktr-a-pedalboard-friendly-redesign"><span class="header-section-number">37.6</span> The Klon KTR: A Pedalboard-Friendly Redesign</h2>
<p>The Klon KTR is a redesigned version of the Klon Centaur overdrive pedal, released in 2014 by Bill Finnegan. Finnegan’s aim with the KTR was to create a pedal that retained the sound of the original Centaur while addressing some of the production and practicality issues of the original design. One of his main goals was to make the KTR easier to manufacture, so he opted for a design that could be built by a contracted manufacturing firm. This involved using surface-mount components for most of the parts, with the exception of the germanium clipping diodes. He also wanted to make the KTR more pedalboard-friendly, so he chose a smaller enclosure than the original Centaur. The KTR features a standard DC jack and a switchable buffer bypass. Importantly, Finnegan maintained the use of the original Klon Centaur germanium clipping diodes in the KTR. The KTR initially sold for $269. Finnegan included the text “Kindly remember: The ridiculous hype that offends so many is not of my making” on the pedal. The Klon KTR is no longer in production.</p>
</section>
<section id="klon-centaur-clones" class="level2" data-number="37.7">
<h2 data-number="37.7" class="anchored" data-anchor-id="klon-centaur-clones"><span class="header-section-number">37.7</span> Klon Centaur clones</h2>
<p>The Klon Centaur is a legendary overdrive pedal widely regarded as the “holy grail” of overdrive by many guitarists. There are many Klon Centaur clones available on the market that try to capture the sound of the original. Here are some of the popular Klon Centaur clones:</p>
<ul>
<li><a href="https://moskyaudio.com/product/products-8-4.html">Mosky Silver Horse Overdrive Boost-Function</a>: This is a budget-friendly option that captures the Klon Centaur’s warm overdrive sound. It has gain and sustain, making it great for solos. Prices are typically $48.</li>
<li><a href="https://warmaudio.com/centavo/">Warm Audio Centavo Overdrive Pedal</a>: This clone is known for its high quality and accurate reproduction of the Klon Centaur sound. It also includes a mod switch for extending the low-end response. It currently costs $179.</li>
<li><a href="https://www.tonepedia.com/catalog/effects-and-pedals/overdrive-and-boost/bad-horse-overdrive/">Tone City Bad Horse Overdrive</a>: This is another well-regarded Klon clone that is known for its accurate sound and small size. It has a rating of 4.80 out of 5 based on 51 user reviews and currently costs $54.</li>
<li><a href="https://www.stewmac.com/kits-and-projects/electronic-kits/pedals-and-mod-kits/stewmac-ghost-drive-pedal-kit/">StewMac Ghost Drive Pedal Kit</a>: This is a great option for those who want to build their own Klon clone. It has a rating of 4.91 out of 5 based on 210 user reviews and costs $125.</li>
<li><a href="https://www.moskyaudio.com/product/product-22-912.html">Mosky Golden Horse</a>: This is a popular Klon clone that is known for its transparent overdrive sound and ease of use. It is also very compact. Prices typically are around $39.</li>
<li><a href="https://bentfishbowl.wixsite.com/electronics/post/clown-centurion">Clown Centurion</a>: A DIY implementation with some circuit simplification.</li>
<li><a href="https://jhspedals.info/products/notaklon">NOTAKLÖN</a>: A kit for a no-solder clone for $99.</li>
</ul>
</section>
<section id="analysis-methodology" class="level2" data-number="37.8">
<h2 data-number="37.8" class="anchored" data-anchor-id="analysis-methodology"><span class="header-section-number">37.8</span> Analysis methodology</h2>
<div id="fig-Klon-Centaur_sch" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-Klon-Centaur_sch-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Klon-Centaur_v1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-Klon-Centaur_sch-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;37.3: Schematic used for the Python analysis
</figcaption>
</figure>
</div>
<p>The analysis of the circuit in <a href="#fig-Klon-Centaur_sch" class="quarto-xref">Figure&nbsp;<span>37.3</span></a> will use some symbolic analysis and primarily numerical methods to solve a system of equations to obtain solutions of the node voltages. The circuit analysis relies on using <a href="https://en.wikipedia.org/wiki/Laplace_transform">Laplace transformed</a> circuit elements. This means that the analysis is performed in the frequency domain where linear algebra and matrix inversions are used to solve for the unknown voltages and currents. This method avoids having to deal with differential equations.</p>
<p><a href="https://www.analog.com/en/design-center/design-tools-and-calculators/ltspice-simulator.html">LTSpice</a> was used to draw the schematics of the circuits and generate the netlist. This helps to ensure that the netlist is correct. The component values in the netlist were manually edited to use scientific notation and the Op Amp entries were fixed to use the Op Amp component type.</p>
<p>The analysis begins with generating the network equations from the circuit’s netlist by calling:</p>
<blockquote class="blockquote">
<p><code>report, network_df, df2, A, X, Z = SymMNA.smna(net_list)</code></p>
</blockquote>
<p>The function <code>SymMNA.smna()</code> is described in <a href="SMNA-function.html" class="quarto-xref"><span>Chapter 4</span></a> and the source listing is shown in <a href="SymMNA_py.html" class="quarto-xref"><span>Appendix A</span></a>.</p>
<p>Key techniques used in the analysis are described in the following sections:</p>
<!--
- circuit description, where did the schematic used for analysis come from? I redrew the schematic using LTSpice and omitted parts of the circuit not related to my analysis. Omitted are the power supply and V+ is drawn as a ground since it is an AC ground. nodes are labeled. Op Amps are ideal, Pots P1 and P2 are drawn as individual resistors. Drawn for analysis, no power supply, v+, the 4.5V virtual ground replaced by the AC ground, Ideal Op Amp, diode model from the internet.
  - description
    - overview, power supply, Op Amps, Diodes, circuit paths
    - same ref designators as in original schematic, except for pots which are named as Rp1a for value between terminals 1 and 2 for example.
    - mysterious path, see @sec-clean_tone_path2
- circuit analysis steps: What about Op Amps and diodes?
  - draw circuit in LTSpice: original schematic source (see reference)
    - explain the LTSpice schematic and derived from the Martin Chittum’s Klon Centaur schematic
    - Klon-Centaur.asc - fix schematic, add labels
  - ideal Op Amps and no diodes, looking at just the effects of the passive components, in the frequency domain
  - replace split rail 9V with AC ground
  - MNA
    - linear analysis
    - symbolic analysis
    - Numerical analysis
    - What are these and why are they used?: Bode, impulse, step, poles and zeros, group delay
- Signal paths
  - bypass
    - isolation between bypass and effects
  - effect
    - output
    - treble
    - clean tone paths
    - distortion path
  - nonlinear analysis
    - Op Amp and diode model
    - AC analysis
    - transient analysis
      - sinusoidal
      - step
    - Op Amp signal levels
  - MNA and LTSpice results comparison, @sec-Comparison_of_MNA_and_LTSpice_results
  - subcircuit analysis, @sec-Analysis_of_reactive_branches
    - U1b filter network
    - diode filtering
    - clean path 1
    - clean path 2 
- Summary
  - uniqueness
  - design review comments
  - inspired by circuits
-->
<section id="frequency-response-plot" class="level3" data-number="37.8.1">
<h3 data-number="37.8.1" class="anchored" data-anchor-id="frequency-response-plot"><span class="header-section-number">37.8.1</span> Frequency Response Plot</h3>
<p>A <a href="https://en.wikipedia.org/wiki/Frequency_response">frequency response</a> plot is a graphical representation of how a system responds to different input frequencies. It’s a valuable tool in various fields, including engineering, audio, and signal processing. Typically, a frequency response plot shows two key characteristics of a system:</p>
<ol type="1">
<li>Magnitude Response: This indicates how much the system amplifies or attenuates different frequencies. It’s often plotted in decibels (dB) on a logarithmic scale.</li>
<li>Phase Response: This shows the phase shift introduced by the system at different frequencies. It’s usually plotted in degrees or radians.</li>
</ol>
<p>By analyzing a frequency response plot, you can determine:</p>
<ul>
<li>Bandwidth: The range of frequencies a system can process effectively.</li>
<li>Gain: The amount of amplification or attenuation at specific frequencies.</li>
<li>Phase shift: The delay introduced by the system at different frequencies.</li>
<li>Resonance: Peaks in the magnitude response indicating frequencies where the system amplifies strongly.</li>
<li>Stability: Whether a system is stable or unstable based on the phase margin.</li>
</ul>
</section>
<section id="the-complex-frequency-plane" class="level3" data-number="37.8.2">
<h3 data-number="37.8.2" class="anchored" data-anchor-id="the-complex-frequency-plane"><span class="header-section-number">37.8.2</span> The Complex Frequency Plane</h3>
<p>The <a href="https://en.wikipedia.org/wiki/Complex_plane">complex frequency</a> plane is a two-dimensional space where complex numbers represent frequency. Unlike the real-world concept of frequency, which is a scalar value representing the rate of oscillation, complex frequency adds a dimension of complexity. It’s represented by the symbol <span class="math inline">\(s\)</span> and is defined as:</p>
<p><span class="math inline">\(s=\sigma+j\omega\)</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(\sigma\)</span> is the real part, representing exponential growth or decay.</li>
<li><span class="math inline">\(j\)</span> is the imaginary unit <span class="math inline">\(\sqrt{-1}\)</span>.</li>
<li><span class="math inline">\(\omega\)</span> is the imaginary part, representing the angular frequency (related to the frequency in Hertz).</li>
</ul>
<p>The complex frequency plane is divided into four quadrants:</p>
<ul>
<li>Right half-plane (RHP): <span class="math inline">\(\sigma \gt 0\)</span>, representing exponentially growing signals.</li>
<li>Left half-plane (LHP): <span class="math inline">\(\sigma \lt 0\)</span>, representing exponentially decaying signals.</li>
<li>Imaginary axis: <span class="math inline">\(\sigma = 0\)</span>, representing sinusoidal signals with constant amplitude.</li>
</ul>
<p>The complex frequency plane is crucial in various fields, including:</p>
<ul>
<li>Control systems: Analyzing system stability, designing controllers.</li>
<li>Signal processing: Representing signals and systems in the frequency domain.</li>
<li>Electrical engineering: Analyzing circuits and systems.</li>
<li>Physics: Describing damped oscillations and resonances.</li>
</ul>
<p>By plotting poles and zeros of a system on this plane, you can gain insights into its behavior, stability, and frequency response.</p>
</section>
<section id="pole-zero-diagram" class="level3" data-number="37.8.3">
<h3 data-number="37.8.3" class="anchored" data-anchor-id="pole-zero-diagram"><span class="header-section-number">37.8.3</span> Pole-Zero Diagram</h3>
<p>A <a href="https://en.wikipedia.org/wiki/Pole%E2%80%93zero_plot">pole–zero plot</a> is a graphical representation of a system’s transfer function in the complex plane. It provides valuable insights into the system’s behavior, stability, and frequency response. The diagram is plotted on the complex plane, with the real part on the horizontal axis (<span class="math inline">\(\sigma\)</span>) and the imaginary part on the vertical axis (<span class="math inline">\(j\omega\)</span>).</p>
<ul>
<li>Poles: These are the values of the complex variable ‘s’ that make the transfer function infinite. They are represented by ‘x’ on the diagram.</li>
<li>Zeros: These are the values of ‘s’ that make the transfer function zero. They are represented by ‘o’ on the diagram.</li>
</ul>
<section id="relative-count-of-zeros-vs.-poles" class="level4" data-number="37.8.3.1">
<h4 data-number="37.8.3.1" class="anchored" data-anchor-id="relative-count-of-zeros-vs.-poles"><span class="header-section-number">37.8.3.1</span> Relative Count of Zeros vs.&nbsp;Poles</h4>
<p>The relative count of zeros and poles in a transfer function significantly impacts the shape of the frequency response.</p>
<ul>
<li>Poles:
<ul>
<li>Each pole introduces a downward slope of -20 dB/decade. Multiple poles at the same frequency amplify this effect.</li>
<li>Each pole contributes a phase shift of -90 degrees. Multiple poles at the same frequency amplify this effect.<br>
</li>
</ul></li>
<li>Zeros:
<ul>
<li>Each zero introduces an upward slope of +20 dB/decade. Multiple zeros at the same frequency amplify this effect.</li>
<li>Each zero contributes a phase shift of +90 degrees. Multiple zeros at the same frequency amplify this effect.</li>
</ul></li>
<li>Overall Slope:
<ul>
<li>If the number of zeros exceeds the number of poles, the magnitude plot will have a net upward slope.</li>
<li>If the number of poles exceeds the number of zeros, the magnitude plot will have a net downward slope.</li>
<li>A balanced number of zeros and poles can lead to a flat magnitude plot over certain frequency ranges.</li>
</ul></li>
<li>High-Frequency Asymptote:
<ul>
<li>The high-frequency asymptote of the magnitude plot is determined by the difference between the number of zeros and poles.</li>
<li>A larger number of zeros compared to poles will result in a steeper upward slope at high frequencies.</li>
<li>A larger number of poles compared to zeros will result in a steeper downward slope at high frequencies.</li>
</ul></li>
<li>Phase Shift:
<ul>
<li>The total phase shift at any frequency is the sum of the phase shifts contributed by each pole and zero.</li>
<li>A larger number of zeros compared to poles will result in a larger positive phase shift.</li>
<li>A larger number of poles compared to zeros will result in a larger negative phase shift.</li>
</ul></li>
</ul>
<p>The location of poles and zeros on the complex plane provides information about:</p>
<ul>
<li>Stability: If all poles are in the left half of the plane (LHP), the system is stable. If any pole is in the right half of the plane (RHP), the system is unstable.</li>
<li>Frequency response: The distance of poles and zeros from the imaginary axis affects the system’s gain and phase response at different frequencies.</li>
<li>Time-domain behavior: The location of poles and zeros can influence the system’s transient response and steady-state behavior.</li>
</ul>
</section>
</section>
<section id="impulse-response" class="level3" data-number="37.8.4">
<h3 data-number="37.8.4" class="anchored" data-anchor-id="impulse-response"><span class="header-section-number">37.8.4</span> Impulse Response</h3>
<p>The <a href="https://en.wikipedia.org/wiki/Impulse_response">impulse response</a> of a system is its output when presented with a brief input signal called an impulse. An impulse is an idealized signal that has infinite amplitude and infinitely short duration, but with a total area of one. The impulse response can be obtained from the transfer function by using the SciPy function <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.signal.impulse.html">impulse</a>. However, for the analysis of the Klon Centaur, I don’t find the impulse response of the transfer functions to be that informative. Using SciPy, the impulse response is easy to calculate and plot, but I couldn’t relate the shape of the impulse response back to the circuit in an intuitive way. All the impulse responses looked very similar and they were not insightful. Additionally, using the impulse response along with the convolution function did not produce correct results since the <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.signal.convolve.html">SciPy convolve</a> and <a href="https://numpy.org/doc/stable/reference/generated/numpy.convolve.html">Numpy convolve</a> functions seemed to treat the signal and circuit as a discrete time system. For this reason, the impulse of the transfer functions are not included in the analysis.</p>
<!--
The impulse response is a fundamental concept in system analysis and has several key applications:

- Convolution: Any input signal can be represented as a sum of scaled and shifted impulses. By convolving the input signal with the impulse response, we can determine the system's output.
- System identification: By measuring the impulse response, we can characterize a system without knowing its internal structure.
- Filter design: Impulse responses can be used to design filters with specific frequency characteristics.
- Room acoustics: Impulse responses are used to capture the acoustic characteristics of a room, which is essential for audio processing and virtual reality applications.

In essence, the impulse response is a fingerprint of a system, providing valuable information about its behavior and enabling various signal processing techniques.

Impulse Response: A System's Fingerprint

An impulse response is a fundamental concept in signal processing and system analysis. It essentially reveals how a system reacts to a very short, sharp input signal, often called an impulse. This response can provide valuable insights into the system's behavior, particularly its frequency response and time-domain characteristics.  

Key Uses of Impulse Response:

System Identification: 
By measuring a system's impulse response, engineers can characterize its properties, such as its frequency response, phase response, and time delay.

This information is crucial for understanding how a system will behave under different input conditions.
-->
</section>
<section id="step-response" class="level3" data-number="37.8.5">
<h3 data-number="37.8.5" class="anchored" data-anchor-id="step-response"><span class="header-section-number">37.8.5</span> Step response</h3>
<p>The <a href="https://en.wikipedia.org/wiki/Step_response">step response</a> of a system is its output when the input is a sudden change from zero to a constant value. This constant value is often referred to as a “step” input. The system’s behavior as it transitions from its initial state to a new steady-state condition is captured by the step response.</p>
<p>Several parameters are used to characterize a step response:</p>
<ul>
<li>Rise time: The time it takes for the output to go from 10% to 90% of its final value.</li>
<li>Overshoot: The maximum amount by which the output exceeds the final value.</li>
<li>Settling time: The time it takes for the output to settle within a specified percentage (e.g., 2%) of the final value.</li>
<li>Steady-state error: The difference between the final value of the output and the desired output.</li>
</ul>
<p>The step response provides valuable insights into a system’s behavior:</p>
<ul>
<li>Stability: A stable system will eventually reach a steady-state value.</li>
<li>Speed of response: The rise time indicates how quickly the system reacts to changes.</li>
<li>Damping: Overshoot and settling time reveal information about the system’s damping characteristics.</li>
</ul>
<p>The step response is calculated by using the SciPy function <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.signal.lsim.html">lsim</a>, which can be used to simulate output of a continuous-time linear system from the continuous-time linear time invariant system base class. The function <code>lsim</code> allows us to evaluate the performance characteristics of the circuit to square wave or arbitrary input signal input.</p>
</section>
<section id="sec-Group_delay" class="level3" data-number="37.8.6">
<h3 data-number="37.8.6" class="anchored" data-anchor-id="sec-Group_delay"><span class="header-section-number">37.8.6</span> Group Delay</h3>
<p><a href="https://en.wikipedia.org/wiki/Group_delay_and_phase_delay#">Group delay</a> is a measure of the time delay experienced by a group of frequencies as they pass through a system. It’s essentially the rate of change of the phase response with respect to frequency. Group Delay is important for the following reasons:</p>
<ul>
<li>Signal distortion: Variations in group delay across different frequencies can cause signal distortion, affecting the quality of audio, video, and data transmission.</li>
<li>System design: Understanding group delay is crucial for designing systems with linear phase characteristics, which minimize distortion.</li>
<li>Pulse propagation: In fields like optics and telecommunications, group delay affects the shape and timing of pulses.</li>
</ul>
<p>Group delay (<span class="math inline">\(\tau_g\)</span>) is calculated as the negative derivative of the phase response (<span class="math inline">\(\phi\)</span>) with respect to angular frequency (<span class="math inline">\(\omega\)</span>):</p>
<p><span class="math inline">\(\tau _{g}(\omega )=-\frac  {d\phi (\omega)}{d\omega}\)</span></p>
<p>A system with a constant group delay is called a linear phase system. These systems introduce a pure time delay to all frequency components without altering their relative phase relationships, preserving the original waveform shape. According to <a href="https://acris.aalto.fi/ws/portalfiles/portal/66449704/Audibility_of_Group_Delay_Equalization.pdf">Audibility of Group-Delay Equalization</a>, the threshold is 2 ms. The abstract for the paper states:</p>
<blockquote class="blockquote">
<p>The audibility thresholds for group-delay variation from several previous related studies are shown in Fig. 1. If not otherwise stated, these studies have been conducted using headphones. Green applied Huffman sequences, or truncated impulse responses of second-order allpass filters, to study the audibility of phase distortion. He found a threshold value for the peak group delay of about 2 ms for center frequencies of 625 Hz, 1875 Hz, and 4062 Hz.</p>
</blockquote>
<p>The following Python modules are used in this notebook.</p>
<div id="e90560b1-89df-48a6-b4d7-ec74b3a19ff1" class="cell" data-jupyter="{&quot;outputs_hidden&quot;:false}" data-execution_count="160">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sympy <span class="im">import</span> <span class="op">*</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> signal</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.ticker</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> SymMNA</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> display, Markdown, Math, Latex</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>init_printing()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="sec-Bypass_path" class="level2" data-number="37.9">
<h2 data-number="37.9" class="anchored" data-anchor-id="sec-Bypass_path"><span class="header-section-number">37.9</span> Bypass path</h2>
<p>The bypass path is controlled by the effect on/off switch S1A and S1B. The effect on/off switch is a DPDT (double pole, double throw, On-On, type, which are two switches operated by the same actuator). <a href="#fig-klon-centaur-schematic-high-res_w_bypass_highlight" class="quarto-xref">Figure&nbsp;<span>37.4</span></a> shows the bypass signal path highlighted. When switch S1A is in the effect-on position, R27 is shorted and the wiper contact of P3 is directly connected to the output jack J2. Switch S1B controls the current in D1, a red LED (Light Emitting Diode) that indicates the position of S1A. S1B also grounds the distortion diodes D2 and D3 when the switch is in the effects off (bypass) position. However, the effects signal can still travel to the output via the connections to U2A, see <a href="#sec-clean_tone_path1" class="quarto-xref"><span>Section 37.11.1</span></a> and <a href="#sec-clean_tone_path2" class="quarto-xref"><span>Section 37.11.2</span></a>. When S1A is in the bypass position, R26 is shorted and the bypass signal is directly connected to the output jack.</p>
<p>This is not a true bypass, since the signal is buffered by Op Amp U1A and AC coupled by C1 and C2. The bypass signal is resistively summed with the signal from the wiper terminal of P3, the output level potentiometer. S1A either shorts R26 or R27. In either case, the bypass signal or the effects signal is attenuated by 20dB or more depending on the rotational position of P3.</p>
<p>The analysis below will look at:</p>
<ul>
<li>bypass path frequency response</li>
<li>effect signal leakage into bypass path</li>
<li>effects path frequency response from U2B to the output</li>
<li>bypass signal leakage into effects path</li>
</ul>
<!--
- include original schematic with highlight circuit parts covered in analysis.
- description of schematic
- analysis circuit description
- theory of operation
- update schematic, P3 is OUTPUT not level, check CW orientation and equations
- plots
  - bypass path
  - effects leakage into bypass path
  - effects path
  - bypass leakage into effects path
-->
<div id="fig-klon-centaur-schematic-high-res_w_bypass_highlight" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-klon-centaur-schematic-high-res_w_bypass_highlight-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="klon-centaur-schematic-high-res_w_bypass_highlight.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-klon-centaur-schematic-high-res_w_bypass_highlight-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;37.4: Klon Centaur schematic with bypass circuit highlighted.
</figcaption>
</figure>
</div>
<section id="bypass-path-frequency-response" class="level3" data-number="37.9.1">
<h3 data-number="37.9.1" class="anchored" data-anchor-id="bypass-path-frequency-response"><span class="header-section-number">37.9.1</span> Bypass path frequency response</h3>
<p>The schematic below, <a href="#fig-Klon-Centaur_bypass_v1_sch" class="quarto-xref">Figure&nbsp;<span>37.5</span></a> shows the essential parts of the bypass circuit. We can look at this path independently of the rest of the circuit because the Op Amps, U1A and U2B, control the voltage at circuit nodes connected to their output terminals. The circuit branches that start with components C3 and R5 || C4 can be ignored when analyzing the bypass path since the voltage at this node is controlled by the output of U1A. The current from the output of U1A is the sum of currents in the branch connected to the node. Superposition allows us to analyze these other currents independently. Since we are only interested in the bypass path we can ignore the other paths while keeping in mind that when we do this the current from U1A is missing the current from the other paths, but the voltage at this node is correct. Op Amp U2B can be replaced with the voltage source, V2.</p>
<p>The signal path, either the bypass signal or the effects signal, is a high pass filter with a very low corner frequency, which essentially blocks DC and passes audio frequencies higher than about 3 Hz.</p>
<p>The operation of S1A is accounted for by changing the values of R26 and R27. Depending on the position of S1A, the value of R26 and R27 are alternatively either 0.01 or 68K <span class="math inline">\(\Omega\)</span>. V1 is the bypass signal and V2 is the effects signal. From the way the schematic has been redrawn, it should be clear that both the bypass and the effects signal are always connected to the output, by either 68k or the on position switch resistance, modeled here as a 0.01 <span class="math inline">\(\Omega\)</span> resistor.</p>
<p>R1 is a 10K <span class="math inline">\(\Omega\)</span> resistor and in some builds of the Klon Centaur, R1 is a wire jumper, and R2 is a 1000K <span class="math inline">\(\Omega\)</span> and connects the non-inverting input of Op Amp U1A to the virtual ground <span class="math inline">\(V_g=4.5 V_{dc}\)</span> and biases the input signal to the midpoint of U1A’s power supply rails. C1 is a 100n Farad capacitor who’s function in the circuit is to block bias voltage from the virtual ground or any residual DC voltage present at the input jack, J1. R1, C1 and R2 form a high pass filter. C1 will prevent the bias voltage, <span class="math inline">\(V_g\)</span>, from getting to J1 and adversely affecting any equipment that plugs into J1. The Centaur schematic indicates the value of R1 as 10k <span class="math inline">\(\Omega\)</span>, but the value of 10k or sometimes zero if it is a jumper, is small when compared to the value of R2, which is 1000K <span class="math inline">\(\Omega\)</span>, and the high pass corner frequency controlled by the value of R1, R2 and C1 is not influenced significantly by the value of R1.</p>
<p>V1 is a voltage source that represents the input signal from the guitar or another pedal. The amplitude of this signal from the guitar pickups can range from almost zero to 0.5 Volts peak to peak depending on how the guitar’s strings are strummed or plucked. The frequency range is from 80 Hz to 8 kHz.</p>
<p>U1A is a TL072 Op Amp described in <span class="quarto-unresolved-ref">?sec-nonlinear_analysis</span> and modeled in this section as an ideal Op Amp. The output of U1A is connected to C2, which continues the bypass path. C2 is a 4.7<span class="math inline">\(\mu\)</span> Farad capacitor together with R3, a 100k <span class="math inline">\(\Omega\)</span> resistor, forms a high pass filter who’s corner frequency is <span class="math inline">\(\omega=\frac{1}{R_3C_3}\)</span>.</p>
<p>The output of Op Amp U1A is also connected to the circuit branches of C3 and R5||C4 (|| is used to denote the parallel connection of the components) as well as C2. Since the Op Amp output is modeled as a voltage source, each of the connecting branches sees the same node voltage, labeled as node 5 below. We can employ the principle of superposition and ignore the branch currents in C3 and R5||C4. While U1A will source current equal to the sum of the connecting branch currents, the current in branches of C3 and R5||C4 doesn’t affect the node voltages along the path starting with the C2 branch. The principle of superposition is described in more detail in <a href="#sec-effects_paths_linear_analysis" class="quarto-xref"><span>Section 37.11</span></a>.</p>
<p>The output control, P3, is modeled as a voltage divider consisting of resistors with reference designators of Rp3a and Rp3b. The value of Rp3a is controlled by the equation <span class="math inline">\(Rp3a=100k-R_{output}\)</span> and the value of Rp3b is controlled by the equation <span class="math inline">\(Rp3b=R_{output}\)</span>, with the variable <span class="math inline">\(R_{output}\)</span> indicating the value of the potentiometer set by the rotational position of the knob.</p>
<p>R4 is a 560 <span class="math inline">\(\Omega\)</span> resistor that isolates the output of U1A from any short circuits to ground that might inadvertently be connected to the output jack, J2. R28 is a 100k <span class="math inline">\(\Omega\)</span> resistor used to provide a DC path to ground to discharge any stray voltage that might be present on the output jack from external equipment. It also prevents transients from occurring when S1A is toggled. R26 and R27 are 68k <span class="math inline">\(\Omega\)</span> resistors that are alternately shorted by S1A. When the pedal is bypass mode, R26 is shorted and in the equations below, the value of R26 is set to 0.01 <span class="math inline">\(\Omega\)</span>, which is the value being used in this analysis for the On resistance of S1A. In the bypass mode, R27 isolates the effects signal present at the wiper contact of P3. As described below, there is a small amount of signal leakage from the effects path into the bypass path.</p>
<p>The Output level is controlled by P3, a 100k <span class="math inline">\(\Omega\)</span> potentiometer. In the circuit analysis presented below, I’m assuming that P3 has an audio taper, also described below. This makes the output level somewhat linear to the ear as P3 is rotated. R25 is a 560 <span class="math inline">\(\Omega\)</span> resistor that isolates the output of U2B from any short circuits to ground that might inadvertently be connected to the output jack, J2. C15 is a 4.7<span class="math inline">\(\mu\)</span> Farad capacitor together with R25 and P3, form a high pass filter who’s corner frequency is <span class="math inline">\(\omega=\frac{1}{R_{25} P_3 C_3}\)</span>. V2 is a voltage source that represents the effects signal from the pedal.</p>
<p>The output of Op Amp U2B is the final amplifier in the effects signal path. In <a href="#fig-Klon-Centaur_bypass_v1_sch" class="quarto-xref">Figure&nbsp;<span>37.5</span></a>, the output of U2B is replaced by V2 for analysis. The output of U2B is a voltage source and controls the voltage at node 11. When analyzing the bypass path, V2 is set to zero. Later I’ll look at the leakage of the effects signal into the bypass path by setting V1 to zero and examining the transfer function from V2 to node 2, the output.</p>
<div id="fig-Klon-Centaur_bypass_v1_sch" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-Klon-Centaur_bypass_v1_sch-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Klon-Centaur_bypass_v1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-Klon-Centaur_bypass_v1_sch-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;37.5: The LTSpice schematic of the bypass path which generated the netlist.
</figcaption>
</figure>
</div>
<section id="symbolic-solution" class="level4" data-number="37.9.1.1">
<h4 data-number="37.9.1.1" class="anchored" data-anchor-id="symbolic-solution"><span class="header-section-number">37.9.1.1</span> Symbolic solution</h4>
<p>The following section of this notebook presents calculations that are used to find the poles and zeros of the system using symbolic calculations. This allows us to determine which components influence the values of the poles and zeros. The netlist for the schematic in <a href="#fig-Klon-Centaur_bypass_v1_sch" class="quarto-xref">Figure&nbsp;<span>37.5</span></a> was generated by LTSpice and shown below. Notice that the value of the Level control potentiometer is set in a position where the values of Rp3a and Rp3b are equal and have a value of 5k. As described later, I will assume that P3 has a logarithmic taper and this type of pot is usually called an audio pot. Notice that in the netlist, V2 is assigned a value of zero.</p>
<div id="1d4a61d6-a767-4561-a384-c1bf169f2c66" class="cell" data-execution_count="161">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>bypass_v1_net_list <span class="op">=</span> <span class="st">'''</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="st">* Klon-Centaur_bypass_v1.asc</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="st">V1 1 0 1</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="st">R1 3 1 10e3</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="st">R2 0 4 1000e3</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="st">C1 4 3 100e-9</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="st">O1a 5 4 5</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="st">R3 6 0 100e3</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="st">R4 7 6 560</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="st">R28 0 2 100e3</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="st">C2 5 6 4.7e-6</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="st">R27 2 9 68e3</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="st">Rp3b 9 0 5e3</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="st">Rp3a 8 9 5e3</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="st">R25 8 10 560</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="st">C15 11 10 4.7e-6</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="st">V2 11 0 0</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="st">R26 2 7 0.01</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="st">'''</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Call the symbolic modified nodal analysis function.</p>
<div id="f3013e27-e54d-4c69-8a22-012d882e37e1" class="cell" data-execution_count="162">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>report, network_df, i_unk_df, A, X, Z <span class="op">=</span> SymMNA.smna(bypass_v1_net_list)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The element values can be loaded into a Python dictionary variable.</p>
<div id="f1d0d4b6-a4e7-4b79-be12-bbb2ab2c6018" class="cell" data-execution_count="163">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>element_values <span class="op">=</span> SymMNA.get_part_values(network_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Build and display the network equations.</p>
<div id="d2396d4b-e024-402d-8c17-953c14b9ef71" class="cell" data-execution_count="164">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Put matrices into SymPy </span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> Matrix(X)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>Z <span class="op">=</span> Matrix(Z)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>NE_sym <span class="op">=</span> Eq(A<span class="op">*</span>X,Z)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># display the equations</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>temp <span class="op">=</span> <span class="st">''</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(shape(NE_sym.lhs)[<span class="dv">0</span>]):</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">+=</span> <span class="st">'$</span><span class="sc">{:s}</span><span class="st"> = </span><span class="sc">{:s}</span><span class="st">$&lt;br&gt;'</span>.<span class="bu">format</span>(latex(NE_sym.rhs[i]),latex(NE_sym.lhs[i]))</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>Markdown(temp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="164">
<p><span class="math inline">\(0 = I_{V1} + \frac{v_{1}}{R_{1}} - \frac{v_{3}}{R_{1}}\)</span><br><span class="math inline">\(0 = v_{2} \cdot \left(\frac{1}{R_{28}} + \frac{1}{R_{27}} + \frac{1}{R_{26}}\right) - \frac{v_{9}}{R_{27}} - \frac{v_{7}}{R_{26}}\)</span><br><span class="math inline">\(0 = - C_{1} s v_{4} + v_{3} \left(C_{1} s + \frac{1}{R_{1}}\right) - \frac{v_{1}}{R_{1}}\)</span><br><span class="math inline">\(0 = - C_{1} s v_{3} + v_{4} \left(C_{1} s + \frac{1}{R_{2}}\right)\)</span><br><span class="math inline">\(0 = C_{2} s v_{5} - C_{2} s v_{6} + I_{O1a}\)</span><br><span class="math inline">\(0 = - C_{2} s v_{5} + v_{6} \left(C_{2} s + \frac{1}{R_{4}} + \frac{1}{R_{3}}\right) - \frac{v_{7}}{R_{4}}\)</span><br><span class="math inline">\(0 = v_{7} \cdot \left(\frac{1}{R_{4}} + \frac{1}{R_{26}}\right) - \frac{v_{6}}{R_{4}} - \frac{v_{2}}{R_{26}}\)</span><br><span class="math inline">\(0 = v_{8} \cdot \left(\frac{1}{Rp3a} + \frac{1}{R_{25}}\right) - \frac{v_{9}}{Rp3a} - \frac{v_{10}}{R_{25}}\)</span><br><span class="math inline">\(0 = v_{9} \cdot \left(\frac{1}{Rp3b} + \frac{1}{Rp3a} + \frac{1}{R_{27}}\right) - \frac{v_{8}}{Rp3a} - \frac{v_{2}}{R_{27}}\)</span><br><span class="math inline">\(0 = - C_{15} s v_{11} + v_{10} \left(C_{15} s + \frac{1}{R_{25}}\right) - \frac{v_{8}}{R_{25}}\)</span><br><span class="math inline">\(0 = - C_{15} s v_{10} + C_{15} s v_{11} + I_{V2}\)</span><br><span class="math inline">\(V_{1} = v_{1}\)</span><br><span class="math inline">\(V_{2} = v_{11}\)</span><br><span class="math inline">\(0 = - v_{4} + v_{5}\)</span><br></p>
</div>
</div>
<p>Turn the free symbols into SymPy variables.</p>
<div id="6a14992a-86ef-4144-aba4-1748eb2e11a1" class="cell" data-execution_count="165">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>var(<span class="bu">str</span>(NE_sym.free_symbols).replace(<span class="st">'{'</span>,<span class="st">''</span>).replace(<span class="st">'}'</span>,<span class="st">''</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="165">
<p><span class="math inline">\(\displaystyle \left( v_{6}, \  R_{3}, \  R_{2}, \  v_{1}, \  I_{V2}, \  v_{10}, \  R_{4}, \  V_{1}, \  R_{28}, \  Rp3a, \  v_{9}, \  v_{2}, \  s, \  v_{11}, \  v_{8}, \  R_{27}, \  C_{2}, \  v_{3}, \  I_{O1a}, \  R_{26}, \  I_{V1}, \  v_{4}, \  v_{7}, \  Rp3b, \  v_{5}, \  R_{25}, \  C_{15}, \  V_{2}, \  R_{1}, \  C_{1}\right)\)</span></p>
</div>
</div>
<p>The network equations can be solved symbolically using the SymPy function, solve. The solution takes about one minute on my i3 laptop.</p>
<div id="b97ab3e8-ebf2-4d4d-a2a1-75c2abdf7348" class="cell" data-execution_count="166">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>U_sym <span class="op">=</span> solve(NE_sym,X)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Display the symbolic solution.</p>
<div id="6422da93-8b17-4211-a0d2-f160ca26b794" class="cell" data-execution_count="167">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co">temp = ''</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">for i in U_sym.keys():</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co">    temp += '${:s} = {:s}$&lt;br&gt;'.format(latex(i),latex(U_sym[i]))</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co">Markdown(temp)</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co">"""output too long, uncomment to display the equations"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="167">
<pre><code>'output too long, uncomment to display the equations'</code></pre>
</div>
</div>
<p>The equations generated for the solution of the node voltages and unknown currents are long and not very insightful, so the code to display the equations has been commented out.</p>
<p>The voltage transfer function from the input (V1) to the output, node 2, which is the voltage across R28 is <span class="math inline">\(H_{sym}=\frac{v2}{v1}\)</span>. <span class="math inline">\(H_{sym}\)</span> is computed below and is used to examine the poles and zeros of a system and describe the operation of the circuit in the frequency domain.</p>
<div id="20e6904b-4dc9-45a5-8381-b514eed50edc" class="cell" data-execution_count="168">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>H_sym <span class="op">=</span> U_sym[v2]<span class="op">/</span>U_sym[v1]</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co">#H_sym</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co">"""output too long, uncomment to display the equations"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="168">
<pre><code>'output too long, uncomment to display the equations'</code></pre>
</div>
</div>
<p>The numerator and denominator of <span class="math inline">\(H_{sym}\)</span> are assigned to the variables sym_num and sym_denom.</p>
<div id="cb326ba1-1aa5-424a-ba25-352c5954c904" class="cell" data-execution_count="169">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>sym_num, sym_denom <span class="op">=</span> fraction(H_sym) <span class="co">#returns numerator and denominator</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>SymPy can solve for the roots of the numerator. The roots of the numerator are called the zeros of the transfer function. These correspond to the capacitors, C1, C2 and C3 which are in series along the signal paths and block the flow of DC current.</p>
<p>SymPy can determine the degree of the numerator and denominator polynomials.</p>
<div id="0842b883-4383-4379-95cc-b27087c01183" class="cell" data-execution_count="170">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'degree of numerator polynomial: </span><span class="sc">{:d}</span><span class="st">'</span>.<span class="bu">format</span>(<span class="bu">int</span>(degree(sym_num,gen<span class="op">=</span>s))))</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'degree of denominator polynomial: </span><span class="sc">{:d}</span><span class="st">'</span>.<span class="bu">format</span>(<span class="bu">int</span>(degree(sym_denom,gen<span class="op">=</span>s))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>degree of numerator polynomial: 3
degree of denominator polynomial: 3</code></pre>
</div>
</div>
<p>The numerator is a third order polynomial and commented out since the expression is long and not that insightful.</p>
<div id="0fd846d9-2532-43ab-ad38-6baabff118d1" class="cell" data-execution_count="171">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">#sym_num</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>SymPy can solve for the roots of the numerator.</p>
<div id="3e4e8727-fe7d-4e66-b042-0cd926551d7c" class="cell" data-execution_count="172">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>num_roots <span class="op">=</span> solve(sym_num,s)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The roots of the numerator are called zeros of the transfer function. The numerator polynomial is a third order polynomial and there are three zeros. The components that determine the value of zeros are listed below.</p>
<p>The first zero is at 0 Hz.</p>
<div id="5db81499-dd5a-4024-9005-369ec927aae7" class="cell" data-execution_count="173">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>num_roots[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="173">
<p><span class="math inline">\(\displaystyle 0\)</span></p>
</div>
</div>
<div id="771e202a-0375-4c9d-9a3d-5b5e7e9b8578" class="cell" data-execution_count="174">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>sym_num.free_symbols</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="174">
<p><span class="math inline">\(\displaystyle \left\{C_{1}, C_{15}, C_{2}, R_{1}, R_{2}, R_{25}, R_{26}, R_{27}, R_{28}, R_{3}, R_{4}, Rp3a, Rp3b, V_{1}, V_{2}, s\right\}\)</span></p>
</div>
</div>
<p>There are three zeros. The first zero is at <span class="math inline">\(s=0\)</span>.</p>
<div id="d665c0ec-48bd-4106-8687-53164373fd7f" class="cell" data-execution_count="175">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'system zero: </span><span class="sc">{:.2f}</span><span class="st"> Hz'</span>.<span class="bu">format</span>(<span class="op">-</span>N(num_roots[<span class="dv">0</span>].subs(element_values))<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>system zero: 0.00 Hz</code></pre>
</div>
</div>
<p>The symbolic solution for the 2nd system zero is a long expression and is commented out since it’s not particularly insightful.</p>
<div id="031cf051-fd16-4551-9816-7b2b64ea85f4" class="cell" data-execution_count="176">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">#num_roots[1]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The 2nd system zero can be evaluated to find the frequency.</p>
<div id="f416c801-261d-4d03-a822-62736acf7198" class="cell" data-execution_count="177">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'system zero: </span><span class="sc">{:.2f}</span><span class="st"> Hz'</span>.<span class="bu">format</span>(<span class="op">-</span>N(num_roots[<span class="dv">1</span>].subs(element_values))<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>system zero: 3.31 Hz</code></pre>
</div>
</div>
<p>The components that contribute to this zero are shown below.</p>
<div id="f5d894df-9e56-4175-8cf5-36b3ed91648b" class="cell" data-execution_count="178">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>num_roots[<span class="dv">1</span>].free_symbols</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="178">
<p><span class="math inline">\(\displaystyle \left\{C_{1}, C_{15}, C_{2}, R_{1}, R_{2}, R_{25}, R_{26}, R_{27}, R_{3}, R_{4}, Rp3a, Rp3b, V_{1}, V_{2}\right\}\)</span></p>
</div>
</div>
<p>From the list of free symbols, we can see that most of the components play a part in determining the value of the zero.</p>
<p>The symbolic solution for the 3rd system zero is a long expression and is commented out since it’s not particularly insightful.</p>
<div id="7ae8209a-5c2f-40a7-8569-a31f49a95921" class="cell" data-execution_count="179">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">#num_roots[2]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The 3rd system zero can be evaluated to find the frequency.</p>
<div id="212466d4-43c7-4df8-8897-231fad57cab3" class="cell" data-execution_count="180">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'system zero: </span><span class="sc">{:.2f}</span><span class="st"> Hz'</span>.<span class="bu">format</span>(<span class="op">-</span>N(num_roots[<span class="dv">2</span>].subs(element_values))<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>system zero: 0.00 Hz</code></pre>
</div>
</div>
<p>The components that contribute to this zero are shown below.</p>
<div id="b052aeb0-b630-48ed-b373-16d48512b2dd" class="cell" data-execution_count="181">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>num_roots[<span class="dv">2</span>].free_symbols</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="181">
<p><span class="math inline">\(\displaystyle \left\{C_{1}, C_{15}, C_{2}, R_{1}, R_{2}, R_{25}, R_{26}, R_{27}, R_{3}, R_{4}, Rp3a, Rp3b, V_{1}, V_{2}\right\}\)</span></p>
</div>
</div>
<p>As shown above, there are three zeros in the transfer function. There is a double zero at 0 Hz and a zero at 3.31 Hz.</p>
<p>The denominator of the transfer function can be displayed, but is commented out since the expression is long and not that insightful.</p>
<div id="6122e66f-c332-4913-89b8-a4514d9babb3" class="cell" data-execution_count="182">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">#sym_denom</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>SymPy can solve for the roots and these are shown below. The roots of the denominator are called poles of the transfer function.</p>
<div id="98b88048-e835-4abe-8851-ccc528179ab7" class="cell" data-execution_count="183">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>demon_roots <span class="op">=</span> solve(sym_denom,s)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>There are three denominator roots since the equation is a third order equation.</p>
<div id="b102864a-1ea5-4fb1-9794-f29aa9a42eab" class="cell" data-execution_count="184">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">#demon_roots[0]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Using the component values, we can solve for the location of the pole on the complex frequency plane.</p>
<div id="2d1c72ab-8c4a-4c94-9a6f-2a2d89c22f20" class="cell" data-execution_count="185">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'system pole: </span><span class="sc">{:.2f}</span><span class="st"> Hz'</span>.<span class="bu">format</span>(<span class="op">-</span>N(demon_roots[<span class="dv">0</span>].subs(element_values))<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>system pole: 3.34 Hz</code></pre>
</div>
</div>
<div id="0d79bd1b-24d5-45d8-819a-5a1146812f95" class="cell" data-execution_count="186">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>demon_roots[<span class="dv">0</span>].free_symbols</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="186">
<p><span class="math inline">\(\displaystyle \left\{C_{15}, C_{2}, R_{25}, R_{26}, R_{27}, R_{28}, R_{3}, R_{4}, Rp3a, Rp3b\right\}\)</span></p>
</div>
</div>
<p>The first system pole is at 3.34 Hz and the components that determine this pole are shown above.</p>
<p>The second pole is:</p>
<div id="fffe52c7-70a7-4707-a875-d5ce24ac710a" class="cell" data-execution_count="187">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">#demon_roots[1]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="b94d1ac6-c373-41df-af05-b09e85dc4bed" class="cell" data-execution_count="188">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'system pole: </span><span class="sc">{:.2f}</span><span class="st"> Hz'</span>.<span class="bu">format</span>(<span class="op">-</span>N(demon_roots[<span class="dv">1</span>].subs(element_values))<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>system pole: 1.12 Hz</code></pre>
</div>
</div>
<div id="96bfd15e-cdea-46f4-bb6e-0b40252df453" class="cell" data-execution_count="189">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>demon_roots[<span class="dv">1</span>].free_symbols</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="189">
<p><span class="math inline">\(\displaystyle \left\{C_{15}, C_{2}, R_{25}, R_{26}, R_{27}, R_{28}, R_{3}, R_{4}, Rp3a, Rp3b\right\}\)</span></p>
</div>
</div>
<p>The second system pole is at 1.12 Hz and the components that determine this pole are shown above.</p>
<div id="c9aca7c7-f0a8-4a89-9226-997ef049cd84" class="cell" data-execution_count="190">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co">#demon_roots[2]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="08f569b5-03bc-4429-9141-b69f598f8eb8" class="cell" data-execution_count="191">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'system pole: </span><span class="sc">{:.2f}</span><span class="st"> Hz'</span>.<span class="bu">format</span>(<span class="op">-</span>N(demon_roots[<span class="dv">2</span>].subs(element_values))<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>system pole: 1.58 Hz</code></pre>
</div>
</div>
<div id="9d31abfb-3d96-4f3f-94fa-2a59f3d961ae" class="cell" data-execution_count="192">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>demon_roots[<span class="dv">2</span>].free_symbols</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="192">
<p><span class="math inline">\(\displaystyle \left\{C_{1}, R_{1}, R_{2}\right\}\)</span></p>
</div>
</div>
<p>The third system pole is at 1.58 Hz and the components that determine this pole are <span class="math inline">\(C_1, R_1 \text { and } R_2\)</span>. The expressions for the poles and zeros can be used as design equations.</p>
</section>
<section id="numerical-solution" class="level4" data-number="37.9.1.2">
<h4 data-number="37.9.1.2" class="anchored" data-anchor-id="numerical-solution"><span class="header-section-number">37.9.1.2</span> Numerical solution</h4>
<p>The following section of this notebook presents calculations that are used to find the frequency, impulse and step response, and the poles and zeros of the bypass circuit using numerical methods.</p>
<section id="output-control" class="level5" data-number="37.9.1.2.1">
<h5 data-number="37.9.1.2.1" class="anchored" data-anchor-id="output-control"><span class="header-section-number">37.9.1.2.1</span> Output control</h5>
<p>The output control is the potentiometer, P3 in <a href="#fig-Klon-Centaur_sch" class="quarto-xref">Figure&nbsp;<span>37.3</span></a>, and modeled as resistors, Rp3a and Rp3b in <a href="#fig-Klon-Centaur_bypass_v1_sch" class="quarto-xref">Figure&nbsp;<span>37.5</span></a>. I’m going to assume that this component has an audio taper similar to <a href="https://www.bourns.com/docs/Product-Datasheets/PTV09.pdf">PTV09</a>, which can be found at <a href="https://www.digikey.com/en/products/detail/bourns-inc/PTV09A-4025U-A104/3781136">Digikey</a>. I don’t know the actual Klon part number used for P3 and online references are not clear about the type, so the PTV09 is being used as a stand-in.</p>
<p>A potentiometer is essentially a variable resistor and is usually a three-terminal component with a sliding or rotating contact that allows the resistance to be adjusted. Two terminals are fixed at the ends of a resistive element, and the third terminal is connected to a movable wiper. As the wiper is moved, the resistance between the wiper and each end terminal changes. Let’s say the pins are numbered 1, 2, and 3. Pins 1 and 3 are connected to the end points of the resistive element and pin 2 is connected to the wiper. Full CW rotation of the shaft sets the resistance between pins 1 and 3 to the value of potentiometer.</p>
<p>The following function describes the taper from the figure in the datasheet for A series tapers. Data point values for the taper were eyeballed and the curve shown below approximates the curve shown in the datasheet. The equation used for modeling the taper was obtained from the following references, <a href="https://electronics.stackexchange.com/questions/304692/formula-for-logarithmic-audio-taper-pot">Formula for Logarithmic (audio taper) pot</a> and <a href="https://benholmes.co.uk/posts/2017/11/logarithmic-potentiometer-laws">Modeling logarithmic potentiometer laws</a>.</p>
<div id="b2779980-ea75-4c0b-8f32-2f4cb3d6fa7b" class="cell" data-execution_count="193">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> audio_pot_10k(rotation):</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="co">    defines the resistance of an audio taper potentiometer as a function of rotation.</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="co">    The value for the rotation should be a number between 0 and 100, which corresponds to 0 to 100 percent.</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="co">    ref: 1) https://electronics.stackexchange.com/questions/304692/formula-for-logarithmic-audio-taper-pot, </span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="co">    2) https://benholmes.co.uk/posts/2017/11/logarithmic-potentiometer-laws</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="co">    '''</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>    mid <span class="op">=</span> <span class="fl">0.2</span> <span class="co"># define the factor of resistance at the middle pot position, at the mid postion</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># of the pot's rotation, the resistance value of the wiper will be 0.2 * 10k = 2k  </span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> (<span class="dv">1</span><span class="op">/</span>mid <span class="op">-</span> <span class="dv">1</span>)<span class="op">**</span><span class="dv">2</span> <span class="co"># b is the base of the exponential equation</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="dv">1</span><span class="op">/</span>(b<span class="op">-</span><span class="dv">1</span>) <span class="co"># a is the multiple and also the offset</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fl">10e3</span><span class="op">*</span>(a<span class="op">*</span>b<span class="op">**</span>(rotation<span class="op">/</span><span class="dv">100</span>) <span class="op">-</span> a)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The plot below shows the value of resistance between pins 1 and 3 as a function of wiper position.</p>
<div id="18d2aa49-503d-44cb-972f-b6c276914a6c" class="cell" data-execution_count="194">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>p3_value <span class="op">=</span> <span class="fl">10e3</span> <span class="co"># full scale value of potentiometer</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>potentiometer_rotation <span class="op">=</span> np.linspace(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">51</span>)<span class="op">*</span><span class="dv">100</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>plt.plot(potentiometer_rotation,audio_pot_10k(potentiometer_rotation)<span class="op">/</span><span class="fl">1e3</span>,<span class="st">'-'</span>)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'resistance between pins 1 and 3, k</span><span class="ch">\u03A9</span><span class="st">'</span>)</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'rotational travel, %'</span>)</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Output potentiometer taper'</span>)</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Klon Centaur part 1_files/figure-html/cell-36-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>As shown above, the resistance value between pins 1 and 2 is an exponential function of pot rotation. If a linear Pot was used, the spacing of the output level in some of the frequency response plots below would be compressed in a narrow dB range that didn’t look correct.</p>
<p>Plot the frequency response of the bypass circuit, <span class="math inline">\(H(s)=\frac {v_2} {V_1}\)</span>, for various settings of P3.</p>
<div id="cell-fig-bypass-path-freq-plot" class="cell" data-execution_count="195">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>output_setting <span class="op">=</span> np.array([<span class="dv">1</span>,<span class="dv">25</span>,<span class="dv">50</span>,<span class="dv">75</span>,<span class="dv">99</span>])</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>color_list <span class="op">=</span> [<span class="st">'tab:blue'</span>,<span class="st">'tab:red'</span>,<span class="st">'tab:green'</span>,<span class="st">'tab:orange'</span>,<span class="st">'k'</span>]</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>fig, ax1 <span class="op">=</span> plt.subplots()</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'magnitude, dB'</span>)</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'frequency, Hz'</span>)</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a><span class="co"># instantiate a second y-axes that shares the same x-axis</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> ax1.twinx()</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>color <span class="op">=</span> <span class="st">'k'</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'phase, deg'</span>,color<span class="op">=</span>color)</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>ax2.tick_params(axis<span class="op">=</span><span class="st">'y'</span>, labelcolor<span class="op">=</span>color)</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.logspace(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">2000</span>, endpoint<span class="op">=</span><span class="va">False</span>)<span class="op">*</span><span class="dv">2</span><span class="op">*</span>np.pi</span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span> (<span class="bu">len</span>(output_setting)):</span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a>    element_values[Rp3a] <span class="op">=</span> p3_value <span class="op">-</span> audio_pot_10k(output_setting[i])</span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>    element_values[Rp3b] <span class="op">=</span> audio_pot_10k(output_setting[i])</span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a>    NE <span class="op">=</span> NE_sym.subs(element_values)</span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a>    U <span class="op">=</span> solve(NE,X)</span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a>    H <span class="op">=</span> U[v2]<span class="op">/</span>U[v1]</span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a>    num, denom <span class="op">=</span> fraction(H) <span class="co">#returns numerator and denominator</span></span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># convert symbolic to numpy polynomial</span></span>
<span id="cb45-29"><a href="#cb45-29" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> np.array(Poly(num, s).all_coeffs(), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb45-30"><a href="#cb45-30" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> np.array(Poly(denom, s).all_coeffs(), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb45-31"><a href="#cb45-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-32"><a href="#cb45-32" aria-hidden="true" tabindex="-1"></a>    w, mag, phase <span class="op">=</span> signal.bode((a, b), w<span class="op">=</span>x) <span class="co"># returns: rad/s, mag in dB, phase in deg</span></span>
<span id="cb45-33"><a href="#cb45-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-34"><a href="#cb45-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># plot the results.  </span></span>
<span id="cb45-35"><a href="#cb45-35" aria-hidden="true" tabindex="-1"></a>    ax1.semilogx(w<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), mag,<span class="st">'-'</span>,color<span class="op">=</span>color_list[i],label<span class="op">=</span><span class="st">'magitude, P3 at </span><span class="sc">{:.0f}</span><span class="st">%'</span>.<span class="bu">format</span>(output_setting[i]))    <span class="co"># magnitude plot</span></span>
<span id="cb45-36"><a href="#cb45-36" aria-hidden="true" tabindex="-1"></a>    ax2.semilogx(w<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), phase,<span class="st">':'</span>,color<span class="op">=</span>color_list[i],label<span class="op">=</span><span class="st">'phase, P3 at </span><span class="sc">{:.0f}</span><span class="st">%'</span>.<span class="bu">format</span>(output_setting[i]))  <span class="co"># phase plot</span></span>
<span id="cb45-37"><a href="#cb45-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb45-38"><a href="#cb45-38" aria-hidden="true" tabindex="-1"></a><span class="co"># highlight the guitar audio band, 80 to 8kHz</span></span>
<span id="cb45-39"><a href="#cb45-39" aria-hidden="true" tabindex="-1"></a>plt.axvspan(<span class="dv">80</span>, <span class="fl">8e3</span>, color<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb45-40"><a href="#cb45-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb45-41"><a href="#cb45-41" aria-hidden="true" tabindex="-1"></a><span class="co"># position legends outside the graph</span></span>
<span id="cb45-42"><a href="#cb45-42" aria-hidden="true" tabindex="-1"></a>ax1.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.6</span>,<span class="dv">1</span>)) <span class="co"># magitude legend position: relative (horizontal position, vertical position) </span></span>
<span id="cb45-43"><a href="#cb45-43" aria-hidden="true" tabindex="-1"></a>ax2.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.6</span>,<span class="fl">0.5</span>)) <span class="co"># phase legend position:</span></span>
<span id="cb45-44"><a href="#cb45-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-45"><a href="#cb45-45" aria-hidden="true" tabindex="-1"></a>ax1.set_ylim((<span class="op">-</span><span class="fl">0.5</span>,<span class="dv">0</span>))</span>
<span id="cb45-46"><a href="#cb45-46" aria-hidden="true" tabindex="-1"></a>ax1.grid()</span>
<span id="cb45-47"><a href="#cb45-47" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Magnitude and phase response at various rotational positions'</span>)</span>
<span id="cb45-48"><a href="#cb45-48" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-bypass-path-freq-plot" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-bypass-path-freq-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Klon Centaur part 1_files/figure-html/fig-bypass-path-freq-plot-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-bypass-path-freq-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;37.6: Bypass path magnitude and phase response
</figcaption>
</figure>
</div>
</div>
</div>
<p>The plot above shows the frequency response for the bypass circuit. The highlighted frequency range of 80 to 8,000 Hz is the audio range of a typical electric guitar. The gain is flat across this range and there is a small amount of insertion loss of about 0.2 dB across the guitar audio band. P3 has only a very small effect on the gain. The annotation for the plot shows the position of P3 at various rotation displacements from 1 to 99 percent.</p>
</section>
</section>
<section id="pole-zero-plot" class="level4" data-number="37.9.1.3">
<h4 data-number="37.9.1.3" class="anchored" data-anchor-id="pole-zero-plot"><span class="header-section-number">37.9.1.3</span> Pole / zero plot</h4>
<p>The following calculations solve for the pole and zero locations for the bypass circuit with the wiper position on P3 set to <span class="math inline">\(5k\Omega\)</span>.</p>
<div id="4480d35c-0279-49e0-acb5-79e626e8e0bc" class="cell" data-execution_count="196">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># output_setting = 50%, knob position as a percent of full rotation</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>element_values[Rp3a] <span class="op">=</span> <span class="fl">5e3</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>element_values[Rp3b] <span class="op">=</span> <span class="fl">5e3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The element values are substituted into the equations, solutions are obtained and the ratio <span class="math inline">\(H = \frac {v_2}{v_1}\)</span> is formulated. Then the coefficients of the numerator and denominator polynomials are saved to variables a and b.</p>
<div id="ec0226ae-8daf-4786-9c0f-f0ff01b119a6" class="cell" data-execution_count="197">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>NE <span class="op">=</span> NE_sym.subs(element_values)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>U <span class="op">=</span> solve(NE,X)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>H <span class="op">=</span> U[v2]<span class="op">/</span>U[v1]</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>num, denom <span class="op">=</span> fraction(H) <span class="co">#returns numerator and denominator</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="co"># convert symbolic to numpy polynomial</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> np.array(Poly(num, s).all_coeffs(), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> np.array(Poly(denom, s).all_coeffs(), dtype<span class="op">=</span><span class="bu">float</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Use the SciPy function <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.signal.TransferFunction.html">TransferFunction</a> to represent the system as the continuous-time transfer function.</p>
<div id="4fd4a755-635e-4da5-9948-0942692a5711" class="cell" data-execution_count="198">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>sys_tf <span class="op">=</span> signal.TransferFunction(a,b)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The poles and zeros of the transfer function can easily be obtained with the following code:</p>
<div id="dfb6d88a-06b3-4335-aacc-907314ac8d2b" class="cell" data-execution_count="199">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>sys_zeros <span class="op">=</span> np.roots(sys_tf.num)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>sys_poles <span class="op">=</span> np.roots(sys_tf.den)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The poles and zeros of the preamp transfer function are plotted.</p>
<div id="781cabc0-5a3c-4394-ab75-502f0f35b185" class="cell" data-execution_count="200">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>plt.plot(np.real(sys_zeros), np.imag(sys_zeros), <span class="st">'ob'</span>, markerfacecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>plt.plot(np.real(sys_poles), np.imag(sys_poles), <span class="st">'xr'</span>)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>plt.legend([<span class="st">'Zeros'</span>, <span class="st">'Poles'</span>], loc<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Pole / Zero Plot'</span>)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'real part, </span><span class="ch">\u03C3</span><span class="st">'</span>)</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'imaginary part, j</span><span class="ch">\u03C9</span><span class="st">'</span>)</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Klon Centaur part 1_files/figure-html/cell-42-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>As shown above and printed below, there are three zeros and three poles in the transfer function. The plotted position of the poles and zeros are in units of radian frequency. There are two zeros at 0 Hz and one at 3.3 Hz. The position of zeros at 0 Hz indicates that the transfer function is a high pass filter and the equal count of poles and zeros indicate the system has a flat frequency response over some frequencies. The pole zero pair near 3.3 Hz tend to cancel since they are very close in frequency. The system zeros stem from C1 and C2, which block the direct current path. One of the system poles stems from C1 , R1 and R2. The other system pole stems from C2 and primarily R3.</p>
<p>The following cells print the zero and pole values in Hz.</p>
<div id="6b43e88b-0719-44df-9fc0-69a2cdf0f2ec" class="cell" data-execution_count="201">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'number of zeros: </span><span class="sc">{:d}</span><span class="st">'</span>.<span class="bu">format</span>(<span class="bu">len</span>(sys_zeros)))</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(sys_zeros)):</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'z</span><span class="sc">{:d}</span><span class="st">: </span><span class="sc">{:,.2f}</span><span class="st"> Hz'</span>.<span class="bu">format</span>(i,sys_zeros[i]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi)))</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'number of poles: </span><span class="sc">{:d}</span><span class="st">'</span>.<span class="bu">format</span>(<span class="bu">len</span>(sys_poles)))</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(sys_poles)):</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'p</span><span class="sc">{:d}</span><span class="st">: </span><span class="sc">{:,.2f}</span><span class="st"> Hz'</span>.<span class="bu">format</span>(i,sys_poles[i]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>number of zeros: 3
z0: -3.31 Hz
z1: 0.00 Hz
z2: 0.00 Hz
number of poles: 3
p0: -3.34 Hz
p1: -1.58 Hz
p2: -1.12 Hz</code></pre>
</div>
</div>
</section>
<section id="step-response-1" class="level4" data-number="37.9.1.4">
<h4 data-number="37.9.1.4" class="anchored" data-anchor-id="step-response-1"><span class="header-section-number">37.9.1.4</span> Step response</h4>
<p>The step response of the is calculated using the SciPy function <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.signal.lsim.html">lsim</a>, which can be used to simulate output of a continuous-time linear system from the continuous-time linear time invariant system base class. The function <code>lsim</code> allows us to evaluate the performance characteristics of the circuit to square wave input. A square wave with a frequency of 500 Hz and an amplitude of 0.1 volts peak to peak is used as the input to this path. An input amplitude of 0.1 Vpp is used to keep the signal levels in the path below the conduction threshold for the diodes. The input square wave has a positive 0.05 volt offset which allows us to examine the DC characteristics of the path. The frequency of the square wave was chosen to allow the time constant of the path to be plotted with sufficient resolution to be examined in the plot.</p>
<p>If we didn’t already know from the schematic that the bypass path is AC coupled, the step response would show us that for large values of time, the response is zero, therefore DC is being blocked. The input signal for the step response is 0.1 volt step. The circuit responds to the rising edge of the square wave and tracks the leading edge of the input. This is because at time zero, the capacitors in the circuit are at their initial condition which is zero volts. At this instant, the output voltage is almost 0.1 volts, since the value of the resistors along the path don’t present much of a voltage divider. As time increases, the voltage on the capacitors will approach their final values according to Kirchhoff’s Current Law, which results in a final output voltage of zero for time greater than about one second.</p>
<div id="17bfbdbb-d675-46c7-80d9-72b01a007c9c" class="cell" data-execution_count="202">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define the time interval and create a square wave step waveform.</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">500</span>, endpoint<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>sqr_signal <span class="op">=</span> signal.square(<span class="dv">2</span><span class="op">*</span>np.pi<span class="op">*</span><span class="fl">0.5</span><span class="op">*</span>t, duty<span class="op">=</span><span class="fl">0.5</span>)<span class="op">/</span><span class="dv">20</span><span class="op">+</span><span class="dv">1</span><span class="op">/</span><span class="dv">20</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="co"># call lsim to generate the response signal</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>t_step, y_step, x_step <span class="op">=</span> signal.lsim(sys_tf, U<span class="op">=</span>sqr_signal, T<span class="op">=</span>t)</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>plt.plot(t_step, sqr_signal, <span class="st">'r'</span>, alpha <span class="op">=</span> <span class="fl">1.0</span>, linewidth<span class="op">=</span><span class="dv">1</span>, label<span class="op">=</span><span class="st">'input'</span>)</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>plt.plot(t_step, y_step,<span class="st">'b'</span>, linewidth <span class="op">=</span> <span class="fl">1.0</span>, label<span class="op">=</span><span class="st">'output'</span>)</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Step response'</span>)</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'volts'</span>)</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'time, sec'</span>)</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">'best'</span>)</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a><span class="co"># show plot</span></span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Klon Centaur part 1_files/figure-html/cell-44-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The square wave response shows about 10% overshoot and a settling time of about 1 second with no ringing. This is a result of series connection of C1 and C2 in the path which equate to a zero at DC and two low frequency poles at 1.1 and 1.6 Hz. The location of these poles result from the relatively large time constants produced by C2 and R3 as well as from C15 and R28.</p>
<p>You would expect the transient step response to be an exponential decay function, asymptotically approaching zero volts. The bypass network has three capacitors, C1, C2 and C15. This makes the circuit a third order system. From the plot above, we can see that there is some overshoot, but no ringing in the step response. This implies that the damping ratio is between 0.7 and 1. We can approximate the damping ratio by considering the two dominant poles of the system and ignoring the highest frequency pole.</p>
<p>As calculated above, the transfer function of the bypass circuit for P3 at 50% is <span class="math inline">\(H(s)\)</span>.</p>
<div id="396e8839-cc07-4df1-b3c0-5209556ce6e2" class="cell" data-execution_count="203">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>H</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="203">
<p><span class="math inline">\(\displaystyle \frac{1.0 \cdot \left(2.31889927274817 \cdot 10^{77} s^{3} + 4.82878561580902 \cdot 10^{78} s^{2}\right)}{2.37377342819845 \cdot 10^{77} s^{3} + 9.00095037426057 \cdot 10^{78} s^{2} + 1.00954261077259 \cdot 10^{80} s + 3.47583640381444 \cdot 10^{80}}\)</span></p>
</div>
</div>
<p>As calculated above, the system poles are:</p>
<div id="4763df79-4030-4c28-a245-73dd81a2568d" class="cell" data-execution_count="204">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sys_poles)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[-20.9622128   -9.9009901   -7.05511848]</code></pre>
</div>
</div>
<p>We can have NumPy to generate the system polynomial.</p>
<div id="9c1dc844-02e6-4919-8a96-ca56606fe536" class="cell" data-execution_count="205">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>sys_poly <span class="op">=</span> np.poly(sys_poles)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sys_poly)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1.00000000e+00 3.79183214e+01 4.25290215e+02 1.46426629e+03]</code></pre>
</div>
</div>
<p>Normalize the system polynomial on the second order term by dividing the polynomial coefficients by the second order coefficient.</p>
<div id="7fa493ba-7c15-4278-a019-87acdd1422fa" class="cell" data-execution_count="206">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>norm_sys_poly <span class="op">=</span> sys_poly<span class="op">/</span>sys_poly[<span class="dv">1</span>]</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(norm_sys_poly)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[2.63724755e-02 1.00000000e+00 1.12159557e+01 3.86163267e+01]</code></pre>
</div>
</div>
<p>This puts the pronominal into the form:</p>
<p><span class="math inline">\(as^3 + s^{2}+\frac {\omega _N}{Q}s + \omega _N^2\)</span></p>
<p>We are going to ignore the <span class="math inline">\(as^3\)</span> term and only consider the other terms:</p>
<p><span class="math inline">\(s^{2}+\frac {\omega _N}{Q}s + \omega _N^2\)</span></p>
<p>The natural frequency can be found from the last term in the normalized system polynomial.</p>
<div id="313525d6-c981-4638-a384-9b8cde731d22" class="cell" data-execution_count="207">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>w_n <span class="op">=</span> np.sqrt(norm_sys_poly[<span class="dv">3</span>])</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>w_n</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="207">
<p><span class="math inline">\(\displaystyle 6.21420362662557\)</span></p>
</div>
</div>
<p>The damping ratio can be found solving for the damping ratio, <span class="math inline">\(\delta\)</span>, in the equation:</p>
<p><span class="math inline">\(\frac {\omega _N}{Q} = 2 \delta \omega _N\)</span></p>
<div id="9ecbcb01-b180-47ff-9bf0-8ce134ea50a5" class="cell" data-execution_count="208">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>damp_ratio <span class="op">=</span> norm_sys_poly[<span class="dv">2</span>]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>w_n)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'damping ratio = </span><span class="sc">{:.2f}</span><span class="st">'</span>.<span class="bu">format</span>(damp_ratio))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>damping ratio = 0.90</code></pre>
</div>
</div>
<p>The damping ratio is less than between 0.7 and 1, leading to the behavior shown in the step response.</p>
<p>The transient behavior of the circuit in <a href="#fig-Klon-Centaur_bypass_v1_sch" class="quarto-xref">Figure&nbsp;<span>37.5</span></a> with a square wave input was simulated in LTSpice and the results are a close match with the Python results as shown in the plot below.</p>
<div id="1f3e506b-5267-44ca-b4dd-af53b07e19f2" class="cell" data-execution_count="209">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>fn <span class="op">=</span> <span class="st">'Klon-Centaur_bypass_v1.csv'</span> <span class="co"># data from LTSpice</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>LTSpice_data <span class="op">=</span> np.genfromtxt(fn, delimiter<span class="op">=</span><span class="st">','</span>,skip_header<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Copy the data from the csv file into NumPy arrays.</p>
<div id="0480e626-eb21-4020-bfc3-47b7dbe7038e" class="cell" data-execution_count="210">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize some empty arrays</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>time <span class="op">=</span> np.zeros(<span class="bu">len</span>(LTSpice_data))</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>voltage1 <span class="op">=</span> np.zeros(<span class="bu">len</span>(LTSpice_data))</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>voltage2 <span class="op">=</span> np.zeros(<span class="bu">len</span>(LTSpice_data))</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="co"># convert the csv data to complex numbers and store in the array</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(LTSpice_data)):</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>    time[i] <span class="op">=</span> LTSpice_data[i][<span class="dv">0</span>]</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>    voltage1[i] <span class="op">=</span> LTSpice_data[i][<span class="dv">1</span>]</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>    voltage2[i] <span class="op">=</span> LTSpice_data[i][<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Plot the LTSpice data and the Python data to see if they agree.</p>
<div id="38f454d6-6b7b-4269-91bb-697a434938fb" class="cell" data-execution_count="211">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'LTSpice'</span>)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.plot(time, voltage1, 'g', alpha = 1.0, linewidth=1, label='LTSpice v1(t)')</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>plt.plot(time, voltage2, <span class="st">'-.r'</span>, alpha <span class="op">=</span> <span class="fl">1.0</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'LTSpice v2(t)'</span>)</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.plot(t_step, sqr_signal, 'r', alpha = 1.0, linewidth=1, label='input')</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>plt.plot(t_step, y_step,<span class="st">'b'</span>, alpha <span class="op">=</span> <span class="fl">1.0</span>, linewidth <span class="op">=</span> <span class="fl">1.0</span>, label<span class="op">=</span><span class="st">'Python result'</span>)</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'v(t), volts'</span>)</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'time, sec'</span>)</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Klon Centaur part 1_files/figure-html/cell-53-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>As shown above, there is a one to one correspondence.</p>
</section>
<section id="group-delay" class="level4" data-number="37.9.1.5">
<h4 data-number="37.9.1.5" class="anchored" data-anchor-id="group-delay"><span class="header-section-number">37.9.1.5</span> Group delay</h4>
<p>The group delay for this path is calculated and plotted below.</p>
<div id="73e73ebf-f265-4c67-a72b-8e50b2c206a5" class="cell" data-execution_count="212">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.logspace(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">2000</span>, endpoint<span class="op">=</span><span class="va">False</span>)<span class="op">*</span><span class="dv">2</span><span class="op">*</span>np.pi</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>w, mag, phase <span class="op">=</span> signal.bode((a, b), w<span class="op">=</span>x) <span class="co"># returns: rad/s, mag in dB, phase in deg</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'group delay'</span>)</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>plt.semilogx(w<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), <span class="op">-</span>np.gradient(phase<span class="op">*</span>np.pi<span class="op">/</span><span class="dv">180</span>)<span class="op">/</span>np.gradient(w)<span class="op">*</span><span class="dv">1000</span>,<span class="st">'-'</span>,label<span class="op">=</span><span class="st">'group delay'</span>)</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a><span class="co"># highlight the guitar audio band, 80 to 8kHz</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>plt.axvspan(<span class="dv">80</span>, <span class="fl">8e3</span>, color<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>plt.xlim((<span class="dv">10</span>,<span class="fl">100e3</span>))</span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>plt.ylim((<span class="dv">0</span>,<span class="dv">2</span>))</span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Group delay, msec'</span>)</span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Frequency, Hz'</span>)</span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Klon Centaur part 1_files/figure-html/cell-54-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The plot above shows that for frequencies in the guitar audio band, the group delay variation is less than 2 ms and therefore below the threshold of audibility as described in <a href="#sec-Group_delay" class="quarto-xref"><span>Section 37.8.6</span></a>.</p>
</section>
<section id="effect-signal-leakage-into-bypass-path" class="level4" data-number="37.9.1.6">
<h4 data-number="37.9.1.6" class="anchored" data-anchor-id="effect-signal-leakage-into-bypass-path"><span class="header-section-number">37.9.1.6</span> Effect signal leakage into bypass path</h4>
<p>The frequency response plot below shows the signal gain from the effects path into the output when the switch is in the bypass position. The transfer function, <span class="math inline">\(H(s)=\frac {v_2} {v_{11}}\)</span>, is plotted for various settings of P3, with <span class="math inline">\(V_1=0\)</span>, <span class="math inline">\(R_{26}=68k\Omega\)</span> and <span class="math inline">\(R_{27}=0.01\Omega\)</span>. Since the bypass switch doesn’t break the connection between the bypass and effects path, it is informative to look at the leakage of one path into the other.</p>
<div id="cell-fig-bypass-path-effect-leakage-freq-plot" class="cell" data-execution_count="213">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>element_values[V1] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>element_values[V2] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>element_values[R26] <span class="op">=</span> <span class="fl">0.01</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>element_values[R27] <span class="op">=</span> <span class="fl">68e3</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>output_setting <span class="op">=</span> np.array([<span class="dv">1</span>,<span class="dv">25</span>,<span class="dv">50</span>,<span class="dv">75</span>,<span class="dv">99</span>])</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>color_list <span class="op">=</span> [<span class="st">'tab:blue'</span>,<span class="st">'tab:red'</span>,<span class="st">'tab:green'</span>,<span class="st">'tab:orange'</span>,<span class="st">'k'</span>]</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>fig, ax1 <span class="op">=</span> plt.subplots()</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'magnitude, dB'</span>)</span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'frequency, Hz'</span>)</span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a><span class="co"># instantiate a second y-axes that shares the same x-axis</span></span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> ax1.twinx()</span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a>color <span class="op">=</span> <span class="st">'k'</span></span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'phase, deg'</span>,color<span class="op">=</span>color)</span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a>ax2.tick_params(axis<span class="op">=</span><span class="st">'y'</span>, labelcolor<span class="op">=</span>color)</span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.logspace(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">2000</span>, endpoint<span class="op">=</span><span class="va">False</span>)<span class="op">*</span><span class="dv">2</span><span class="op">*</span>np.pi</span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(output_setting)):</span>
<span id="cb68-24"><a href="#cb68-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb68-25"><a href="#cb68-25" aria-hidden="true" tabindex="-1"></a>    element_values[Rp3a] <span class="op">=</span> p3_value <span class="op">-</span> audio_pot_10k(output_setting[i])</span>
<span id="cb68-26"><a href="#cb68-26" aria-hidden="true" tabindex="-1"></a>    element_values[Rp3b] <span class="op">=</span> audio_pot_10k(output_setting[i])</span>
<span id="cb68-27"><a href="#cb68-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb68-28"><a href="#cb68-28" aria-hidden="true" tabindex="-1"></a>    NE <span class="op">=</span> NE_sym.subs(element_values)</span>
<span id="cb68-29"><a href="#cb68-29" aria-hidden="true" tabindex="-1"></a>    U <span class="op">=</span> solve(NE,X)</span>
<span id="cb68-30"><a href="#cb68-30" aria-hidden="true" tabindex="-1"></a>    H <span class="op">=</span> U[v2]<span class="op">/</span>U[v11]</span>
<span id="cb68-31"><a href="#cb68-31" aria-hidden="true" tabindex="-1"></a>    num, denom <span class="op">=</span> fraction(H) <span class="co">#returns numerator and denominator</span></span>
<span id="cb68-32"><a href="#cb68-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-33"><a href="#cb68-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># convert symbolic to numpy polynomial</span></span>
<span id="cb68-34"><a href="#cb68-34" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> np.array(Poly(num, s).all_coeffs(), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb68-35"><a href="#cb68-35" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> np.array(Poly(denom, s).all_coeffs(), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb68-36"><a href="#cb68-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-37"><a href="#cb68-37" aria-hidden="true" tabindex="-1"></a>    w, mag, phase <span class="op">=</span> signal.bode((a, b), w<span class="op">=</span>x) <span class="co"># returns: rad/s, mag in dB, phase in deg</span></span>
<span id="cb68-38"><a href="#cb68-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-39"><a href="#cb68-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># plot the results.  </span></span>
<span id="cb68-40"><a href="#cb68-40" aria-hidden="true" tabindex="-1"></a>    ax1.semilogx(w<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), mag,<span class="st">'-'</span>,color<span class="op">=</span>color_list[i],label<span class="op">=</span><span class="st">'magitude, P3 at </span><span class="sc">{:.0f}</span><span class="st">%'</span>.<span class="bu">format</span>(output_setting[i]))    <span class="co"># magnitude plot</span></span>
<span id="cb68-41"><a href="#cb68-41" aria-hidden="true" tabindex="-1"></a>    ax2.semilogx(w<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), phase,<span class="st">':'</span>,color<span class="op">=</span>color_list[i],label<span class="op">=</span><span class="st">'phase, P3 at </span><span class="sc">{:.0f}</span><span class="st">%'</span>.<span class="bu">format</span>(output_setting[i]))  <span class="co"># phase plot</span></span>
<span id="cb68-42"><a href="#cb68-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-43"><a href="#cb68-43" aria-hidden="true" tabindex="-1"></a><span class="co"># highlight the guitar audio band, 80 to 8kHz</span></span>
<span id="cb68-44"><a href="#cb68-44" aria-hidden="true" tabindex="-1"></a>plt.axvspan(<span class="dv">80</span>, <span class="fl">8e3</span>, color<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb68-45"><a href="#cb68-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-46"><a href="#cb68-46" aria-hidden="true" tabindex="-1"></a><span class="co"># position legends outside the graph</span></span>
<span id="cb68-47"><a href="#cb68-47" aria-hidden="true" tabindex="-1"></a>ax1.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.6</span>,<span class="dv">1</span>)) <span class="co"># magnitude legend position: relative (horizontal position, vertical position) </span></span>
<span id="cb68-48"><a href="#cb68-48" aria-hidden="true" tabindex="-1"></a>ax2.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.6</span>,<span class="fl">0.5</span>)) <span class="co"># phase legend position:</span></span>
<span id="cb68-49"><a href="#cb68-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-50"><a href="#cb68-50" aria-hidden="true" tabindex="-1"></a>ax1.grid()</span>
<span id="cb68-51"><a href="#cb68-51" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Magnitude and phase response'</span>)</span>
<span id="cb68-52"><a href="#cb68-52" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-bypass-path-effect-leakage-freq-plot" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-bypass-path-effect-leakage-freq-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Klon Centaur part 1_files/figure-html/fig-bypass-path-effect-leakage-freq-plot-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-bypass-path-effect-leakage-freq-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;37.7: Effect signal leakage into bypass path magnitude and phase response
</figcaption>
</figure>
</div>
</div>
</div>
<p>The plot above shows that the effects signal is isolated from the bypass signal by more than 40 dB over the audio band of the guitar.</p>
</section>
</section>
<section id="effects-path-output-frequency-response" class="level3" data-number="37.9.2">
<h3 data-number="37.9.2" class="anchored" data-anchor-id="effects-path-output-frequency-response"><span class="header-section-number">37.9.2</span> Effects path output frequency response</h3>
<p>The signal through the effects path is analyzed from C15 to the output at J2. In <a href="#fig-Klon-Centaur_bypass_v1_sch" class="quarto-xref">Figure&nbsp;<span>37.5</span></a>, the output of U2A is replaced by <span class="math inline">\(V_2\)</span> at node 11. The frequency response for the transfer function, <span class="math inline">\(H(s)=\frac{v_2}{v_{11}}\)</span> is plotted below. <span class="math inline">\(V_1\)</span> has been set to zero, <span class="math inline">\(R_{26}=68k\Omega\)</span> and <span class="math inline">\(R_{27}=0.01\Omega\)</span></p>
<div id="cell-fig-effect-output-freq-plot" class="cell" data-execution_count="214">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>element_values[V1] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>element_values[V2] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>element_values[R26] <span class="op">=</span> <span class="fl">68e3</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>element_values[R27] <span class="op">=</span> <span class="fl">0.01</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>output_setting <span class="op">=</span> np.array([<span class="dv">1</span>,<span class="dv">25</span>,<span class="dv">50</span>,<span class="dv">75</span>,<span class="dv">99</span>])</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>color_list <span class="op">=</span> [<span class="st">'tab:blue'</span>,<span class="st">'tab:red'</span>,<span class="st">'tab:green'</span>,<span class="st">'tab:orange'</span>,<span class="st">'k'</span>]</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>fig, ax1 <span class="op">=</span> plt.subplots()</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'magnitude, dB'</span>)</span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'frequency, Hz'</span>)</span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a><span class="co"># instantiate a second y-axes that shares the same x-axis</span></span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> ax1.twinx()</span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a>color <span class="op">=</span> <span class="st">'k'</span></span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'phase, deg'</span>,color<span class="op">=</span>color)</span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a>ax2.tick_params(axis<span class="op">=</span><span class="st">'y'</span>, labelcolor<span class="op">=</span>color)</span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.logspace(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">2000</span>, endpoint<span class="op">=</span><span class="va">False</span>)<span class="op">*</span><span class="dv">2</span><span class="op">*</span>np.pi</span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(output_setting)):</span>
<span id="cb69-24"><a href="#cb69-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-25"><a href="#cb69-25" aria-hidden="true" tabindex="-1"></a>    element_values[Rp3a] <span class="op">=</span> p3_value <span class="op">-</span> audio_pot_10k(output_setting[i])</span>
<span id="cb69-26"><a href="#cb69-26" aria-hidden="true" tabindex="-1"></a>    element_values[Rp3b] <span class="op">=</span> audio_pot_10k(output_setting[i])</span>
<span id="cb69-27"><a href="#cb69-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb69-28"><a href="#cb69-28" aria-hidden="true" tabindex="-1"></a>    NE <span class="op">=</span> NE_sym.subs(element_values)</span>
<span id="cb69-29"><a href="#cb69-29" aria-hidden="true" tabindex="-1"></a>    U <span class="op">=</span> solve(NE,X)</span>
<span id="cb69-30"><a href="#cb69-30" aria-hidden="true" tabindex="-1"></a>    H <span class="op">=</span> U[v2]<span class="op">/</span>U[v11]</span>
<span id="cb69-31"><a href="#cb69-31" aria-hidden="true" tabindex="-1"></a>    num, denom <span class="op">=</span> fraction(H) <span class="co">#returns numerator and denominator</span></span>
<span id="cb69-32"><a href="#cb69-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-33"><a href="#cb69-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># convert symbolic to NumPy polynomial</span></span>
<span id="cb69-34"><a href="#cb69-34" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> np.array(Poly(num, s).all_coeffs(), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb69-35"><a href="#cb69-35" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> np.array(Poly(denom, s).all_coeffs(), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb69-36"><a href="#cb69-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-37"><a href="#cb69-37" aria-hidden="true" tabindex="-1"></a>    w, mag, phase <span class="op">=</span> signal.bode((a, b), w<span class="op">=</span>x) <span class="co"># returns: rad/s, mag in dB, phase in deg</span></span>
<span id="cb69-38"><a href="#cb69-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-39"><a href="#cb69-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># plot the results.  </span></span>
<span id="cb69-40"><a href="#cb69-40" aria-hidden="true" tabindex="-1"></a>    ax1.semilogx(w<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), mag,<span class="st">'-'</span>,color<span class="op">=</span>color_list[i],label<span class="op">=</span><span class="st">'magnitude, P3 at </span><span class="sc">{:.0f}</span><span class="st">%'</span>.<span class="bu">format</span>(output_setting[i]))    <span class="co"># magnitude plot</span></span>
<span id="cb69-41"><a href="#cb69-41" aria-hidden="true" tabindex="-1"></a>    ax2.semilogx(w<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), phase,<span class="st">':'</span>,color<span class="op">=</span>color_list[i],label<span class="op">=</span><span class="st">'phase, P3 at </span><span class="sc">{:.0f}</span><span class="st">%'</span>.<span class="bu">format</span>(output_setting[i]))  <span class="co"># phase plot</span></span>
<span id="cb69-42"><a href="#cb69-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-43"><a href="#cb69-43" aria-hidden="true" tabindex="-1"></a><span class="co"># highlight the guitar audio band, 80 to 8kHz</span></span>
<span id="cb69-44"><a href="#cb69-44" aria-hidden="true" tabindex="-1"></a>plt.axvspan(<span class="dv">80</span>, <span class="fl">8e3</span>, color<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb69-45"><a href="#cb69-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-46"><a href="#cb69-46" aria-hidden="true" tabindex="-1"></a><span class="co"># position legends outside the graph</span></span>
<span id="cb69-47"><a href="#cb69-47" aria-hidden="true" tabindex="-1"></a>ax1.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.6</span>,<span class="dv">1</span>)) <span class="co"># magnitude legend position: relative (horizontal position, vertical position) </span></span>
<span id="cb69-48"><a href="#cb69-48" aria-hidden="true" tabindex="-1"></a>ax2.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.6</span>,<span class="fl">0.5</span>)) <span class="co"># phase legend position:</span></span>
<span id="cb69-49"><a href="#cb69-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-50"><a href="#cb69-50" aria-hidden="true" tabindex="-1"></a>ax1.grid()</span>
<span id="cb69-51"><a href="#cb69-51" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Magnitude and phase response'</span>)</span>
<span id="cb69-52"><a href="#cb69-52" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-effect-output-freq-plot" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-effect-output-freq-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Klon Centaur part 1_files/figure-html/fig-effect-output-freq-plot-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-effect-output-freq-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;37.8: Effect output path magnitude and phase response
</figcaption>
</figure>
</div>
</div>
</div>
<p>The gain of the output circuit for the effects path can be adjusted by P3 to have a gain of a bit less than 0 dB to about -55 dB.</p>
<section id="poles-and-zeros" class="level4" data-number="37.9.2.1">
<h4 data-number="37.9.2.1" class="anchored" data-anchor-id="poles-and-zeros"><span class="header-section-number">37.9.2.1</span> Poles and zeros</h4>
<p>Setting the wiper position of P3 to a position that puts <span class="math inline">\(5k\Omega\)</span> on each side of the wiper, the poles and zeros for the output circuit are calculated.</p>
<div id="7e183685-0c0a-4d8a-99e4-791194e77933" class="cell" data-execution_count="215">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># output_setting = 50%, knob position as a percent of full rotation</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>element_values[Rp3a] <span class="op">=</span> <span class="fl">5e3</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>element_values[Rp3b] <span class="op">=</span> <span class="fl">5e3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="d1a0d92e-0246-4962-bf6f-807e3db670e7" class="cell" data-execution_count="216">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>NE <span class="op">=</span> NE_sym.subs(element_values)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>U <span class="op">=</span> solve(NE,X)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>H <span class="op">=</span> U[v2]<span class="op">/</span>U[v11]</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>num, denom <span class="op">=</span> fraction(H) <span class="co">#returns numerator and denominator</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a><span class="co"># convert symbolic to numpy polynomial</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> np.array(Poly(num, s).all_coeffs(), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> np.array(Poly(denom, s).all_coeffs(), dtype<span class="op">=</span><span class="bu">float</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The poles and zeros of the transfer function can easily be obtained with the following code:</p>
<div id="2832de24-c597-4c63-9dbf-749a4538504d" class="cell" data-execution_count="217">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>sys_tf <span class="op">=</span> signal.TransferFunction(a,b)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>sys_zeros <span class="op">=</span> np.roots(sys_tf.num)</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>sys_poles <span class="op">=</span> np.roots(sys_tf.den)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The poles and zeros of the transfer function are plotted below. As indicated in the legend, the location of the zeros are marked with blue circles and the location of the poles are marked with red x’s.</p>
<div id="5ee139b8-9d20-44a9-ab42-80604fa0fd49" class="cell" data-execution_count="218">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>plt.plot(np.real(sys_zeros), np.imag(sys_zeros), <span class="st">'ob'</span>, markerfacecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>plt.plot(np.real(sys_poles), np.imag(sys_poles), <span class="st">'xr'</span>)</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>plt.legend([<span class="st">'Zeros'</span>, <span class="st">'Poles'</span>], loc<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Pole / Zero Plot'</span>)</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'real part, </span><span class="ch">\u03C3</span><span class="st">'</span>)</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'imaginary part, j</span><span class="ch">\u03C9</span><span class="st">'</span>)</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Klon Centaur part 1_files/figure-html/cell-60-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>In the plot above, the units of frequency are in radians, cycles per 1 radian, or <span class="math inline">\(2\pi\)</span> degrees. There is a zero at 0 Hz, which is from C15. The second zero is from C2. The two poles are also from C15 and C2 combined with various resistors in the network.</p>
<p>Printing these values in Hz.</p>
<div id="c93535cc-94eb-43bf-93b1-4261609504e5" class="cell" data-execution_count="219">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'number of zeros: </span><span class="sc">{:d}</span><span class="st">'</span>.<span class="bu">format</span>(<span class="bu">len</span>(sys_zeros)))</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(sys_zeros)):</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'z</span><span class="sc">{:d}</span><span class="st">: </span><span class="sc">{:,.2f}</span><span class="st"> Hz'</span>.<span class="bu">format</span>(i,sys_zeros[i]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi)))</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'number of poles: </span><span class="sc">{:d}</span><span class="st">'</span>.<span class="bu">format</span>(<span class="bu">len</span>(sys_poles)))</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(sys_poles)):</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'p</span><span class="sc">{:d}</span><span class="st">: </span><span class="sc">{:,.2f}</span><span class="st"> Hz'</span>.<span class="bu">format</span>(i,sys_poles[i]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>number of zeros: 2
z0: -0.83 Hz
z1: 0.00 Hz
number of poles: 2
p0: -3.40 Hz
p1: -0.80 Hz</code></pre>
</div>
</div>
</section>
<section id="step-response-2" class="level4" data-number="37.9.2.2">
<h4 data-number="37.9.2.2" class="anchored" data-anchor-id="step-response-2"><span class="header-section-number">37.9.2.2</span> Step response</h4>
<p>The step response of the is calculated using the SciPy function <code>lsim</code> and plotted below. A square wave with a frequency of 500 Hz and an amplitude of 0.1 volts peak to peak is used as the input to this path. An input amplitude of 0.1 Vpp is used to keep the signal levels in the path below the conduction threshold for the diodes. The input square wave has a positive 0.05 volt offset which allows us to examine the DC characteristics of the path. The frequency of the square wave was chosen to allow the time constant of the path to be plotted with sufficient resolution to be examined in the plot.</p>
<div id="6a7bd2e1-1cbf-40ce-b73c-6502ca96dc9d" class="cell" data-execution_count="220">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">500</span>, endpoint<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>sqr_signal <span class="op">=</span> signal.square(<span class="dv">2</span><span class="op">*</span>np.pi<span class="op">*</span><span class="fl">0.5</span><span class="op">*</span>t, duty<span class="op">=</span><span class="fl">0.5</span>)<span class="op">/</span><span class="dv">20</span><span class="op">+</span><span class="dv">1</span><span class="op">/</span><span class="dv">20</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>t_step, y_step, x_step <span class="op">=</span> signal.lsim(sys_tf, U<span class="op">=</span>sqr_signal, T<span class="op">=</span>t)</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>plt.plot(t_step, sqr_signal, <span class="st">'r'</span>, alpha<span class="op">=</span><span class="fl">0.75</span>, linewidth<span class="op">=</span><span class="dv">1</span>, label<span class="op">=</span><span class="st">'input'</span>)</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>plt.plot(t_step, y_step,<span class="st">'b'</span>, linewidth<span class="op">=</span><span class="fl">1.25</span>, label<span class="op">=</span><span class="st">'output'</span>)</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Step response'</span>)</span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'volts'</span>)</span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'time, sec'</span>)</span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">'best'</span>)</span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a><span class="co"># show plot</span></span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Klon Centaur part 1_files/figure-html/cell-62-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The step response shows that the DC gain of the path is zero. There is a relatively small spike in the output at each square wave edge. The step response of this path could be explored in more detail during prototype testing.</p>
</section>
<section id="group-delay-1" class="level4" data-number="37.9.2.3">
<h4 data-number="37.9.2.3" class="anchored" data-anchor-id="group-delay-1"><span class="header-section-number">37.9.2.3</span> Group delay</h4>
<p>The group delay for this path is calculated and plotted below.</p>
<div id="ef814e9f-c9d5-45ed-8a6d-f019e3b53b8c" class="cell" data-execution_count="221">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.logspace(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">2000</span>, endpoint<span class="op">=</span><span class="va">False</span>)<span class="op">*</span><span class="dv">2</span><span class="op">*</span>np.pi</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>w, mag, phase <span class="op">=</span> signal.bode((a, b), w<span class="op">=</span>x) <span class="co"># returns: rad/s, mag in dB, phase in deg</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'group delay'</span>)</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>plt.semilogx(w<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), <span class="op">-</span>np.gradient(phase<span class="op">*</span>np.pi<span class="op">/</span><span class="dv">180</span>)<span class="op">/</span>np.gradient(w)<span class="op">*</span><span class="dv">1000</span>,<span class="st">'-'</span>,label<span class="op">=</span><span class="st">'group delay'</span>)</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a><span class="co"># highlight the guitar audio band, 80 to 8kHz</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>plt.axvspan(<span class="dv">80</span>, <span class="fl">8e3</span>, color<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>plt.xlim((<span class="dv">10</span>,<span class="fl">100e3</span>))</span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>plt.ylim((<span class="dv">0</span>,<span class="dv">2</span>))</span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Group delay, msec'</span>)</span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Frequency, Hz'</span>)</span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Klon Centaur part 1_files/figure-html/cell-63-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The plot above shows that for frequencies in the guitar audio band, the group delay variation is less than 2 ms and therefore below the threshold of audibility as described in <a href="#sec-Group_delay" class="quarto-xref"><span>Section 37.8.6</span></a>.</p>
</section>
<section id="bypass-signal-leakage-into-effects-path" class="level4" data-number="37.9.2.4">
<h4 data-number="37.9.2.4" class="anchored" data-anchor-id="bypass-signal-leakage-into-effects-path"><span class="header-section-number">37.9.2.4</span> Bypass signal leakage into effects path</h4>
<p>The frequency response of the bypass signal leakage into the effects path is shown below. The bypass switch is simulated by setting the values of <span class="math inline">\(R_{26}\)</span> and <span class="math inline">\(R_{27}\)</span></p>
<div id="cell-fig-effect-path-bypass-leakage-freq-plot" class="cell" data-execution_count="222">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>element_values[V1] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>element_values[V2] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>element_values[R26] <span class="op">=</span> <span class="fl">68e3</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>element_values[R27] <span class="op">=</span> <span class="fl">0.01</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>output_setting <span class="op">=</span> np.array([<span class="dv">1</span>,<span class="dv">25</span>,<span class="dv">50</span>,<span class="dv">75</span>,<span class="dv">99</span>])</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.logspace(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">2000</span>, endpoint<span class="op">=</span><span class="va">False</span>)<span class="op">*</span><span class="dv">2</span><span class="op">*</span>np.pi</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>color_list <span class="op">=</span> [<span class="st">'tab:blue'</span>,<span class="st">'tab:red'</span>,<span class="st">'tab:green'</span>,<span class="st">'tab:orange'</span>,<span class="st">'k'</span>]</span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>fig, ax1 <span class="op">=</span> plt.subplots()</span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'magnitude, dB'</span>)</span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'frequency, Hz'</span>)</span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a><span class="co"># instantiate a second y-axes that shares the same x-axis</span></span>
<span id="cb78-17"><a href="#cb78-17" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> ax1.twinx()</span>
<span id="cb78-18"><a href="#cb78-18" aria-hidden="true" tabindex="-1"></a>color <span class="op">=</span> <span class="st">'k'</span></span>
<span id="cb78-19"><a href="#cb78-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-20"><a href="#cb78-20" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'phase, deg'</span>,color<span class="op">=</span>color)</span>
<span id="cb78-21"><a href="#cb78-21" aria-hidden="true" tabindex="-1"></a>ax2.tick_params(axis<span class="op">=</span><span class="st">'y'</span>, labelcolor<span class="op">=</span>color)</span>
<span id="cb78-22"><a href="#cb78-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-23"><a href="#cb78-23" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(output_setting)):</span>
<span id="cb78-24"><a href="#cb78-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-25"><a href="#cb78-25" aria-hidden="true" tabindex="-1"></a>    element_values[Rp3a] <span class="op">=</span> p3_value <span class="op">-</span> audio_pot_10k(output_setting[i]) </span>
<span id="cb78-26"><a href="#cb78-26" aria-hidden="true" tabindex="-1"></a>    element_values[Rp3b] <span class="op">=</span> audio_pot_10k(output_setting[i])</span>
<span id="cb78-27"><a href="#cb78-27" aria-hidden="true" tabindex="-1"></a>    NE <span class="op">=</span> NE_sym.subs(element_values)</span>
<span id="cb78-28"><a href="#cb78-28" aria-hidden="true" tabindex="-1"></a>    U <span class="op">=</span> solve(NE,X)</span>
<span id="cb78-29"><a href="#cb78-29" aria-hidden="true" tabindex="-1"></a>    H <span class="op">=</span> U[v2]<span class="op">/</span>U[v1]</span>
<span id="cb78-30"><a href="#cb78-30" aria-hidden="true" tabindex="-1"></a>    num, denom <span class="op">=</span> fraction(H) <span class="co">#returns numerator and denominator</span></span>
<span id="cb78-31"><a href="#cb78-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-32"><a href="#cb78-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># convert symbolic to NumPy polynomial</span></span>
<span id="cb78-33"><a href="#cb78-33" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> np.array(Poly(num, s).all_coeffs(), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb78-34"><a href="#cb78-34" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> np.array(Poly(denom, s).all_coeffs(), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb78-35"><a href="#cb78-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-36"><a href="#cb78-36" aria-hidden="true" tabindex="-1"></a>    w, mag, phase <span class="op">=</span> signal.bode((a, b), w<span class="op">=</span>x) <span class="co"># returns: rad/s, mag in dB, phase in deg</span></span>
<span id="cb78-37"><a href="#cb78-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-38"><a href="#cb78-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># plot the results.  </span></span>
<span id="cb78-39"><a href="#cb78-39" aria-hidden="true" tabindex="-1"></a>    ax1.semilogx(w<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), mag,<span class="st">'-'</span>,color<span class="op">=</span>color_list[i],label<span class="op">=</span><span class="st">'magnitude, P3 at </span><span class="sc">{:.0f}</span><span class="st">%'</span>.<span class="bu">format</span>(output_setting[i]))    <span class="co"># magnitude plot</span></span>
<span id="cb78-40"><a href="#cb78-40" aria-hidden="true" tabindex="-1"></a>    ax2.semilogx(w<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), phase,<span class="st">':'</span>,color<span class="op">=</span>color_list[i],label<span class="op">=</span><span class="st">'phase, P3 at </span><span class="sc">{:.0f}</span><span class="st">%'</span>.<span class="bu">format</span>(output_setting[i]))  <span class="co"># phase plot</span></span>
<span id="cb78-41"><a href="#cb78-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-42"><a href="#cb78-42" aria-hidden="true" tabindex="-1"></a><span class="co"># highlight the guitar audio band, 80 to 8kHz</span></span>
<span id="cb78-43"><a href="#cb78-43" aria-hidden="true" tabindex="-1"></a>plt.axvspan(<span class="dv">80</span>, <span class="fl">8e3</span>, color<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb78-44"><a href="#cb78-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-45"><a href="#cb78-45" aria-hidden="true" tabindex="-1"></a><span class="co"># position legends outside the graph</span></span>
<span id="cb78-46"><a href="#cb78-46" aria-hidden="true" tabindex="-1"></a>ax1.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.6</span>,<span class="dv">1</span>)) <span class="co"># magnitude legend position: relative (horizontal position, vertical position) </span></span>
<span id="cb78-47"><a href="#cb78-47" aria-hidden="true" tabindex="-1"></a>ax2.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.6</span>,<span class="fl">0.5</span>)) <span class="co"># phase legend position:</span></span>
<span id="cb78-48"><a href="#cb78-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-49"><a href="#cb78-49" aria-hidden="true" tabindex="-1"></a>ax1.grid()</span>
<span id="cb78-50"><a href="#cb78-50" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Magnitude and phase response'</span>)</span>
<span id="cb78-51"><a href="#cb78-51" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-effect-path-bypass-leakage-freq-plot" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-effect-path-bypass-leakage-freq-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Klon Centaur part 1_files/figure-html/fig-effect-path-bypass-leakage-freq-plot-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-effect-path-bypass-leakage-freq-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;37.9: Bypass signal leakage into effects path magnitude and phase response
</figcaption>
</figure>
</div>
</div>
</div>
<p>The gain of the output circuit for the bypass path to the output with the bypass switch off varies as a function of P3 position. As shown above the maximum leakage for the values plotted is at a rotational position of 75%.</p>
<p>The signal leakage into the other path, while not zero, is very small and not a concern.</p>
</section>
</section>
</section>
<section id="treble-control" class="level2" data-number="37.10">
<h2 data-number="37.10" class="anchored" data-anchor-id="treble-control"><span class="header-section-number">37.10</span> Treble control</h2>
<p>The treble control circuit is highlighted in the schematic below and can be analyzed independently from the rest of the Klon Centaur circuit if we consider the sub circuit from the output of U2A to the output of U2B. The isolation and buffering provided by the Op Amp allows us to analyze this part of the pedal without having to consider other parts of the circuit.</p>
<div id="fig-klon-centaur-schematic-high-res_w_treble_highlight_sch" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-klon-centaur-schematic-high-res_w_treble_highlight_sch-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="klon-centaur-schematic-high-res_w_treble_highlight.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-klon-centaur-schematic-high-res_w_treble_highlight_sch-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;37.10: Schematic of Klon Centaur treble circuit highlighted.
</figcaption>
</figure>
</div>
<p>The circuit for the treble control was drawn using LTSpice and shown below. The treble control allows the frequency response of the pedal to be adjusted. The treble circuit resembles the treble portion of the classic <a href="https://en.wikipedia.org/wiki/Peter_Baxandall">Baxandall</a> tone control circuit. As shown in the circuit analysis below, the circuit can cut or boost the treble frequencies with a single potentiometer control. The capacitor, C14, is connected from the inverting terminal of U2B to the wiper contact of potentiometer P2. This places a frequency dependent negative feedback network around the Op Amp.</p>
<p>There are several interesting online references for audio tone control circuits:</p>
<ul>
<li><a href="https://www.petervis.com/record_players_and_turntables/baxandall-tone-control/circuit-and-calculator.html">tone circuit calculator</a></li>
<li><a href="https://www.learnabout-electronics.org/Amplifiers/amplifiers42.php">Amplifier Controls</a></li>
<li><a href="https://www.ti.com/lit/an/sloa042/sloa042.pdf">Audio Tone Control Using The TLC074 Operational Amplifier</a></li>
<li><a href="https://www.guitarscience.net/tsc/james_4.htm#RIN=600&amp;R1=2200&amp;R2=2200&amp;R3=2200&amp;RB=10k&amp;RT=10k&amp;RF=600&amp;CB=220n&amp;CT1=10n&amp;CT2=10n&amp;RB_pot=Linear&amp;RT_pot=Linear">James tone stack</a></li>
<li><a href="https://www.ampbooks.com/mobile/amp-technology/james-tonestack-analysis/">James Tone Stack - Analysis</a></li>
</ul>
<div id="fig-Klon-Centaur_treble_v2_sch" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-Klon-Centaur_treble_v2_sch-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Klon-Centaur_treble_v2.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-Klon-Centaur_treble_v2_sch-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;37.11: LTSpice schematic of the treble circuit.
</figcaption>
</figure>
</div>
<p>V1 is the input signal for circuit and for frequency analysis the value is 1.</p>
<p>Two resistors, R21, a 1.8K <span class="math inline">\(\Omega\)</span> resistor and R23, a 4.7K <span class="math inline">\(\Omega\)</span> resistor, sit on either side of the treble potentiometer and skew the treble control towards treble boost at the control mid point of rotation, since R21 is a lower value. R21 and R23 also limit the amount of boost and cut provided by the treble circuit.</p>
<p>R22 is a 100K <span class="math inline">\(\Omega\)</span> resistor and with R241 sets the DC gain of the Op Amp circuit.</p>
<p>The treble control, potentiometer P2, is modeled as a voltage divider consisting of resistors with reference designators of Rp2a and Rp2b. The value of Rp2a is controlled by the equation <span class="math inline">\(Rp2a=10k-R_{treble}\)</span> and the value of Rp2b is controlled by the equation <span class="math inline">\(Rp2b=R_{treble}\)</span>, with the variable <span class="math inline">\(R_{treble}\)</span> indicating the value of the potentiometer set by the rotational position of the knob.</p>
<p>C14 is a 3.9n Farad capacitor and one end is connected to the inverting input of the Op Amp, which is a virtual ground. The other end is connected to the wiper terminal of P2.</p>
<p>R21, Rp2a and C14 form a low pass network, since C14 is shunting the input signal to the virtual ground. This puts a zero in the voltage transfer function. The output signal from the Op Amp is fed back to the inverting input through the network of R23, Rp2b and C14 and because these components put a pole in the voltage transfer function. The relative pole and zero location in the complex frequency plane determine if the circuit will provide boost or cut to the treble frequencies.</p>
<p>R241 is a 100K <span class="math inline">\(\Omega\)</span> resistor in the negative feedback path of the Op Amp along with the components R23, Rp2b and C14. R241 along with R22, P2, R21 and R23 set the DC gain for the circuit.</p>
<p>U2B is an ideal Op Amp in this analysis.</p>
<p>Load the net list for the treble control circuit.</p>
<div id="c7c219e6-95bd-4ec1-b5d3-6a11f65b6fa3" class="cell" data-tags="[]" data-execution_count="223">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>treble_v2_net_list <span class="op">=</span> <span class="st">'''</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="st">V1 1 0 1</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="st">R21 1 4 1.8e3</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a><span class="st">R22 3 1 100e3</span></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a><span class="st">Rp2a 4 5 5e3</span></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a><span class="st">Rp2b 5 6 5e3</span></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a><span class="st">C14 3 5 3.9e-9</span></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a><span class="st">R241 2 3 100e3</span></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a><span class="st">R23 2 6 4.7e3</span></span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a><span class="st">O2b 3 0 2</span></span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a><span class="st">'''</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Call the symbolic modified nodal analysis function to generate the network matrices and databases.</p>
<div id="060c230d-5548-48f6-ac9e-c259a25f677b" class="cell" data-execution_count="224">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>report, network_df, i_unk_df, A, X, Z <span class="op">=</span> SymMNA.smna(treble_v2_net_list)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Build the network equations and display the equations.</p>
<div id="f526cd54-f824-4d6b-946a-79829650f781" class="cell" data-execution_count="225">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Put matrices into SymPy </span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> Matrix(X)</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>Z <span class="op">=</span> Matrix(Z)</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>NE_sym <span class="op">=</span> Eq(A<span class="op">*</span>X,Z)</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a><span class="co"># display the equations</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>temp <span class="op">=</span> <span class="st">''</span></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(shape(NE_sym.lhs)[<span class="dv">0</span>]):</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">+=</span> <span class="st">'$</span><span class="sc">{:s}</span><span class="st"> = </span><span class="sc">{:s}</span><span class="st">$&lt;br&gt;'</span>.<span class="bu">format</span>(latex(NE_sym.rhs[i]),latex(NE_sym.lhs[i]))</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>Markdown(temp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="225">
<p><span class="math inline">\(0 = I_{V1} + v_{1} \cdot \left(\frac{1}{R_{22}} + \frac{1}{R_{21}}\right) - \frac{v_{3}}{R_{22}} - \frac{v_{4}}{R_{21}}\)</span><br><span class="math inline">\(0 = I_{O2b} + v_{2} \cdot \left(\frac{1}{R_{241}} + \frac{1}{R_{23}}\right) - \frac{v_{3}}{R_{241}} - \frac{v_{6}}{R_{23}}\)</span><br><span class="math inline">\(0 = - C_{14} s v_{5} + v_{3} \left(C_{14} s + \frac{1}{R_{241}} + \frac{1}{R_{22}}\right) - \frac{v_{2}}{R_{241}} - \frac{v_{1}}{R_{22}}\)</span><br><span class="math inline">\(0 = v_{4} \cdot \left(\frac{1}{Rp2a} + \frac{1}{R_{21}}\right) - \frac{v_{5}}{Rp2a} - \frac{v_{1}}{R_{21}}\)</span><br><span class="math inline">\(0 = - C_{14} s v_{3} + v_{5} \left(C_{14} s + \frac{1}{Rp2b} + \frac{1}{Rp2a}\right) - \frac{v_{6}}{Rp2b} - \frac{v_{4}}{Rp2a}\)</span><br><span class="math inline">\(0 = v_{6} \cdot \left(\frac{1}{Rp2b} + \frac{1}{R_{23}}\right) - \frac{v_{5}}{Rp2b} - \frac{v_{2}}{R_{23}}\)</span><br><span class="math inline">\(V_{1} = v_{1}\)</span><br><span class="math inline">\(0 = v_{3}\)</span><br></p>
</div>
</div>
<p>Turn the free symbols into SymPy variables.</p>
<div id="27402266-7ad0-4e1a-9acd-902b713c9e0d" class="cell" data-execution_count="226">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>var(<span class="bu">str</span>(NE_sym.free_symbols).replace(<span class="st">'{'</span>,<span class="st">''</span>).replace(<span class="st">'}'</span>,<span class="st">''</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="226">
<p><span class="math inline">\(\displaystyle \left( v_{6}, \  I_{O2b}, \  v_{1}, \  V_{1}, \  v_{2}, \  s, \  Rp2b, \  R_{21}, \  v_{3}, \  R_{22}, \  v_{4}, \  I_{V1}, \  v_{5}, \  C_{14}, \  R_{241}, \  R_{23}, \  Rp2a\right)\)</span></p>
</div>
</div>
<p>Get the element values from the network database.</p>
<div id="479b9cc8-385c-454d-95c3-e5f01a99a1be" class="cell" data-execution_count="227">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>element_values <span class="op">=</span> SymMNA.get_part_values(network_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="symbolic-solution-1" class="level3" data-number="37.10.1">
<h3 data-number="37.10.1" class="anchored" data-anchor-id="symbolic-solution-1"><span class="header-section-number">37.10.1</span> Symbolic solution</h3>
<p>The network equations can be solved symbolically and the solution to the node voltages and unknown currents is displayed.</p>
<div id="9ed5275c-9b6c-4434-8d0e-ef80fa91144e" class="cell" data-execution_count="228">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>U_sym <span class="op">=</span> solve(NE_sym,X)</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="co"># display the symbolic solution</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>temp <span class="op">=</span> <span class="st">''</span></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> U_sym.keys():</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">+=</span> <span class="st">'$</span><span class="sc">{:s}</span><span class="st"> = </span><span class="sc">{:s}</span><span class="st">$&lt;br&gt;'</span>.<span class="bu">format</span>(latex(i),latex(U_sym[i]))</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>Markdown(temp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="228">
<p><span class="math inline">\(v_{1} = V_{1}\)</span><br><span class="math inline">\(v_{2} = \frac{- C_{14} R_{21} R_{23} R_{241} V_{1} s - C_{14} R_{21} R_{241} Rp2b V_{1} s - C_{14} R_{22} R_{23} R_{241} V_{1} s - C_{14} R_{22} R_{241} Rp2b V_{1} s - C_{14} R_{23} R_{241} Rp2a V_{1} s - C_{14} R_{241} Rp2a Rp2b V_{1} s - R_{21} R_{241} V_{1} - R_{23} R_{241} V_{1} - R_{241} Rp2a V_{1} - R_{241} Rp2b V_{1}}{C_{14} R_{21} R_{22} R_{23} s + C_{14} R_{21} R_{22} R_{241} s + C_{14} R_{21} R_{22} Rp2b s + C_{14} R_{22} R_{23} Rp2a s + C_{14} R_{22} R_{241} Rp2a s + C_{14} R_{22} Rp2a Rp2b s + R_{21} R_{22} + R_{22} R_{23} + R_{22} Rp2a + R_{22} Rp2b}\)</span><br><span class="math inline">\(v_{3} = 0\)</span><br><span class="math inline">\(v_{4} = \frac{C_{14} R_{22} R_{23} Rp2a V_{1} s + C_{14} R_{22} R_{241} Rp2a V_{1} s + C_{14} R_{22} Rp2a Rp2b V_{1} s - R_{21} R_{241} V_{1} + R_{22} R_{23} V_{1} + R_{22} Rp2a V_{1} + R_{22} Rp2b V_{1}}{C_{14} R_{21} R_{22} R_{23} s + C_{14} R_{21} R_{22} R_{241} s + C_{14} R_{21} R_{22} Rp2b s + C_{14} R_{22} R_{23} Rp2a s + C_{14} R_{22} R_{241} Rp2a s + C_{14} R_{22} Rp2a Rp2b s + R_{21} R_{22} + R_{22} R_{23} + R_{22} Rp2a + R_{22} Rp2b}\)</span><br><span class="math inline">\(v_{5} = \frac{- R_{21} R_{241} V_{1} + R_{22} R_{23} V_{1} + R_{22} Rp2b V_{1} - R_{241} Rp2a V_{1}}{C_{14} R_{21} R_{22} R_{23} s + C_{14} R_{21} R_{22} R_{241} s + C_{14} R_{21} R_{22} Rp2b s + C_{14} R_{22} R_{23} Rp2a s + C_{14} R_{22} R_{241} Rp2a s + C_{14} R_{22} Rp2a Rp2b s + R_{21} R_{22} + R_{22} R_{23} + R_{22} Rp2a + R_{22} Rp2b}\)</span><br><span class="math inline">\(v_{6} = \frac{- C_{14} R_{21} R_{241} Rp2b V_{1} s - C_{14} R_{22} R_{241} Rp2b V_{1} s - C_{14} R_{241} Rp2a Rp2b V_{1} s - R_{21} R_{241} V_{1} + R_{22} R_{23} V_{1} - R_{241} Rp2a V_{1} - R_{241} Rp2b V_{1}}{C_{14} R_{21} R_{22} R_{23} s + C_{14} R_{21} R_{22} R_{241} s + C_{14} R_{21} R_{22} Rp2b s + C_{14} R_{22} R_{23} Rp2a s + C_{14} R_{22} R_{241} Rp2a s + C_{14} R_{22} Rp2a Rp2b s + R_{21} R_{22} + R_{22} R_{23} + R_{22} Rp2a + R_{22} Rp2b}\)</span><br><span class="math inline">\(I_{V1} = \frac{- C_{14} R_{21} R_{23} V_{1} s - C_{14} R_{21} R_{241} V_{1} s - C_{14} R_{21} Rp2b V_{1} s - C_{14} R_{22} R_{23} V_{1} s - C_{14} R_{22} R_{241} V_{1} s - C_{14} R_{22} Rp2b V_{1} s - C_{14} R_{23} Rp2a V_{1} s - C_{14} R_{241} Rp2a V_{1} s - C_{14} Rp2a Rp2b V_{1} s - R_{21} V_{1} - R_{22} V_{1} - R_{23} V_{1} - R_{241} V_{1} - Rp2a V_{1} - Rp2b V_{1}}{C_{14} R_{21} R_{22} R_{23} s + C_{14} R_{21} R_{22} R_{241} s + C_{14} R_{21} R_{22} Rp2b s + C_{14} R_{22} R_{23} Rp2a s + C_{14} R_{22} R_{241} Rp2a s + C_{14} R_{22} Rp2a Rp2b s + R_{21} R_{22} + R_{22} R_{23} + R_{22} Rp2a + R_{22} Rp2b}\)</span><br><span class="math inline">\(I_{O2b} = \frac{C_{14} R_{21} R_{23} V_{1} s + C_{14} R_{21} R_{241} V_{1} s + C_{14} R_{21} Rp2b V_{1} s + C_{14} R_{22} R_{23} V_{1} s + C_{14} R_{22} R_{241} V_{1} s + C_{14} R_{22} Rp2b V_{1} s + C_{14} R_{23} Rp2a V_{1} s + C_{14} R_{241} Rp2a V_{1} s + C_{14} Rp2a Rp2b V_{1} s + R_{21} V_{1} + R_{22} V_{1} + R_{23} V_{1} + R_{241} V_{1} + Rp2a V_{1} + Rp2b V_{1}}{C_{14} R_{21} R_{22} R_{23} s + C_{14} R_{21} R_{22} R_{241} s + C_{14} R_{21} R_{22} Rp2b s + C_{14} R_{22} R_{23} Rp2a s + C_{14} R_{22} R_{241} Rp2a s + C_{14} R_{22} Rp2a Rp2b s + R_{21} R_{22} + R_{22} R_{23} + R_{22} Rp2a + R_{22} Rp2b}\)</span><br></p>
</div>
</div>
</section>
<section id="transfer-function" class="level3" data-number="37.10.2">
<h3 data-number="37.10.2" class="anchored" data-anchor-id="transfer-function"><span class="header-section-number">37.10.2</span> Transfer function</h3>
<p>The transfer function, <span class="math inline">\(H(s)=\frac{v_2}{v_1}\)</span>, can be expressed in symbolic form and is displayed below.</p>
<div id="e66f25c4-56e4-4b98-9e69-37c4e2dfc782" class="cell" data-execution_count="229">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>H_sym <span class="op">=</span> cancel(U_sym[v2]<span class="op">/</span>U_sym[v1])</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>H_sym</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="229">
<p><span class="math inline">\(\displaystyle \frac{- C_{14} R_{21} R_{23} R_{241} s - C_{14} R_{21} R_{241} Rp2b s - C_{14} R_{22} R_{23} R_{241} s - C_{14} R_{22} R_{241} Rp2b s - C_{14} R_{23} R_{241} Rp2a s - C_{14} R_{241} Rp2a Rp2b s - R_{21} R_{241} - R_{23} R_{241} - R_{241} Rp2a - R_{241} Rp2b}{C_{14} R_{21} R_{22} R_{23} s + C_{14} R_{21} R_{22} R_{241} s + C_{14} R_{21} R_{22} Rp2b s + C_{14} R_{22} R_{23} Rp2a s + C_{14} R_{22} R_{241} Rp2a s + C_{14} R_{22} Rp2a Rp2b s + R_{21} R_{22} + R_{22} R_{23} + R_{22} Rp2a + R_{22} Rp2b}\)</span></p>
</div>
</div>
</section>
<section id="dc-gain" class="level3" data-number="37.10.3">
<h3 data-number="37.10.3" class="anchored" data-anchor-id="dc-gain"><span class="header-section-number">37.10.3</span> DC gain</h3>
<p>The gain of the treble circuit at zero frequency can be calculated by putting the component values into <span class="math inline">\(H(s)\)</span> and setting <span class="math inline">\(s=0\)</span> as shown below.</p>
<div id="cfd3c054-c412-4637-a36c-be4d3d9c2863" class="cell" data-execution_count="230">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>H_sym.subs({s:<span class="dv">0</span>}).subs(element_values)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="230">
<p><span class="math inline">\(\displaystyle -1.0\)</span></p>
</div>
</div>
<p>The DC gain of the treble circuit is -1.</p>
</section>
<section id="solve-p2-position-for-flat-treble-response" class="level3" data-number="37.10.4">
<h3 data-number="37.10.4" class="anchored" data-anchor-id="solve-p2-position-for-flat-treble-response"><span class="header-section-number">37.10.4</span> Solve P2 position for flat treble response</h3>
<p>The position of P2 that gives a flat treble response can be calculated. A flat frequency response occurs when the numerator of <span class="math inline">\(H(s)\)</span> equal to the denominator. Another way of saying this is, the frequency response is flat when the system pole and zero are at the same frequency. Since <span class="math inline">\(R_{21}\)</span> and <span class="math inline">\(R_{23}\)</span> have different values, a flat frequency response will not occur at the rotational mid point of P2.</p>
<p>In the cells that follow, the SymPy symbols <span class="math inline">\(P2a\)</span> and <span class="math inline">\(P2b\)</span> are defined and are substituted into the system transfer function. This is done for two reasons, first to make it clear that we are solving for the value of P2 sections ‘a’ and ‘b’. Second, we want to substitute numerical values for the symbols and we don’t want to overwrite the values of Rp2a and Rp2b. The modified <span class="math inline">\(H_{sym}\)</span> is displayed below.</p>
<div id="417c0c3d-a035-4407-aaab-4f959fb333a9" class="cell" data-execution_count="231">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>P2a, P2b <span class="op">=</span> symbols(<span class="st">'P2a P2b'</span>)</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>H_sym1 <span class="op">=</span> H_sym.subs({𝑅𝑝<span class="dv">2</span><span class="er">𝑏</span>:P2b,Rp2a:P2a})</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>H_sym1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="231">
<p><span class="math inline">\(\displaystyle \frac{- C_{14} P2a P2b R_{241} s - C_{14} P2a R_{23} R_{241} s - C_{14} P2b R_{21} R_{241} s - C_{14} P2b R_{22} R_{241} s - C_{14} R_{21} R_{23} R_{241} s - C_{14} R_{22} R_{23} R_{241} s - P2a R_{241} - P2b R_{241} - R_{21} R_{241} - R_{23} R_{241}}{C_{14} P2a P2b R_{22} s + C_{14} P2a R_{22} R_{23} s + C_{14} P2a R_{22} R_{241} s + C_{14} P2b R_{21} R_{22} s + C_{14} R_{21} R_{22} R_{23} s + C_{14} R_{21} R_{22} R_{241} s + P2a R_{22} + P2b R_{22} + R_{21} R_{22} + R_{22} R_{23}}\)</span></p>
</div>
</div>
<p>The numerator and denominator of <span class="math inline">\(H_{sym}\)</span> can be extracted and saved off as new variables, num_sym and denom_sym.</p>
<div id="cc3388ef-f304-4c69-bfbd-324f33f58190" class="cell" data-execution_count="232">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>num_sym, denom_sym <span class="op">=</span> fraction(H_sym1)</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>num_sym</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="232">
<p><span class="math inline">\(\displaystyle - C_{14} P2a P2b R_{241} s - C_{14} P2a R_{23} R_{241} s - C_{14} P2b R_{21} R_{241} s - C_{14} P2b R_{22} R_{241} s - C_{14} R_{21} R_{23} R_{241} s - C_{14} R_{22} R_{23} R_{241} s - P2a R_{241} - P2b R_{241} - R_{21} R_{241} - R_{23} R_{241}\)</span></p>
</div>
</div>
<p>The root of the numerator polynomial is solved for and displayed.</p>
<div id="8ff4dc88-7c7b-4b02-911c-a39c9aab48a9" class="cell" data-execution_count="233">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>num_root_sym <span class="op">=</span> solve(num_sym,s)[<span class="dv">0</span>]</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>num_root_sym</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="233">
<p><span class="math inline">\(\displaystyle \frac{- P2a - P2b - R_{21} - R_{23}}{C_{14} \left(P2a P2b + P2a R_{23} + P2b R_{21} + P2b R_{22} + R_{21} R_{23} + R_{22} R_{23}\right)}\)</span></p>
</div>
</div>
<p>Display the denominator polynomial.</p>
<div id="a0049844-ce2d-4130-b902-6037d97bce79" class="cell" data-execution_count="234">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>denom_sym</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="234">
<p><span class="math inline">\(\displaystyle C_{14} P2a P2b R_{22} s + C_{14} P2a R_{22} R_{23} s + C_{14} P2a R_{22} R_{241} s + C_{14} P2b R_{21} R_{22} s + C_{14} R_{21} R_{22} R_{23} s + C_{14} R_{21} R_{22} R_{241} s + P2a R_{22} + P2b R_{22} + R_{21} R_{22} + R_{22} R_{23}\)</span></p>
</div>
</div>
<p>The root of the denominator polynomial is solved for and displayed.</p>
<div id="322b72f3-dea3-4ed7-b667-615df89fae59" class="cell" data-execution_count="235">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>denom_root_sym <span class="op">=</span> solve(denom_sym,s)[<span class="dv">0</span>]</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>denom_root_sym</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="235">
<p><span class="math inline">\(\displaystyle \frac{- P2a - P2b - R_{21} - R_{23}}{C_{14} \left(P2a P2b + P2a R_{23} + P2a R_{241} + P2b R_{21} + R_{21} R_{23} + R_{21} R_{241}\right)}\)</span></p>
</div>
</div>
<p>Numerical values are substituted into the expressions for the roots, while leaving P2a and P2b as variables.</p>
<div id="8a14506d-6ced-4528-9513-ce95cf8a3c7b" class="cell" data-execution_count="236">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>num_root <span class="op">=</span> num_root_sym.subs(element_values)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>num_root</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="236">
<p><span class="math inline">\(\displaystyle \frac{256410256.410256 \left(- P2a - P2b - 6500.0\right)}{P2a P2b + 4700.0 P2a + 101800.0 P2b + 478460000.0}\)</span></p>
</div>
</div>
<div id="ae10b7fc-1a04-444c-9717-54c169ff0ab7" class="cell" data-execution_count="237">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>denom_root <span class="op">=</span> denom_root_sym.subs(element_values)</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>denom_root</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="237">
<p><span class="math inline">\(\displaystyle \frac{256410256.410256 \left(- P2a - P2b - 6500.0\right)}{P2a P2b + 104700.0 P2a + 1800.0 P2b + 188460000.0}\)</span></p>
</div>
</div>
<p>PymPy can be used to solve the equations:</p>
<p><span class="math inline">\(P2_a+P2_b = 10k\Omega\)</span></p>
<p><span class="math inline">\(numerator_{root} = denominator_{root}\)</span></p>
<p>Rearranging the equations to put zero on the right hand side of the equal sign and using SymPy to solve for P2a nd P2b, we get:</p>
<div id="b4ec228b-e571-41c1-94bf-1c4441f9fbb3" class="cell" data-execution_count="238">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>P2_a, P2_b <span class="op">=</span> solve([num_root<span class="op">-</span>denom_root,P2a<span class="op">+</span>P2b<span class="op">-</span><span class="dv">10000</span>],P2a,P2b)[<span class="dv">0</span>]</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'solution: P2a = </span><span class="sc">{:,.0f}</span><span class="st"> and p2b = </span><span class="sc">{:,.0f}</span><span class="st"> ohms'</span>.<span class="bu">format</span>(P2_a, P2_b))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>solution: P2a = 6,450 and p2b = 3,550 ohms</code></pre>
</div>
</div>
<p>This means that for a rotational displacement of 35.5% on P2, the treble response will be flat.</p>
</section>
<section id="frequency-response-vs-p2" class="level3" data-number="37.10.5">
<h3 data-number="37.10.5" class="anchored" data-anchor-id="frequency-response-vs-p2"><span class="header-section-number">37.10.5</span> Frequency response vs P2</h3>
<p>The frequency response of the treble circuit as a function of P2 for selected positions is plotted below.</p>
<p><a href="#fig-treble-path-freq-plot" class="quarto-xref">Figure&nbsp;<span>37.12</span></a></p>
<div id="cell-fig-treble-path-freq-plot" class="cell" data-execution_count="239">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>P2_setting <span class="op">=</span> np.array([<span class="dv">1</span>,<span class="dv">25</span>,<span class="fl">35.5</span>,<span class="dv">50</span>,<span class="dv">75</span>,<span class="dv">99</span>])<span class="op">/</span><span class="dv">100</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>P2_value <span class="op">=</span> <span class="fl">10e3</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>tf_num_coef_list <span class="op">=</span> []</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>tf_denom_coef_list <span class="op">=</span> []</span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>color_list <span class="op">=</span> [<span class="st">'tab:blue'</span>,<span class="st">'tab:red'</span>,<span class="st">'tab:purple'</span>,<span class="st">'tab:green'</span>,<span class="st">'tab:orange'</span>,<span class="st">'k'</span>]</span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>fig, ax1 <span class="op">=</span> plt.subplots()</span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'magnitude, dB'</span>)</span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'frequency, Hz'</span>)</span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a><span class="co"># instantiate a second y-axes that shares the same x-axis</span></span>
<span id="cb96-14"><a href="#cb96-14" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> ax1.twinx()</span>
<span id="cb96-15"><a href="#cb96-15" aria-hidden="true" tabindex="-1"></a>color <span class="op">=</span> <span class="st">'k'</span></span>
<span id="cb96-16"><a href="#cb96-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-17"><a href="#cb96-17" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'phase, deg'</span>,color<span class="op">=</span>color)</span>
<span id="cb96-18"><a href="#cb96-18" aria-hidden="true" tabindex="-1"></a>ax2.tick_params(axis<span class="op">=</span><span class="st">'y'</span>, labelcolor<span class="op">=</span>color)</span>
<span id="cb96-19"><a href="#cb96-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-20"><a href="#cb96-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(P2_setting)):</span>
<span id="cb96-21"><a href="#cb96-21" aria-hidden="true" tabindex="-1"></a>    element_values[Rp2a] <span class="op">=</span> P2_value <span class="op">-</span> P2_setting[i]<span class="op">*</span>P2_value </span>
<span id="cb96-22"><a href="#cb96-22" aria-hidden="true" tabindex="-1"></a>    element_values[Rp2b] <span class="op">=</span> P2_setting[i]<span class="op">*</span>P2_value </span>
<span id="cb96-23"><a href="#cb96-23" aria-hidden="true" tabindex="-1"></a>    NE <span class="op">=</span> NE_sym.subs(element_values)</span>
<span id="cb96-24"><a href="#cb96-24" aria-hidden="true" tabindex="-1"></a>    U <span class="op">=</span> solve(NE,X)</span>
<span id="cb96-25"><a href="#cb96-25" aria-hidden="true" tabindex="-1"></a>    H <span class="op">=</span> U[v2]<span class="op">/</span>U[v1]</span>
<span id="cb96-26"><a href="#cb96-26" aria-hidden="true" tabindex="-1"></a>    num, denom <span class="op">=</span> fraction(H) <span class="co">#returns numerator and denominator</span></span>
<span id="cb96-27"><a href="#cb96-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-28"><a href="#cb96-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># convert symbolic to numpy polynomial</span></span>
<span id="cb96-29"><a href="#cb96-29" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> np.array(Poly(num, s).all_coeffs(), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb96-30"><a href="#cb96-30" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> np.array(Poly(denom, s).all_coeffs(), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb96-31"><a href="#cb96-31" aria-hidden="true" tabindex="-1"></a>    tf_num_coef_list.append(a)</span>
<span id="cb96-32"><a href="#cb96-32" aria-hidden="true" tabindex="-1"></a>    tf_denom_coef_list.append(b)</span>
<span id="cb96-33"><a href="#cb96-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb96-34"><a href="#cb96-34" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> np.logspace(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">2000</span>, endpoint<span class="op">=</span><span class="va">False</span>)<span class="op">*</span><span class="dv">2</span><span class="op">*</span>np.pi</span>
<span id="cb96-35"><a href="#cb96-35" aria-hidden="true" tabindex="-1"></a>    w, mag, phase <span class="op">=</span> signal.bode((a, b), w<span class="op">=</span>x) <span class="co"># returns: rad/s, mag in dB, phase in deg</span></span>
<span id="cb96-36"><a href="#cb96-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-37"><a href="#cb96-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># plot the results.  </span></span>
<span id="cb96-38"><a href="#cb96-38" aria-hidden="true" tabindex="-1"></a>    ax1.semilogx(w<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), mag,<span class="st">'-'</span>,color<span class="op">=</span>color_list[i],label<span class="op">=</span><span class="st">'magnitude, P2 at </span><span class="sc">{:.0f}</span><span class="st">%'</span>.<span class="bu">format</span>(P2_setting[i]<span class="op">*</span><span class="dv">100</span>))    <span class="co"># magnitude plot</span></span>
<span id="cb96-39"><a href="#cb96-39" aria-hidden="true" tabindex="-1"></a>    ax2.semilogx(w<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), phase,<span class="st">':'</span>,color<span class="op">=</span>color_list[i],label<span class="op">=</span><span class="st">'phase, P2 at </span><span class="sc">{:.0f}</span><span class="st">%'</span>.<span class="bu">format</span>(P2_setting[i]<span class="op">*</span><span class="dv">100</span>))  <span class="co"># phase plot</span></span>
<span id="cb96-40"><a href="#cb96-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-41"><a href="#cb96-41" aria-hidden="true" tabindex="-1"></a><span class="co"># highlight the guitar audio band, 80 to 8kHz</span></span>
<span id="cb96-42"><a href="#cb96-42" aria-hidden="true" tabindex="-1"></a>plt.axvspan(<span class="dv">80</span>, <span class="fl">8e3</span>, color<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb96-43"><a href="#cb96-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-44"><a href="#cb96-44" aria-hidden="true" tabindex="-1"></a><span class="co"># position legends outside the graph</span></span>
<span id="cb96-45"><a href="#cb96-45" aria-hidden="true" tabindex="-1"></a>ax1.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.6</span>,<span class="dv">1</span>)) <span class="co"># magnitude legend position: relative (horizontal position, vertical position) </span></span>
<span id="cb96-46"><a href="#cb96-46" aria-hidden="true" tabindex="-1"></a>ax2.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.6</span>,<span class="fl">0.5</span>)) <span class="co"># phase legend position:</span></span>
<span id="cb96-47"><a href="#cb96-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-48"><a href="#cb96-48" aria-hidden="true" tabindex="-1"></a>ax1.grid()</span>
<span id="cb96-49"><a href="#cb96-49" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Treble magnitude and phase response'</span>)</span>
<span id="cb96-50"><a href="#cb96-50" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-treble-path-freq-plot" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-treble-path-freq-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Klon Centaur part 1_files/figure-html/fig-treble-path-freq-plot-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-treble-path-freq-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;37.12: Treble path magnitude and phase response as a function of treble setting (P2). Solid lines are the magnitude responses at various settings of P2 and the dashed lines are the phase responses.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="step-response-at-p250" class="level3" data-number="37.10.6">
<h3 data-number="37.10.6" class="anchored" data-anchor-id="step-response-at-p250"><span class="header-section-number">37.10.6</span> Step response at P2=50%</h3>
<p>Setting the value of P2 to the midpoint, P2 = 50%, the transfer function is computed.</p>
<div id="a83660cd-bd52-426b-91b3-c4e18ec0c670" class="cell" data-execution_count="240">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>P2_setting <span class="op">=</span> <span class="fl">0.5</span> <span class="co"># percentage of rotation</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>element_values[Rp2a] <span class="op">=</span> P2_setting<span class="op">*</span>P2_value</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>element_values[Rp2b] <span class="op">=</span> P2_value <span class="op">-</span> P2_setting<span class="op">*</span>P2_value</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>NE <span class="op">=</span> NE_sym.subs(element_values)</span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>U <span class="op">=</span> solve(NE,X)</span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>H <span class="op">=</span> U[v2]<span class="op">/</span>U[v1]</span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a>num, denom <span class="op">=</span> fraction(H) <span class="co">#returns numerator and denominator</span></span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a><span class="co"># convert symbolic to numpy polynomial</span></span>
<span id="cb97-13"><a href="#cb97-13" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> np.array(Poly(num, s).all_coeffs(), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb97-14"><a href="#cb97-14" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> np.array(Poly(denom, s).all_coeffs(), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb97-15"><a href="#cb97-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-16"><a href="#cb97-16" aria-hidden="true" tabindex="-1"></a>sys_tf <span class="op">=</span> signal.TransferFunction(a,b)</span>
<span id="cb97-17"><a href="#cb97-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-18"><a href="#cb97-18" aria-hidden="true" tabindex="-1"></a>sys_zeros <span class="op">=</span> np.roots(sys_tf.num)</span>
<span id="cb97-19"><a href="#cb97-19" aria-hidden="true" tabindex="-1"></a>sys_poles <span class="op">=</span> np.roots(sys_tf.den)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The step response of the is calculated using the SciPy function <code>lsim</code> and plotted below. A square wave with a frequency of 500 Hz and an amplitude of 0.1 volts peak to peak is used as the input to this path. An input amplitude of 0.1 Vpp is used to keep the signal levels in the path below the conduction threshold for the diodes. The input square wave has a positive 0.05 volt offset which allows us to examine the DC characteristics of the path. The frequency of the square wave was chosen to allow the time constant of the path to be plotted with sufficient resolution to be examined in the plot.</p>
<div id="204ca23e-9306-4aec-a950-735fe04b0d6a" class="cell" data-execution_count="241">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="fl">0.005</span>, <span class="dv">500</span>, endpoint<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>sqr_signal <span class="op">=</span> signal.square(<span class="dv">2</span><span class="op">*</span>np.pi<span class="op">*</span><span class="dv">500</span><span class="op">*</span>t, duty<span class="op">=</span><span class="fl">0.5</span>)<span class="op">/</span><span class="dv">20</span><span class="op">+</span><span class="dv">1</span><span class="op">/</span><span class="dv">20</span></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>t_step, y_step, x_step <span class="op">=</span> signal.lsim(sys_tf, U<span class="op">=</span>sqr_signal, T<span class="op">=</span>t)</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>plt.plot(t_step<span class="op">*</span><span class="fl">1e3</span>, sqr_signal<span class="op">*</span><span class="fl">1e3</span>, <span class="st">'r'</span>, alpha<span class="op">=</span><span class="fl">0.75</span>, linewidth<span class="op">=</span><span class="dv">1</span>, label<span class="op">=</span><span class="st">'input'</span>)</span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>plt.plot(t_step<span class="op">*</span><span class="fl">1e3</span>, y_step<span class="op">*</span><span class="fl">1e3</span>,<span class="st">'b'</span>, linewidth<span class="op">=</span><span class="fl">1.25</span>, label<span class="op">=</span><span class="st">'output'</span>)</span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Step response'</span>)</span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'volts, mV'</span>)</span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'time, msec'</span>)</span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">'best'</span>)</span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a><span class="co"># show plot</span></span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Klon Centaur part 1_files/figure-html/cell-83-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The step response has a rather long decay time and asymptomatically approaches zero and -1 indicating the DC gain is -1.</p>
<section id="group-delay-2" class="level4" data-number="37.10.6.1">
<h4 data-number="37.10.6.1" class="anchored" data-anchor-id="group-delay-2"><span class="header-section-number">37.10.6.1</span> Group delay</h4>
<p>The following python code calculates and plots the group delay. Notice that the scale for the vertical axis is msec.</p>
<div id="5478c4ec-d7d3-44a8-8a6c-8ef5041a42e4" class="cell" data-execution_count="242">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.logspace(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">2000</span>, endpoint<span class="op">=</span><span class="va">False</span>)<span class="op">*</span><span class="dv">2</span><span class="op">*</span>np.pi</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>w, mag, phase <span class="op">=</span> signal.bode((a, b), w<span class="op">=</span>x) <span class="co"># returns: rad/s, mag in dB, phase in deg</span></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'group delay'</span>)</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>plt.semilogx(w<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), <span class="op">-</span>np.gradient(phase<span class="op">*</span>np.pi<span class="op">/</span><span class="dv">180</span>)<span class="op">/</span>np.gradient(w)<span class="op">*</span><span class="fl">1e3</span>,<span class="st">'-'</span>,label<span class="op">=</span><span class="st">'group delay'</span>)</span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a><span class="co"># highlight the guitar audio band, 80 to 8kHz</span></span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>plt.axvspan(<span class="dv">80</span>, <span class="fl">8e3</span>, color<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a>plt.xlim((<span class="dv">10</span>,<span class="fl">100e3</span>))</span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a>plt.ylim((<span class="op">-</span><span class="fl">0.25</span>,<span class="fl">0.25</span>))</span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-13"><a href="#cb99-13" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Group delay, msec'</span>)</span>
<span id="cb99-14"><a href="#cb99-14" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Frequency, Hz'</span>)</span>
<span id="cb99-15"><a href="#cb99-15" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb99-16"><a href="#cb99-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Klon Centaur part 1_files/figure-html/cell-84-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The plot above shows that for frequencies in the guitar audio band, the group delay variation is less than 2 ms and therefore below the threshold of audibility as described in <a href="#sec-Group_delay" class="quarto-xref"><span>Section 37.8.6</span></a>.</p>
</section>
</section>
<section id="polezero-locus-plot" class="level3" data-number="37.10.7">
<h3 data-number="37.10.7" class="anchored" data-anchor-id="polezero-locus-plot"><span class="header-section-number">37.10.7</span> Pole/zero locus plot</h3>
<p>The plot below shows the frequency locations for the treble control pole and zero locations as a function of P2 rotation. Since the poles and zeros don’t have imaginary parts, the complex frequency is plotted on the vertical axis versus the treble control rotational position, from 1 to 99 percent. The plot provides a visual indication of how the poles and zeros change as a function P2.</p>
<div id="e687a044-f1aa-419b-b1d7-cd14661313c6" class="cell" data-execution_count="243">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>sym_num, sym_denom <span class="op">=</span> fraction(H_sym) <span class="co">#returns numerator and denominator</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>p2_value <span class="op">=</span> <span class="fl">10e3</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>num_roots <span class="op">=</span> []</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>denom_roots <span class="op">=</span> []</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> np.linspace(<span class="dv">1</span>,<span class="dv">99</span>,<span class="dv">20</span>)<span class="op">/</span><span class="dv">100</span>:</span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>    element_values[Rp2a] <span class="op">=</span> p2_value <span class="op">-</span> i<span class="op">*</span>p2_value</span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>    element_values[Rp2b] <span class="op">=</span> i<span class="op">*</span>p2_value</span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>    num_roots.append(solve(sym_num.subs(element_values),s))</span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>    denom_roots.append(solve(sym_denom.subs(element_values),s))</span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a>plt.plot(np.linspace(<span class="dv">1</span>,<span class="dv">99</span>,<span class="bu">len</span>(np.array(num_roots).flatten())),<span class="op">-</span>np.array(num_roots).flatten()<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi)<span class="op">/</span><span class="fl">1e3</span>,<span class="st">'o-b'</span>, markerfacecolor<span class="op">=</span><span class="st">'none'</span>,label<span class="op">=</span><span class="st">'zero'</span>)</span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a>plt.plot(np.linspace(<span class="dv">1</span>,<span class="dv">99</span>,<span class="bu">len</span>(np.array(denom_roots).flatten())),<span class="op">-</span>np.array(denom_roots).flatten()<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi)<span class="op">/</span><span class="fl">1e3</span>,<span class="st">'x-r'</span>,label<span class="op">=</span><span class="st">'pole'</span>)</span>
<span id="cb100-14"><a href="#cb100-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-15"><a href="#cb100-15" aria-hidden="true" tabindex="-1"></a>plt.ylim((<span class="dv">0</span>,<span class="dv">4</span>))</span>
<span id="cb100-16"><a href="#cb100-16" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">'upper left'</span>)</span>
<span id="cb100-17"><a href="#cb100-17" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Treble control pole &amp; zero frequency plot vs treble rotation %'</span>)</span>
<span id="cb100-18"><a href="#cb100-18" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Treble rotation percentage'</span>)</span>
<span id="cb100-19"><a href="#cb100-19" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'pole and zero frequency, kHz'</span>)</span>
<span id="cb100-20"><a href="#cb100-20" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb100-21"><a href="#cb100-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-22"><a href="#cb100-22" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Klon Centaur part 1_files/figure-html/cell-85-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>As P2 is rotated, the frequency location of the pole and zero move in opposite directions. At a low P2 rotation percentage, the pole has a lower frequency location than the zero, and above 35.5% rotation the pole has a higher frequency location than the zero.</p>
<p>Since each zero has the effect of adding a -20 dB slope contribution to the frequency response and each pole has the effect of adding a +20 dB slope contribution to the frequency response, at low rotation percentage, there is a negative slope in the frequency response plot from the pole frequency to the zero frequency, where the slope is canceled by the zero. The designers of the Klon, either by accident or design chose to give the treble control more boost than cut over the rotational range.</p>
</section>
</section>
<section id="sec-effects_paths_linear_analysis" class="level2" data-number="37.11">
<h2 data-number="37.11" class="anchored" data-anchor-id="sec-effects_paths_linear_analysis"><span class="header-section-number">37.11</span> Effects path linear analysis</h2>
<p>When the bypass switch, S1A/B is in the effect on position, R27 is shorted by the switch and the output jack is connected to the wiper terminal of P3 and the bypass signal is isolated by R26. The operation of the effects path is somewhat complicated and the function and purpose of some of the reactive branches in the circuit path are not obvious. The Chittum Klon Centaur schematic is shown below with parts of the circuit highlighted in different colors.</p>
<div id="fig-klon-centaur-schematic-high-res_w_paths_highlight_sch" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-klon-centaur-schematic-high-res_w_paths_highlight_sch-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="klon-centaur-schematic-high-res_w_paths_highlight.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-klon-centaur-schematic-high-res_w_paths_highlight_sch-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;37.13: Schematic of the Klon Centaur with the signal paths highlighted.
</figcaption>
</figure>
</div>
<p>The red highlight is the node connected to the output of U1A. From this node, the guitar signal will travel forward in the circuit to C2, C3 and R5||C4. The path starting with C2, which is not highlighted, is the bypass path described in <a href="#sec-Bypass_path" class="quarto-xref"><span>Section 37.9</span></a>. The component, C3, also not highlighted, because it is common to the green highlighted path and the brown highlighted path, is the start of one path leading to the summing amplifier, U2A, highlighted in yellow. The inverting input of U2A is where the effects paths are summed together. Each path is described below:</p>
<ul>
<li>The green highlighted path, which I’ve named, clean tone path 1, see <a href="#sec-clean_tone_path1" class="quarto-xref"><span>Section 37.11.1</span></a>, is a low pass filter with components R7 and C16. R19 can be considered part of the summing amplifier and sets the DC gain for this path with R20. One side of R7 is connected to C3 and C5||R6 and these components present a complex impedance seen by the R7 and C16 low pass filter, so we can’t just ignore these and analyze the low pass filter in isolation. C3 blocks the DC bias from the output of U1A, in addition to any other impedance effects it might be adding to the circuit’s operation.</li>
<li>The brown highlighted path, which I named, distortion path part A, see <a href="#sec-Distortion_path_part_A" class="quarto-xref"><span>Section 37.11.3</span></a>, consists of a reactive branch composed of C5||R6 and the gain control potentiometer P1B. The gain control potentiometer is a dual gang 100K <span class="math inline">\(\Omega\)</span> device. The wiper terminal of P1B is connected to ground and when P1B is fully CCW, the input to U1B is grounded, which effectively blocks the signal from traversing this path in the pedal. The operation of the reactive branches R11||C7 and R12||C8 are described below.</li>
<li>The gray highlighted path, named, distortion path part B, see <a href="#sec-Distortion_path_part_B" class="quarto-xref"><span>Section 37.11.4</span></a>, consists of DC blocking capacitors, C9 and C10, R13 and the clipping diodes D2 and D3. R13 softens the clipping action of the diodes and limits the diode current. D2 and D3 are not highlighted since they are omitted in the linear circuit analysis, described later. R16 is included in this path since it can be considered the summing input for this path. The reactive branch C11 and R15 is not highlighted since it is common to the purple highlighted path, and is connected to the left side of R16, not the inverting terminal of U2A. The interaction of the gray highlighted path and the purple highlighted path at the inverting input to U2A is not obvious and is analyzed below.</li>
<li>The purple highlighted path, named, clean tone path 2, see <a href="#sec-clean_tone_path2" class="quarto-xref"><span>Section 37.11.2</span></a>, consists of several reactive branches who’s function and operation is not obvious and is analyzed below. The gain control potentiometer P1A acts like a voltage divider, taking the signal from one end of C6 and attenuating the signal depending on the rotational position of the gain knob. Fully CCW, the signal at C6 is not attenuated and at the same time, the inverting input to U1B is grounded. The gain knob blends various amounts of either clean tone or distortion to the summing amplifier.</li>
</ul>
<p>The schematic in <a href="#fig-Klon-Centaur_sum_path_v1_sch" class="quarto-xref">Figure&nbsp;<span>37.14</span></a> will be used for MNA analysis. The circuit paths leading from the output of U1A are separated, with one path starting at C3. This path is connected to V1. The other path starts with R5||C4 and this path is connected to V2. A third path starts at the output of U1B and is connected to V3. The branch from the output of U1B to C9 was removed and the path terminates at node 8.</p>
<p>By using the superposition theorem, we can consider each voltage source independently and the composite result is the sum of the various results. The output of U1A is modeled as a voltage source, so the voltage at this node is determined by the voltage out U1A output. The current in each branch is determined by the impedance of each path. This allows examination of each path to see how the circuit works otherwise we would just see the composite results at node 2.</p>
<div id="fig-Klon-Centaur_sum_path_v1_sch" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-Klon-Centaur_sum_path_v1_sch-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Klon-Centaur_sum_path_v1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-Klon-Centaur_sum_path_v1_sch-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;37.14: LTSpice schematic of Klon Centaur with the sum paths driven by voltage sources.
</figcaption>
</figure>
</div>
<p>The circuit in <a href="#fig-Klon-Centaur_sum_path_v1_sch" class="quarto-xref">Figure&nbsp;<span>37.14</span></a> has two diodes, D2 and D3. These are omitted for MNA. There is no <a href="https://en.wikipedia.org/wiki/Diode">diode</a> model supported by the MNA code so we have no choice but to ignore the diodes, which can be done when doing frequency domain analysis in the audio band. Diodes are not very frequency dependent since the junction capacitance is small, and at audio frequencies, plays a small role.</p>
<p>The diode capacitance can be ignored without too much loss in accuracy. D2 and D3 are used in the circuit to limit the amplitude of the signal from U1B. For signal amplitudes above the forward threshold voltage, the current through the diode exponentially increases with voltage. R13 limits current that U1B would need to source or sink for signal amplitudes above the diode’s threshold voltage, which limits the voltage at node 10 for large signals.</p>
<p>Since we are primarily interested in examining the frequency response of the circuit paths and the V3 term cancels out in <span class="math inline">\(H(s) = \frac {v_2(s)}{v_{20}(s)}\)</span>, we can treat the results of MNA as accurate for small signals without including the diodes in the circuit. See <span class="quarto-unresolved-ref">?sec-Comparison_of_MNA_and_LTSpice_results</span> and <span class="quarto-unresolved-ref">?fig-ltspice-mna-freq-plot</span> for a comparison of the LTSpice and MNA results that supports the idea of ignoring the diodes when doing frequency domain analysis.</p>
<p>In linear circuits, the principle of superposition applies, meaning that the response (voltage or current) to multiple inputs is the sum of the responses to each input applied individually. The Op Amp outputs control the voltages at the nodes they are connected to. This allows us to consider each path that originates at an Op Amp output independently and later using superposition, combine the results.</p>
<p>In the following analysis, the branches that are common to the node connected to the output of U1A are separated and replaced by voltage sources. This is shown in <a href="#fig-Klon-Centaur_sum_path_v1_sch" class="quarto-xref">Figure&nbsp;<span>37.14</span></a>, where <span class="math inline">\(V_1\)</span>, <span class="math inline">\(V_2\)</span> and <span class="math inline">\(V_3\)</span> drive the circuit branches. We can analyze the response from each of these sources one at a time, by setting either <span class="math inline">\(V_1\)</span>, <span class="math inline">\(V_2\)</span> and <span class="math inline">\(V_3\)</span> to one and the others to zero. The terms for the sources, <span class="math inline">\(V_1\)</span>, <span class="math inline">\(V_2\)</span> or <span class="math inline">\(V_3\)</span>, cancel in the voltage transfer function, making the frequency response independent of the amplitude of the input source, with the condition that the diodes are not conducting. The analysis presented below is valid as long as the circuit remains in the linear domain.</p>
<p>The step response for each path, presented below, is calculated using a 0.1 volt square wave, which should keep the diodes in the non-conducting region. In Part 2, LTSpice will be used to examine the circuit when the diodes and possibly the Op Amp’s output are driven into the nonlinear range.</p>
<!--
- What is the effects path? What is the clean tone?
  - separating the paths, justification
  - justification for ignoring the diodes
- tonal shaping of the signal
- description of schematic
- Theory of operation
- break down of clean tone paths with gain pot at zero
  - path 1, 2, 3
  - resonant parts
  - do the poles/zeros of each path correlate to the full clean path analysis? poles for the most part, but not zeros

Call this the clean tone, since no distortion is applied to this path.

The Klon Centaur: Clean Boost Mode  
The Klon Centaur is frequently used in clean boost mode. When the pedal is used this way, the diodes are not being activated and, therefore, are not contributing to the sound.
At what pot position do the diodes come into play?

- Need new variable names for num and den and roots
- save plots to overlay

Links: 

@fig-Klon-Centaur_sum_path_v1_sch

@sec-Comparison_of_MNA_and_LTSpice_results

@fig-ltspice-mna-freq-plot
-->
<p>Define the frequency range for x axis to be used on all plots in this section and storage arrays for the magnitude of the frequency response. The frequency range for the x axis is 10 to 100kHz. The frequency response plots are generated for gains of 1, 10, 25, 50, 75 and 99 percent of the full scale value of the gain control potentiometer, P1, which is 100k<span class="math inline">\(\Omega\)</span>. The plot colors for each gain setting are defined in the color list shown below. Arrays are declared to store the magnitude and radian frequency data for each path and each gain setting.</p>
<div id="5bb0f8fd-e2bb-478e-a180-12e19efb0eab" class="cell" data-execution_count="244">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>x_axis <span class="op">=</span> np.logspace(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">2000</span>, endpoint<span class="op">=</span><span class="va">True</span>)<span class="op">*</span><span class="dv">2</span><span class="op">*</span>np.pi</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>color_list <span class="op">=</span> [<span class="st">'tab:blue'</span>,<span class="st">'tab:purple'</span>,<span class="st">'tab:brown'</span>,<span class="st">'tab:red'</span>,<span class="st">'tab:green'</span>,<span class="st">'tab:orange'</span>,<span class="st">'k'</span>]</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>gain_setting <span class="op">=</span> np.array([<span class="dv">1</span>,<span class="fl">2.5</span>,<span class="fl">9.75</span>,<span class="dv">25</span>,<span class="dv">50</span>,<span class="dv">75</span>,<span class="dv">99</span>])<span class="op">/</span><span class="dv">100</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>p1_value <span class="op">=</span> <span class="fl">100e3</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a><span class="co"># save the magnitude and radian frequency</span></span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>clean_path1_mag <span class="op">=</span> np.zeros((<span class="bu">len</span>(gain_setting),<span class="bu">len</span>(x_axis)))</span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>clean_path1_w <span class="op">=</span> np.zeros((<span class="bu">len</span>(gain_setting),<span class="bu">len</span>(x_axis)))</span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>clean_path2_mag <span class="op">=</span> np.zeros((<span class="bu">len</span>(gain_setting),<span class="bu">len</span>(x_axis)))</span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>clean_path2_w <span class="op">=</span> np.zeros((<span class="bu">len</span>(gain_setting),<span class="bu">len</span>(x_axis)))</span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a>diode_pathA_mag <span class="op">=</span> np.zeros((<span class="bu">len</span>(gain_setting),<span class="bu">len</span>(x_axis)))</span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a>diode_pathA_w <span class="op">=</span> np.zeros((<span class="bu">len</span>(gain_setting),<span class="bu">len</span>(x_axis)))</span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a>diode_pathB_mag <span class="op">=</span> np.zeros((<span class="bu">len</span>(gain_setting),<span class="bu">len</span>(x_axis)))</span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a>diode_pathB_w <span class="op">=</span> np.zeros((<span class="bu">len</span>(gain_setting),<span class="bu">len</span>(x_axis)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="sec-clean_tone_path1" class="level3" data-number="37.11.1">
<h3 data-number="37.11.1" class="anchored" data-anchor-id="sec-clean_tone_path1"><span class="header-section-number">37.11.1</span> Clean tone path 1</h3>
<div id="fig-klon-centaur-schematic-high-res_w_clean_path1_highlight_sch" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-klon-centaur-schematic-high-res_w_clean_path1_highlight_sch-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="klon-centaur-schematic-high-res_w_clean_path1_highlight.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-klon-centaur-schematic-high-res_w_clean_path1_highlight_sch-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;37.15: Klon Centaur schematic with clean tone path 1 highlighted.
</figcaption>
</figure>
</div>
<p>The clean tone path in <a href="#fig-klon-centaur-schematic-high-res_w_clean_path1_highlight_sch" class="quarto-xref">Figure&nbsp;<span>37.15</span></a> is highlighted. This signal path starts at the output of the input buffer Amp, U1A and runs to the output of the summing Op Amp, U2A. As described above this path can be analyzed in isolation of the other parts of the circuit based on the principle of superposition. This path starts with C3, which blocks the DC bias and forms a high pass filter blocking frequencies below the audio range. The signal in this path then continues to R7 and C16 which are a low pass filter. The branch consisting of C5 and R16 is terminated to ground when P1 is fully counterclockwise since the wiper of P1 is connected to the virtual ground. The low frequency gain of the summing amp, U2A, is determined by R7, R20 and R24.</p>
<p>The net list generated from <a href="#fig-Klon-Centaur_sum_path_v1_sch" class="quarto-xref">Figure&nbsp;<span>37.14</span></a> is used for this analysis. V2 and V3 are set to zero and the transfer function from node 1 to node 2 is calculated. C5||R6 and the network surrounding U1B is included in the analysis since the impedance of these components appears along the path of interest.</p>
<p>The branch consisting of R5||C4 is the start of clean path 2. This circuit branch presents an impedance that is isolated since it is driven by V2, an ideal voltage source. C12 and R17, the other end of the clean path 2 are connected to the summing junction of U2A inverting input.</p>
<p>Branch with C2 is not analyzed as part of clean path 1 since U1A output is an ideal voltage source and the current that flows from U1A into the branch containing C2 can be partitioned due to superposition.</p>
<p>C13||R20 are in the feedback path of U2A. U2A is configured as an inverting summing amplifier. Pin 2 of U2A is a virtual ground since the Op Amp will keep the voltage difference between pins 2 and 3 to zero volts and pin 3 is connected to ground (as described above this is an AC ground). C13 limits the high frequency gain of U2A. This path is an AC coupled low pass filter.</p>
<!--

- do the gains need to be adjusted by a factor of 2?
- how come a simple low frequency gain calc for path 1 is not the same as the bode plot below?, do a SPICE simulation.

- Effects path 1
- Clean tone v3, path V1 to v2
- now using schematic Klon-Centaur_sum_path_v1.asc
- update net list

-->
<p>The net list below has all the components of the direct and distortion paths, <a href="#fig-Klon-Centaur_sum_path_v1_sch" class="quarto-xref">Figure&nbsp;<span>37.14</span></a>. In the net list, the voltage sources V1, V2 and V3 are set to a value of 1. Later when we analyze various paths, some of these sources will be set to zero and by relying on the principle of superposition, we can isolate the various paths. In the net list, the diodes have been commented out.</p>
<div id="c7d809ff-a891-430a-ac28-906f2c16cf6c" class="cell" data-execution_count="245">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co"># change variable name to clean_path1_net_list</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>clean_path_v3_net_list <span class="op">=</span> <span class="st">'''</span></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a><span class="st">* Klon-Centaur_clean_path_v3.asc</span></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a><span class="st">V1 1 0 1</span></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a><span class="st">R5 19 14 5.1e3</span></span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a><span class="st">R8 14 0 1.5e3</span></span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a><span class="st">C3 3 1 100e-9</span></span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a><span class="st">C4 19 14 68e-9</span></span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a><span class="st">C6 14 15 390e-9</span></span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a><span class="st">R9 15 0 1e3</span></span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a><span class="st">R6 4 3 10e3</span></span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a><span class="st">C5 4 3 68e-9</span></span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a><span class="st">Rp1b2 14 16 50e3</span></span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a><span class="st">Rp1a2 16 0 50e3</span></span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a><span class="st">Rp1b1 0 4 50e3</span></span>
<span id="cb102-16"><a href="#cb102-16" aria-hidden="true" tabindex="-1"></a><span class="st">Rp1a1 5 0 50e3</span></span>
<span id="cb102-17"><a href="#cb102-17" aria-hidden="true" tabindex="-1"></a><span class="st">R10 6 5 2e3</span></span>
<span id="cb102-18"><a href="#cb102-18" aria-hidden="true" tabindex="-1"></a><span class="st">R11 7 6 15e3</span></span>
<span id="cb102-19"><a href="#cb102-19" aria-hidden="true" tabindex="-1"></a><span class="st">C7 7 6 82e-9</span></span>
<span id="cb102-20"><a href="#cb102-20" aria-hidden="true" tabindex="-1"></a><span class="st">C8 8 7 390e-12</span></span>
<span id="cb102-21"><a href="#cb102-21" aria-hidden="true" tabindex="-1"></a><span class="st">R12 8 7 422e3</span></span>
<span id="cb102-22"><a href="#cb102-22" aria-hidden="true" tabindex="-1"></a><span class="st">R13 10 9 1e3</span></span>
<span id="cb102-23"><a href="#cb102-23" aria-hidden="true" tabindex="-1"></a><span class="st">C11 11 17 2.2e-9</span></span>
<span id="cb102-24"><a href="#cb102-24" aria-hidden="true" tabindex="-1"></a><span class="st">R15 17 16 22e3</span></span>
<span id="cb102-25"><a href="#cb102-25" aria-hidden="true" tabindex="-1"></a><span class="st">R17 12 16 27e3</span></span>
<span id="cb102-26"><a href="#cb102-26" aria-hidden="true" tabindex="-1"></a><span class="st">R18 18 16 12e3</span></span>
<span id="cb102-27"><a href="#cb102-27" aria-hidden="true" tabindex="-1"></a><span class="st">C12 12 18 27e-9</span></span>
<span id="cb102-28"><a href="#cb102-28" aria-hidden="true" tabindex="-1"></a><span class="st">R16 12 11 47e3</span></span>
<span id="cb102-29"><a href="#cb102-29" aria-hidden="true" tabindex="-1"></a><span class="st">R7 3 13 1.5e3</span></span>
<span id="cb102-30"><a href="#cb102-30" aria-hidden="true" tabindex="-1"></a><span class="st">R24 12 13 15e3</span></span>
<span id="cb102-31"><a href="#cb102-31" aria-hidden="true" tabindex="-1"></a><span class="st">R20 2 12 392e3</span></span>
<span id="cb102-32"><a href="#cb102-32" aria-hidden="true" tabindex="-1"></a><span class="st">C13 2 12 820e-12</span></span>
<span id="cb102-33"><a href="#cb102-33" aria-hidden="true" tabindex="-1"></a><span class="st">O1b 7 4 8</span></span>
<span id="cb102-34"><a href="#cb102-34" aria-hidden="true" tabindex="-1"></a><span class="st">O2a 12 0 2</span></span>
<span id="cb102-35"><a href="#cb102-35" aria-hidden="true" tabindex="-1"></a><span class="st">*D2 0 10 1N34A</span></span>
<span id="cb102-36"><a href="#cb102-36" aria-hidden="true" tabindex="-1"></a><span class="st">*D3 10 0 1N34A</span></span>
<span id="cb102-37"><a href="#cb102-37" aria-hidden="true" tabindex="-1"></a><span class="st">C16 13 0 1e-6</span></span>
<span id="cb102-38"><a href="#cb102-38" aria-hidden="true" tabindex="-1"></a><span class="st">C9 20 9 1e-6</span></span>
<span id="cb102-39"><a href="#cb102-39" aria-hidden="true" tabindex="-1"></a><span class="st">C10 11 10 1e-6</span></span>
<span id="cb102-40"><a href="#cb102-40" aria-hidden="true" tabindex="-1"></a><span class="st">V2 19 0 1</span></span>
<span id="cb102-41"><a href="#cb102-41" aria-hidden="true" tabindex="-1"></a><span class="st">V3 20 0 1</span></span>
<span id="cb102-42"><a href="#cb102-42" aria-hidden="true" tabindex="-1"></a><span class="st">'''</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Call the symbolic modified nodal analysis function.</p>
<div id="be4e9034-8312-4d3d-ad01-2635b0e37f54" class="cell" data-execution_count="246">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>report, network_df, i_unk_df, A, X, Z <span class="op">=</span> SymMNA.smna(clean_path_v3_net_list)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Build and display the network equations.</p>
<div id="434e8c12-a455-4083-9c6c-4fb9db0b9e71" class="cell" data-execution_count="247">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Put matrices into SymPy </span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> Matrix(X)</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>Z <span class="op">=</span> Matrix(Z)</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>NE_sym <span class="op">=</span> Eq(A<span class="op">*</span>X,Z)</span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a><span class="co"># display the equations</span></span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>temp <span class="op">=</span> <span class="st">''</span></span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(shape(NE_sym.lhs)[<span class="dv">0</span>]):</span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">+=</span> <span class="st">'$</span><span class="sc">{:s}</span><span class="st"> = </span><span class="sc">{:s}</span><span class="st">$&lt;br&gt;'</span>.<span class="bu">format</span>(latex(NE_sym.rhs[i]),latex(NE_sym.lhs[i]))</span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a>Markdown(temp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="247">
<p><span class="math inline">\(0 = C_{3} s v_{1} - C_{3} s v_{3} + I_{V1}\)</span><br><span class="math inline">\(0 = I_{O2a} + v_{12} \left(- C_{13} s - \frac{1}{R_{20}}\right) + v_{2} \left(C_{13} s + \frac{1}{R_{20}}\right)\)</span><br><span class="math inline">\(0 = - C_{3} s v_{1} + v_{3} \left(C_{3} s + C_{5} s + \frac{1}{R_{7}} + \frac{1}{R_{6}}\right) + v_{4} \left(- C_{5} s - \frac{1}{R_{6}}\right) - \frac{v_{13}}{R_{7}}\)</span><br><span class="math inline">\(0 = v_{3} \left(- C_{5} s - \frac{1}{R_{6}}\right) + v_{4} \left(C_{5} s + \frac{1}{Rp1b1} + \frac{1}{R_{6}}\right)\)</span><br><span class="math inline">\(0 = v_{5} \cdot \left(\frac{1}{Rp1a1} + \frac{1}{R_{10}}\right) - \frac{v_{6}}{R_{10}}\)</span><br><span class="math inline">\(0 = v_{6} \left(C_{7} s + \frac{1}{R_{11}} + \frac{1}{R_{10}}\right) + v_{7} \left(- C_{7} s - \frac{1}{R_{11}}\right) - \frac{v_{5}}{R_{10}}\)</span><br><span class="math inline">\(0 = v_{6} \left(- C_{7} s - \frac{1}{R_{11}}\right) + v_{7} \left(C_{7} s + C_{8} s + \frac{1}{R_{12}} + \frac{1}{R_{11}}\right) + v_{8} \left(- C_{8} s - \frac{1}{R_{12}}\right)\)</span><br><span class="math inline">\(0 = I_{O1b} + v_{7} \left(- C_{8} s - \frac{1}{R_{12}}\right) + v_{8} \left(C_{8} s + \frac{1}{R_{12}}\right)\)</span><br><span class="math inline">\(0 = - C_{9} s v_{20} + v_{9} \left(C_{9} s + \frac{1}{R_{13}}\right) - \frac{v_{10}}{R_{13}}\)</span><br><span class="math inline">\(0 = - C_{10} s v_{11} + v_{10} \left(C_{10} s + \frac{1}{R_{13}}\right) - \frac{v_{9}}{R_{13}}\)</span><br><span class="math inline">\(0 = - C_{10} s v_{10} - C_{11} s v_{17} + v_{11} \left(C_{10} s + C_{11} s + \frac{1}{R_{16}}\right) - \frac{v_{12}}{R_{16}}\)</span><br><span class="math inline">\(0 = - C_{12} s v_{18} + v_{12} \left(C_{12} s + C_{13} s + \frac{1}{R_{24}} + \frac{1}{R_{20}} + \frac{1}{R_{17}} + \frac{1}{R_{16}}\right) + v_{2} \left(- C_{13} s - \frac{1}{R_{20}}\right) - \frac{v_{13}}{R_{24}} - \frac{v_{16}}{R_{17}} - \frac{v_{11}}{R_{16}}\)</span><br><span class="math inline">\(0 = v_{13} \left(C_{16} s + \frac{1}{R_{7}} + \frac{1}{R_{24}}\right) - \frac{v_{3}}{R_{7}} - \frac{v_{12}}{R_{24}}\)</span><br><span class="math inline">\(0 = - C_{6} s v_{15} + v_{14} \left(C_{4} s + C_{6} s + \frac{1}{Rp1b2} + \frac{1}{R_{8}} + \frac{1}{R_{5}}\right) + v_{19} \left(- C_{4} s - \frac{1}{R_{5}}\right) - \frac{v_{16}}{Rp1b2}\)</span><br><span class="math inline">\(0 = - C_{6} s v_{14} + v_{15} \left(C_{6} s + \frac{1}{R_{9}}\right)\)</span><br><span class="math inline">\(0 = v_{16} \cdot \left(\frac{1}{Rp1b2} + \frac{1}{Rp1a2} + \frac{1}{R_{18}} + \frac{1}{R_{17}} + \frac{1}{R_{15}}\right) - \frac{v_{14}}{Rp1b2} - \frac{v_{18}}{R_{18}} - \frac{v_{12}}{R_{17}} - \frac{v_{17}}{R_{15}}\)</span><br><span class="math inline">\(0 = - C_{11} s v_{11} + v_{17} \left(C_{11} s + \frac{1}{R_{15}}\right) - \frac{v_{16}}{R_{15}}\)</span><br><span class="math inline">\(0 = - C_{12} s v_{12} + v_{18} \left(C_{12} s + \frac{1}{R_{18}}\right) - \frac{v_{16}}{R_{18}}\)</span><br><span class="math inline">\(0 = I_{V2} + v_{14} \left(- C_{4} s - \frac{1}{R_{5}}\right) + v_{19} \left(C_{4} s + \frac{1}{R_{5}}\right)\)</span><br><span class="math inline">\(0 = C_{9} s v_{20} - C_{9} s v_{9} + I_{V3}\)</span><br><span class="math inline">\(V_{1} = v_{1}\)</span><br><span class="math inline">\(V_{2} = v_{19}\)</span><br><span class="math inline">\(V_{3} = v_{20}\)</span><br><span class="math inline">\(0 = - v_{4} + v_{7}\)</span><br><span class="math inline">\(0 = v_{12}\)</span><br></p>
</div>
</div>
<p>Turn the free symbols into SymPy variables.</p>
<div id="dc983d08-a2b2-487b-b4c4-3ddef3235fb6" class="cell" data-execution_count="248">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>var(<span class="bu">str</span>(NE_sym.free_symbols).replace(<span class="st">'{'</span>,<span class="st">''</span>).replace(<span class="st">'}'</span>,<span class="st">''</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="248">
<p><span class="math inline">\(\displaystyle \left( v_{6}, \  R_{18}, \  V_{3}, \  R_{12}, \  C_{6}, \  I_{O1b}, \  v_{1}, \  C_{13}, \  R_{6}, \  Rp1b2, \  C_{8}, \  v_{17}, \  v_{9}, \  s, \  v_{11}, \  I_{V3}, \  I_{O2a}, \  v_{8}, \  v_{16}, \  R_{5}, \  C_{4}, \  R_{8}, \  v_{19}, \  C_{10}, \  v_{15}, \  v_{7}, \  v_{5}, \  R_{24}, \  R_{15}, \  R_{11}, \  R_{7}, \  C_{16}, \  V_{2}, \  v_{12}, \  R_{17}, \  R_{9}, \  C_{5}, \  R_{16}, \  v_{14}, \  v_{10}, \  I_{V2}, \  C_{12}, \  R_{20}, \  V_{1}, \  v_{2}, \  Rp1a2, \  v_{18}, \  v_{3}, \  v_{4}, \  I_{V1}, \  C_{9}, \  Rp1b1, \  Rp1a1, \  C_{7}, \  R_{13}, \  R_{10}, \  v_{20}, \  C_{3}, \  C_{11}, \  v_{13}\right)\)</span></p>
</div>
</div>
<p>Construct a dictionary of element values.</p>
<div id="3ab425d8-a915-4c8a-a29b-18e926488ceb" class="cell" data-execution_count="249">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>element_values <span class="op">=</span> SymMNA.get_part_values(network_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="clean-tone-path-1-frequency-response" class="level4" data-number="37.11.1.1">
<h4 data-number="37.11.1.1" class="anchored" data-anchor-id="clean-tone-path-1-frequency-response"><span class="header-section-number">37.11.1.1</span> Clean tone path 1 frequency response</h4>
<p>The transfer function <span class="math inline">\(H(s)=\frac{v2}{v1}\)</span> is analyzed for various settings of the Gain control, P1. The gain setting is in steps of percentage of full scale, from 1 to 99 percent. The voltage sources V2 and V3 are set to zero so that the transfer function of clean tone path 1 can be examined.</p>
<div id="aabb885f-4e49-4b28-919c-b1b192cd0306" class="cell" data-execution_count="250">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>element_values[V1] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>element_values[V2] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>element_values[V3] <span class="op">=</span> <span class="dv">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The plot below shows the frequency response of the path for various settings of P1 ranging from 1% to 99%.</p>
<div id="cell-fig-clean-tone-path1-freq-plot" class="cell" data-execution_count="251">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>fig, ax1 <span class="op">=</span> plt.subplots()</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'magnitude, dB'</span>)</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'frequency, Hz'</span>)</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a><span class="co"># instantiate a second y-axes that shares the same x-axis</span></span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> ax1.twinx()</span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a>color <span class="op">=</span> <span class="st">'k'</span></span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'phase, deg'</span>,color<span class="op">=</span>color)</span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a>ax2.tick_params(axis<span class="op">=</span><span class="st">'y'</span>, labelcolor<span class="op">=</span>color)</span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(gain_setting)):</span>
<span id="cb108-13"><a href="#cb108-13" aria-hidden="true" tabindex="-1"></a>    element_values[Rp1a1] <span class="op">=</span> p1_value <span class="op">-</span> gain_setting[i]<span class="op">*</span>p1_value</span>
<span id="cb108-14"><a href="#cb108-14" aria-hidden="true" tabindex="-1"></a>    element_values[Rp1b1] <span class="op">=</span> gain_setting[i]<span class="op">*</span>p1_value</span>
<span id="cb108-15"><a href="#cb108-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb108-16"><a href="#cb108-16" aria-hidden="true" tabindex="-1"></a>    element_values[Rp1a2] <span class="op">=</span> p1_value <span class="op">-</span> gain_setting[i]<span class="op">*</span>p1_value</span>
<span id="cb108-17"><a href="#cb108-17" aria-hidden="true" tabindex="-1"></a>    element_values[Rp1b2] <span class="op">=</span> gain_setting[i]<span class="op">*</span>p1_value</span>
<span id="cb108-18"><a href="#cb108-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb108-19"><a href="#cb108-19" aria-hidden="true" tabindex="-1"></a>    NE <span class="op">=</span> NE_sym.subs(element_values)</span>
<span id="cb108-20"><a href="#cb108-20" aria-hidden="true" tabindex="-1"></a>    U <span class="op">=</span> solve(NE,X)</span>
<span id="cb108-21"><a href="#cb108-21" aria-hidden="true" tabindex="-1"></a>    H <span class="op">=</span> U[v2]<span class="op">/</span>U[v1]</span>
<span id="cb108-22"><a href="#cb108-22" aria-hidden="true" tabindex="-1"></a>    num, denom <span class="op">=</span> fraction(H) <span class="co">#returns numerator and denominator</span></span>
<span id="cb108-23"><a href="#cb108-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-24"><a href="#cb108-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># convert symbolic to NumPy polynomial</span></span>
<span id="cb108-25"><a href="#cb108-25" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> np.array(Poly(num, s).all_coeffs(), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb108-26"><a href="#cb108-26" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> np.array(Poly(denom, s).all_coeffs(), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb108-27"><a href="#cb108-27" aria-hidden="true" tabindex="-1"></a>    sys <span class="op">=</span> (a, b)</span>
<span id="cb108-28"><a href="#cb108-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-29"><a href="#cb108-29" aria-hidden="true" tabindex="-1"></a>    <span class="co">#x = np.logspace(1, 5, 2000, endpoint=False)*2*np.pi</span></span>
<span id="cb108-30"><a href="#cb108-30" aria-hidden="true" tabindex="-1"></a>    w, mag, phase <span class="op">=</span> signal.bode(sys, w<span class="op">=</span>x_axis) <span class="co"># returns: rad/s, mag in dB, phase in deg</span></span>
<span id="cb108-31"><a href="#cb108-31" aria-hidden="true" tabindex="-1"></a>    clean_path1_mag[i] <span class="op">=</span> mag</span>
<span id="cb108-32"><a href="#cb108-32" aria-hidden="true" tabindex="-1"></a>    clean_path1_w[i] <span class="op">=</span> w    </span>
<span id="cb108-33"><a href="#cb108-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-34"><a href="#cb108-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># plot the results.  </span></span>
<span id="cb108-35"><a href="#cb108-35" aria-hidden="true" tabindex="-1"></a>    ax1.semilogx(w<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), mag,<span class="st">'-'</span>,color<span class="op">=</span>color_list[i],label<span class="op">=</span><span class="st">'magnitude @ </span><span class="sc">{:.0f}% g</span><span class="st">ain'</span>.<span class="bu">format</span>(gain_setting[i]<span class="op">*</span><span class="dv">100</span>)) <span class="co"># magnitude plot</span></span>
<span id="cb108-36"><a href="#cb108-36" aria-hidden="true" tabindex="-1"></a>    ax2.semilogx(w<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), phase,<span class="st">':'</span>,color<span class="op">=</span>color_list[i],label<span class="op">=</span><span class="st">'phase @ </span><span class="sc">{:.0f}% g</span><span class="st">ain'</span>.<span class="bu">format</span>(gain_setting[i]<span class="op">*</span><span class="dv">100</span>)) <span class="co"># phase plot</span></span>
<span id="cb108-37"><a href="#cb108-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-38"><a href="#cb108-38" aria-hidden="true" tabindex="-1"></a><span class="co"># highlight the guitar audio band, 80 to 8kHz</span></span>
<span id="cb108-39"><a href="#cb108-39" aria-hidden="true" tabindex="-1"></a>plt.axvspan(<span class="dv">80</span>, <span class="fl">8e3</span>, color<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>) </span>
<span id="cb108-40"><a href="#cb108-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-41"><a href="#cb108-41" aria-hidden="true" tabindex="-1"></a><span class="co"># set plot limits for display</span></span>
<span id="cb108-42"><a href="#cb108-42" aria-hidden="true" tabindex="-1"></a>plt.xlim((<span class="dv">10</span>,<span class="fl">100e3</span>))</span>
<span id="cb108-43"><a href="#cb108-43" aria-hidden="true" tabindex="-1"></a>ax1.set_ylim((<span class="op">-</span><span class="dv">60</span>,<span class="dv">10</span>))</span>
<span id="cb108-44"><a href="#cb108-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-45"><a href="#cb108-45" aria-hidden="true" tabindex="-1"></a><span class="co"># position legends outside the graph</span></span>
<span id="cb108-46"><a href="#cb108-46" aria-hidden="true" tabindex="-1"></a>ax1.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.6</span>,<span class="dv">1</span>)) <span class="co"># magnitude legend position: relative (horizontal position, vertical position) </span></span>
<span id="cb108-47"><a href="#cb108-47" aria-hidden="true" tabindex="-1"></a>ax2.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.6</span>,<span class="fl">0.5</span>)) <span class="co"># phase legend position:</span></span>
<span id="cb108-48"><a href="#cb108-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-49"><a href="#cb108-49" aria-hidden="true" tabindex="-1"></a>ax1.grid()</span>
<span id="cb108-50"><a href="#cb108-50" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Magnitude and phase response for gains of 1% to 99%'</span>)</span>
<span id="cb108-51"><a href="#cb108-51" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-clean-tone-path1-freq-plot" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-clean-tone-path1-freq-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Klon Centaur part 1_files/figure-html/fig-clean-tone-path1-freq-plot-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-clean-tone-path1-freq-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;37.16: Clean tone path 1 magnitude and phase response
</figcaption>
</figure>
</div>
</div>
</div>
<p>The Klon Centaur clean path 1 has a low pass profile in the guitar audio band. The path is AC coupled so there is some roll off in gain below 80 Hz. The position of P1 does not affect the gain of this path to any significant amount. There is only about 1.5 dB difference in gain between P1 being fully CW to fully CCW. The filter characteristics of peak gain, -3dB attenuation frequency and attenuation roll off for P1 setting of 50% are measured from the frequency response data using the code below.</p>
<div id="fa4ccc7a-71e1-4ec5-a12a-f61587a022d9" class="cell" data-execution_count="252">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">4</span> <span class="co"># index for 50%</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'gain setting: </span><span class="sc">{:.0f}</span><span class="st">%'</span>.<span class="bu">format</span>(gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>max_gain <span class="op">=</span> clean_path1_mag[i].<span class="bu">max</span>()</span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>max_gain_arg <span class="op">=</span> clean_path1_mag[i].argmax()</span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>max_gain_freq <span class="op">=</span> clean_path1_w[i][max_gain_arg]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi)</span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'max gain: </span><span class="sc">{:.1f}</span><span class="st"> dB at </span><span class="sc">{:.1f}</span><span class="st"> Hz'</span>.<span class="bu">format</span>(max_gain, max_gain_freq))</span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a>gain_3dB_arg_offset <span class="op">=</span> np.where(clean_path1_mag[i][max_gain_arg:] <span class="op">&lt;</span> max_gain <span class="op">-</span> <span class="dv">3</span>)[<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a>freq_3dB <span class="op">=</span> clean_path1_w[i][max_gain_arg<span class="op">+</span>gain_3dB_arg_offset]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi)</span>
<span id="cb109-11"><a href="#cb109-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'-3dB frequency: </span><span class="sc">{:.1f}</span><span class="st"> Hz'</span>.<span class="bu">format</span>(freq_3dB))</span>
<span id="cb109-12"><a href="#cb109-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-13"><a href="#cb109-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'clean path 1 attenuation: </span><span class="sc">{:.1f}</span><span class="st"> dB per decade'</span>.<span class="bu">format</span>(clean_path1_mag[i][<span class="dv">1500</span>] <span class="op">-</span> clean_path1_mag[i][<span class="op">-</span><span class="dv">1</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>gain setting: 50%
max gain: 7.1 dB at 73.9 Hz
-3dB frequency: 451.7 Hz
clean path 1 attenuation: 39.9 dB per decade</code></pre>
</div>
</div>
<p>The maximum gain of this path is 7.1 dB at 74 Hz with the gain control at 50%. As shown in the plot, the gain control does not affect the gain in this path too much. Within the guitar audio band, this path has a low pass characteristic with a -3dB frequency of 452 Hz and a roll off of about 40 dB per decade. As shown below there are two poles not canceled by zeros and this results in the 40 dB per decade roll off.</p>
</section>
<section id="numerical-solution-for-p1-at-50" class="level4" data-number="37.11.1.2">
<h4 data-number="37.11.1.2" class="anchored" data-anchor-id="numerical-solution-for-p1-at-50"><span class="header-section-number">37.11.1.2</span> Numerical solution for P1 at 50%</h4>
<p>The analysis can be run for any setting of P1, for illustration a setting of 50% is used to generate numerical values.</p>
<div id="73070dc8-7ea0-480f-a0e0-cb95ce9cb4ee" class="cell" data-execution_count="253">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>p1_setting <span class="op">=</span> <span class="dv">50</span><span class="op">/</span><span class="dv">100</span> <span class="co"># setting the gain pot to 50%</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>element_values[Rp1a1] <span class="op">=</span> p1_value <span class="op">-</span> p1_setting<span class="op">*</span>p1_value</span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>element_values[Rp1b1] <span class="op">=</span> p1_setting<span class="op">*</span>p1_value</span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>element_values[Rp1a2] <span class="op">=</span> p1_value <span class="op">-</span> p1_setting<span class="op">*</span>p1_value</span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>element_values[Rp1b2] <span class="op">=</span> p1_setting<span class="op">*</span>p1_value</span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a>NE <span class="op">=</span> NE_sym.subs(element_values)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Display the equations with component values.</p>
<div id="cef84139-12a5-48fb-a3dd-ede4951e983a" class="cell" data-execution_count="254">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>temp <span class="op">=</span> <span class="st">''</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(shape(NE.lhs)[<span class="dv">0</span>]):</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">+=</span> <span class="st">'$</span><span class="sc">{:s}</span><span class="st"> = </span><span class="sc">{:s}</span><span class="st">$&lt;br&gt;'</span>.<span class="bu">format</span>(latex(NE.rhs[i]),latex(NE.lhs[i]))</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>Markdown(temp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="254">
<p><span class="math inline">\(0 = I_{V1} + 1.0 \cdot 10^{-7} s v_{1} - 1.0 \cdot 10^{-7} s v_{3}\)</span><br><span class="math inline">\(0 = I_{O2a} + v_{12} \left(- 8.2 \cdot 10^{-10} s - 2.55102040816327 \cdot 10^{-6}\right) + v_{2} \cdot \left(8.2 \cdot 10^{-10} s + 2.55102040816327 \cdot 10^{-6}\right)\)</span><br><span class="math inline">\(0 = - 1.0 \cdot 10^{-7} s v_{1} - 0.000666666666666667 v_{13} + v_{3} \cdot \left(1.68 \cdot 10^{-7} s + 0.000766666666666667\right) + v_{4} \left(- 6.8 \cdot 10^{-8} s - 0.0001\right)\)</span><br><span class="math inline">\(0 = v_{3} \left(- 6.8 \cdot 10^{-8} s - 0.0001\right) + v_{4} \cdot \left(6.8 \cdot 10^{-8} s + 0.00012\right)\)</span><br><span class="math inline">\(0 = 0.00052 v_{5} - 0.0005 v_{6}\)</span><br><span class="math inline">\(0 = - 0.0005 v_{5} + v_{6} \cdot \left(8.2 \cdot 10^{-8} s + 0.000566666666666667\right) + v_{7} \left(- 8.2 \cdot 10^{-8} s - 6.66666666666667 \cdot 10^{-5}\right)\)</span><br><span class="math inline">\(0 = v_{6} \left(- 8.2 \cdot 10^{-8} s - 6.66666666666667 \cdot 10^{-5}\right) + v_{7} \cdot \left(8.239 \cdot 10^{-8} s + 6.90363349131122 \cdot 10^{-5}\right) + v_{8} \left(- 3.9 \cdot 10^{-10} s - 2.3696682464455 \cdot 10^{-6}\right)\)</span><br><span class="math inline">\(0 = I_{O1b} + v_{7} \left(- 3.9 \cdot 10^{-10} s - 2.3696682464455 \cdot 10^{-6}\right) + v_{8} \cdot \left(3.9 \cdot 10^{-10} s + 2.3696682464455 \cdot 10^{-6}\right)\)</span><br><span class="math inline">\(0 = - 1.0 \cdot 10^{-6} s v_{20} - 0.001 v_{10} + v_{9} \cdot \left(1.0 \cdot 10^{-6} s + 0.001\right)\)</span><br><span class="math inline">\(0 = - 1.0 \cdot 10^{-6} s v_{11} + v_{10} \cdot \left(1.0 \cdot 10^{-6} s + 0.001\right) - 0.001 v_{9}\)</span><br><span class="math inline">\(0 = - 1.0 \cdot 10^{-6} s v_{10} - 2.2 \cdot 10^{-9} s v_{17} + v_{11} \cdot \left(1.0022 \cdot 10^{-6} s + 2.12765957446809 \cdot 10^{-5}\right) - 2.12765957446809 \cdot 10^{-5} v_{12}\)</span><br><span class="math inline">\(0 = - 2.7 \cdot 10^{-8} s v_{18} - 2.12765957446809 \cdot 10^{-5} v_{11} + v_{12} \cdot \left(2.782 \cdot 10^{-8} s + 0.000127531319856548\right) - 6.66666666666667 \cdot 10^{-5} v_{13} - 3.7037037037037 \cdot 10^{-5} v_{16} + v_{2} \left(- 8.2 \cdot 10^{-10} s - 2.55102040816327 \cdot 10^{-6}\right)\)</span><br><span class="math inline">\(0 = - 6.66666666666667 \cdot 10^{-5} v_{12} + v_{13} \cdot \left(1.0 \cdot 10^{-6} s + 0.000733333333333333\right) - 0.000666666666666667 v_{3}\)</span><br><span class="math inline">\(0 = - 3.9 \cdot 10^{-7} s v_{15} + v_{14} \cdot \left(4.58 \cdot 10^{-7} s + 0.000882745098039216\right) - 2.0 \cdot 10^{-5} v_{16} + v_{19} \left(- 6.8 \cdot 10^{-8} s - 0.000196078431372549\right)\)</span><br><span class="math inline">\(0 = - 3.9 \cdot 10^{-7} s v_{14} + v_{15} \cdot \left(3.9 \cdot 10^{-7} s + 0.001\right)\)</span><br><span class="math inline">\(0 = - 3.7037037037037 \cdot 10^{-5} v_{12} - 2.0 \cdot 10^{-5} v_{14} + 0.000205824915824916 v_{16} - 4.54545454545455 \cdot 10^{-5} v_{17} - 8.33333333333333 \cdot 10^{-5} v_{18}\)</span><br><span class="math inline">\(0 = - 2.2 \cdot 10^{-9} s v_{11} - 4.54545454545455 \cdot 10^{-5} v_{16} + v_{17} \cdot \left(2.2 \cdot 10^{-9} s + 4.54545454545455 \cdot 10^{-5}\right)\)</span><br><span class="math inline">\(0 = - 2.7 \cdot 10^{-8} s v_{12} - 8.33333333333333 \cdot 10^{-5} v_{16} + v_{18} \cdot \left(2.7 \cdot 10^{-8} s + 8.33333333333333 \cdot 10^{-5}\right)\)</span><br><span class="math inline">\(0 = I_{V2} + v_{14} \left(- 6.8 \cdot 10^{-8} s - 0.000196078431372549\right) + v_{19} \cdot \left(6.8 \cdot 10^{-8} s + 0.000196078431372549\right)\)</span><br><span class="math inline">\(0 = I_{V3} + 1.0 \cdot 10^{-6} s v_{20} - 1.0 \cdot 10^{-6} s v_{9}\)</span><br><span class="math inline">\(1 = v_{1}\)</span><br><span class="math inline">\(0 = v_{19}\)</span><br><span class="math inline">\(0 = v_{20}\)</span><br><span class="math inline">\(0 = - v_{4} + v_{7}\)</span><br><span class="math inline">\(0 = v_{12}\)</span><br></p>
</div>
</div>
<p>Solve for voltages and currents and display the results.</p>
<div id="d2b12957-96e5-4162-831d-f028bcb3b0b7" class="cell" data-execution_count="255">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>U <span class="op">=</span> solve(NE,X)</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>temp <span class="op">=</span> <span class="st">''</span></span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> U.keys():</span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">+=</span> <span class="st">'$</span><span class="sc">{:s}</span><span class="st"> = </span><span class="sc">{:s}</span><span class="st">$&lt;br&gt;'</span>.<span class="bu">format</span>(latex(i),latex(U[i]))</span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a>Markdown(temp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="255">
<p><span class="math inline">\(v_{1} = 1.0\)</span><br><span class="math inline">\(v_{2} = \frac{- 1.666 \cdot 10^{36} s^{2} - 2.94 \cdot 10^{39} s}{3.07377 \cdot 10^{28} s^{4} + 3.8347452 \cdot 10^{32} s^{3} + 1.324108096 \cdot 10^{36} s^{2} + 1.3641377 \cdot 10^{39} s + 9.5625 \cdot 10^{40}}\)</span><br><span class="math inline">\(v_{3} = \frac{1.53 \cdot 10^{25} s^{3} + 3.822 \cdot 10^{28} s^{2} + 1.98 \cdot 10^{31} s}{1.53 \cdot 10^{25} s^{3} + 1.4328 \cdot 10^{29} s^{2} + 2.13344 \cdot 10^{32} s + 1.53 \cdot 10^{34}}\)</span><br><span class="math inline">\(v_{4} = \frac{1.53 \cdot 10^{25} s^{3} + 3.372 \cdot 10^{28} s^{2} + 1.65 \cdot 10^{31} s}{1.53 \cdot 10^{25} s^{3} + 1.4328 \cdot 10^{29} s^{2} + 2.13344 \cdot 10^{32} s + 1.53 \cdot 10^{34}}\)</span><br><span class="math inline">\(v_{5} = \frac{1.56825 \cdot 10^{37} s^{4} + 4.7313 \cdot 10^{40} s^{3} + 4.50125 \cdot 10^{43} s^{2} + 1.375 \cdot 10^{46} s}{1.63098 \cdot 10^{37} s^{4} + 1.6982148 \cdot 10^{41} s^{3} + 3.87420704000001 \cdot 10^{44} s^{2} + 2.54543933333334 \cdot 10^{47} s + 1.70850000000001 \cdot 10^{49}}\)</span><br><span class="math inline">\(v_{6} = \frac{1.63098 \cdot 10^{37} s^{4} + 4.920552 \cdot 10^{40} s^{3} + 4.6813 \cdot 10^{43} s^{2} + 1.43 \cdot 10^{46} s}{1.63098 \cdot 10^{37} s^{4} + 1.6982148 \cdot 10^{41} s^{3} + 3.87420704000001 \cdot 10^{44} s^{2} + 2.54543933333334 \cdot 10^{47} s + 1.70850000000001 \cdot 10^{49}}\)</span><br><span class="math inline">\(v_{7} = \frac{1.53 \cdot 10^{25} s^{3} + 3.372 \cdot 10^{28} s^{2} + 1.65 \cdot 10^{31} s}{1.53 \cdot 10^{25} s^{3} + 1.4328 \cdot 10^{29} s^{2} + 2.13344 \cdot 10^{32} s + 1.53 \cdot 10^{34}}\)</span><br><span class="math inline">\(v_{8} = \frac{1.2721644 \cdot 10^{46} s^{5} + 7.45961435931766 \cdot 10^{50} s^{4} + 2.18693901867302 \cdot 10^{54} s^{3} + 2.07668666587681 \cdot 10^{57} s^{2} + 6.37322274881527 \cdot 10^{59} s}{1.2721644 \cdot 10^{46} s^{5} + 2.09758384731754 \cdot 10^{50} s^{4} + 1.10702928656076 \cdot 10^{54} s^{3} + 2.03466134856873 \cdot 10^{57} s^{2} + 1.21969565229069 \cdot 10^{60} s + 8.09715639810431 \cdot 10^{61}}\)</span><br><span class="math inline">\(v_{9} = 0.0\)</span><br><span class="math inline">\(v_{10} = 0.0\)</span><br><span class="math inline">\(v_{11} = 0.0\)</span><br><span class="math inline">\(v_{12} = 0.0\)</span><br><span class="math inline">\(v_{13} = \frac{1.02 \cdot 10^{28} s^{2} + 1.8 \cdot 10^{31} s}{1.53 \cdot 10^{25} s^{3} + 1.4328 \cdot 10^{29} s^{2} + 2.13344 \cdot 10^{32} s + 1.53 \cdot 10^{34}}\)</span><br><span class="math inline">\(v_{14} = 0.0\)</span><br><span class="math inline">\(v_{15} = 0.0\)</span><br><span class="math inline">\(v_{16} = 0.0\)</span><br><span class="math inline">\(v_{17} = 0.0\)</span><br><span class="math inline">\(v_{18} = 0.0\)</span><br><span class="math inline">\(v_{19} = 0.0\)</span><br><span class="math inline">\(v_{20} = 0.0\)</span><br><span class="math inline">\(I_{V1} = \frac{- 1.0506 \cdot 10^{29} s^{3} - 1.93544 \cdot 10^{32} s^{2} - 1.53 \cdot 10^{34} s}{1.53 \cdot 10^{32} s^{3} + 1.4328 \cdot 10^{36} s^{2} + 2.13344 \cdot 10^{39} s + 1.53 \cdot 10^{41}}\)</span><br><span class="math inline">\(I_{V2} = 0.0\)</span><br><span class="math inline">\(I_{V3} = 0.0\)</span><br><span class="math inline">\(I_{O1b} = \frac{- 3.13650000000006 \cdot 10^{40} s^{4} - 9.46260000000018 \cdot 10^{43} s^{3} - 9.00250000000017 \cdot 10^{46} s^{2} - 2.75000000000005 \cdot 10^{49} s}{1.63098 \cdot 10^{45} s^{4} + 1.6982148 \cdot 10^{49} s^{3} + 3.87420704000001 \cdot 10^{52} s^{2} + 2.54543933333334 \cdot 10^{55} s + 1.70850000000001 \cdot 10^{57}}\)</span><br><span class="math inline">\(I_{O2a} = \frac{6.8 \cdot 10^{23} s^{2} + 1.2 \cdot 10^{27} s}{1.53 \cdot 10^{25} s^{3} + 1.4328 \cdot 10^{29} s^{2} + 2.13344 \cdot 10^{32} s + 1.53 \cdot 10^{34}}\)</span><br></p>
</div>
</div>
<p>The transfer function for the clean tone path 1 is calculated from the ratio of <span class="math inline">\(v_{2}\)</span> and <span class="math inline">\(v_{1}\)</span>.<br>
The voltage transfer function is <span class="math inline">\(H(s)=\frac {v_2} {v_{1}}\)</span>:</p>
<div id="72e41549-935d-4ea8-ab58-08a94527ec1c" class="cell" data-execution_count="256">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>H <span class="op">=</span> U[v2]<span class="op">/</span>U[v1]</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>H</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="256">
<p><span class="math inline">\(\displaystyle \frac{1.0 \left(- 1.666 \cdot 10^{36} s^{2} - 2.94 \cdot 10^{39} s\right)}{3.07377 \cdot 10^{28} s^{4} + 3.8347452 \cdot 10^{32} s^{3} + 1.324108096 \cdot 10^{36} s^{2} + 1.3641377 \cdot 10^{39} s + 9.5625 \cdot 10^{40}}\)</span></p>
</div>
</div>
<div id="4450c36b-6848-4b49-89f8-e2fd28adad73" class="cell" data-jupyter="{&quot;outputs_hidden&quot;:false}" data-execution_count="257">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>num, denom <span class="op">=</span> fraction(H) <span class="co">#returns numerator and denominator</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a><span class="co"># convert symbolic to NumPy polynomial</span></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> np.array(Poly(num, s).all_coeffs(), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> np.array(Poly(denom, s).all_coeffs(), dtype<span class="op">=</span><span class="bu">float</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The poles and zeros of the transfer function can easily be obtained with the following code:</p>
<div id="7fddc10a-5774-4d67-be4c-0e65b92f1561" class="cell" data-execution_count="258">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>sys_tf <span class="op">=</span> signal.TransferFunction(a,b)</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>sys_zeros <span class="op">=</span> np.roots(sys_tf.num)</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>sys_poles <span class="op">=</span> np.roots(sys_tf.den)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Pole zero plot The poles and zeros of the preamp transfer function are plotted.</p>
<div id="60f2c925-16a0-422f-af62-211d46313243" class="cell" data-execution_count="259">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>plt.plot(np.real(sys_zeros), np.imag(sys_zeros), <span class="st">'ob'</span>, markerfacecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>plt.plot(np.real(sys_poles), np.imag(sys_poles), <span class="st">'xr'</span>)</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>plt.legend([<span class="st">'Zeros'</span>, <span class="st">'Poles'</span>], loc<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Pole / Zero Plot'</span>)</span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'real part, </span><span class="ch">\u03C3</span><span class="st">'</span>)</span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'imaginary part, j</span><span class="ch">\u03C9</span><span class="st">'</span>)</span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Klon Centaur part 1_files/figure-html/cell-101-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>As shown above and printed below, there are two zeros and four poles in the transfer function. The zero at 0 Hz means that the direct current is blocked through this path, since the pole and zero near 0 Hz don’t quite cancel. Since the number of poles is greater than the number of zero, the transfer function is a low pass function.</p>
<p>Printing these values in Hz.</p>
<div id="43848d67-8476-4d52-a352-4edff956d6f3" class="cell" data-execution_count="260">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'number of zeros: </span><span class="sc">{:d}</span><span class="st">'</span>.<span class="bu">format</span>(<span class="bu">len</span>(sys_zeros)))</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(sys_zeros)):</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'z</span><span class="sc">{:d}</span><span class="st">: </span><span class="sc">{:,.2f}</span><span class="st"> Hz'</span>.<span class="bu">format</span>(i,sys_zeros[i]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi)))</span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'number of poles: </span><span class="sc">{:d}</span><span class="st">'</span>.<span class="bu">format</span>(<span class="bu">len</span>(sys_poles)))</span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(sys_poles)):</span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'p</span><span class="sc">{:d}</span><span class="st">: </span><span class="sc">{:,.2f}</span><span class="st"> Hz'</span>.<span class="bu">format</span>(i,sys_poles[i]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>number of zeros: 2
z0: -280.86 Hz
z1: 0.00 Hz
number of poles: 4
p0: -1,198.55 Hz
p1: -495.13 Hz
p2: -279.87 Hz
p3: -12.02 Hz</code></pre>
</div>
</div>
</section>
<section id="step-response-3" class="level4" data-number="37.11.1.3">
<h4 data-number="37.11.1.3" class="anchored" data-anchor-id="step-response-3"><span class="header-section-number">37.11.1.3</span> Step response</h4>
<p>The step response of the is calculated using the SciPy function <code>lsim</code> and plotted below. A square wave with a frequency of 5 Hz and an amplitude of 0.1 volts peak to peak is used as the input to this path. An input amplitude of 0.1 Vpp is used to keep the signal levels in the path below the conduction threshold for the diodes. The input square wave has a positive 0.05 volt offset which allows us to examine the DC characteristics of the path. The frequency of the square wave was chosen to allow the time constant of the path to be plotted with sufficient resolution to be examined in the plot.</p>
<div id="e4105e88-7116-4773-9318-07e39a18678c" class="cell" data-execution_count="261">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dv">500</span>, endpoint<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>sqr_signal <span class="op">=</span> signal.square(<span class="dv">2</span><span class="op">*</span>np.pi<span class="op">*</span><span class="dv">5</span><span class="op">*</span>t, duty<span class="op">=</span><span class="fl">0.5</span>)<span class="op">/</span><span class="dv">20</span><span class="op">+</span><span class="dv">1</span><span class="op">/</span><span class="dv">20</span></span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>t_step, y_step, x_step <span class="op">=</span> signal.lsim(sys_tf, U<span class="op">=</span>sqr_signal, T<span class="op">=</span>t)</span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a>plt.plot(t_step, sqr_signal, <span class="st">'r'</span>, alpha<span class="op">=</span><span class="fl">0.75</span>, linewidth<span class="op">=</span><span class="dv">1</span>, label<span class="op">=</span><span class="st">'input'</span>)</span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a>plt.plot(t_step, y_step,<span class="st">'b'</span>, linewidth<span class="op">=</span><span class="fl">1.25</span>, label<span class="op">=</span><span class="st">'output'</span>)</span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Step response'</span>)</span>
<span id="cb120-9"><a href="#cb120-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'volts'</span>)</span>
<span id="cb120-10"><a href="#cb120-10" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'time, sec'</span>)</span>
<span id="cb120-11"><a href="#cb120-11" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb120-12"><a href="#cb120-12" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">'best'</span>)</span>
<span id="cb120-13"><a href="#cb120-13" aria-hidden="true" tabindex="-1"></a><span class="co"># show plot</span></span>
<span id="cb120-14"><a href="#cb120-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Klon Centaur part 1_files/figure-html/cell-103-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The step response shows that the DC gain of the path is zero. There is a relatively large spike in the output at each square wave edge.</p>
</section>
<section id="group-delay-3" class="level4" data-number="37.11.1.4">
<h4 data-number="37.11.1.4" class="anchored" data-anchor-id="group-delay-3"><span class="header-section-number">37.11.1.4</span> Group delay</h4>
<p>The group delay for this path is calculated and plotted below.</p>
<div id="c4666f10-fe6b-4f27-adb2-6ed8956ad8a9" class="cell" data-execution_count="262">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.logspace(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">2000</span>, endpoint<span class="op">=</span><span class="va">False</span>)<span class="op">*</span><span class="dv">2</span><span class="op">*</span>np.pi</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>w, mag, phase <span class="op">=</span> signal.bode((a, b), w<span class="op">=</span>x) <span class="co"># returns: rad/s, mag in dB, phase in deg</span></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'group delay'</span>)</span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>plt.semilogx(w<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), <span class="op">-</span>np.gradient(phase<span class="op">*</span>np.pi<span class="op">/</span><span class="dv">180</span>)<span class="op">/</span>np.gradient(w)<span class="op">*</span><span class="dv">1000</span>,<span class="st">'-'</span>,label<span class="op">=</span><span class="st">'group delay'</span>)</span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a><span class="co"># highlight the guitar audio band, 80 to 8kHz</span></span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a>plt.axvspan(<span class="dv">80</span>, <span class="fl">8e3</span>, color<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb121-9"><a href="#cb121-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-10"><a href="#cb121-10" aria-hidden="true" tabindex="-1"></a>plt.xlim((<span class="dv">10</span>,<span class="fl">100e3</span>))</span>
<span id="cb121-11"><a href="#cb121-11" aria-hidden="true" tabindex="-1"></a>plt.ylim((<span class="op">-</span><span class="dv">1</span>,<span class="dv">4</span>))</span>
<span id="cb121-12"><a href="#cb121-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-13"><a href="#cb121-13" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Group delay, msec'</span>)</span>
<span id="cb121-14"><a href="#cb121-14" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Frequency, Hz'</span>)</span>
<span id="cb121-15"><a href="#cb121-15" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.legend()</span></span>
<span id="cb121-16"><a href="#cb121-16" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb121-17"><a href="#cb121-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Klon Centaur part 1_files/figure-html/cell-104-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The plot above shows that for frequencies in the guitar audio band, the group delay variation is less than 2 ms and therefore below the threshold of audibility as described in <a href="#sec-Group_delay" class="quarto-xref"><span>Section 37.8.6</span></a>.</p>
</section>
</section>
<section id="sec-clean_tone_path2" class="level3" data-number="37.11.2">
<h3 data-number="37.11.2" class="anchored" data-anchor-id="sec-clean_tone_path2"><span class="header-section-number">37.11.2</span> Clean tone path 2</h3>
<div id="fig-klon-centaur-schematic-high-res_w_clean_path2_highlight_sch" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-klon-centaur-schematic-high-res_w_clean_path2_highlight_sch-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="klon-centaur-schematic-high-res_w_clean_path2_highlight.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-klon-centaur-schematic-high-res_w_clean_path2_highlight_sch-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;37.17: Klon Centaur schematic with clean tone path 2 highlighted.
</figcaption>
</figure>
</div>
<p>The second clean tone path is highlighted in <a href="#fig-klon-centaur-schematic-high-res_w_clean_path2_highlight_sch" class="quarto-xref">Figure&nbsp;<span>37.17</span></a>. This circuit path, which runs from the output of the buffer amp to the output of the summing amp, U2A, is the least intuitive path in the pedal. The operation and interaction of the reactive branches with C4, C6, C11 and C12 is not very obvious. One thing to notice is that there is a DC path from the output of U1A to the inverting terminal of U2A. This will bias U2A to the DC level of the virtual ground. The DC path continues to the treble tone control circuit. V1 and V3 are set to zero and the transfer function from node 19 to node 2 is calculated.</p>
<p>The operation and purpose of this path has been discussed online in forums and web pages, see <a href="#sec-web_circuit_analysis" class="quarto-xref"><span>Section 37.4</span></a>. None of these presented a detailed analysis to the level provided below. In this section, the path is analyzed while the input to the other paths are zero, so we can get the contribution of this path.</p>
<p>The C3 path has been partitioned since the output of U1A is an ideal voltage source and by applying superposition allows us to consider parts of the circuit independently. Since the circuit is considered a linear circuit,, the individual responses can be combined later to obtain the total response.</p>
<p>The C2 path is ignored since the circuit can be partitioned at each of the Op Amp’s outputs.</p>
<p>The C10 path is connected to the diodes and for now we can ignore the diodes since we are interested in the voltage transfer function and we assume the signal levels do not cause the diodes to conduct.</p>
<p>The components, C13||R20 and U2A, as described above, are part of an inverting low pass filter which sums the signals from the various paths.</p>
<p>Clean path 2 has reactive branches formed by the capacitors in the signal path or branching from the signal path. The presence of these capacitors (C4, C6, C10, C11 and C12) in the branches will produce poles and zeros in the voltage transfer function. It’s not obvious, at least to me, what is happening in this path and what the various branches are doing. We can analyze this path, setting V1 and V3 to zero in <a href="#fig-Klon-Centaur_sum_path_v1_sch" class="quarto-xref">Figure&nbsp;<span>37.14</span></a> and using nodal analysis to obtain the voltage transfer function.</p>
<p>Later in <span class="quarto-unresolved-ref">?sec-Analysis_of_reactive_branches</span>, I’ll look at the reactive branches isolated from the circuit to attempt to get some insight into the role they play in the overall operation of the circuit since the transfer function of Clean tone path 2 doesn’t provide much insight into what’s actually happening in this path; see <span class="quarto-unresolved-ref">?sec-sum_path2b</span> and <span class="quarto-unresolved-ref">?sec-sum_path2a</span>.</p>
<!--

See sections:

@sec-sum_path3

@sec-sum_path2b

@sec-sum_path2a

- path V2 to v2
 
use same net list from above, then edit element_values

None of the explanations describe the operation of clean path 2.

@sec-web_circuit_analysis

Also see Analysis of reactive branches, @sec-Analysis_of_reactive_branches

- From Electrosmash

Network 2: This one is more complex, it includes the secondary gang of the Gain potentiometer. This gang works against the primary gang in the Op-Amp Gain Stage, that is to say, that as the op-amp output signal goes louder, this 2nd feedforward network signal goes quieter (and vice-versa) giving balance to the mix. According to Finnegan, this network “optimizes the circuit’s overall tonal response for whatever the main gain stage is generating in the way of level and distortion.”

- from Coda effects

At the input of the splitter, there is the beginning of the buffer circuit. Instead of going to the top part of the circuit, the signal can now take several paths: down through the 5.1k resistor and the C4 capacitor, go through the second OP amp, or can go through the R17 resistor... What is this mess?

These different splitters select some specific frequencies. Unfortunately, I am not good enough with theory to tell you which ones... It involves rather complicated calculations with Fourier transforms and all... If any talented person could help me with that, it would be awesome!

Lets focus on the bottom part. The signal goes through different components (R5, C4, R6, C6 and R9), then goes through the GAIN2 potentiometer, which sets the maximum . You can see that the signal does not goes through any diode clipping system, so this part of the signal stays clean. In the end of the loop, it is mixed with the saturated signal.

The clean signal can also go through the top part of the circuit, with the 1,5 and 15k resistor. It adds a bit of clean signal in the end that is mixed with the GAIN2 clean signal and the saturated signal, in order to always have a bit of clean mixed with the saturated signal, even when GAIN2 is maxed.

Finally, the remaining signal goes to the input of the second OP amp. A GAIN1 potentiometer sets the amount of signal going into the amplification loop of the OP amp. GAIN1 and GAIN2 are in fact one double potentiometer: when the value of one increases, the other one increases! Thus, it does the amount of clean and saturated signal to mix together: the more saturated signal, the less clean signal! It is an unique feature that is not present in any other pedal, and this is one of the novelty brung by the Klon Centaur: a part of the signal is kept as is, and the other part is saturated. Thus, the overdrive is really good for low drive.

The saturation comes mainly from the OP amp saturation. Another thing that is not usual with classic overdrives circuits! It has quit a high gain. We can calculate it. It is wired in non-inverter, so the gain will be 1 + loop resistor / resistor to ground = 1 + 422 / (15 + 2  + value of the 100k potentiometer  = 1 + 422 / (117) = 4,6 with the lowest gain, and 1 + 422 /  (17) = 25,8 when gain is maxed.

- from freestompboxes.org

-The three branches. This is the tricky part. As some might know, the effected signal is a mix of three by the U2A summing amplifier, with a dual gang pot controlling gain of two of them. Well, that's only part of the story, as I found that R3 and C4 (in my schem) also form and high pass filter with C2 for the clipping path! Of course there's also clean attenuated signal tapped off there by R5, and this part is mostly unchanged, except for R3 being a standard value. 

-The bottom branch. This one carries clean signal of which the volume is adjusted by half of the gain pot. In the original, the signal to the gain pot comes from a fixed attenuator formed by a 5.1K and a 1.5K resistor, to which are added a 68n shelving highpass (bright cap) and a shelving lowpass cap. After the volume, the signal goes again through a shelving lowpass formed by the 27K in parallel with the 12K and 27n into the summing amp. In parallel to this there's a 22K and a 2.2n. Unlike the other one, this network is not at virtual ground and its output isn't summed directly. Here's an assumption, and it is that this network isn't relevant. In the simulation of the original it's been included and it doesn't contribute significantly to the signal coming from this branch. Another possibility is that the diodes conducting will pull this side to ground, but even with it grounded there's no difference. Maybe it's the other way around and it affects the signal coming from the clipping stage? I don't think so, as the source impedance there is much lower, so I think it's a safe assumption.

I find this branch quite messy, with shelving filters which partially cancel each other, and indeed as you can see in the album, the frequency response of this branch is less interesting that it would seem. I decided to rework it into a simple volume control, which is tapered so that the volume closely follows that of the original (important for balancing with the distorted signal), followed by a low pass filter. The frequency response is close enough, at least for me. 

-->
<section id="frequency-response-versus-p1" class="level4" data-number="37.11.2.1">
<h4 data-number="37.11.2.1" class="anchored" data-anchor-id="frequency-response-versus-p1"><span class="header-section-number">37.11.2.1</span> Frequency response versus P1</h4>
<p>The frequency response for the clean tone path 2 for various settings of P1 is calculated and displayed below. The source <span class="math inline">\(V_2\)</span> is set to one and the other sources are set to zero.</p>
<div id="58bd8769-aa9f-403c-8a65-e6887cc57e82" class="cell" data-execution_count="263">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>element_values[V1] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>element_values[V2] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>element_values[V3] <span class="op">=</span> <span class="dv">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The plot below shows the frequency response of the path for various settings of P1 ranging from 1% to 99%.</p>
<div id="cell-fig-clean-tone-path2-freq-plot" class="cell" data-execution_count="264">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>fig, ax1 <span class="op">=</span> plt.subplots()</span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'magnitude, dB'</span>)</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'frequency, Hz'</span>)</span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a><span class="co"># instantiate a second y-axes that shares the same x-axis</span></span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> ax1.twinx()</span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a>color <span class="op">=</span> <span class="st">'k'</span></span>
<span id="cb123-8"><a href="#cb123-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-9"><a href="#cb123-9" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'phase, deg'</span>,color<span class="op">=</span>color)</span>
<span id="cb123-10"><a href="#cb123-10" aria-hidden="true" tabindex="-1"></a>ax2.tick_params(axis<span class="op">=</span><span class="st">'y'</span>, labelcolor<span class="op">=</span>color)</span>
<span id="cb123-11"><a href="#cb123-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-12"><a href="#cb123-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(gain_setting)):</span>
<span id="cb123-13"><a href="#cb123-13" aria-hidden="true" tabindex="-1"></a>    element_values[Rp1a1] <span class="op">=</span> p1_value <span class="op">-</span> gain_setting[i]<span class="op">*</span>p1_value</span>
<span id="cb123-14"><a href="#cb123-14" aria-hidden="true" tabindex="-1"></a>    element_values[Rp1b1] <span class="op">=</span> gain_setting[i]<span class="op">*</span>p1_value</span>
<span id="cb123-15"><a href="#cb123-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb123-16"><a href="#cb123-16" aria-hidden="true" tabindex="-1"></a>    element_values[Rp1a2] <span class="op">=</span> p1_value <span class="op">-</span> gain_setting[i]<span class="op">*</span>p1_value</span>
<span id="cb123-17"><a href="#cb123-17" aria-hidden="true" tabindex="-1"></a>    element_values[Rp1b2] <span class="op">=</span> gain_setting[i]<span class="op">*</span>p1_value</span>
<span id="cb123-18"><a href="#cb123-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb123-19"><a href="#cb123-19" aria-hidden="true" tabindex="-1"></a>    NE <span class="op">=</span> NE_sym.subs(element_values)</span>
<span id="cb123-20"><a href="#cb123-20" aria-hidden="true" tabindex="-1"></a>    U <span class="op">=</span> solve(NE,X)</span>
<span id="cb123-21"><a href="#cb123-21" aria-hidden="true" tabindex="-1"></a>    H <span class="op">=</span> U[v2]<span class="op">/</span>U[v19]</span>
<span id="cb123-22"><a href="#cb123-22" aria-hidden="true" tabindex="-1"></a>    num, denom <span class="op">=</span> fraction(H) <span class="co">#returns numerator and denominator</span></span>
<span id="cb123-23"><a href="#cb123-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-24"><a href="#cb123-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># convert symbolic to NumPy polynomial</span></span>
<span id="cb123-25"><a href="#cb123-25" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> np.array(Poly(num, s).all_coeffs(), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb123-26"><a href="#cb123-26" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> np.array(Poly(denom, s).all_coeffs(), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb123-27"><a href="#cb123-27" aria-hidden="true" tabindex="-1"></a>    sys <span class="op">=</span> (a, b)</span>
<span id="cb123-28"><a href="#cb123-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-29"><a href="#cb123-29" aria-hidden="true" tabindex="-1"></a>    <span class="co">#x = np.logspace(1, 5, 2000, endpoint=False)*2*np.pi</span></span>
<span id="cb123-30"><a href="#cb123-30" aria-hidden="true" tabindex="-1"></a>    w, mag, phase <span class="op">=</span> signal.bode(sys, w<span class="op">=</span>x_axis) <span class="co"># returns: rad/s, mag in dB, phase in deg</span></span>
<span id="cb123-31"><a href="#cb123-31" aria-hidden="true" tabindex="-1"></a>    clean_path2_mag[i] <span class="op">=</span> mag</span>
<span id="cb123-32"><a href="#cb123-32" aria-hidden="true" tabindex="-1"></a>    clean_path2_w[i] <span class="op">=</span> w</span>
<span id="cb123-33"><a href="#cb123-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-34"><a href="#cb123-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># plot the results.  </span></span>
<span id="cb123-35"><a href="#cb123-35" aria-hidden="true" tabindex="-1"></a>    ax1.semilogx(w<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), mag,<span class="st">'-'</span>,color<span class="op">=</span>color_list[i],label<span class="op">=</span><span class="st">'magnitude @ </span><span class="sc">{:.0f}% g</span><span class="st">ain'</span>.<span class="bu">format</span>(gain_setting[i]<span class="op">*</span><span class="dv">100</span>)) <span class="co"># magnitude plot</span></span>
<span id="cb123-36"><a href="#cb123-36" aria-hidden="true" tabindex="-1"></a>    ax2.semilogx(w<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), phase,<span class="st">':'</span>,color<span class="op">=</span>color_list[i],label<span class="op">=</span><span class="st">'phase @ </span><span class="sc">{:.0f}% g</span><span class="st">ain'</span>.<span class="bu">format</span>(gain_setting[i]<span class="op">*</span><span class="dv">100</span>)) <span class="co"># phase plot</span></span>
<span id="cb123-37"><a href="#cb123-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-38"><a href="#cb123-38" aria-hidden="true" tabindex="-1"></a><span class="co"># highlight the guitar audio band, 80 to 8kHz</span></span>
<span id="cb123-39"><a href="#cb123-39" aria-hidden="true" tabindex="-1"></a>plt.axvspan(<span class="dv">80</span>, <span class="fl">8e3</span>, color<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>) </span>
<span id="cb123-40"><a href="#cb123-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-41"><a href="#cb123-41" aria-hidden="true" tabindex="-1"></a><span class="co"># set plot limits for display</span></span>
<span id="cb123-42"><a href="#cb123-42" aria-hidden="true" tabindex="-1"></a>plt.xlim((<span class="dv">10</span>,<span class="fl">100e3</span>))</span>
<span id="cb123-43"><a href="#cb123-43" aria-hidden="true" tabindex="-1"></a>ax1.set_ylim((<span class="op">-</span><span class="dv">60</span>,<span class="dv">20</span>))</span>
<span id="cb123-44"><a href="#cb123-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-45"><a href="#cb123-45" aria-hidden="true" tabindex="-1"></a><span class="co"># position legends outside the graph</span></span>
<span id="cb123-46"><a href="#cb123-46" aria-hidden="true" tabindex="-1"></a>ax1.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.6</span>,<span class="dv">1</span>)) <span class="co"># magnitude legend position: relative (horizontal position, vertical position) </span></span>
<span id="cb123-47"><a href="#cb123-47" aria-hidden="true" tabindex="-1"></a>ax2.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.6</span>,<span class="fl">0.5</span>)) <span class="co"># phase legend position:</span></span>
<span id="cb123-48"><a href="#cb123-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-49"><a href="#cb123-49" aria-hidden="true" tabindex="-1"></a>ax1.grid()</span>
<span id="cb123-50"><a href="#cb123-50" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Magnitude and phase response for gains of 1% to 99%'</span>)</span>
<span id="cb123-51"><a href="#cb123-51" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-clean-tone-path2-freq-plot" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-clean-tone-path2-freq-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Klon Centaur part 1_files/figure-html/fig-clean-tone-path2-freq-plot-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-clean-tone-path2-freq-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;37.18: Clean tone path 2 magnitude and phase response
</figcaption>
</figure>
</div>
</div>
</div>
<p>From the curves above, the clean path 2 has a low pass response with a cut off frequency about 2kHz and the gain varies from 10 dB to -30 dB controlled by the position of P1.</p>
<p>describe filter characteristics, 3dB point, roll off, gain at 1kHz</p>
<div id="4c16fa68-61df-4b15-99ed-69605432e09c" class="cell" data-execution_count="265">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">4</span> <span class="co"># index for 50%</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'gain setting: </span><span class="sc">{:.0f}</span><span class="st">%'</span>.<span class="bu">format</span>(gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>max_gain <span class="op">=</span> clean_path2_mag[i].<span class="bu">max</span>()</span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a>max_gain_arg <span class="op">=</span> clean_path2_mag[i].argmax()</span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a>max_gain_freq <span class="op">=</span> clean_path2_w[i][max_gain_arg]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi)</span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'max gain: </span><span class="sc">{:.1f}</span><span class="st"> dB at </span><span class="sc">{:.1f}</span><span class="st"> Hz'</span>.<span class="bu">format</span>(max_gain, max_gain_freq))</span>
<span id="cb124-8"><a href="#cb124-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-9"><a href="#cb124-9" aria-hidden="true" tabindex="-1"></a>gain_3dB_arg_offset <span class="op">=</span> np.where(clean_path2_mag[i][max_gain_arg:] <span class="op">&lt;</span> max_gain <span class="op">-</span> <span class="dv">3</span>)[<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb124-10"><a href="#cb124-10" aria-hidden="true" tabindex="-1"></a>freq_3dB <span class="op">=</span> clean_path2_w[i][max_gain_arg<span class="op">+</span>gain_3dB_arg_offset]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi)</span>
<span id="cb124-11"><a href="#cb124-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'-3dB frequency: </span><span class="sc">{:.1f}</span><span class="st"> Hz'</span>.<span class="bu">format</span>(freq_3dB))</span>
<span id="cb124-12"><a href="#cb124-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-13"><a href="#cb124-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'clean path 2 attenuation: </span><span class="sc">{:.1f}</span><span class="st"> dB per decade'</span>.<span class="bu">format</span>(clean_path2_mag[i][<span class="dv">1500</span>] <span class="op">-</span> clean_path2_mag[i][<span class="op">-</span><span class="dv">1</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>gain setting: 50%
max gain: -1.5 dB at 39.3 Hz
-3dB frequency: 1109.2 Hz
clean path 2 attenuation: 19.3 dB per decade</code></pre>
</div>
</div>
</section>
<section id="numerical-solution-for-p1-at-50-1" class="level4" data-number="37.11.2.2">
<h4 data-number="37.11.2.2" class="anchored" data-anchor-id="numerical-solution-for-p1-at-50-1"><span class="header-section-number">37.11.2.2</span> Numerical solution for P1 at 50%</h4>
<p>The transfer function for this path is solved for the case where P1 is set at a 50% rotational position.</p>
<div id="2218b40d-9d66-4afa-9eaf-8713e732ce5d" class="cell" data-execution_count="266">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>p1_setting <span class="op">=</span> <span class="dv">50</span><span class="op">/</span><span class="dv">100</span> <span class="co"># setting the gain pot to 50%</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>element_values[Rp1a1] <span class="op">=</span> p1_value <span class="op">-</span> p1_setting<span class="op">*</span>p1_value</span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>element_values[Rp1b1] <span class="op">=</span> p1_setting<span class="op">*</span>p1_value</span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a>element_values[Rp1a2] <span class="op">=</span> p1_value <span class="op">-</span> p1_setting<span class="op">*</span>p1_value</span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a>element_values[Rp1b2] <span class="op">=</span> p1_setting<span class="op">*</span>p1_value</span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-9"><a href="#cb126-9" aria-hidden="true" tabindex="-1"></a>NE <span class="op">=</span> NE_sym.subs(element_values)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Display the equations with numerical values.</p>
<div id="c33ff2d7-7ecd-44b6-8f01-a1eaf856c9bb" class="cell" data-execution_count="267">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>temp <span class="op">=</span> <span class="st">''</span></span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(shape(NE.lhs)[<span class="dv">0</span>]):</span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">+=</span> <span class="st">'$</span><span class="sc">{:s}</span><span class="st"> = </span><span class="sc">{:s}</span><span class="st">$&lt;br&gt;'</span>.<span class="bu">format</span>(latex(NE.rhs[i]),latex(NE.lhs[i]))</span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>Markdown(temp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="267">
<p><span class="math inline">\(0 = I_{V1} + 1.0 \cdot 10^{-7} s v_{1} - 1.0 \cdot 10^{-7} s v_{3}\)</span><br><span class="math inline">\(0 = I_{O2a} + v_{12} \left(- 8.2 \cdot 10^{-10} s - 2.55102040816327 \cdot 10^{-6}\right) + v_{2} \cdot \left(8.2 \cdot 10^{-10} s + 2.55102040816327 \cdot 10^{-6}\right)\)</span><br><span class="math inline">\(0 = - 1.0 \cdot 10^{-7} s v_{1} - 0.000666666666666667 v_{13} + v_{3} \cdot \left(1.68 \cdot 10^{-7} s + 0.000766666666666667\right) + v_{4} \left(- 6.8 \cdot 10^{-8} s - 0.0001\right)\)</span><br><span class="math inline">\(0 = v_{3} \left(- 6.8 \cdot 10^{-8} s - 0.0001\right) + v_{4} \cdot \left(6.8 \cdot 10^{-8} s + 0.00012\right)\)</span><br><span class="math inline">\(0 = 0.00052 v_{5} - 0.0005 v_{6}\)</span><br><span class="math inline">\(0 = - 0.0005 v_{5} + v_{6} \cdot \left(8.2 \cdot 10^{-8} s + 0.000566666666666667\right) + v_{7} \left(- 8.2 \cdot 10^{-8} s - 6.66666666666667 \cdot 10^{-5}\right)\)</span><br><span class="math inline">\(0 = v_{6} \left(- 8.2 \cdot 10^{-8} s - 6.66666666666667 \cdot 10^{-5}\right) + v_{7} \cdot \left(8.239 \cdot 10^{-8} s + 6.90363349131122 \cdot 10^{-5}\right) + v_{8} \left(- 3.9 \cdot 10^{-10} s - 2.3696682464455 \cdot 10^{-6}\right)\)</span><br><span class="math inline">\(0 = I_{O1b} + v_{7} \left(- 3.9 \cdot 10^{-10} s - 2.3696682464455 \cdot 10^{-6}\right) + v_{8} \cdot \left(3.9 \cdot 10^{-10} s + 2.3696682464455 \cdot 10^{-6}\right)\)</span><br><span class="math inline">\(0 = - 1.0 \cdot 10^{-6} s v_{20} - 0.001 v_{10} + v_{9} \cdot \left(1.0 \cdot 10^{-6} s + 0.001\right)\)</span><br><span class="math inline">\(0 = - 1.0 \cdot 10^{-6} s v_{11} + v_{10} \cdot \left(1.0 \cdot 10^{-6} s + 0.001\right) - 0.001 v_{9}\)</span><br><span class="math inline">\(0 = - 1.0 \cdot 10^{-6} s v_{10} - 2.2 \cdot 10^{-9} s v_{17} + v_{11} \cdot \left(1.0022 \cdot 10^{-6} s + 2.12765957446809 \cdot 10^{-5}\right) - 2.12765957446809 \cdot 10^{-5} v_{12}\)</span><br><span class="math inline">\(0 = - 2.7 \cdot 10^{-8} s v_{18} - 2.12765957446809 \cdot 10^{-5} v_{11} + v_{12} \cdot \left(2.782 \cdot 10^{-8} s + 0.000127531319856548\right) - 6.66666666666667 \cdot 10^{-5} v_{13} - 3.7037037037037 \cdot 10^{-5} v_{16} + v_{2} \left(- 8.2 \cdot 10^{-10} s - 2.55102040816327 \cdot 10^{-6}\right)\)</span><br><span class="math inline">\(0 = - 6.66666666666667 \cdot 10^{-5} v_{12} + v_{13} \cdot \left(1.0 \cdot 10^{-6} s + 0.000733333333333333\right) - 0.000666666666666667 v_{3}\)</span><br><span class="math inline">\(0 = - 3.9 \cdot 10^{-7} s v_{15} + v_{14} \cdot \left(4.58 \cdot 10^{-7} s + 0.000882745098039216\right) - 2.0 \cdot 10^{-5} v_{16} + v_{19} \left(- 6.8 \cdot 10^{-8} s - 0.000196078431372549\right)\)</span><br><span class="math inline">\(0 = - 3.9 \cdot 10^{-7} s v_{14} + v_{15} \cdot \left(3.9 \cdot 10^{-7} s + 0.001\right)\)</span><br><span class="math inline">\(0 = - 3.7037037037037 \cdot 10^{-5} v_{12} - 2.0 \cdot 10^{-5} v_{14} + 0.000205824915824916 v_{16} - 4.54545454545455 \cdot 10^{-5} v_{17} - 8.33333333333333 \cdot 10^{-5} v_{18}\)</span><br><span class="math inline">\(0 = - 2.2 \cdot 10^{-9} s v_{11} - 4.54545454545455 \cdot 10^{-5} v_{16} + v_{17} \cdot \left(2.2 \cdot 10^{-9} s + 4.54545454545455 \cdot 10^{-5}\right)\)</span><br><span class="math inline">\(0 = - 2.7 \cdot 10^{-8} s v_{12} - 8.33333333333333 \cdot 10^{-5} v_{16} + v_{18} \cdot \left(2.7 \cdot 10^{-8} s + 8.33333333333333 \cdot 10^{-5}\right)\)</span><br><span class="math inline">\(0 = I_{V2} + v_{14} \left(- 6.8 \cdot 10^{-8} s - 0.000196078431372549\right) + v_{19} \cdot \left(6.8 \cdot 10^{-8} s + 0.000196078431372549\right)\)</span><br><span class="math inline">\(0 = I_{V3} + 1.0 \cdot 10^{-6} s v_{20} - 1.0 \cdot 10^{-6} s v_{9}\)</span><br><span class="math inline">\(0 = v_{1}\)</span><br><span class="math inline">\(1 = v_{19}\)</span><br><span class="math inline">\(0 = v_{20}\)</span><br><span class="math inline">\(0 = - v_{4} + v_{7}\)</span><br><span class="math inline">\(0 = v_{12}\)</span><br></p>
</div>
</div>
<p>Solve for voltages and currents and display the results.</p>
<div id="d3af93e0-01fa-4328-ab35-35305dae12d2" class="cell" data-execution_count="268">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>U <span class="op">=</span> solve(NE,X)</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>temp <span class="op">=</span> <span class="st">''</span></span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> U.keys():</span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">+=</span> <span class="st">'$</span><span class="sc">{:s}</span><span class="st"> = </span><span class="sc">{:s}</span><span class="st">$&lt;br&gt;'</span>.<span class="bu">format</span>(latex(i),latex(U[i]))</span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a>Markdown(temp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="268">
<p><span class="math inline">\(v_{1} = 0.0\)</span><br><span class="math inline">\(v_{2} = \frac{- 1.26384690189495 \cdot 10^{63} s^{5} - 3.30941715880806 \cdot 10^{67} s^{4} - 1.76927318717644 \cdot 10^{71} s^{3} - 3.29892164039092 \cdot 10^{74} s^{2} - 1.88749342217544 \cdot 10^{77} s - 7.25931088102553 \cdot 10^{78}}{8.7114749288661 \cdot 10^{58} s^{6} + 4.42758037940265 \cdot 10^{63} s^{5} + 6.39426906142035 \cdot 10^{67} s^{4} + 2.72152037399421 \cdot 10^{71} s^{3} + 4.243557822183 \cdot 10^{74} s^{2} + 2.24888518595392 \cdot 10^{77} s + 8.61957981330834 \cdot 10^{78}}\)</span><br><span class="math inline">\(v_{3} = 0.0\)</span><br><span class="math inline">\(v_{4} = 0.0\)</span><br><span class="math inline">\(v_{5} = 0.0\)</span><br><span class="math inline">\(v_{6} = 0.0\)</span><br><span class="math inline">\(v_{7} = 0.0\)</span><br><span class="math inline">\(v_{8} = 0.0\)</span><br><span class="math inline">\(v_{9} = \frac{2.0138625 \cdot 10^{55} s^{4} + 1.71863602941176 \cdot 10^{59} s^{3} + 4.87499999999999 \cdot 10^{62} s^{2} + 4.59558823529411 \cdot 10^{65} s}{4.81802717154256 \cdot 10^{54} s^{5} + 2.29885866434566 \cdot 10^{59} s^{4} + 2.82128259649683 \cdot 10^{63} s^{3} + 6.27481286137239 \cdot 10^{66} s^{2} + 3.94876161529248 \cdot 10^{69} s + 1.53236974458815 \cdot 10^{71}}\)</span><br><span class="math inline">\(v_{10} = \frac{2.0138625 \cdot 10^{52} s^{5} + 1.92002227941176 \cdot 10^{56} s^{4} + 6.59363602941176 \cdot 10^{59} s^{3} + 9.47058823529411 \cdot 10^{62} s^{2} + 4.59558823529411 \cdot 10^{65} s}{4.81802717154256 \cdot 10^{54} s^{5} + 2.29885866434566 \cdot 10^{59} s^{4} + 2.82128259649683 \cdot 10^{63} s^{3} + 6.27481286137239 \cdot 10^{66} s^{2} + 3.94876161529248 \cdot 10^{69} s + 1.53236974458815 \cdot 10^{71}}\)</span><br><span class="math inline">\(v_{11} = \frac{2.0138625 \cdot 10^{52} s^{5} + 2.12140852941176 \cdot 10^{56} s^{4} + 8.31227205882352 \cdot 10^{59} s^{3} + 1.43455882352941 \cdot 10^{63} s^{2} + 9.19117647058822 \cdot 10^{65} s}{4.81802717154256 \cdot 10^{54} s^{5} + 2.29885866434566 \cdot 10^{59} s^{4} + 2.82128259649683 \cdot 10^{63} s^{3} + 6.27481286137239 \cdot 10^{66} s^{2} + 3.94876161529248 \cdot 10^{69} s + 1.53236974458815 \cdot 10^{71}}\)</span><br><span class="math inline">\(v_{12} = 0.0\)</span><br><span class="math inline">\(v_{13} = 0.0\)</span><br><span class="math inline">\(v_{14} = \frac{7.70884347446809 \cdot 10^{55} s^{5} + 1.76830244412326 \cdot 10^{60} s^{4} + 9.75686883763291 \cdot 10^{63} s^{3} + 2.00756023341467 \cdot 10^{67} s^{2} + 1.40196836955285 \cdot 10^{70} s + 5.47822825670137 \cdot 10^{71}}{7.70884347446809 \cdot 10^{55} s^{5} + 3.67817386295305 \cdot 10^{60} s^{4} + 4.51405215439493 \cdot 10^{64} s^{3} + 1.00397005781958 \cdot 10^{68} s^{2} + 6.31801858446797 \cdot 10^{70} s + 2.45179159134104 \cdot 10^{72}}\)</span><br><span class="math inline">\(v_{15} = \frac{7.70884347446809 \cdot 10^{55} s^{5} + 1.57063979093177 \cdot 10^{60} s^{4} + 5.72958732242324 \cdot 10^{63} s^{3} + 5.3843527894717 \cdot 10^{66} s^{2} + 2.13650902011353 \cdot 10^{68} s}{7.70884347446809 \cdot 10^{55} s^{5} + 3.67817386295305 \cdot 10^{60} s^{4} + 4.51405215439493 \cdot 10^{64} s^{3} + 1.00397005781958 \cdot 10^{68} s^{2} + 6.31801858446797 \cdot 10^{70} s + 2.45179159134104 \cdot 10^{72}}\)</span><br><span class="math inline">\(v_{16} = \frac{4.72614965425532 \cdot 10^{53} s^{5} + 1.34411248109 \cdot 10^{58} s^{4} + 9.21167841492205 \cdot 10^{61} s^{3} + 2.41846205484128 \cdot 10^{65} s^{2} + 2.24113593696666 \cdot 10^{68} s + 8.88895209921494 \cdot 10^{69}}{4.81802717154256 \cdot 10^{54} s^{5} + 2.29885866434566 \cdot 10^{59} s^{4} + 2.82128259649683 \cdot 10^{63} s^{3} + 6.27481286137239 \cdot 10^{66} s^{2} + 3.94876161529248 \cdot 10^{69} s + 1.53236974458815 \cdot 10^{71}}\)</span><br><span class="math inline">\(v_{17} = \frac{2.0138625 \cdot 10^{52} s^{5} + 9.56082557247695 \cdot 10^{57} s^{4} + 8.10026990741267 \cdot 10^{61} s^{3} + 2.31064415746956 \cdot 10^{65} s^{2} + 2.23683368415064 \cdot 10^{68} s + 8.88895209921494 \cdot 10^{69}}{4.81802717154256 \cdot 10^{54} s^{5} + 2.29885866434566 \cdot 10^{59} s^{4} + 2.82128259649683 \cdot 10^{63} s^{3} + 6.27481286137239 \cdot 10^{66} s^{2} + 3.94876161529248 \cdot 10^{69} s + 1.53236974458815 \cdot 10^{71}}\)</span><br><span class="math inline">\(v_{18} = \frac{1.45868816489362 \cdot 10^{57} s^{4} + 3.69828291543406 \cdot 10^{61} s^{3} + 1.70166527761975 \cdot 10^{65} s^{2} + 2.2123357321652 \cdot 10^{68} s + 8.88895209921494 \cdot 10^{69}}{4.81802717154256 \cdot 10^{54} s^{5} + 2.29885866434566 \cdot 10^{59} s^{4} + 2.82128259649683 \cdot 10^{63} s^{3} + 6.27481286137239 \cdot 10^{66} s^{2} + 3.94876161529248 \cdot 10^{69} s + 1.53236974458815 \cdot 10^{71}}\)</span><br><span class="math inline">\(v_{19} = 1.0\)</span><br><span class="math inline">\(v_{20} = 0.0\)</span><br><span class="math inline">\(I_{V1} = 0.0\)</span><br><span class="math inline">\(I_{V2} = \frac{- 1.29871256480426 \cdot 10^{71} s^{5} - 2.78057297595692 \cdot 10^{75} s^{4} - 1.23998265533368 \cdot 10^{79} s^{3} - 1.90922089398308 \cdot 10^{82} s^{2} - 9.76878402295801 \cdot 10^{84} s - 3.73327208955079 \cdot 10^{86}}{7.70884347446809 \cdot 10^{73} s^{5} + 3.67817386295305 \cdot 10^{78} s^{4} + 4.51405215439493 \cdot 10^{82} s^{3} + 1.00397005781958 \cdot 10^{86} s^{2} + 6.31801858446797 \cdot 10^{88} s + 2.45179159134104 \cdot 10^{90}}\)</span><br><span class="math inline">\(I_{V3} = \frac{2.0138625 \cdot 10^{49} s^{5} + 1.71863602941176 \cdot 10^{53} s^{4} + 4.87499999999999 \cdot 10^{56} s^{3} + 4.59558823529411 \cdot 10^{59} s^{2}}{4.81802717154256 \cdot 10^{54} s^{5} + 2.29885866434566 \cdot 10^{59} s^{4} + 2.82128259649683 \cdot 10^{63} s^{3} + 6.27481286137239 \cdot 10^{66} s^{2} + 3.94876161529248 \cdot 10^{69} s + 1.53236974458815 \cdot 10^{71}}\)</span><br><span class="math inline">\(I_{O1b} = 0.0\)</span><br><span class="math inline">\(I_{O2a} = \frac{5.15855878324468 \cdot 10^{50} s^{5} + 1.35078251379921 \cdot 10^{55} s^{4} + 7.22152321296506 \cdot 10^{58} s^{3} + 1.34649862873099 \cdot 10^{62} s^{2} + 7.70405478438957 \cdot 10^{64} s + 2.96298403307165 \cdot 10^{66}}{4.3362244543883 \cdot 10^{55} s^{5} + 2.06897279791109 \cdot 10^{60} s^{4} + 2.53915433684715 \cdot 10^{64} s^{3} + 5.64733157523515 \cdot 10^{67} s^{2} + 3.55388545376323 \cdot 10^{70} s + 1.37913277012933 \cdot 10^{72}}\)</span><br></p>
</div>
</div>
<p>The transfer function for the Clean tone path 2 is calculated from the ratio of <span class="math inline">\(v_{2}\)</span> and <span class="math inline">\(v_{19}\)</span>. There are six capacitors in the network that comprises this path, so the order of the denominator polynomial is six. The voltage transfer function is <span class="math inline">\(H(s)=\frac {v_2} {v_{19}}\)</span>:</p>
<div id="0af3c7a6-959b-49db-9313-ede478ec92d0" class="cell" data-execution_count="269">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>H <span class="op">=</span> U[v2]<span class="op">/</span>U[v19]</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>H</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="269">
<p><span class="math inline">\(\displaystyle \frac{1.0 \left(- 1.26384690189495 \cdot 10^{63} s^{5} - 3.30941715880806 \cdot 10^{67} s^{4} - 1.76927318717644 \cdot 10^{71} s^{3} - 3.29892164039092 \cdot 10^{74} s^{2} - 1.88749342217544 \cdot 10^{77} s - 7.25931088102553 \cdot 10^{78}\right)}{8.7114749288661 \cdot 10^{58} s^{6} + 4.42758037940265 \cdot 10^{63} s^{5} + 6.39426906142035 \cdot 10^{67} s^{4} + 2.72152037399421 \cdot 10^{71} s^{3} + 4.243557822183 \cdot 10^{74} s^{2} + 2.24888518595392 \cdot 10^{77} s + 8.61957981330834 \cdot 10^{78}}\)</span></p>
</div>
</div>
<div id="bc165557-b8a9-415f-93ea-a6c8b4de9411" class="cell" data-jupyter="{&quot;outputs_hidden&quot;:false}" data-execution_count="270">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>num, denom <span class="op">=</span> fraction(H) <span class="co">#returns numerator and denominator</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a><span class="co"># convert symbolic to NumPy polynomial</span></span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> np.array(Poly(num, s).all_coeffs(), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> np.array(Poly(denom, s).all_coeffs(), dtype<span class="op">=</span><span class="bu">float</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="poles-and-zeros-1" class="level4" data-number="37.11.2.3">
<h4 data-number="37.11.2.3" class="anchored" data-anchor-id="poles-and-zeros-1"><span class="header-section-number">37.11.2.3</span> Poles and zeros</h4>
<p>The poles and zeros of the transfer function can easily be obtained with the following code:</p>
<div id="3ea3370c-003e-4af0-93ca-ee2b7a91b95f" class="cell" data-execution_count="271">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>sys_tf <span class="op">=</span> signal.TransferFunction(a,b)</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>sys_zeros <span class="op">=</span> np.roots(sys_tf.num)</span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>sys_poles <span class="op">=</span> np.roots(sys_tf.den)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The poles and zeros of the clean path 2 transfer function are plotted.</p>
<div id="58ec82b2-1186-4385-a501-00277e306042" class="cell" data-execution_count="272">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>plt.plot(np.real(sys_zeros), np.imag(sys_zeros), <span class="st">'ob'</span>, markerfacecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>plt.plot(np.real(sys_poles), np.imag(sys_poles), <span class="st">'xr'</span>)</span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>plt.legend([<span class="st">'Zeros'</span>, <span class="st">'Poles'</span>], loc<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Pole / Zero Plot'</span>)</span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'real part, </span><span class="ch">\u03C3</span><span class="st">'</span>)</span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'imaginary part, j</span><span class="ch">\u03C9</span><span class="st">'</span>)</span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb132-8"><a href="#cb132-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Klon Centaur part 1_files/figure-html/cell-114-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The plot above shows the poles and zeros of the transfer function plotted on the complex plane. The units are in radian frequency. There are five zeros and six poles. There is no zero at 0 Hz. Since there are more poles than zeros, and the value of the last pole is greater than the value of the last zero, the transfer function is a low pass filter.</p>
<p>Printing these values in Hz.</p>
<div id="68ff398e-36be-42c0-939c-80dd558600df" class="cell" data-execution_count="273">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'number of zeros: </span><span class="sc">{:d}</span><span class="st">'</span>.<span class="bu">format</span>(<span class="bu">len</span>(sys_zeros)))</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(sys_zeros)):</span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'z</span><span class="sc">{:d}</span><span class="st">: </span><span class="sc">{:,.2f}</span><span class="st"> Hz'</span>.<span class="bu">format</span>(i,sys_zeros[i]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi)))</span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'number of poles: </span><span class="sc">{:d}</span><span class="st">'</span>.<span class="bu">format</span>(<span class="bu">len</span>(sys_poles)))</span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(sys_poles)):</span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'p</span><span class="sc">{:d}</span><span class="st">: </span><span class="sc">{:,.2f}</span><span class="st"> Hz'</span>.<span class="bu">format</span>(i,sys_poles[i]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>number of zeros: 5
z0: -3,142.62 Hz
z1: -458.92 Hz
z2: -408.09 Hz
z3: -151.29 Hz
z4: -6.59 Hz
number of poles: 6
p0: -4,629.79 Hz
p1: -2,545.69 Hz
p2: -495.13 Hz
p3: -231.62 Hz
p4: -180.17 Hz
p5: -6.60 Hz</code></pre>
</div>
</div>
</section>
<section id="step-response-4" class="level4" data-number="37.11.2.4">
<h4 data-number="37.11.2.4" class="anchored" data-anchor-id="step-response-4"><span class="header-section-number">37.11.2.4</span> Step response</h4>
<p>The step response of the is calculated using the SciPy function <code>lsim</code> and plotted below. A square wave with a frequency of 100 Hz and an amplitude of 0.1 volts peak to peak is used as the input to this path. An input amplitude of 0.1 Vpp is used to keep the signal levels in the path below the conduction threshold for the diodes. Since the diodes have been removed from the circuit for analysis, we can say that at these low signal amplitudes, the diodes are not active and can be ignored. The input square wave has a positive 0.05 volt offset which allows us to examine the DC characteristics of the path. The frequency of the square wave was chosen to allow the time constant of the path to be plotted with sufficient resolution to be examined in the plot.</p>
<div id="7e3a3738-ebc9-4217-b62b-ad54733bb23d" class="cell" data-execution_count="274">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="fl">0.025</span>, <span class="dv">500</span>, endpoint<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>sqr_signal <span class="op">=</span> signal.square(<span class="dv">2</span><span class="op">*</span>np.pi<span class="op">*</span><span class="dv">100</span><span class="op">*</span>t, duty<span class="op">=</span><span class="fl">0.5</span>)<span class="op">/</span><span class="dv">20</span><span class="op">+</span><span class="dv">1</span><span class="op">/</span><span class="dv">20</span></span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>t_step, y_step, x_step <span class="op">=</span> signal.lsim(sys_tf, U<span class="op">=</span>sqr_signal, T<span class="op">=</span>t)</span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a>plt.plot(t_step<span class="op">*</span><span class="fl">1e3</span>, sqr_signal<span class="op">*</span><span class="fl">1e3</span>, <span class="st">'r'</span>, alpha<span class="op">=</span><span class="fl">0.75</span>, linewidth<span class="op">=</span><span class="dv">1</span>, label<span class="op">=</span><span class="st">'input'</span>)</span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a>plt.plot(t_step<span class="op">*</span><span class="fl">1e3</span>, y_step<span class="op">*</span><span class="fl">1e3</span>,<span class="st">'b'</span>, linewidth<span class="op">=</span><span class="fl">1.25</span>, label<span class="op">=</span><span class="st">'output'</span>)</span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Step response'</span>)</span>
<span id="cb135-9"><a href="#cb135-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'volts, mV'</span>)</span>
<span id="cb135-10"><a href="#cb135-10" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'time, msec'</span>)</span>
<span id="cb135-11"><a href="#cb135-11" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb135-12"><a href="#cb135-12" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">'best'</span>)</span>
<span id="cb135-13"><a href="#cb135-13" aria-hidden="true" tabindex="-1"></a><span class="co"># show plot</span></span>
<span id="cb135-14"><a href="#cb135-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Klon Centaur part 1_files/figure-html/cell-116-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The step response shows that the DC offset is preserved and the DC gain of the path is less than -1. The DC gain can be calculated by setting the Laplace variable equal to 0.</p>
<div id="573a4e46-2964-43d2-8821-0f54f8bfe930" class="cell" data-execution_count="275">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'DC gain: </span><span class="sc">{:.2f}</span><span class="st">'</span>.<span class="bu">format</span>(H.subs({s:<span class="dv">0</span>})))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>DC gain: -0.84</code></pre>
</div>
</div>
<p>There is almost no overshoot in the response and the rise time is relatively fast, on the order of a couple milliseconds.</p>
</section>
<section id="group-delay-4" class="level4" data-number="37.11.2.5">
<h4 data-number="37.11.2.5" class="anchored" data-anchor-id="group-delay-4"><span class="header-section-number">37.11.2.5</span> Group delay</h4>
<p>The group delay for this path is calculated and plotted below.</p>
<div id="a97548f3-4f92-495b-8751-f6e1f106acfc" class="cell" data-execution_count="276">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.logspace(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">2000</span>, endpoint<span class="op">=</span><span class="va">False</span>)<span class="op">*</span><span class="dv">2</span><span class="op">*</span>np.pi</span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>w, mag, phase <span class="op">=</span> signal.bode((a, b), w<span class="op">=</span>x) <span class="co"># returns: rad/s, mag in dB, phase in deg</span></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'group delay'</span>)</span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a>plt.semilogx(w<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), <span class="op">-</span>np.gradient(phase<span class="op">*</span>np.pi<span class="op">/</span><span class="dv">180</span>)<span class="op">/</span>np.gradient(w)<span class="op">*</span><span class="dv">1000</span>,<span class="st">'-'</span>,label<span class="op">=</span><span class="st">'group delay'</span>)</span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a><span class="co"># highlight the guitar audio band, 80 to 8kHz</span></span>
<span id="cb138-8"><a href="#cb138-8" aria-hidden="true" tabindex="-1"></a>plt.axvspan(<span class="dv">80</span>, <span class="fl">8e3</span>, color<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb138-9"><a href="#cb138-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-10"><a href="#cb138-10" aria-hidden="true" tabindex="-1"></a>plt.xlim((<span class="dv">10</span>,<span class="fl">100e3</span>))</span>
<span id="cb138-11"><a href="#cb138-11" aria-hidden="true" tabindex="-1"></a>plt.ylim((<span class="dv">0</span>,<span class="fl">0.2</span>))</span>
<span id="cb138-12"><a href="#cb138-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-13"><a href="#cb138-13" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Group delay, msec'</span>)</span>
<span id="cb138-14"><a href="#cb138-14" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Frequency, Hz'</span>)</span>
<span id="cb138-15"><a href="#cb138-15" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.legend()</span></span>
<span id="cb138-16"><a href="#cb138-16" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb138-17"><a href="#cb138-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Klon Centaur part 1_files/figure-html/cell-118-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The plot above shows that for frequencies in the guitar audio band, the group delay variation is less than 2 ms and therefore below the threshold of audibility as described in <a href="#sec-Group_delay" class="quarto-xref"><span>Section 37.8.6</span></a>.</p>
</section>
</section>
<section id="sec-Distortion_path_part_A" class="level3" data-number="37.11.3">
<h3 data-number="37.11.3" class="anchored" data-anchor-id="sec-Distortion_path_part_A"><span class="header-section-number">37.11.3</span> Distortion path part A</h3>
<div id="fig-klon-centaur-schematic-high-res_w_diode_path1_highlight_sch" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-klon-centaur-schematic-high-res_w_diode_path1_highlight_sch-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="klon-centaur-schematic-high-res_w_diode_path1_highlight.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-klon-centaur-schematic-high-res_w_diode_path1_highlight_sch-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;37.19: Klon Centaur distortion path part A schematic with the path highlighted.
</figcaption>
</figure>
</div>
<p>Distortion path part A is highlighted in <a href="#fig-klon-centaur-schematic-high-res_w_diode_path1_highlight_sch" class="quarto-xref">Figure&nbsp;<span>37.19</span></a>. There are four capacitors in this path which determine the frequency response. The signal level is also determined by the potentiometer P1B. The voltage transfer function from node 1 to node 8 is calculated below. The frequency response at node 8 shows some emphasis at 1 kHz as a function of the gain setting as seen in fig-distortion-path-part-A-freq-plot. The signal at the output of U1B, node 8, is what get clipped by the diodes. The guitar signal, already rich in harmonics, is heavily modified harmonically and amplitude limited by the diodes. In the net list the signal path at node 8 to C9 is removed and V3 is used to drive the rest of the path, because the MNA code is not modeling the diodes. So we can only look at the circuit up to that point.</p>
<p>The path starts at the output of U1A and ends at the output of U1B. The op amps isolate the path from the rest of the circuit.</p>
<p>The path starts with C3 and continues to R5||C4. The R7 &amp; C16 branch (part of clean path 1) also connects to the C3, R5||C4 node. There are a lot of components in the circuit that connect to the path, some only tangentially, but still need to be included in the analysis.</p>
<p>The gain potentiometer, P1 is connected to the non-inverting input of U1B and the wiper of P1 is connected to the AC ground. The CCW end of P1 forms (modeled as Rp1b in <a href="#fig-Klon-Centaur_sum_path_v1_sch" class="quarto-xref">Figure&nbsp;<span>37.14</span></a>) a voltage divider with R6 and when P1 is fully CCW, the non-inverting input of U1B is grounded. This effectively stops the signal from traveling to U1B and the diodes.</p>
<p>The most interesting part of this path are the components in the feedback of U1B which are, R10, R11||C7, R12||C8 and P1B. These components are the main contributors to the gain and frequency response of signals in this path. It’s not obvious by inspection how these components play together, but some guesses can be made. Capacitor C3 AC couples the signal into the path, so the signals should be attenuated at very low frequencies. At high frequencies, the capacitor, C8, decreases in impedance and limits the gain of U1B. However one would need to examine the resonant frequencies of R11||C7 and R12||C8 to get an idea of what might be happening over the guitar audio band. The position of P1 complicates an intuitive inspection of the circuit’s operation and rather than guessing. To obtain some insight into the operation of the circuit, we could perform a nodal analysis of the circuit and then try to relate the dominant poles and zeros to the behavior of the circuit and to the individual components. In <span class="quarto-unresolved-ref">?sec-Analysis_of_reactive_branches</span> an attempt is made to do this.</p>
<section id="distortion-path-part-a-frequency-response" class="level4" data-number="37.11.3.1">
<h4 data-number="37.11.3.1" class="anchored" data-anchor-id="distortion-path-part-a-frequency-response"><span class="header-section-number">37.11.3.1</span> Distortion path part A frequency response</h4>
<p>The frequency response of the path for various settings of P1 is calculated and displayed below. The source <span class="math inline">\(V_1\)</span> is set to one and the other sources are set to zero.</p>
<div id="24dc7823-e09a-4415-af90-0ca90d1a17b3" class="cell" data-execution_count="277">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>element_values[V1] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>element_values[V2] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>element_values[V3] <span class="op">=</span> <span class="dv">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The plot below shows the frequency response of the path for various settings of P1 ranging from 1% to 99%.</p>
<div id="cell-fig-distortion-path-part-a-freq-plot" class="cell" data-execution_count="278">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>fig, ax1 <span class="op">=</span> plt.subplots()</span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'magnitude, dB'</span>)</span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'frequency, Hz'</span>)</span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a><span class="co"># instantiate a second y-axes that shares the same x-axis</span></span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> ax1.twinx()</span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a>color <span class="op">=</span> <span class="st">'k'</span></span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-9"><a href="#cb140-9" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'phase, deg'</span>,color<span class="op">=</span>color)</span>
<span id="cb140-10"><a href="#cb140-10" aria-hidden="true" tabindex="-1"></a>ax2.tick_params(axis<span class="op">=</span><span class="st">'y'</span>, labelcolor<span class="op">=</span>color)</span>
<span id="cb140-11"><a href="#cb140-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-12"><a href="#cb140-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(gain_setting)):</span>
<span id="cb140-13"><a href="#cb140-13" aria-hidden="true" tabindex="-1"></a>    element_values[Rp1a1] <span class="op">=</span> p1_value <span class="op">-</span> gain_setting[i]<span class="op">*</span>p1_value</span>
<span id="cb140-14"><a href="#cb140-14" aria-hidden="true" tabindex="-1"></a>    element_values[Rp1b1] <span class="op">=</span> gain_setting[i]<span class="op">*</span>p1_value</span>
<span id="cb140-15"><a href="#cb140-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb140-16"><a href="#cb140-16" aria-hidden="true" tabindex="-1"></a>    element_values[Rp1a2] <span class="op">=</span> p1_value <span class="op">-</span> gain_setting[i]<span class="op">*</span>p1_value</span>
<span id="cb140-17"><a href="#cb140-17" aria-hidden="true" tabindex="-1"></a>    element_values[Rp1b2] <span class="op">=</span> gain_setting[i]<span class="op">*</span>p1_value</span>
<span id="cb140-18"><a href="#cb140-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb140-19"><a href="#cb140-19" aria-hidden="true" tabindex="-1"></a>    NE <span class="op">=</span> NE_sym.subs(element_values)</span>
<span id="cb140-20"><a href="#cb140-20" aria-hidden="true" tabindex="-1"></a>    U <span class="op">=</span> solve(NE,X)</span>
<span id="cb140-21"><a href="#cb140-21" aria-hidden="true" tabindex="-1"></a>    H <span class="op">=</span> U[v8]<span class="op">/</span>U[v1]</span>
<span id="cb140-22"><a href="#cb140-22" aria-hidden="true" tabindex="-1"></a>    num, denom <span class="op">=</span> fraction(H) <span class="co">#returns numerator and denominator</span></span>
<span id="cb140-23"><a href="#cb140-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-24"><a href="#cb140-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># convert symbolic to NumPy polynomial</span></span>
<span id="cb140-25"><a href="#cb140-25" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> np.array(Poly(num, s).all_coeffs(), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb140-26"><a href="#cb140-26" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> np.array(Poly(denom, s).all_coeffs(), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb140-27"><a href="#cb140-27" aria-hidden="true" tabindex="-1"></a>    sys <span class="op">=</span> (a, b)</span>
<span id="cb140-28"><a href="#cb140-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-29"><a href="#cb140-29" aria-hidden="true" tabindex="-1"></a>    w, mag, phase <span class="op">=</span> signal.bode(sys, w<span class="op">=</span>x_axis) <span class="co"># returns: rad/s, mag in dB, phase in deg</span></span>
<span id="cb140-30"><a href="#cb140-30" aria-hidden="true" tabindex="-1"></a>    diode_pathA_mag[i] <span class="op">=</span> mag</span>
<span id="cb140-31"><a href="#cb140-31" aria-hidden="true" tabindex="-1"></a>    diode_pathA_w[i] <span class="op">=</span> w</span>
<span id="cb140-32"><a href="#cb140-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-33"><a href="#cb140-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># plot the results.  </span></span>
<span id="cb140-34"><a href="#cb140-34" aria-hidden="true" tabindex="-1"></a>    ax1.semilogx(w<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), mag,<span class="st">'-'</span>,color<span class="op">=</span>color_list[i],label<span class="op">=</span><span class="st">'magnitude @ </span><span class="sc">{:.0f}% g</span><span class="st">ain'</span>.<span class="bu">format</span>(gain_setting[i]<span class="op">*</span><span class="dv">100</span>)) <span class="co"># magnitude plot</span></span>
<span id="cb140-35"><a href="#cb140-35" aria-hidden="true" tabindex="-1"></a>    ax2.semilogx(w<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), phase,<span class="st">':'</span>,color<span class="op">=</span>color_list[i],label<span class="op">=</span><span class="st">'phase @ </span><span class="sc">{:.0f}% g</span><span class="st">ain'</span>.<span class="bu">format</span>(gain_setting[i]<span class="op">*</span><span class="dv">100</span>)) <span class="co"># phase plot</span></span>
<span id="cb140-36"><a href="#cb140-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-37"><a href="#cb140-37" aria-hidden="true" tabindex="-1"></a><span class="co"># highlight the guitar audio band, 80 to 8kHz</span></span>
<span id="cb140-38"><a href="#cb140-38" aria-hidden="true" tabindex="-1"></a>plt.axvspan(<span class="dv">80</span>, <span class="fl">8e3</span>, color<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>) </span>
<span id="cb140-39"><a href="#cb140-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-40"><a href="#cb140-40" aria-hidden="true" tabindex="-1"></a><span class="co"># set plot limits for display</span></span>
<span id="cb140-41"><a href="#cb140-41" aria-hidden="true" tabindex="-1"></a>plt.xlim((<span class="dv">10</span>,<span class="fl">100e3</span>))</span>
<span id="cb140-42"><a href="#cb140-42" aria-hidden="true" tabindex="-1"></a>ax1.set_ylim((<span class="op">-</span><span class="dv">40</span>,<span class="dv">40</span>))</span>
<span id="cb140-43"><a href="#cb140-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-44"><a href="#cb140-44" aria-hidden="true" tabindex="-1"></a><span class="co"># position legends outside the graph</span></span>
<span id="cb140-45"><a href="#cb140-45" aria-hidden="true" tabindex="-1"></a>ax1.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.6</span>,<span class="dv">1</span>)) <span class="co"># magnitude legend position: relative (horizontal position, vertical position) </span></span>
<span id="cb140-46"><a href="#cb140-46" aria-hidden="true" tabindex="-1"></a>ax2.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.6</span>,<span class="fl">0.5</span>)) <span class="co"># phase legend position:</span></span>
<span id="cb140-47"><a href="#cb140-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-48"><a href="#cb140-48" aria-hidden="true" tabindex="-1"></a>ax1.grid()</span>
<span id="cb140-49"><a href="#cb140-49" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Magnitude and phase response for gains of 1% to 99%'</span>)</span>
<span id="cb140-50"><a href="#cb140-50" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-distortion-path-part-a-freq-plot" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-distortion-path-part-a-freq-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Klon Centaur part 1_files/figure-html/fig-distortion-path-part-a-freq-plot-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-distortion-path-part-a-freq-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;37.20: Distortion path part A magnitude and phase response
</figcaption>
</figure>
</div>
</div>
</div>
<p>The Klon Centaur distortion path part A has a band pass characteristic centered at 1kHz. The gain of this path at 1 kHz ranges from about -3 dB to 35 dB depending on the position of P1. Distortion path A shapes the tonal characteristics of the signal prior to the clipping diodes.</p>
<p>The frequency response for this path exhibits emphasis near 1,000 Hz for gains above 10% and starts to look like a band pass filter. The bandwidth for the filter is measured at the half-power points (gain −3 dB) and the quality factor, also called Q, is the reciprocal of the fractional bandwidth. These parameters are calculated below.</p>
<div id="bcca1634-e591-4c60-a9d7-c5676e6ca738" class="cell" data-execution_count="279">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">4</span> <span class="co"># index for 50%</span></span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'gain setting: </span><span class="sc">{:.0f}</span><span class="st">%'</span>.<span class="bu">format</span>(gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a>max_gain <span class="op">=</span> diode_pathA_mag[i].<span class="bu">max</span>()</span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a>max_gain_arg <span class="op">=</span> diode_pathA_mag[i].argmax()</span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a>max_gain_freq <span class="op">=</span> diode_pathA_w[i][max_gain_arg]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi)</span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'max gain: </span><span class="sc">{:.1f}</span><span class="st"> dB at </span><span class="sc">{:,.0f}</span><span class="st"> Hz'</span>.<span class="bu">format</span>(max_gain, max_gain_freq))</span>
<span id="cb141-8"><a href="#cb141-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-9"><a href="#cb141-9" aria-hidden="true" tabindex="-1"></a>upper_3dB_arg_offset <span class="op">=</span> np.where(diode_pathA_mag[i][max_gain_arg:] <span class="op">&lt;</span> max_gain <span class="op">-</span> <span class="dv">3</span>)[<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb141-10"><a href="#cb141-10" aria-hidden="true" tabindex="-1"></a>upper_3dB_freq <span class="op">=</span> diode_pathA_w[i][max_gain_arg<span class="op">+</span>upper_3dB_arg_offset]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi)</span>
<span id="cb141-11"><a href="#cb141-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'upper -3dB frequency: </span><span class="sc">{:,.0f}</span><span class="st"> Hz'</span>.<span class="bu">format</span>(upper_3dB_freq))</span>
<span id="cb141-12"><a href="#cb141-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-13"><a href="#cb141-13" aria-hidden="true" tabindex="-1"></a>lower_3dB_arg <span class="op">=</span> np.where(diode_pathA_mag[i][:max_gain_arg] <span class="op">&lt;</span> max_gain <span class="op">-</span> <span class="dv">3</span>)[<span class="dv">0</span>][<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb141-14"><a href="#cb141-14" aria-hidden="true" tabindex="-1"></a>lower_3dB_freq <span class="op">=</span> diode_pathA_w[i][lower_3dB_arg]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi)</span>
<span id="cb141-15"><a href="#cb141-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'lower -3dB frequency: </span><span class="sc">{:,.0f}</span><span class="st"> Hz'</span>.<span class="bu">format</span>(lower_3dB_freq))</span>
<span id="cb141-16"><a href="#cb141-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-17"><a href="#cb141-17" aria-hidden="true" tabindex="-1"></a>diode_pathA_bw <span class="op">=</span> upper_3dB_freq <span class="op">-</span> lower_3dB_freq</span>
<span id="cb141-18"><a href="#cb141-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'bandwidth: </span><span class="sc">{:,.0f}</span><span class="st"> Hz'</span>.<span class="bu">format</span>(diode_pathA_bw))</span>
<span id="cb141-19"><a href="#cb141-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-20"><a href="#cb141-20" aria-hidden="true" tabindex="-1"></a>diode_pathA_q <span class="op">=</span> max_gain_freq<span class="op">/</span>diode_pathA_bw</span>
<span id="cb141-21"><a href="#cb141-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Q factor: </span><span class="sc">{:.1f}</span><span class="st">'</span>.<span class="bu">format</span>(diode_pathA_q))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>gain setting: 50%
max gain: 12.2 dB at 1,109 Hz
upper -3dB frequency: 2,788 Hz
lower -3dB frequency: 464 Hz
bandwidth: 2,323 Hz
Q factor: 0.5</code></pre>
</div>
</div>
</section>
<section id="numerical-solution-for-p1-at-50-2" class="level4" data-number="37.11.3.2">
<h4 data-number="37.11.3.2" class="anchored" data-anchor-id="numerical-solution-for-p1-at-50-2"><span class="header-section-number">37.11.3.2</span> Numerical solution for P1 at 50%</h4>
<p>The transfer function for this path is solved for the case where P1 is set at a 50% rotational position.</p>
<div id="6d7eed5e-ecaa-4ed2-9fbb-88b77adf5d6d" class="cell" data-execution_count="281">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>p1_setting <span class="op">=</span> <span class="dv">50</span><span class="op">/</span><span class="dv">100</span> <span class="co"># setting the gain pot to 50%</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>element_values[Rp1a1] <span class="op">=</span> p1_value <span class="op">-</span> p1_setting<span class="op">*</span>p1_value</span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a>element_values[Rp1b1] <span class="op">=</span> p1_setting<span class="op">*</span>p1_value</span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a>element_values[Rp1a2] <span class="op">=</span> p1_value <span class="op">-</span> p1_setting<span class="op">*</span>p1_value</span>
<span id="cb143-7"><a href="#cb143-7" aria-hidden="true" tabindex="-1"></a>element_values[Rp1b2] <span class="op">=</span> p1_setting<span class="op">*</span>p1_value</span>
<span id="cb143-8"><a href="#cb143-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-9"><a href="#cb143-9" aria-hidden="true" tabindex="-1"></a>NE <span class="op">=</span> NE_sym.subs(element_values)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Display the equations with numerical component values.</p>
<div id="d4488af5-46cf-4b19-b653-d579dc9357b1" class="cell" data-execution_count="282">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>temp <span class="op">=</span> <span class="st">''</span></span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(shape(NE.lhs)[<span class="dv">0</span>]):</span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">+=</span> <span class="st">'$</span><span class="sc">{:s}</span><span class="st"> = </span><span class="sc">{:s}</span><span class="st">$&lt;br&gt;'</span>.<span class="bu">format</span>(latex(NE.rhs[i]),latex(NE.lhs[i]))</span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a>Markdown(temp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="282">
<p><span class="math inline">\(0 = I_{V1} + 1.0 \cdot 10^{-7} s v_{1} - 1.0 \cdot 10^{-7} s v_{3}\)</span><br><span class="math inline">\(0 = I_{O2a} + v_{12} \left(- 8.2 \cdot 10^{-10} s - 2.55102040816327 \cdot 10^{-6}\right) + v_{2} \cdot \left(8.2 \cdot 10^{-10} s + 2.55102040816327 \cdot 10^{-6}\right)\)</span><br><span class="math inline">\(0 = - 1.0 \cdot 10^{-7} s v_{1} - 0.000666666666666667 v_{13} + v_{3} \cdot \left(1.68 \cdot 10^{-7} s + 0.000766666666666667\right) + v_{4} \left(- 6.8 \cdot 10^{-8} s - 0.0001\right)\)</span><br><span class="math inline">\(0 = v_{3} \left(- 6.8 \cdot 10^{-8} s - 0.0001\right) + v_{4} \cdot \left(6.8 \cdot 10^{-8} s + 0.00012\right)\)</span><br><span class="math inline">\(0 = 0.00052 v_{5} - 0.0005 v_{6}\)</span><br><span class="math inline">\(0 = - 0.0005 v_{5} + v_{6} \cdot \left(8.2 \cdot 10^{-8} s + 0.000566666666666667\right) + v_{7} \left(- 8.2 \cdot 10^{-8} s - 6.66666666666667 \cdot 10^{-5}\right)\)</span><br><span class="math inline">\(0 = v_{6} \left(- 8.2 \cdot 10^{-8} s - 6.66666666666667 \cdot 10^{-5}\right) + v_{7} \cdot \left(8.239 \cdot 10^{-8} s + 6.90363349131122 \cdot 10^{-5}\right) + v_{8} \left(- 3.9 \cdot 10^{-10} s - 2.3696682464455 \cdot 10^{-6}\right)\)</span><br><span class="math inline">\(0 = I_{O1b} + v_{7} \left(- 3.9 \cdot 10^{-10} s - 2.3696682464455 \cdot 10^{-6}\right) + v_{8} \cdot \left(3.9 \cdot 10^{-10} s + 2.3696682464455 \cdot 10^{-6}\right)\)</span><br><span class="math inline">\(0 = - 1.0 \cdot 10^{-6} s v_{20} - 0.001 v_{10} + v_{9} \cdot \left(1.0 \cdot 10^{-6} s + 0.001\right)\)</span><br><span class="math inline">\(0 = - 1.0 \cdot 10^{-6} s v_{11} + v_{10} \cdot \left(1.0 \cdot 10^{-6} s + 0.001\right) - 0.001 v_{9}\)</span><br><span class="math inline">\(0 = - 1.0 \cdot 10^{-6} s v_{10} - 2.2 \cdot 10^{-9} s v_{17} + v_{11} \cdot \left(1.0022 \cdot 10^{-6} s + 2.12765957446809 \cdot 10^{-5}\right) - 2.12765957446809 \cdot 10^{-5} v_{12}\)</span><br><span class="math inline">\(0 = - 2.7 \cdot 10^{-8} s v_{18} - 2.12765957446809 \cdot 10^{-5} v_{11} + v_{12} \cdot \left(2.782 \cdot 10^{-8} s + 0.000127531319856548\right) - 6.66666666666667 \cdot 10^{-5} v_{13} - 3.7037037037037 \cdot 10^{-5} v_{16} + v_{2} \left(- 8.2 \cdot 10^{-10} s - 2.55102040816327 \cdot 10^{-6}\right)\)</span><br><span class="math inline">\(0 = - 6.66666666666667 \cdot 10^{-5} v_{12} + v_{13} \cdot \left(1.0 \cdot 10^{-6} s + 0.000733333333333333\right) - 0.000666666666666667 v_{3}\)</span><br><span class="math inline">\(0 = - 3.9 \cdot 10^{-7} s v_{15} + v_{14} \cdot \left(4.58 \cdot 10^{-7} s + 0.000882745098039216\right) - 2.0 \cdot 10^{-5} v_{16} + v_{19} \left(- 6.8 \cdot 10^{-8} s - 0.000196078431372549\right)\)</span><br><span class="math inline">\(0 = - 3.9 \cdot 10^{-7} s v_{14} + v_{15} \cdot \left(3.9 \cdot 10^{-7} s + 0.001\right)\)</span><br><span class="math inline">\(0 = - 3.7037037037037 \cdot 10^{-5} v_{12} - 2.0 \cdot 10^{-5} v_{14} + 0.000205824915824916 v_{16} - 4.54545454545455 \cdot 10^{-5} v_{17} - 8.33333333333333 \cdot 10^{-5} v_{18}\)</span><br><span class="math inline">\(0 = - 2.2 \cdot 10^{-9} s v_{11} - 4.54545454545455 \cdot 10^{-5} v_{16} + v_{17} \cdot \left(2.2 \cdot 10^{-9} s + 4.54545454545455 \cdot 10^{-5}\right)\)</span><br><span class="math inline">\(0 = - 2.7 \cdot 10^{-8} s v_{12} - 8.33333333333333 \cdot 10^{-5} v_{16} + v_{18} \cdot \left(2.7 \cdot 10^{-8} s + 8.33333333333333 \cdot 10^{-5}\right)\)</span><br><span class="math inline">\(0 = I_{V2} + v_{14} \left(- 6.8 \cdot 10^{-8} s - 0.000196078431372549\right) + v_{19} \cdot \left(6.8 \cdot 10^{-8} s + 0.000196078431372549\right)\)</span><br><span class="math inline">\(0 = I_{V3} + 1.0 \cdot 10^{-6} s v_{20} - 1.0 \cdot 10^{-6} s v_{9}\)</span><br><span class="math inline">\(1 = v_{1}\)</span><br><span class="math inline">\(0 = v_{19}\)</span><br><span class="math inline">\(0 = v_{20}\)</span><br><span class="math inline">\(0 = - v_{4} + v_{7}\)</span><br><span class="math inline">\(0 = v_{12}\)</span><br></p>
</div>
</div>
<p>Solve for voltages and currents and display the results.</p>
<div id="5c20c536-fbe0-4626-8985-46cd8937bd26" class="cell" data-execution_count="283">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>U <span class="op">=</span> solve(NE,X)</span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>temp <span class="op">=</span> <span class="st">''</span></span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> U.keys():</span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">+=</span> <span class="st">'$</span><span class="sc">{:s}</span><span class="st"> = </span><span class="sc">{:s}</span><span class="st">$&lt;br&gt;'</span>.<span class="bu">format</span>(latex(i),latex(U[i]))</span>
<span id="cb145-6"><a href="#cb145-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-7"><a href="#cb145-7" aria-hidden="true" tabindex="-1"></a>Markdown(temp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="283">
<p><span class="math inline">\(v_{1} = 1.0\)</span><br><span class="math inline">\(v_{2} = \frac{- 1.666 \cdot 10^{36} s^{2} - 2.94 \cdot 10^{39} s}{3.07377 \cdot 10^{28} s^{4} + 3.8347452 \cdot 10^{32} s^{3} + 1.324108096 \cdot 10^{36} s^{2} + 1.3641377 \cdot 10^{39} s + 9.5625 \cdot 10^{40}}\)</span><br><span class="math inline">\(v_{3} = \frac{1.53 \cdot 10^{25} s^{3} + 3.822 \cdot 10^{28} s^{2} + 1.98 \cdot 10^{31} s}{1.53 \cdot 10^{25} s^{3} + 1.4328 \cdot 10^{29} s^{2} + 2.13344 \cdot 10^{32} s + 1.53 \cdot 10^{34}}\)</span><br><span class="math inline">\(v_{4} = \frac{1.53 \cdot 10^{25} s^{3} + 3.372 \cdot 10^{28} s^{2} + 1.65 \cdot 10^{31} s}{1.53 \cdot 10^{25} s^{3} + 1.4328 \cdot 10^{29} s^{2} + 2.13344 \cdot 10^{32} s + 1.53 \cdot 10^{34}}\)</span><br><span class="math inline">\(v_{5} = \frac{1.56825 \cdot 10^{37} s^{4} + 4.7313 \cdot 10^{40} s^{3} + 4.50125 \cdot 10^{43} s^{2} + 1.375 \cdot 10^{46} s}{1.63098 \cdot 10^{37} s^{4} + 1.6982148 \cdot 10^{41} s^{3} + 3.87420704000001 \cdot 10^{44} s^{2} + 2.54543933333334 \cdot 10^{47} s + 1.70850000000001 \cdot 10^{49}}\)</span><br><span class="math inline">\(v_{6} = \frac{1.63098 \cdot 10^{37} s^{4} + 4.920552 \cdot 10^{40} s^{3} + 4.6813 \cdot 10^{43} s^{2} + 1.43 \cdot 10^{46} s}{1.63098 \cdot 10^{37} s^{4} + 1.6982148 \cdot 10^{41} s^{3} + 3.87420704000001 \cdot 10^{44} s^{2} + 2.54543933333334 \cdot 10^{47} s + 1.70850000000001 \cdot 10^{49}}\)</span><br><span class="math inline">\(v_{7} = \frac{1.53 \cdot 10^{25} s^{3} + 3.372 \cdot 10^{28} s^{2} + 1.65 \cdot 10^{31} s}{1.53 \cdot 10^{25} s^{3} + 1.4328 \cdot 10^{29} s^{2} + 2.13344 \cdot 10^{32} s + 1.53 \cdot 10^{34}}\)</span><br><span class="math inline">\(v_{8} = \frac{1.2721644 \cdot 10^{46} s^{5} + 7.45961435931766 \cdot 10^{50} s^{4} + 2.18693901867302 \cdot 10^{54} s^{3} + 2.07668666587681 \cdot 10^{57} s^{2} + 6.37322274881527 \cdot 10^{59} s}{1.2721644 \cdot 10^{46} s^{5} + 2.09758384731754 \cdot 10^{50} s^{4} + 1.10702928656076 \cdot 10^{54} s^{3} + 2.03466134856873 \cdot 10^{57} s^{2} + 1.21969565229069 \cdot 10^{60} s + 8.09715639810431 \cdot 10^{61}}\)</span><br><span class="math inline">\(v_{9} = 0.0\)</span><br><span class="math inline">\(v_{10} = 0.0\)</span><br><span class="math inline">\(v_{11} = 0.0\)</span><br><span class="math inline">\(v_{12} = 0.0\)</span><br><span class="math inline">\(v_{13} = \frac{1.02 \cdot 10^{28} s^{2} + 1.8 \cdot 10^{31} s}{1.53 \cdot 10^{25} s^{3} + 1.4328 \cdot 10^{29} s^{2} + 2.13344 \cdot 10^{32} s + 1.53 \cdot 10^{34}}\)</span><br><span class="math inline">\(v_{14} = 0.0\)</span><br><span class="math inline">\(v_{15} = 0.0\)</span><br><span class="math inline">\(v_{16} = 0.0\)</span><br><span class="math inline">\(v_{17} = 0.0\)</span><br><span class="math inline">\(v_{18} = 0.0\)</span><br><span class="math inline">\(v_{19} = 0.0\)</span><br><span class="math inline">\(v_{20} = 0.0\)</span><br><span class="math inline">\(I_{V1} = \frac{- 1.0506 \cdot 10^{29} s^{3} - 1.93544 \cdot 10^{32} s^{2} - 1.53 \cdot 10^{34} s}{1.53 \cdot 10^{32} s^{3} + 1.4328 \cdot 10^{36} s^{2} + 2.13344 \cdot 10^{39} s + 1.53 \cdot 10^{41}}\)</span><br><span class="math inline">\(I_{V2} = 0.0\)</span><br><span class="math inline">\(I_{V3} = 0.0\)</span><br><span class="math inline">\(I_{O1b} = \frac{- 3.13650000000006 \cdot 10^{40} s^{4} - 9.46260000000018 \cdot 10^{43} s^{3} - 9.00250000000017 \cdot 10^{46} s^{2} - 2.75000000000005 \cdot 10^{49} s}{1.63098 \cdot 10^{45} s^{4} + 1.6982148 \cdot 10^{49} s^{3} + 3.87420704000001 \cdot 10^{52} s^{2} + 2.54543933333334 \cdot 10^{55} s + 1.70850000000001 \cdot 10^{57}}\)</span><br><span class="math inline">\(I_{O2a} = \frac{6.8 \cdot 10^{23} s^{2} + 1.2 \cdot 10^{27} s}{1.53 \cdot 10^{25} s^{3} + 1.4328 \cdot 10^{29} s^{2} + 2.13344 \cdot 10^{32} s + 1.53 \cdot 10^{34}}\)</span><br></p>
</div>
</div>
<p>The transfer function for the distortion path part A is calculated from the ratio of <span class="math inline">\(v_{8}\)</span> and <span class="math inline">\(v_{1}\)</span>.</p>
<p>The voltage transfer function is <span class="math inline">\(H(s)=\frac {v_8} {v_{1}}\)</span>:</p>
<div id="36b044ac-c97b-49bf-98a5-0402f6cfc356" class="cell" data-execution_count="284">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>H <span class="op">=</span> U[v8]<span class="op">/</span>U[v1]</span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>H</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="284">
<p><span class="math inline">\(\displaystyle \frac{1.0 \cdot \left(1.2721644 \cdot 10^{46} s^{5} + 7.45961435931766 \cdot 10^{50} s^{4} + 2.18693901867302 \cdot 10^{54} s^{3} + 2.07668666587681 \cdot 10^{57} s^{2} + 6.37322274881527 \cdot 10^{59} s\right)}{1.2721644 \cdot 10^{46} s^{5} + 2.09758384731754 \cdot 10^{50} s^{4} + 1.10702928656076 \cdot 10^{54} s^{3} + 2.03466134856873 \cdot 10^{57} s^{2} + 1.21969565229069 \cdot 10^{60} s + 8.09715639810431 \cdot 10^{61}}\)</span></p>
</div>
</div>
<div id="eb38ccf5-ef71-4c6e-b8f4-5bdad37b1f04" class="cell" data-jupyter="{&quot;outputs_hidden&quot;:false}" data-execution_count="285">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>num, denom <span class="op">=</span> fraction(H) <span class="co">#returns numerator and denominator</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a><span class="co"># convert symbolic to NumPy polynomial</span></span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> np.array(Poly(num, s).all_coeffs(), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> np.array(Poly(denom, s).all_coeffs(), dtype<span class="op">=</span><span class="bu">float</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The poles and zeros of the transfer function can easily be obtained with the following code:</p>
<div id="cf51fc52-6ea0-4a30-b2db-18ce2360eb5a" class="cell" data-execution_count="286">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>sys_tf <span class="op">=</span> signal.TransferFunction(a,b)</span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>sys_zeros <span class="op">=</span> np.roots(sys_tf.num)</span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a>sys_poles <span class="op">=</span> np.roots(sys_tf.den)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Pole zero plot The poles and zeros of the preamp transfer function are plotted.</p>
<div id="ff267251-95f1-4f11-8421-12b1080ac909" class="cell" data-execution_count="287">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>plt.plot(np.real(sys_zeros), np.imag(sys_zeros), <span class="st">'ob'</span>, markerfacecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>plt.plot(np.real(sys_poles), np.imag(sys_poles), <span class="st">'xr'</span>)</span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a>plt.legend([<span class="st">'Zeros'</span>, <span class="st">'Poles'</span>], loc<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Pole / Zero Plot'</span>)</span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'real part, </span><span class="ch">\u03C3</span><span class="st">'</span>)</span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'imaginary part, j</span><span class="ch">\u03C9</span><span class="st">'</span>)</span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb149-8"><a href="#cb149-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Klon Centaur part 1_files/figure-html/cell-129-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The plot above shows the location of poles and zeros of the transfer function plotted on the complex plane and the units are in radian frequency. The number of poles and zeros are equal. There is a zero at 0 Hz not canceled by a pole and the value of the last zero is greater than the value of the last pole. This suggests that the transfer function is a band pass filter.</p>
<p>Printing the values of the poles and zeros in Hz.</p>
<div id="7a75fa47-6bb1-4c7c-9899-63f3b24068b4" class="cell" data-execution_count="288">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'number of zeros: </span><span class="sc">{:d}</span><span class="st">'</span>.<span class="bu">format</span>(<span class="bu">len</span>(sys_zeros)))</span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(sys_zeros)):</span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'z</span><span class="sc">{:d}</span><span class="st">: </span><span class="sc">{:,.2f}</span><span class="st"> Hz'</span>.<span class="bu">format</span>(i,sys_zeros[i]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi)))</span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'number of poles: </span><span class="sc">{:d}</span><span class="st">'</span>.<span class="bu">format</span>(<span class="bu">len</span>(sys_poles)))</span>
<span id="cb150-6"><a href="#cb150-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(sys_poles)):</span>
<span id="cb150-7"><a href="#cb150-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'p</span><span class="sc">{:d}</span><span class="st">: </span><span class="sc">{:,.2f}</span><span class="st"> Hz'</span>.<span class="bu">format</span>(i,sys_poles[i]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>number of zeros: 5
z0: -8,848.65 Hz
z1: -234.05 Hz
z2: -132.98 Hz
z3: -116.71 Hz
z4: 0.00 Hz
number of poles: 5
p0: -1,198.55 Hz
p1: -967.04 Hz
p2: -279.87 Hz
p3: -166.72 Hz
p4: -12.02 Hz</code></pre>
</div>
</div>
</section>
<section id="step-response-5" class="level4" data-number="37.11.3.3">
<h4 data-number="37.11.3.3" class="anchored" data-anchor-id="step-response-5"><span class="header-section-number">37.11.3.3</span> Step response</h4>
<p>The step response of the is calculated using the SciPy function <code>lsim</code> and plotted below. A square wave with a frequency of 10 Hz and an amplitude of 0.1 volts peak to peak is used as the input to this path. An input amplitude of 0.1 Vpp is used to keep the signal levels in the path below the conduction threshold for the diodes. The input square wave has a positive 0.05 volt offset which allows us to examine the DC characteristics of the path. The frequency of the square wave was chosen to allow the time constant of the path to be plotted with sufficient resolution to be examined in the plot.</p>
<div id="83bdbd4c-9922-4792-a28e-bc9a37f0bb8e" class="cell" data-execution_count="289">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="fl">0.2</span>, <span class="dv">500</span>, endpoint<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>sqr_signal <span class="op">=</span> signal.square(<span class="dv">2</span><span class="op">*</span>np.pi<span class="op">*</span><span class="dv">10</span><span class="op">*</span>t, duty<span class="op">=</span><span class="fl">0.5</span>)<span class="op">/</span><span class="dv">20</span><span class="op">+</span><span class="dv">1</span><span class="op">/</span><span class="dv">20</span></span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a>t_step, y_step, x_step <span class="op">=</span> signal.lsim(sys_tf, U<span class="op">=</span>sqr_signal, T<span class="op">=</span>t)</span>
<span id="cb152-5"><a href="#cb152-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-6"><a href="#cb152-6" aria-hidden="true" tabindex="-1"></a>plt.plot(t_step<span class="op">*</span><span class="fl">1e3</span>, sqr_signal, <span class="st">'r'</span>, alpha<span class="op">=</span><span class="fl">0.75</span>, linewidth<span class="op">=</span><span class="dv">1</span>, label<span class="op">=</span><span class="st">'input'</span>)</span>
<span id="cb152-7"><a href="#cb152-7" aria-hidden="true" tabindex="-1"></a>plt.plot(t_step<span class="op">*</span><span class="fl">1e3</span>, y_step,<span class="st">'b'</span>, linewidth<span class="op">=</span><span class="fl">1.25</span>, label<span class="op">=</span><span class="st">'output'</span>)</span>
<span id="cb152-8"><a href="#cb152-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Step response'</span>)</span>
<span id="cb152-9"><a href="#cb152-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'volts'</span>)</span>
<span id="cb152-10"><a href="#cb152-10" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'time, msec'</span>)</span>
<span id="cb152-11"><a href="#cb152-11" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb152-12"><a href="#cb152-12" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">'best'</span>)</span>
<span id="cb152-13"><a href="#cb152-13" aria-hidden="true" tabindex="-1"></a><span class="co"># show plot</span></span>
<span id="cb152-14"><a href="#cb152-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Klon Centaur part 1_files/figure-html/cell-131-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The step response shows that the DC gain of the path is zero. There is relatively a large spike in the output at each square wave edge. Might indicate that fast transients on the input get propagated to the diodes. This could be explored in more detail during prototype testing.</p>
</section>
<section id="group-delay-5" class="level4" data-number="37.11.3.4">
<h4 data-number="37.11.3.4" class="anchored" data-anchor-id="group-delay-5"><span class="header-section-number">37.11.3.4</span> Group delay</h4>
<p>The group delay for this path is calculated and plotted below.</p>
<div id="06967f60-545f-4b36-aaae-22c02e23264e" class="cell" data-execution_count="290">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.logspace(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">2000</span>, endpoint<span class="op">=</span><span class="va">False</span>)<span class="op">*</span><span class="dv">2</span><span class="op">*</span>np.pi</span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>w, mag, phase <span class="op">=</span> signal.bode((a, b), w<span class="op">=</span>x) <span class="co"># returns: rad/s, mag in dB, phase in deg</span></span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'group delay'</span>)</span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a>plt.semilogx(w<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), <span class="op">-</span>np.gradient(phase<span class="op">*</span>np.pi<span class="op">/</span><span class="dv">180</span>)<span class="op">/</span>np.gradient(w)<span class="op">*</span><span class="dv">1000</span>,<span class="st">'-'</span>,label<span class="op">=</span><span class="st">'group delay'</span>)</span>
<span id="cb153-6"><a href="#cb153-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-7"><a href="#cb153-7" aria-hidden="true" tabindex="-1"></a><span class="co"># highlight the guitar audio band, 80 to 8kHz</span></span>
<span id="cb153-8"><a href="#cb153-8" aria-hidden="true" tabindex="-1"></a>plt.axvspan(<span class="dv">80</span>, <span class="fl">8e3</span>, color<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb153-9"><a href="#cb153-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-10"><a href="#cb153-10" aria-hidden="true" tabindex="-1"></a>plt.xlim((<span class="dv">10</span>,<span class="fl">100e3</span>))</span>
<span id="cb153-11"><a href="#cb153-11" aria-hidden="true" tabindex="-1"></a>plt.ylim((<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb153-12"><a href="#cb153-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-13"><a href="#cb153-13" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Group delay, msec'</span>)</span>
<span id="cb153-14"><a href="#cb153-14" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Frequency, Hz'</span>)</span>
<span id="cb153-15"><a href="#cb153-15" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.legend()</span></span>
<span id="cb153-16"><a href="#cb153-16" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb153-17"><a href="#cb153-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Klon Centaur part 1_files/figure-html/cell-132-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The plot above shows that for frequencies in the guitar audio band, the group delay variation is less than 2 ms and therefore below the threshold of audibility as described in <a href="#sec-Group_delay" class="quarto-xref"><span>Section 37.8.6</span></a>.</p>
</section>
</section>
<section id="sec-Distortion_path_part_B" class="level3" data-number="37.11.4">
<h3 data-number="37.11.4" class="anchored" data-anchor-id="sec-Distortion_path_part_B"><span class="header-section-number">37.11.4</span> Distortion path part B</h3>
<div id="fig-klon-centaur-schematic-high-res_w_diode_path2_highlight_sch" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-klon-centaur-schematic-high-res_w_diode_path2_highlight_sch-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="klon-centaur-schematic-high-res_w_diode_path2_highlight.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-klon-centaur-schematic-high-res_w_diode_path2_highlight_sch-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;37.21: Klon Centaur schematic with the distortion path part B highlighted.
</figcaption>
</figure>
</div>
<p>Distortion path part B is highlighted in <a href="#fig-klon-centaur-schematic-high-res_w_diode_path2_highlight_sch" class="quarto-xref">Figure&nbsp;<span>37.21</span></a>. This path contains the limiting diodes, D2 and D3, which are commented out of the net list since there is no diode model supported by the MNA code. C9 and C10 block the DC bias voltage from the output of U1B and the DC coming ultimately from U1A down the R5, P1A, R17 and R16 path. R13 limits the current to D2 and D3 when the signal is greater than the forward conduction voltage of the diodes and operates in the exponential part of the conduction curve. The clipping diodes when driven into conduction mode, generate additional harmonics that combine with the guitar signal, which is already rich in harmonics.</p>
<p>As described above the limiting diodes don’t affect the frequency response in a significant way, but they do control the maximum amplitude of the signal. This can be accounted for by setting V3 to 0.35 volts and looking at the response at node 2 with V1 and V2 set to zero.</p>
<p>The capacitor, C9, blocks DC at the output of U1A since this Op Amp is biased to +Vb (4.5Vdc). This keeps the D3 from being constantly forward biased, as well as allowing D2 to conduct during negative signal swings.</p>
<p>R13 serves to limit the current from U1B when either D2 or D3 is forward biased by the signal.</p>
<p>D2 and D3 are the Germanium diodes responsible for making the distortion desired by the guitar player. When the signal is nearly at or above the diode’s threshold, the diodes start to conduct current and this effectively limits the amplitude of the signal to about <span class="math inline">\(\pm 0.4\)</span> volts. The shape of the voltage to current curve, see <span class="quarto-unresolved-ref">?fig-diode_volts_current_plot</span>, determines the amplitude of each harmonic component generated.</p>
<p>C10 blocks the bias voltage that is on pin 2 of U2A. Pin 3 of U2A is connected to +Vb and because the Op Amp is operating with feed back provided by R20 || C13 the voltage difference between pins 2 and 3 on U2A is zero, therefore R16 is biased at +Vb. Without C10, D3 would be continually forward biased.</p>
<p>The reactive branch formed by C11 and R15 is connected to the distortion path part B and needs to be included in the circuit analysis. The components R16, R17, R18 and C12 form a PI network in this branch that is connected to the inverting terminal of U2A. It’s not obvious how these components are shaping the signal. The nodal analysis presented for this path includes these reactive paths. See <span class="quarto-unresolved-ref">?sec-sum_path2b</span> and <span class="quarto-unresolved-ref">?sec-sum_path3</span> for an analysis of these branches.</p>
<p>The components, C13||R20 and U2A, as described above, are part of an inverting low pass filter which sums the signals from the various paths.</p>
<section id="frequency-response-vs-p1" class="level4" data-number="37.11.4.1">
<h4 data-number="37.11.4.1" class="anchored" data-anchor-id="frequency-response-vs-p1"><span class="header-section-number">37.11.4.1</span> Frequency response vs P1</h4>
<p>The magnitude and phase response of the distortion path part B are plotted below for various setting on P1, the gain control potentiometer. The gain settings is shown as a percent of full scale rotation of the knob. The voltage sources, V1 and V2 shown in <a href="#fig-Klon-Centaur_sum_path_v1_sch" class="quarto-xref">Figure&nbsp;<span>37.14</span></a> are set to zero and V3 is set to one and the transfer function <span class="math inline">\(H(s)=\frac{v_2}{v_{20}}\)</span> is plotted for various gain settings of 1% to 99%.</p>
<p>As described above, the term V3 in the transfer function gets canceled since it appears in both the numerator and denominator. So for values of V3 less than about <span class="math inline">\(\pm 0.3\)</span> volts, the diodes are not conducting and they can be ignored.</p>
<p>The Python code below sets the values of V1 = V2 = 0 and V3 = 1 in the component dictionary.</p>
<div id="7c02169a-68cd-46f4-8cbf-ad7bc665ba4f" class="cell" data-execution_count="291">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>element_values[V1] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a>element_values[V2] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a>element_values[V3] <span class="op">=</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The following Python code calculates and plots the transfer function for each value of gain setting.</p>
<div id="cell-fig-distortion-path-part-b-freq-plot" class="cell" data-execution_count="292">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>fig, ax1 <span class="op">=</span> plt.subplots()</span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'magnitude, dB'</span>)</span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'frequency, Hz'</span>)</span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-5"><a href="#cb155-5" aria-hidden="true" tabindex="-1"></a><span class="co"># instantiate a second y-axes that shares the same x-axis</span></span>
<span id="cb155-6"><a href="#cb155-6" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> ax1.twinx()</span>
<span id="cb155-7"><a href="#cb155-7" aria-hidden="true" tabindex="-1"></a>color <span class="op">=</span> <span class="st">'k'</span></span>
<span id="cb155-8"><a href="#cb155-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-9"><a href="#cb155-9" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'phase, deg'</span>,color<span class="op">=</span>color)</span>
<span id="cb155-10"><a href="#cb155-10" aria-hidden="true" tabindex="-1"></a>ax2.tick_params(axis<span class="op">=</span><span class="st">'y'</span>, labelcolor<span class="op">=</span>color)</span>
<span id="cb155-11"><a href="#cb155-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-12"><a href="#cb155-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(gain_setting)):</span>
<span id="cb155-13"><a href="#cb155-13" aria-hidden="true" tabindex="-1"></a>    element_values[Rp1a1] <span class="op">=</span> p1_value <span class="op">-</span> gain_setting[i]<span class="op">*</span>p1_value</span>
<span id="cb155-14"><a href="#cb155-14" aria-hidden="true" tabindex="-1"></a>    element_values[Rp1b1] <span class="op">=</span> gain_setting[i]<span class="op">*</span>p1_value</span>
<span id="cb155-15"><a href="#cb155-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb155-16"><a href="#cb155-16" aria-hidden="true" tabindex="-1"></a>    element_values[Rp1a2] <span class="op">=</span> p1_value <span class="op">-</span> gain_setting[i]<span class="op">*</span>p1_value</span>
<span id="cb155-17"><a href="#cb155-17" aria-hidden="true" tabindex="-1"></a>    element_values[Rp1b2] <span class="op">=</span> gain_setting[i]<span class="op">*</span>p1_value</span>
<span id="cb155-18"><a href="#cb155-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb155-19"><a href="#cb155-19" aria-hidden="true" tabindex="-1"></a>    NE <span class="op">=</span> NE_sym.subs(element_values)</span>
<span id="cb155-20"><a href="#cb155-20" aria-hidden="true" tabindex="-1"></a>    U <span class="op">=</span> solve(NE,X)</span>
<span id="cb155-21"><a href="#cb155-21" aria-hidden="true" tabindex="-1"></a>    H <span class="op">=</span> U[v2]<span class="op">/</span>U[v20]</span>
<span id="cb155-22"><a href="#cb155-22" aria-hidden="true" tabindex="-1"></a>    num, denom <span class="op">=</span> fraction(H) <span class="co">#returns numerator and denominator</span></span>
<span id="cb155-23"><a href="#cb155-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-24"><a href="#cb155-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># convert symbolic to NumPy polynomial</span></span>
<span id="cb155-25"><a href="#cb155-25" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> np.array(Poly(num, s).all_coeffs(), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb155-26"><a href="#cb155-26" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> np.array(Poly(denom, s).all_coeffs(), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb155-27"><a href="#cb155-27" aria-hidden="true" tabindex="-1"></a>    sys <span class="op">=</span> (a, b)</span>
<span id="cb155-28"><a href="#cb155-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-29"><a href="#cb155-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># use the bode function to calculate the magnitude and phase response</span></span>
<span id="cb155-30"><a href="#cb155-30" aria-hidden="true" tabindex="-1"></a>    w, mag, phase <span class="op">=</span> signal.bode(sys, w<span class="op">=</span>x_axis) <span class="co"># returns: rad/s, mag in dB, phase in deg</span></span>
<span id="cb155-31"><a href="#cb155-31" aria-hidden="true" tabindex="-1"></a>    diode_pathB_mag[i] <span class="op">=</span> mag</span>
<span id="cb155-32"><a href="#cb155-32" aria-hidden="true" tabindex="-1"></a>    diode_pathB_w[i] <span class="op">=</span> w</span>
<span id="cb155-33"><a href="#cb155-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-34"><a href="#cb155-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># plot the results.  </span></span>
<span id="cb155-35"><a href="#cb155-35" aria-hidden="true" tabindex="-1"></a>    ax1.semilogx(w<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), mag,<span class="st">'-'</span>,color<span class="op">=</span>color_list[i],label<span class="op">=</span><span class="st">'magitude @ </span><span class="sc">{:.0f}% g</span><span class="st">ain'</span>.<span class="bu">format</span>(gain_setting[i]<span class="op">*</span><span class="dv">100</span>)) <span class="co"># magnitude plot</span></span>
<span id="cb155-36"><a href="#cb155-36" aria-hidden="true" tabindex="-1"></a>    ax2.semilogx(w<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), phase,<span class="st">':'</span>,color<span class="op">=</span>color_list[i],label<span class="op">=</span><span class="st">'phase @ </span><span class="sc">{:.0f}% g</span><span class="st">ain'</span>.<span class="bu">format</span>(gain_setting[i]<span class="op">*</span><span class="dv">100</span>)) <span class="co"># phase plot</span></span>
<span id="cb155-37"><a href="#cb155-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-38"><a href="#cb155-38" aria-hidden="true" tabindex="-1"></a><span class="co"># highlight the guitar audio band, 80 to 8kHz</span></span>
<span id="cb155-39"><a href="#cb155-39" aria-hidden="true" tabindex="-1"></a>plt.axvspan(<span class="dv">80</span>, <span class="fl">8e3</span>, color<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>) </span>
<span id="cb155-40"><a href="#cb155-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-41"><a href="#cb155-41" aria-hidden="true" tabindex="-1"></a><span class="co"># set plot limits for display</span></span>
<span id="cb155-42"><a href="#cb155-42" aria-hidden="true" tabindex="-1"></a>plt.xlim((<span class="dv">10</span>,<span class="fl">100e3</span>))</span>
<span id="cb155-43"><a href="#cb155-43" aria-hidden="true" tabindex="-1"></a>ax1.set_ylim((<span class="op">-</span><span class="dv">40</span>,<span class="dv">20</span>))</span>
<span id="cb155-44"><a href="#cb155-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-45"><a href="#cb155-45" aria-hidden="true" tabindex="-1"></a><span class="co"># position legends outside the graph</span></span>
<span id="cb155-46"><a href="#cb155-46" aria-hidden="true" tabindex="-1"></a>ax1.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.6</span>,<span class="dv">1</span>)) <span class="co"># magnitude legend position: relative (horizontal position, vertical position) </span></span>
<span id="cb155-47"><a href="#cb155-47" aria-hidden="true" tabindex="-1"></a>ax2.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.6</span>,<span class="fl">0.5</span>)) <span class="co"># phase legend position:</span></span>
<span id="cb155-48"><a href="#cb155-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-49"><a href="#cb155-49" aria-hidden="true" tabindex="-1"></a>ax1.grid()</span>
<span id="cb155-50"><a href="#cb155-50" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Magnitude and phase response for gains of 1% to 99%'</span>)</span>
<span id="cb155-51"><a href="#cb155-51" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-distortion-path-part-b-freq-plot" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-distortion-path-part-b-freq-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Klon Centaur part 1_files/figure-html/fig-distortion-path-part-b-freq-plot-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-distortion-path-part-b-freq-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;37.22: Distortion path part B magnitude and phase response.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Distortion path part B has a low pass filter characteristic. The some filter parameters at a gain setting of 50% are calculated below with the following code.</p>
<div id="9dd2e2e7-785e-4a59-8c4e-2b0e68704790" class="cell" data-execution_count="293">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">4</span> <span class="co"># index for 50%</span></span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'gain setting: </span><span class="sc">{:.0f}</span><span class="st">%'</span>.<span class="bu">format</span>(gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a>max_gain <span class="op">=</span> diode_pathB_mag[i].<span class="bu">max</span>()</span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a>max_gain_arg <span class="op">=</span> diode_pathB_mag[i].argmax()</span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a>max_gain_freq <span class="op">=</span> diode_pathB_w[i][max_gain_arg]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi)</span>
<span id="cb156-7"><a href="#cb156-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'max gain: </span><span class="sc">{:.1f}</span><span class="st"> dB at </span><span class="sc">{:.1f}</span><span class="st"> Hz'</span>.<span class="bu">format</span>(max_gain, max_gain_freq))</span>
<span id="cb156-8"><a href="#cb156-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-9"><a href="#cb156-9" aria-hidden="true" tabindex="-1"></a>gain_3dB_arg_offset <span class="op">=</span> np.where(diode_pathB_mag[i][max_gain_arg:] <span class="op">&lt;</span> max_gain <span class="op">-</span> <span class="dv">3</span>)[<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb156-10"><a href="#cb156-10" aria-hidden="true" tabindex="-1"></a>freq_3dB <span class="op">=</span> diode_pathB_w[i][max_gain_arg<span class="op">+</span>gain_3dB_arg_offset]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi)</span>
<span id="cb156-11"><a href="#cb156-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'-3dB frequency: </span><span class="sc">{:.1f}</span><span class="st"> Hz'</span>.<span class="bu">format</span>(freq_3dB))</span>
<span id="cb156-12"><a href="#cb156-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-13"><a href="#cb156-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'distortion path part B mag attenuation: </span><span class="sc">{:.1f}</span><span class="st"> dB per decade'</span>.<span class="bu">format</span>(diode_pathB_mag[i][<span class="dv">1500</span>] <span class="op">-</span> diode_pathB_mag[i][<span class="op">-</span><span class="dv">1</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>gain setting: 50%
max gain: 18.1 dB at 54.2 Hz
-3dB frequency: 555.7 Hz
distortion path part B mag attenuation: 19.7 dB per decade</code></pre>
</div>
</div>
<p>The distortion path part B has an attenuation slope of about -20 dB and a -3 dB frequency point of 555 Hz.</p>
</section>
<section id="numerical-solution-for-p1-at-50-3" class="level4" data-number="37.11.4.2">
<h4 data-number="37.11.4.2" class="anchored" data-anchor-id="numerical-solution-for-p1-at-50-3"><span class="header-section-number">37.11.4.2</span> Numerical solution for P1 at 50%</h4>
<p>The transfer function for this path is solved for the case where P1 is set at a 50% rotational position.</p>
<div id="2d16e530-2247-40b9-aa7c-fdaae8ec03cb" class="cell" data-execution_count="294">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>p1_setting <span class="op">=</span> <span class="dv">50</span><span class="op">/</span><span class="dv">100</span> <span class="co"># setting the gain pot to 50%</span></span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>element_values[Rp1a1] <span class="op">=</span> p1_value <span class="op">-</span> p1_setting<span class="op">*</span>p1_value</span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a>element_values[Rp1b1] <span class="op">=</span> p1_setting<span class="op">*</span>p1_value</span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a>element_values[Rp1a2] <span class="op">=</span> p1_value <span class="op">-</span> p1_setting<span class="op">*</span>p1_value</span>
<span id="cb158-7"><a href="#cb158-7" aria-hidden="true" tabindex="-1"></a>element_values[Rp1b2] <span class="op">=</span> p1_setting<span class="op">*</span>p1_value</span>
<span id="cb158-8"><a href="#cb158-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-9"><a href="#cb158-9" aria-hidden="true" tabindex="-1"></a>NE <span class="op">=</span> NE_sym.subs(element_values)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Display the network equations with component values.</p>
<div id="f189d961-9e55-4e98-8d7f-7781b1fde152" class="cell" data-execution_count="295">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>temp <span class="op">=</span> <span class="st">''</span></span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(shape(NE.lhs)[<span class="dv">0</span>]):</span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">+=</span> <span class="st">'$</span><span class="sc">{:s}</span><span class="st"> = </span><span class="sc">{:s}</span><span class="st">$&lt;br&gt;'</span>.<span class="bu">format</span>(latex(NE.rhs[i]),latex(NE.lhs[i]))</span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a>Markdown(temp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="295">
<p><span class="math inline">\(0 = I_{V1} + 1.0 \cdot 10^{-7} s v_{1} - 1.0 \cdot 10^{-7} s v_{3}\)</span><br><span class="math inline">\(0 = I_{O2a} + v_{12} \left(- 8.2 \cdot 10^{-10} s - 2.55102040816327 \cdot 10^{-6}\right) + v_{2} \cdot \left(8.2 \cdot 10^{-10} s + 2.55102040816327 \cdot 10^{-6}\right)\)</span><br><span class="math inline">\(0 = - 1.0 \cdot 10^{-7} s v_{1} - 0.000666666666666667 v_{13} + v_{3} \cdot \left(1.68 \cdot 10^{-7} s + 0.000766666666666667\right) + v_{4} \left(- 6.8 \cdot 10^{-8} s - 0.0001\right)\)</span><br><span class="math inline">\(0 = v_{3} \left(- 6.8 \cdot 10^{-8} s - 0.0001\right) + v_{4} \cdot \left(6.8 \cdot 10^{-8} s + 0.00012\right)\)</span><br><span class="math inline">\(0 = 0.00052 v_{5} - 0.0005 v_{6}\)</span><br><span class="math inline">\(0 = - 0.0005 v_{5} + v_{6} \cdot \left(8.2 \cdot 10^{-8} s + 0.000566666666666667\right) + v_{7} \left(- 8.2 \cdot 10^{-8} s - 6.66666666666667 \cdot 10^{-5}\right)\)</span><br><span class="math inline">\(0 = v_{6} \left(- 8.2 \cdot 10^{-8} s - 6.66666666666667 \cdot 10^{-5}\right) + v_{7} \cdot \left(8.239 \cdot 10^{-8} s + 6.90363349131122 \cdot 10^{-5}\right) + v_{8} \left(- 3.9 \cdot 10^{-10} s - 2.3696682464455 \cdot 10^{-6}\right)\)</span><br><span class="math inline">\(0 = I_{O1b} + v_{7} \left(- 3.9 \cdot 10^{-10} s - 2.3696682464455 \cdot 10^{-6}\right) + v_{8} \cdot \left(3.9 \cdot 10^{-10} s + 2.3696682464455 \cdot 10^{-6}\right)\)</span><br><span class="math inline">\(0 = - 1.0 \cdot 10^{-6} s v_{20} - 0.001 v_{10} + v_{9} \cdot \left(1.0 \cdot 10^{-6} s + 0.001\right)\)</span><br><span class="math inline">\(0 = - 1.0 \cdot 10^{-6} s v_{11} + v_{10} \cdot \left(1.0 \cdot 10^{-6} s + 0.001\right) - 0.001 v_{9}\)</span><br><span class="math inline">\(0 = - 1.0 \cdot 10^{-6} s v_{10} - 2.2 \cdot 10^{-9} s v_{17} + v_{11} \cdot \left(1.0022 \cdot 10^{-6} s + 2.12765957446809 \cdot 10^{-5}\right) - 2.12765957446809 \cdot 10^{-5} v_{12}\)</span><br><span class="math inline">\(0 = - 2.7 \cdot 10^{-8} s v_{18} - 2.12765957446809 \cdot 10^{-5} v_{11} + v_{12} \cdot \left(2.782 \cdot 10^{-8} s + 0.000127531319856548\right) - 6.66666666666667 \cdot 10^{-5} v_{13} - 3.7037037037037 \cdot 10^{-5} v_{16} + v_{2} \left(- 8.2 \cdot 10^{-10} s - 2.55102040816327 \cdot 10^{-6}\right)\)</span><br><span class="math inline">\(0 = - 6.66666666666667 \cdot 10^{-5} v_{12} + v_{13} \cdot \left(1.0 \cdot 10^{-6} s + 0.000733333333333333\right) - 0.000666666666666667 v_{3}\)</span><br><span class="math inline">\(0 = - 3.9 \cdot 10^{-7} s v_{15} + v_{14} \cdot \left(4.58 \cdot 10^{-7} s + 0.000882745098039216\right) - 2.0 \cdot 10^{-5} v_{16} + v_{19} \left(- 6.8 \cdot 10^{-8} s - 0.000196078431372549\right)\)</span><br><span class="math inline">\(0 = - 3.9 \cdot 10^{-7} s v_{14} + v_{15} \cdot \left(3.9 \cdot 10^{-7} s + 0.001\right)\)</span><br><span class="math inline">\(0 = - 3.7037037037037 \cdot 10^{-5} v_{12} - 2.0 \cdot 10^{-5} v_{14} + 0.000205824915824916 v_{16} - 4.54545454545455 \cdot 10^{-5} v_{17} - 8.33333333333333 \cdot 10^{-5} v_{18}\)</span><br><span class="math inline">\(0 = - 2.2 \cdot 10^{-9} s v_{11} - 4.54545454545455 \cdot 10^{-5} v_{16} + v_{17} \cdot \left(2.2 \cdot 10^{-9} s + 4.54545454545455 \cdot 10^{-5}\right)\)</span><br><span class="math inline">\(0 = - 2.7 \cdot 10^{-8} s v_{12} - 8.33333333333333 \cdot 10^{-5} v_{16} + v_{18} \cdot \left(2.7 \cdot 10^{-8} s + 8.33333333333333 \cdot 10^{-5}\right)\)</span><br><span class="math inline">\(0 = I_{V2} + v_{14} \left(- 6.8 \cdot 10^{-8} s - 0.000196078431372549\right) + v_{19} \cdot \left(6.8 \cdot 10^{-8} s + 0.000196078431372549\right)\)</span><br><span class="math inline">\(0 = I_{V3} + 1.0 \cdot 10^{-6} s v_{20} - 1.0 \cdot 10^{-6} s v_{9}\)</span><br><span class="math inline">\(0 = v_{1}\)</span><br><span class="math inline">\(0 = v_{19}\)</span><br><span class="math inline">\(1 = v_{20}\)</span><br><span class="math inline">\(0 = - v_{4} + v_{7}\)</span><br><span class="math inline">\(0 = v_{12}\)</span><br></p>
</div>
</div>
<p>Use the SymPy’s <code>solve</code> function to find the node voltages and unknown currents and display the results.</p>
<div id="f5659c81-bccf-4f8b-a434-a61e2966a6b3" class="cell" data-execution_count="296">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>U <span class="op">=</span> solve(NE,X)</span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a>temp <span class="op">=</span> <span class="st">''</span></span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> U.keys():</span>
<span id="cb160-5"><a href="#cb160-5" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">+=</span> <span class="st">'$</span><span class="sc">{:s}</span><span class="st"> = </span><span class="sc">{:s}</span><span class="st">$&lt;br&gt;'</span>.<span class="bu">format</span>(latex(i),latex(U[i]))</span>
<span id="cb160-6"><a href="#cb160-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-7"><a href="#cb160-7" aria-hidden="true" tabindex="-1"></a>Markdown(temp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="296">
<p><span class="math inline">\(v_{1} = 0.0\)</span><br><span class="math inline">\(v_{2} = \frac{- 4.8116638262633 \cdot 10^{63} s^{5} - 1.86402165198492 \cdot 10^{68} s^{4} - 1.44698956852654 \cdot 10^{72} s^{3} - 2.89838697892964 \cdot 10^{75} s^{2} - 1.68943764340843 \cdot 10^{78} s}{8.7114749288661 \cdot 10^{58} s^{6} + 4.42758037940265 \cdot 10^{63} s^{5} + 6.39426906142035 \cdot 10^{67} s^{4} + 2.72152037399421 \cdot 10^{71} s^{3} + 4.243557822183 \cdot 10^{74} s^{2} + 2.24888518595392 \cdot 10^{77} s + 8.61957981330834 \cdot 10^{78}}\)</span><br><span class="math inline">\(v_{3} = 0.0\)</span><br><span class="math inline">\(v_{4} = 0.0\)</span><br><span class="math inline">\(v_{5} = 0.0\)</span><br><span class="math inline">\(v_{6} = 0.0\)</span><br><span class="math inline">\(v_{7} = 0.0\)</span><br><span class="math inline">\(v_{8} = 0.0\)</span><br><span class="math inline">\(v_{9} = \frac{4.81802717154256 \cdot 10^{54} s^{5} + 2.29627373138023 \cdot 10^{59} s^{4} + 2.81149214573178 \cdot 10^{63} s^{3} + 6.20412190793865 \cdot 10^{66} s^{2} + 3.81322450115202 \cdot 10^{69} s + 7.66184872294075 \cdot 10^{70}}{4.81802717154256 \cdot 10^{54} s^{5} + 2.29885866434566 \cdot 10^{59} s^{4} + 2.82128259649683 \cdot 10^{63} s^{3} + 6.27481286137239 \cdot 10^{66} s^{2} + 3.94876161529248 \cdot 10^{69} s + 1.53236974458815 \cdot 10^{71}}\)</span><br><span class="math inline">\(v_{10} = \frac{4.559533875 \cdot 10^{54} s^{5} + 2.19836922372969 \cdot 10^{59} s^{4} + 2.74080119229803 \cdot 10^{63} s^{3} + 6.06858479379818 \cdot 10^{66} s^{2} + 3.73660601392261 \cdot 10^{69} s + 7.66184872294075 \cdot 10^{70}}{4.81802717154256 \cdot 10^{54} s^{5} + 2.29885866434566 \cdot 10^{59} s^{4} + 2.82128259649683 \cdot 10^{63} s^{3} + 6.27481286137239 \cdot 10^{66} s^{2} + 3.94876161529248 \cdot 10^{69} s + 1.53236974458815 \cdot 10^{71}}\)</span><br><span class="math inline">\(v_{11} = \frac{4.559533875 \cdot 10^{54} s^{5} + 2.19578429076426 \cdot 10^{59} s^{4} + 2.73101074153298 \cdot 10^{63} s^{3} + 5.99789384036444 \cdot 10^{66} s^{2} + 3.60106889978214 \cdot 10^{69} s}{4.81802717154256 \cdot 10^{54} s^{5} + 2.29885866434566 \cdot 10^{59} s^{4} + 2.82128259649683 \cdot 10^{63} s^{3} + 6.27481286137239 \cdot 10^{66} s^{2} + 3.94876161529248 \cdot 10^{69} s + 1.53236974458815 \cdot 10^{71}}\)</span><br><span class="math inline">\(v_{12} = 0.0\)</span><br><span class="math inline">\(v_{13} = 0.0\)</span><br><span class="math inline">\(v_{14} = \frac{2.9615625 \cdot 10^{56} s^{4} + 1.6734375 \cdot 10^{60} s^{3} + 2.34375 \cdot 10^{63} s^{2}}{4.81802717154256 \cdot 10^{54} s^{5} + 2.29885866434566 \cdot 10^{59} s^{4} + 2.82128259649683 \cdot 10^{63} s^{3} + 6.27481286137239 \cdot 10^{66} s^{2} + 3.94876161529248 \cdot 10^{69} s + 1.53236974458815 \cdot 10^{71}}\)</span><br><span class="math inline">\(v_{15} = \frac{2.9615625 \cdot 10^{56} s^{4} + 9.14062499999999 \cdot 10^{59} s^{3}}{4.81802717154256 \cdot 10^{54} s^{5} + 2.29885866434566 \cdot 10^{59} s^{4} + 2.82128259649683 \cdot 10^{63} s^{3} + 6.27481286137239 \cdot 10^{66} s^{2} + 3.94876161529248 \cdot 10^{69} s + 1.53236974458815 \cdot 10^{71}}\)</span><br><span class="math inline">\(v_{16} = \frac{1.00693125 \cdot 10^{54} s^{5} + 3.35690238970588 \cdot 10^{58} s^{4} + 1.275328125 \cdot 10^{62} s^{3} + 1.0344669117647 \cdot 10^{65} s^{2}}{4.81802717154256 \cdot 10^{54} s^{5} + 2.29885866434566 \cdot 10^{59} s^{4} + 2.82128259649683 \cdot 10^{63} s^{3} + 6.27481286137239 \cdot 10^{66} s^{2} + 3.94876161529248 \cdot 10^{69} s + 1.53236974458815 \cdot 10^{71}}\)</span><br><span class="math inline">\(v_{17} = \frac{4.559533875 \cdot 10^{54} s^{5} + 1.46177548394608 \cdot 10^{59} s^{4} + 4.04388334558824 \cdot 10^{62} s^{3} + 2.77738425925926 \cdot 10^{65} s^{2}}{4.81802717154256 \cdot 10^{54} s^{5} + 2.29885866434566 \cdot 10^{59} s^{4} + 2.82128259649683 \cdot 10^{63} s^{3} + 6.27481286137239 \cdot 10^{66} s^{2} + 3.94876161529248 \cdot 10^{69} s + 1.53236974458815 \cdot 10^{71}}\)</span><br><span class="math inline">\(v_{18} = \frac{3.1078125 \cdot 10^{57} s^{4} + 9.40160845588234 \cdot 10^{61} s^{3} + 1.0344669117647 \cdot 10^{65} s^{2}}{4.81802717154256 \cdot 10^{54} s^{5} + 2.29885866434566 \cdot 10^{59} s^{4} + 2.82128259649683 \cdot 10^{63} s^{3} + 6.27481286137239 \cdot 10^{66} s^{2} + 3.94876161529248 \cdot 10^{69} s + 1.53236974458815 \cdot 10^{71}}\)</span><br><span class="math inline">\(v_{19} = 0.0\)</span><br><span class="math inline">\(v_{20} = 1.0\)</span><br><span class="math inline">\(I_{V1} = 0.0\)</span><br><span class="math inline">\(I_{V2} = \frac{2.0138625 \cdot 10^{49} s^{5} + 1.71863602941176 \cdot 10^{53} s^{4} + 4.87499999999999 \cdot 10^{56} s^{3} + 4.59558823529411 \cdot 10^{59} s^{2}}{4.81802717154256 \cdot 10^{54} s^{5} + 2.29885866434566 \cdot 10^{59} s^{4} + 2.82128259649683 \cdot 10^{63} s^{3} + 6.27481286137239 \cdot 10^{66} s^{2} + 3.94876161529248 \cdot 10^{69} s + 1.53236974458815 \cdot 10^{71}}\)</span><br><span class="math inline">\(I_{V3} = \frac{- 2.58493296542554 \cdot 10^{53} s^{5} - 9.79045076505435 \cdot 10^{57} s^{4} - 7.06909534337431 \cdot 10^{61} s^{3} - 1.35537114140466 \cdot 10^{65} s^{2} - 7.66184872294075 \cdot 10^{67} s}{4.81802717154256 \cdot 10^{57} s^{5} + 2.29885866434566 \cdot 10^{62} s^{4} + 2.82128259649683 \cdot 10^{66} s^{3} + 6.27481286137239 \cdot 10^{69} s^{2} + 3.94876161529248 \cdot 10^{72} s + 1.53236974458815 \cdot 10^{74}}\)</span><br><span class="math inline">\(I_{O1b} = 0.0\)</span><br><span class="math inline">\(I_{O2a} = \frac{1.96394441888298 \cdot 10^{54} s^{5} + 7.60825164075479 \cdot 10^{58} s^{4} + 5.90607987153688 \cdot 10^{62} s^{3} + 1.18301509344067 \cdot 10^{66} s^{2} + 6.89566385064667 \cdot 10^{68} s}{4.3362244543883 \cdot 10^{58} s^{5} + 2.06897279791109 \cdot 10^{63} s^{4} + 2.53915433684715 \cdot 10^{67} s^{3} + 5.64733157523515 \cdot 10^{70} s^{2} + 3.55388545376323 \cdot 10^{73} s + 1.37913277012933 \cdot 10^{75}}\)</span><br></p>
</div>
</div>
<p>The transfer function for the distortion path part B is calculated from the ratio of <span class="math inline">\(v_{2}\)</span> and <span class="math inline">\(v_{20}\)</span>.<br>
The voltage transfer function is <span class="math inline">\(H(s)=\frac {v_2} {v_{20}}\)</span>:</p>
<div id="c264c86d-7e72-43f6-9e91-e410d879e576" class="cell" data-execution_count="297">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a>H <span class="op">=</span> U[v2]<span class="op">/</span>U[v20]</span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a>H</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="297">
<p><span class="math inline">\(\displaystyle \frac{1.0 \left(- 4.8116638262633 \cdot 10^{63} s^{5} - 1.86402165198492 \cdot 10^{68} s^{4} - 1.44698956852654 \cdot 10^{72} s^{3} - 2.89838697892964 \cdot 10^{75} s^{2} - 1.68943764340843 \cdot 10^{78} s\right)}{8.7114749288661 \cdot 10^{58} s^{6} + 4.42758037940265 \cdot 10^{63} s^{5} + 6.39426906142035 \cdot 10^{67} s^{4} + 2.72152037399421 \cdot 10^{71} s^{3} + 4.243557822183 \cdot 10^{74} s^{2} + 2.24888518595392 \cdot 10^{77} s + 8.61957981330834 \cdot 10^{78}}\)</span></p>
</div>
</div>
<p>The coefficients for the numerator and denominator polynomials extracted using the following code.</p>
<div id="5828c5ab-be6e-428b-8667-a5d2adf800da" class="cell" data-jupyter="{&quot;outputs_hidden&quot;:false}" data-execution_count="298">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a>num, denom <span class="op">=</span> fraction(H) <span class="co">#returns numerator and denominator</span></span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a><span class="co"># convert symbolic to numpy polynomial</span></span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> np.array(Poly(num, s).all_coeffs(), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb162-5"><a href="#cb162-5" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> np.array(Poly(denom, s).all_coeffs(), dtype<span class="op">=</span><span class="bu">float</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The poles and zeros of the transfer function can easily be obtained with the following code:</p>
<div id="128787db-8f36-4a95-bc60-156881dd459e" class="cell" data-execution_count="299">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a>sys_tf <span class="op">=</span> signal.TransferFunction(a,b)</span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a>sys_zeros <span class="op">=</span> np.roots(sys_tf.num)</span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a>sys_poles <span class="op">=</span> np.roots(sys_tf.den)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="pole-zero-plot-1" class="level4" data-number="37.11.4.3">
<h4 data-number="37.11.4.3" class="anchored" data-anchor-id="pole-zero-plot-1"><span class="header-section-number">37.11.4.3</span> Pole zero plot</h4>
<p>The poles and zeros of the voltage transfer function are plotted.</p>
<div id="7dc557a3-9a87-4b0c-967c-f61bee25fb7a" class="cell" data-execution_count="300">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a>plt.plot(np.real(sys_zeros), np.imag(sys_zeros), <span class="st">'ob'</span>, markerfacecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a>plt.plot(np.real(sys_poles), np.imag(sys_poles), <span class="st">'xr'</span>)</span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a>plt.legend([<span class="st">'Zeros'</span>, <span class="st">'Poles'</span>], loc<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Pole / Zero Plot'</span>)</span>
<span id="cb164-5"><a href="#cb164-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'real part, </span><span class="ch">\u03C3</span><span class="st">'</span>)</span>
<span id="cb164-6"><a href="#cb164-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'imaginary part, j</span><span class="ch">\u03C9</span><span class="st">'</span>)</span>
<span id="cb164-7"><a href="#cb164-7" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb164-8"><a href="#cb164-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Klon Centaur part 1_files/figure-html/cell-142-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The plot above and the calculations below show that there are five zeros and six poles in the transfer function. Many of the poles and zeros are nearly at the same frequency, so they cancel. There is a zero at 0 Hz, because the path has no direct DC path from input to output. The poles near 500 Hz and 2,500 Hz along with the zero near 1,000 Hz determine the low pass shape of the path’s frequency response.</p>
<p>Printing the pole and zero values in Hz.</p>
<div id="2ab04fd1-6441-4166-b298-35c0cff9eb6c" class="cell" data-execution_count="301">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'number of zeros: </span><span class="sc">{:d}</span><span class="st">'</span>.<span class="bu">format</span>(<span class="bu">len</span>(sys_zeros)))</span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(sys_zeros)):</span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'z</span><span class="sc">{:d}</span><span class="st">: </span><span class="sc">{:,.2f}</span><span class="st"> Hz'</span>.<span class="bu">format</span>(i,sys_zeros[i]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi)))</span>
<span id="cb165-4"><a href="#cb165-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-5"><a href="#cb165-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'number of poles: </span><span class="sc">{:d}</span><span class="st">'</span>.<span class="bu">format</span>(<span class="bu">len</span>(sys_poles)))</span>
<span id="cb165-6"><a href="#cb165-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(sys_poles)):</span>
<span id="cb165-7"><a href="#cb165-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'p</span><span class="sc">{:d}</span><span class="st">: </span><span class="sc">{:,.2f}</span><span class="st"> Hz'</span>.<span class="bu">format</span>(i,sys_poles[i]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>number of zeros: 5
z0: -4,631.99 Hz
z1: -1,110.36 Hz
z2: -243.00 Hz
z3: -180.26 Hz
z4: 0.00 Hz
number of poles: 6
p0: -4,629.79 Hz
p1: -2,545.69 Hz
p2: -495.13 Hz
p3: -231.62 Hz
p4: -180.17 Hz
p5: -6.60 Hz</code></pre>
</div>
</div>
</section>
<section id="step-response-6" class="level4" data-number="37.11.4.4">
<h4 data-number="37.11.4.4" class="anchored" data-anchor-id="step-response-6"><span class="header-section-number">37.11.4.4</span> Step response</h4>
<p>The step response of the is calculated using the SciPy function <code>lsim</code> and plotted below. A square wave with a frequency of 5 Hz and an amplitude of 0.1 volts peak to peak is used as the input to this path. An input nearly of 0.1 Vpp is used to keep the signal levels in the path below the conduction threshold for the diodes. The input square wave has a positive 0.05 volt offset which allows us to examine the DC characteristics of the path. The frequency of the square wave was chosen to allow the time constant of the path to be plotted with sufficient resolution to be examined in the plot.</p>
<div id="c64cced5-a024-4f50-8cbb-5f714631795f" class="cell" data-execution_count="302">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dv">500</span>, endpoint<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a>sqr_signal <span class="op">=</span> signal.square(<span class="dv">2</span><span class="op">*</span>np.pi<span class="op">*</span><span class="dv">5</span><span class="op">*</span>t, duty<span class="op">=</span><span class="fl">0.5</span>)<span class="op">/</span><span class="dv">20</span><span class="op">+</span><span class="dv">1</span><span class="op">/</span><span class="dv">20</span></span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a>t_step, y_step, x_step <span class="op">=</span> signal.lsim(sys_tf, U<span class="op">=</span>sqr_signal, T<span class="op">=</span>t)</span>
<span id="cb167-5"><a href="#cb167-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-6"><a href="#cb167-6" aria-hidden="true" tabindex="-1"></a>plt.plot(t_step, sqr_signal, <span class="st">'r'</span>, alpha<span class="op">=</span><span class="fl">0.75</span>, linewidth<span class="op">=</span><span class="dv">1</span>, label<span class="op">=</span><span class="st">'input'</span>)</span>
<span id="cb167-7"><a href="#cb167-7" aria-hidden="true" tabindex="-1"></a>plt.plot(t_step, y_step,<span class="st">'b'</span>, linewidth<span class="op">=</span><span class="fl">1.25</span>, label<span class="op">=</span><span class="st">'output'</span>)</span>
<span id="cb167-8"><a href="#cb167-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Step response'</span>)</span>
<span id="cb167-9"><a href="#cb167-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'volts'</span>)</span>
<span id="cb167-10"><a href="#cb167-10" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'time, sec'</span>)</span>
<span id="cb167-11"><a href="#cb167-11" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb167-12"><a href="#cb167-12" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">'best'</span>)</span>
<span id="cb167-13"><a href="#cb167-13" aria-hidden="true" tabindex="-1"></a><span class="co"># show plot</span></span>
<span id="cb167-14"><a href="#cb167-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Klon Centaur part 1_files/figure-html/cell-144-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The step response shows that the DC gain of the path is zero since after each step transition in the input signal, the output signal decays to zero. The time constant of the decay looks to be about 0.1 seconds.</p>
<p>There is a relatively large spike in the output at each square wave edge because there is a large amount of AC gain in the circuit provided by U2A. This could be explored in more detail during prototype testing. Signals in the pedal are getting filtered, so in part B of the path, edges from fast transients may have been removed.</p>
</section>
<section id="group-delay-6" class="level4" data-number="37.11.4.5">
<h4 data-number="37.11.4.5" class="anchored" data-anchor-id="group-delay-6"><span class="header-section-number">37.11.4.5</span> Group delay</h4>
<p>The group delay for this path is calculated and plotted below.</p>
<div id="aed14b44-d2f6-432e-b5a5-da85c27aa686" class="cell" data-execution_count="303">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.logspace(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">2000</span>, endpoint<span class="op">=</span><span class="va">False</span>)<span class="op">*</span><span class="dv">2</span><span class="op">*</span>np.pi</span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>w, mag, phase <span class="op">=</span> signal.bode((a, b), w<span class="op">=</span>x) <span class="co"># returns: rad/s, mag in dB, phase in deg</span></span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'group delay'</span>)</span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a>plt.semilogx(w<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), <span class="op">-</span>np.gradient(phase<span class="op">*</span>np.pi<span class="op">/</span><span class="dv">180</span>)<span class="op">/</span>np.gradient(w)<span class="op">*</span><span class="dv">1000</span>,<span class="st">'-'</span>,label<span class="op">=</span><span class="st">'group delay'</span>)</span>
<span id="cb168-6"><a href="#cb168-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-7"><a href="#cb168-7" aria-hidden="true" tabindex="-1"></a><span class="co"># highlight the guitar audio band, 80 to 8kHz</span></span>
<span id="cb168-8"><a href="#cb168-8" aria-hidden="true" tabindex="-1"></a>plt.axvspan(<span class="dv">80</span>, <span class="fl">8e3</span>, color<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb168-9"><a href="#cb168-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-10"><a href="#cb168-10" aria-hidden="true" tabindex="-1"></a>plt.xlim((<span class="dv">10</span>,<span class="fl">100e3</span>))</span>
<span id="cb168-11"><a href="#cb168-11" aria-hidden="true" tabindex="-1"></a>plt.ylim((<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb168-12"><a href="#cb168-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-13"><a href="#cb168-13" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Group delay, msec'</span>)</span>
<span id="cb168-14"><a href="#cb168-14" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Frequency, Hz'</span>)</span>
<span id="cb168-15"><a href="#cb168-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-16"><a href="#cb168-16" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb168-17"><a href="#cb168-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Klon Centaur part 1_files/figure-html/cell-145-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The plot above shows that for frequencies in the guitar audio band, the group delay variation is less than 2 ms and therefore below the threshold of audibility as described in <a href="#sec-Group_delay" class="quarto-xref"><span>Section 37.8.6</span></a>.</p>
</section>
</section>
</section>
<section id="overlay-amplitude-response-for-the-paths" class="level2" data-number="37.12">
<h2 data-number="37.12" class="anchored" data-anchor-id="overlay-amplitude-response-for-the-paths"><span class="header-section-number">37.12</span> Overlay amplitude response for the paths</h2>
<p>Frequency response plots for the paths are overlaid to examine their relative gains through the summing amplifier. The solid lines are for the clean paths 1, 2 and the cascade of distortion path parts A and B. Distortion path parta A and part B are plotted as a dash/dot line since the signal in this path is modified by the diodes before traveling to part B of the path.</p>
<p>The frequency response data is plotted from 10 to 100 kHz and the amplitude starting at a level of -40 dB. The frequency band of 80 to 8kHz is the typical audio band of an electric guitar and is plotted to highlight the band of interest. It is possible that sub harmonics of the guitar signal might be present below 80 Hz, and it is also possible that harmonics of the signal could extend to frequencies above 8kHz. The highlighted frequency band is not an absolute limit, but drawn only as a reference to indicate the general area to focus on for the analysis.</p>
<p>The black line in the plots below is the sum of the dashed green and red lines. Since distortion paths part A and part B are in series, the total amplitude response is obtained from the product of the two parts. These are plotted as logarithmic values, so the product is the sum of the logarithmic values. The distortion path and clean paths 1 and 2 are summed at Op Amp U2A.</p>
<p>When looking at the amplitude plots overlaid, you will need to imagine that signals on paths with greater gain will dominate over signals on paths that have less gain. If the gain levels on a path are greater than the other paths by about 2 dB, then signals on the lower gain paths will be less discernible in the output. In other words, when the guitar signal on each of the paths are summed together, the lower amplitude signals will be masked. <a href="https://en.wikipedia.org/wiki/Auditory_masking">Auditory masking</a> is dependent on relative amplitudes and frequency content. As discussed below, the signal on clean path 1 appears to be masked, but this would need to be verified by listening tests.</p>
<p>The required input level needed to drive the diodes in the distortion path into non-linear range varies with the gain setting. At lower gain settings, say from 0 to 10%, input levels above 0.05 volts peak are needed to drive the diodes in the distortion path into non-linear range and achieve a blend of clean and distortion. At a gain setting of 50%, an input level of 0.015 volts peak is needed to drive the diodes into non-linear range, while clean path 1 is more than 10 dB down from the distortion path and clean path 2 is attenuating the signal. Both clean paths are probably not discernible in the output.</p>
<p>What is heard at the output will depend on the signal level at the input. At a gain setting of 1%, that is with the gain control mostly counter clockwise, with input levels of less than 0.25 volts peak, the diodes will not be conducting to a degree where clipping of the signal will take place. This is explained below.</p>
<!--
$\large{\color {red} {\text{Update narrative}}}$  

If the input signal amplitude is below 300 mV, the diodes will not be conducting and there will be no distortion in the distortion path regardless of the setting of the gain pot, P1.

~~The plots below don't tell the whole story of what's happening in the signal path.~~ 

The frequency response plots are plotted for a gain setting of 1%, which is 1% rotational travel on the knob in the clockwise direction.  

https://en.wikipedia.org/wiki/Auditory_masking

https://en.wikipedia.org/wiki/Cocktail_party_effect


In the plots below we can see the relative amplitudes of the signal on each path.  


Clean path 1 is highlighted in @fig-klon-centaur-schematic-high-res_w_clean_path1_highlight_sch

Clean path 2 is highlighted in @fig-klon-centaur-schematic-high-res_w_clean_path2_highlight_sch

Distortion path part A is highlighted in @fig-klon-centaur-schematic-high-res_w_diode_path1_highlight_sch

Distortion path part B is highlighted in @fig-klon-centaur-schematic-high-res_w_diode_path2_highlight_sch
-->
<section id="gain-setting-of-1" class="level3" data-number="37.12.1">
<h3 data-number="37.12.1" class="anchored" data-anchor-id="gain-setting-of-1"><span class="header-section-number">37.12.1</span> Gain setting of 1%</h3>
<p>The frequency response plots are plotted for a gain setting of 1%, which is 1% rotational travel on the knob in the clockwise direction. As shown below, clean path 2 has the most gain across the guitar audio band.</p>
<div id="ee0d49e0-dc86-49c4-bc00-a0993c8661b9" class="cell" data-execution_count="304">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'magnitude, dB'</span>)</span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'frequency, Hz'</span>)</span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">0</span> <span class="co"># set the index for the gain setting of interest</span></span>
<span id="cb169-5"><a href="#cb169-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-6"><a href="#cb169-6" aria-hidden="true" tabindex="-1"></a>plt.semilogx(clean_path1_w[i]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), clean_path1_mag[i],<span class="st">'-b'</span>,label<span class="op">=</span><span class="st">'Clean path 1, P1 @ </span><span class="sc">{:.0f}</span><span class="st">%'</span>.<span class="bu">format</span>(gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb169-7"><a href="#cb169-7" aria-hidden="true" tabindex="-1"></a>plt.semilogx(clean_path2_w[i]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), clean_path2_mag[i],<span class="st">'-m'</span>,label<span class="op">=</span><span class="st">'Clean path 2, P1 @ </span><span class="sc">{:.0f}</span><span class="st">%'</span>.<span class="bu">format</span>(gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb169-8"><a href="#cb169-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-9"><a href="#cb169-9" aria-hidden="true" tabindex="-1"></a>plt.semilogx(diode_pathA_w[i]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), diode_pathA_mag[i],<span class="st">'-.r'</span>,label<span class="op">=</span><span class="st">'Distortion path part A, P1 @ </span><span class="sc">{:.0f}</span><span class="st">%'</span>.<span class="bu">format</span>(gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb169-10"><a href="#cb169-10" aria-hidden="true" tabindex="-1"></a>plt.semilogx(diode_pathB_w[i]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), diode_pathB_mag[i],<span class="st">'-.g'</span>,label<span class="op">=</span><span class="st">'Distortion path part B, P1 @ </span><span class="sc">{:.0f}</span><span class="st">%'</span>.<span class="bu">format</span>(gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb169-11"><a href="#cb169-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-12"><a href="#cb169-12" aria-hidden="true" tabindex="-1"></a><span class="co"># cascade of diode path part A and B</span></span>
<span id="cb169-13"><a href="#cb169-13" aria-hidden="true" tabindex="-1"></a>plt.semilogx(diode_pathB_w[i]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), diode_pathB_mag[i]<span class="op">+</span>diode_pathA_mag[i],<span class="st">'-k'</span>,label<span class="op">=</span><span class="st">'Cascade of A and B @ </span><span class="sc">{:.0f}</span><span class="st">%'</span>.<span class="bu">format</span>(gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb169-14"><a href="#cb169-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-15"><a href="#cb169-15" aria-hidden="true" tabindex="-1"></a>plt.tick_params(axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb169-16"><a href="#cb169-16" aria-hidden="true" tabindex="-1"></a>plt.xlim((<span class="dv">10</span>,<span class="fl">100e3</span>))</span>
<span id="cb169-17"><a href="#cb169-17" aria-hidden="true" tabindex="-1"></a>plt.ylim((<span class="op">-</span><span class="dv">40</span>,<span class="dv">20</span>))</span>
<span id="cb169-18"><a href="#cb169-18" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb169-19"><a href="#cb169-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-20"><a href="#cb169-20" aria-hidden="true" tabindex="-1"></a><span class="co"># highlight the guitar audio band, 80 to 8kHz</span></span>
<span id="cb169-21"><a href="#cb169-21" aria-hidden="true" tabindex="-1"></a>plt.axvspan(<span class="dv">80</span>, <span class="fl">8e3</span>, color<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb169-22"><a href="#cb169-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-23"><a href="#cb169-23" aria-hidden="true" tabindex="-1"></a>plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb169-24"><a href="#cb169-24" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Magnitude and phase response'</span>)</span>
<span id="cb169-25"><a href="#cb169-25" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Klon Centaur part 1_files/figure-html/cell-146-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Clean path 2 is the path with the most gain across the guitar audio spectrum. Overall effect is about 10 dB of clean gain from 80 to 1kHz and above 1kHz, the gain rolls off. Clean path 1 is not contributing much to the output. The gain for distortion path part A is negative for the band 80 to 1kHz and about 0 dB for higher frequencies. Signals on clean path 1 are probably not perceptible in the output since the gain in this path is more than 3 dB lower than clean path 2.</p>
<!--
Signals in this path probably lack sufficient amplitude to drive the diodes into conduction. At a gain setting of 1%, the signal on clean path 2 would dominate. Signals on clean path 1 will be greatly attenuated compared to the signals on other paths.

The gain of Clean path 1, shown in blue, has a low pass frequency response. Signal level through this path is probably below the threshold of perception.

The gain of Clean path 2, shown in purple, has a low pass frequency response with a slight rise around 500 Hz. With the gain pot set at 1%, the gain of this path is a bit more than 10 dB at 1kHz. 

The gain of the Distortion path part A, shown in dot/dash red, is attenuating the signal below 1kHz and adding no gain in the band 1 kHz to 8 kHz.  

The gain of the Distortion path part B, shown in black, has the most gain of any path, but the signal from the part A path has not been attenuated, so the output from this path, which is attenuated compared to clean path 2. 

The signal traveling clean path 2 is the signal which is predominate in the output. 
-->
<p>The 1N34A diodes in the distortion path will start to conduct sufficient current to produce harmonics at a voltage near the knee of the diode’s voltage current curve, see <span class="quarto-unresolved-ref">?fig-diode_volts_current_plot</span>. For the purposes of the calculations below, this point on the curve or knee is 0.25 volts. Typically, the forward voltage at a current of 5 mA is used to define the forward conduction voltage, but here we are interested in using the voltage where the diode starts to conduct current and generate harmonics.</p>
<div id="2f30c520-85f1-413c-bd84-cd4031331518" class="cell" data-execution_count="305">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a>Diode_knee_1N34A <span class="op">=</span> <span class="fl">0.25</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The calculation below finds the maximum gain points on the curves above. BY using the maximum points we can get an idea of the relative signal levels in the output from each path.</p>
<div id="be11dcfb-3071-4545-b65a-5a05300bc201" class="cell" data-execution_count="306">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'clean path 1 maximum gain </span><span class="sc">{:.1f}</span><span class="st"> dB at </span><span class="sc">{:.2f}</span><span class="st">%'</span>.<span class="bu">format</span>(clean_path1_mag[i].<span class="bu">max</span>(),gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'clean path 2 maximum gain </span><span class="sc">{:.1f}</span><span class="st"> dB at </span><span class="sc">{:.2f}</span><span class="st">%'</span>.<span class="bu">format</span>(clean_path2_mag[i].<span class="bu">max</span>(),gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb171-3"><a href="#cb171-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'cascade of A and B maximum gain </span><span class="sc">{:.1f}</span><span class="st"> dB at </span><span class="sc">{:.2f}</span><span class="st">%'</span>.<span class="bu">format</span>((diode_pathB_mag[i]<span class="op">+</span>diode_pathA_mag[i]).<span class="bu">max</span>(),gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb171-4"><a href="#cb171-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-5"><a href="#cb171-5" aria-hidden="true" tabindex="-1"></a>max_gain_dB <span class="op">=</span> diode_pathA_mag[i].<span class="bu">max</span>()</span>
<span id="cb171-6"><a href="#cb171-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'path A maximum gain </span><span class="sc">{:.1f}</span><span class="st"> dB at </span><span class="sc">{:.0f}</span><span class="st">%'</span>.<span class="bu">format</span>(max_gain_dB,gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb171-7"><a href="#cb171-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'peak signal for diode conduction threshold: </span><span class="sc">{:.3f}</span><span class="st"> Vp'</span>.<span class="bu">format</span>(Diode_knee_1N34A<span class="op">/</span>(<span class="dv">10</span><span class="op">**</span>(max_gain_dB<span class="op">/</span><span class="dv">10</span>))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>clean path 1 maximum gain 5.8 dB at 1.00%
clean path 2 maximum gain 12.0 dB at 1.00%
cascade of A and B maximum gain 7.5 dB at 1.00%
path A maximum gain 0.2 dB at 1%
peak signal for diode conduction threshold: 0.241 Vp</code></pre>
</div>
</div>
<p>With a gain setting of 1%, an input signal of greater than about 0.25 volts peak is needed to drive the diodes into conduction and to start producing harmonics. The gain of clean path 2 is substantially higher than that of clean path 1 and the signal on clean path 1 probably will not be discernible in the output. This assumption could be easily verified by conducting blind listening tests. A drive signal to the pedal of greater than 0.25 volts peak is needed to produce harmonics in output. Since the gain of the distortion path with P1 set to 1% is 4 dB lower than clean path 2, any harmonics would be difficult to discern.</p>
</section>
<section id="gain-setting-2.5" class="level3" data-number="37.12.2">
<h3 data-number="37.12.2" class="anchored" data-anchor-id="gain-setting-2.5"><span class="header-section-number">37.12.2</span> gain setting 2.5%</h3>
<p>The frequency response plots are plotted for a gain setting of 2.5%, which is 2.5% rotational travel on the knob in the clockwise direction. At this gain setting, it appears that the clean path 2 and the distortion path are able to provide contributions to the output since the gains at some frequencies are comparable.</p>
<div id="ffdd7d0f-782c-4b92-aa98-19328b3d467e" class="cell" data-execution_count="307">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'magnitude, dB'</span>)</span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'frequency, Hz'</span>)</span>
<span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-4"><a href="#cb173-4" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">1</span> <span class="co"># set the index for the gain setting of interest</span></span>
<span id="cb173-5"><a href="#cb173-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-6"><a href="#cb173-6" aria-hidden="true" tabindex="-1"></a>plt.semilogx(clean_path1_w[i]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), clean_path1_mag[i],<span class="st">'-b'</span>,label<span class="op">=</span><span class="st">'Clean path 1, P1 @ </span><span class="sc">{:.1f}</span><span class="st">%'</span>.<span class="bu">format</span>(gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb173-7"><a href="#cb173-7" aria-hidden="true" tabindex="-1"></a>plt.semilogx(clean_path2_w[i]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), clean_path2_mag[i],<span class="st">'-m'</span>,label<span class="op">=</span><span class="st">'Clean path 2, P1 @ </span><span class="sc">{:.1f}</span><span class="st">%'</span>.<span class="bu">format</span>(gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb173-8"><a href="#cb173-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-9"><a href="#cb173-9" aria-hidden="true" tabindex="-1"></a>plt.semilogx(diode_pathA_w[i]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), diode_pathA_mag[i],<span class="st">'-.r'</span>,label<span class="op">=</span><span class="st">'Distortion path A, P1 @ </span><span class="sc">{:.1f}</span><span class="st">%'</span>.<span class="bu">format</span>(gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb173-10"><a href="#cb173-10" aria-hidden="true" tabindex="-1"></a>plt.semilogx(diode_pathB_w[i]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), diode_pathB_mag[i],<span class="st">'-.g'</span>,label<span class="op">=</span><span class="st">'Distortion path B, P1 @ </span><span class="sc">{:.1f}</span><span class="st">%'</span>.<span class="bu">format</span>(gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb173-11"><a href="#cb173-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-12"><a href="#cb173-12" aria-hidden="true" tabindex="-1"></a><span class="co"># cascade of diode path part A and B</span></span>
<span id="cb173-13"><a href="#cb173-13" aria-hidden="true" tabindex="-1"></a>plt.semilogx(diode_pathB_w[i]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), diode_pathB_mag[i]<span class="op">+</span>diode_pathA_mag[i],<span class="st">'-k'</span>,label<span class="op">=</span><span class="st">'Cascade of A and B @ </span><span class="sc">{:.1f}</span><span class="st">%'</span>.<span class="bu">format</span>(gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb173-14"><a href="#cb173-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-15"><a href="#cb173-15" aria-hidden="true" tabindex="-1"></a>plt.tick_params(axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb173-16"><a href="#cb173-16" aria-hidden="true" tabindex="-1"></a>plt.xlim((<span class="dv">10</span>,<span class="fl">100e3</span>))</span>
<span id="cb173-17"><a href="#cb173-17" aria-hidden="true" tabindex="-1"></a>plt.ylim((<span class="op">-</span><span class="dv">40</span>,<span class="dv">20</span>))</span>
<span id="cb173-18"><a href="#cb173-18" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb173-19"><a href="#cb173-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-20"><a href="#cb173-20" aria-hidden="true" tabindex="-1"></a><span class="co"># highlight the guitar audio band, 80 to 8kHz</span></span>
<span id="cb173-21"><a href="#cb173-21" aria-hidden="true" tabindex="-1"></a>plt.axvspan(<span class="dv">80</span>, <span class="fl">8e3</span>, color<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb173-22"><a href="#cb173-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-23"><a href="#cb173-23" aria-hidden="true" tabindex="-1"></a>plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb173-24"><a href="#cb173-24" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Magnitude and phase response'</span>)</span>
<span id="cb173-25"><a href="#cb173-25" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Klon Centaur part 1_files/figure-html/cell-149-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>As shown in the plots above, the gain for clean path 1 is substantially less than clean path 2. The calculations below show that the difference in gain is about 4 dB. At any drive level, the amplitude of the signal on clean path 2 will be more than twice that of clean path 1. The signal on clean path 1 probably will not be discernable in the output.</p>
<div id="a3e4bacf-3d4b-43c2-865c-2fe4d96a817a" class="cell" data-execution_count="308">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'clean path 1 maximum gain </span><span class="sc">{:.1f}</span><span class="st"> dB at </span><span class="sc">{:.2f}</span><span class="st">%'</span>.<span class="bu">format</span>(clean_path1_mag[i].<span class="bu">max</span>(),gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'clean path 2 maximum gain </span><span class="sc">{:.1f}</span><span class="st"> dB at </span><span class="sc">{:.2f}</span><span class="st">%'</span>.<span class="bu">format</span>(clean_path2_mag[i].<span class="bu">max</span>(),gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'cascade of A and B maximum gain </span><span class="sc">{:.1f}</span><span class="st"> dB at </span><span class="sc">{:.2f}</span><span class="st">%'</span>.<span class="bu">format</span>((diode_pathB_mag[i]<span class="op">+</span>diode_pathA_mag[i]).<span class="bu">max</span>(),gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-5"><a href="#cb174-5" aria-hidden="true" tabindex="-1"></a>max_gain_dB <span class="op">=</span> diode_pathA_mag[i].<span class="bu">max</span>()</span>
<span id="cb174-6"><a href="#cb174-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'path A maximum gain </span><span class="sc">{:.1f}</span><span class="st"> dB at </span><span class="sc">{:.2f}</span><span class="st">%'</span>.<span class="bu">format</span>(max_gain_dB,gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb174-7"><a href="#cb174-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'peak signal for diode conduction threshold: </span><span class="sc">{:.3f}</span><span class="st"> Vp'</span>.<span class="bu">format</span>(Diode_knee_1N34A<span class="op">/</span>(<span class="dv">10</span><span class="op">**</span>(max_gain_dB<span class="op">/</span><span class="dv">10</span>))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>clean path 1 maximum gain 6.0 dB at 2.50%
clean path 2 maximum gain 10.8 dB at 2.50%
cascade of A and B maximum gain 13.5 dB at 2.50%
path A maximum gain 3.8 dB at 2.50%
peak signal for diode conduction threshold: 0.105 Vp</code></pre>
</div>
</div>
<p>An input signal of greater than about 0.1 volts peak is needed to drive the diodes into conduction and produce harmonics. Distortion path part A is starting to provide some boost to the signals as shown by the red dot/dash curve. Signals following the diodes are then filtered by the profile shown by the green dot/dash curve, which is the distortion path part B. Near 1 kHz, you can see that the cascade of the distortion path parts A and B are providing a bit of a boost over that of clean path 2. Diode path B has the most gain up to about 1kHz then clean path 2 has more. Diode path A is boosting the signal in the band 600 Hz and higher into the diodes so this signal should dominate from 300 Hz to about 3 kHz.</p>
<p>Signals on clean path 1 will be overshadowed compared to the signals on other paths over most of the guitar audio band. The signal through Clean path 1 is probably below the perception threshold.</p>
<p>The gain profiles through paths 2 and the distortion path at a gain setting of 2.5% illustrate the need for a preamp pedal prior to the Klon to control the signal level to the Klon. Normal guitar playing might be too soft to achieve the desired mix of clean and distortion through the Klon.</p>
</section>
<section id="gain-setting-9.75" class="level3" data-number="37.12.3">
<h3 data-number="37.12.3" class="anchored" data-anchor-id="gain-setting-9.75"><span class="header-section-number">37.12.3</span> gain setting 9.75%</h3>
<p>The frequency response plots are plotted for a gain setting of 9.75%, which is almost 10% rotational travel on the knob in the clockwise direction. At this gain setting, it appears that the clean paths and distortion path are able to provide contributions to the output since the gains at around 80 Hz are about the same.</p>
<div id="5b4412dc-3866-4958-ad2a-a4db6aa77668" class="cell" data-execution_count="309">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'magnitude, dB'</span>)</span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'frequency, Hz'</span>)</span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">2</span> <span class="co"># set the index for the gain setting of interest</span></span>
<span id="cb176-5"><a href="#cb176-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-6"><a href="#cb176-6" aria-hidden="true" tabindex="-1"></a>plt.semilogx(clean_path1_w[i]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), clean_path1_mag[i],<span class="st">'-b'</span>,label<span class="op">=</span><span class="st">'Clean path 1, P1 @ </span><span class="sc">{:.2f}</span><span class="st">%'</span>.<span class="bu">format</span>(gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb176-7"><a href="#cb176-7" aria-hidden="true" tabindex="-1"></a>plt.semilogx(clean_path2_w[i]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), clean_path2_mag[i],<span class="st">'-m'</span>,label<span class="op">=</span><span class="st">'Clean path 2, P1 @ </span><span class="sc">{:.2f}</span><span class="st">%'</span>.<span class="bu">format</span>(gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb176-8"><a href="#cb176-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-9"><a href="#cb176-9" aria-hidden="true" tabindex="-1"></a>plt.semilogx(diode_pathA_w[i]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), diode_pathA_mag[i],<span class="st">'-.r'</span>,label<span class="op">=</span><span class="st">'Distortion path A, P1 @ </span><span class="sc">{:.2f}</span><span class="st">%'</span>.<span class="bu">format</span>(gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb176-10"><a href="#cb176-10" aria-hidden="true" tabindex="-1"></a>plt.semilogx(diode_pathB_w[i]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), diode_pathB_mag[i],<span class="st">'-.g'</span>,label<span class="op">=</span><span class="st">'Distortion path B, P1 @ </span><span class="sc">{:.2f}</span><span class="st">%'</span>.<span class="bu">format</span>(gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb176-11"><a href="#cb176-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-12"><a href="#cb176-12" aria-hidden="true" tabindex="-1"></a><span class="co"># cascade of diode path part A and B</span></span>
<span id="cb176-13"><a href="#cb176-13" aria-hidden="true" tabindex="-1"></a>plt.semilogx(diode_pathB_w[i]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), diode_pathB_mag[i]<span class="op">+</span>diode_pathA_mag[i],<span class="st">'-k'</span>,label<span class="op">=</span><span class="st">'Cascade of A and B @ </span><span class="sc">{:.2f}</span><span class="st">%'</span>.<span class="bu">format</span>(gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb176-14"><a href="#cb176-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-15"><a href="#cb176-15" aria-hidden="true" tabindex="-1"></a>plt.tick_params(axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb176-16"><a href="#cb176-16" aria-hidden="true" tabindex="-1"></a>plt.xlim((<span class="dv">10</span>,<span class="fl">100e3</span>))</span>
<span id="cb176-17"><a href="#cb176-17" aria-hidden="true" tabindex="-1"></a>plt.ylim((<span class="op">-</span><span class="dv">40</span>,<span class="dv">20</span>))</span>
<span id="cb176-18"><a href="#cb176-18" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb176-19"><a href="#cb176-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-20"><a href="#cb176-20" aria-hidden="true" tabindex="-1"></a><span class="co"># highlight the guitar audio band, 80 to 8kHz</span></span>
<span id="cb176-21"><a href="#cb176-21" aria-hidden="true" tabindex="-1"></a>plt.axvspan(<span class="dv">80</span>, <span class="fl">8e3</span>, color<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb176-22"><a href="#cb176-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-23"><a href="#cb176-23" aria-hidden="true" tabindex="-1"></a>plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb176-24"><a href="#cb176-24" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Magnitude and phase response'</span>)</span>
<span id="cb176-25"><a href="#cb176-25" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Klon Centaur part 1_files/figure-html/cell-151-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>At the low end of the guitar audio range, about 80 Hz, the gains on the clean paths and the distortion path are the same. Over the remainder of the guitar audio band, the distortion path dominates. The plot above suggests that at a gain setting of 9% or more, signals through the distorting path will dominate in the output. If the guitar signal has sufficient amplitude to drive the diodes into clipping, then you will hear distortion in the output. If the guitar signal is very low, you will hear the guitar signal filtered by essentially a band pass filter with a center frequency of 1 kHz. The plot above suggests that at a gain setting of 9% or more, signals through the distorting path will dominate in the output.</p>
<div id="5a185484-719c-4cd4-a78e-59e55d7baf8b" class="cell" data-execution_count="310">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'clean path 1 maximum gain </span><span class="sc">{:.1f}</span><span class="st"> dB at </span><span class="sc">{:.2f}</span><span class="st">%'</span>.<span class="bu">format</span>(clean_path1_mag[i].<span class="bu">max</span>(),gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'clean path 2 maximum gain </span><span class="sc">{:.1f}</span><span class="st"> dB at </span><span class="sc">{:.2f}</span><span class="st">%'</span>.<span class="bu">format</span>(clean_path2_mag[i].<span class="bu">max</span>(),gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb177-3"><a href="#cb177-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'cascade of A and B maximum gain </span><span class="sc">{:.1f}</span><span class="st"> dB at </span><span class="sc">{:.2f}</span><span class="st">%'</span>.<span class="bu">format</span>((diode_pathB_mag[i]<span class="op">+</span>diode_pathA_mag[i]).<span class="bu">max</span>(),gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb177-4"><a href="#cb177-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-5"><a href="#cb177-5" aria-hidden="true" tabindex="-1"></a>max_gain_dB <span class="op">=</span> diode_pathA_mag[i].<span class="bu">max</span>()</span>
<span id="cb177-6"><a href="#cb177-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'path A maximum gain </span><span class="sc">{:.1f}</span><span class="st"> dB at </span><span class="sc">{:.2f}</span><span class="st">%'</span>.<span class="bu">format</span>(max_gain_dB,gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb177-7"><a href="#cb177-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'peak signal for diode conduction threshold: </span><span class="sc">{:.3f}</span><span class="st"> Vp'</span>.<span class="bu">format</span>(Diode_knee_1N34A<span class="op">/</span>(<span class="dv">10</span><span class="op">**</span>(max_gain_dB<span class="op">/</span><span class="dv">10</span>))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>clean path 1 maximum gain 6.5 dB at 9.75%
clean path 2 maximum gain 7.2 dB at 9.75%
cascade of A and B maximum gain 19.2 dB at 9.75%
path A maximum gain 7.2 dB at 9.75%
peak signal for diode conduction threshold: 0.048 Vp</code></pre>
</div>
</div>
<p>An input signal of greater than about 0.05 volts peak is needed to drive the diodes into conduction.</p>
<!--
input signal needs to be greater than about 0.05 volts peak to drive the diodes into conduction.

Distortion path part A is starting to provide some boost to the signals as shown by the red dot/dash curve. Signals following this path are then filtered by the profile shown by the black curve, which is the distortion path B. Near 100 Hz, the gains of all paths are somewhat similar and it is possible that within the band from 80 to 200 Hz, each path contributes a noticeable amount to the output. However, above 200 Hz, it appears that clean path 1 provides too much attenuation to have a noticeable contribution to the output.   


Diode path B has the most gain up to about 3kHz then clean path 2 has more. Diode path A is boosting the signal in the band 200 Hz and higher into the diodes so this signal should dominate from 80 Hz to about 3 kHz. 

Signals on clean path 1 will be greatly attenuated compared to the signals on other paths over most of the guitar audio band.
 
What is the steepness of the attenuation? 

The signal through Clean path 1 is probably below the perception threshold.

The gain of Clean path 2 looks comparable to the gain through Distortion path part A and Distortion path part B. At a setting gain setting of approximately 7%, the signals through Clean path 2 and Distortion path part A and Distortion path part B are of similar amplitude and sound from both both the clean and distorted paths would be perceptible in the output. The amount of distortion would depend on if the amplitude of the input signal was sufficient to cause the diodes to conduct. 
-->
</section>
<section id="gain-setting-25" class="level3" data-number="37.12.4">
<h3 data-number="37.12.4" class="anchored" data-anchor-id="gain-setting-25"><span class="header-section-number">37.12.4</span> gain setting 25%</h3>
<p>The frequency response plots are plotted for a gain setting of 25%, which is 25% rotational travel on the knob in the clockwise direction. At this gain setting, it appears that the distortion path will dominate the output.</p>
<div id="662d8fab-8cee-4fbe-9ca6-ad1c2bcdda7b" class="cell" data-execution_count="311">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'magnitude, dB'</span>)</span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'frequency, Hz'</span>)</span>
<span id="cb179-3"><a href="#cb179-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-4"><a href="#cb179-4" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">3</span> <span class="co"># set the index for the gain setting of interest</span></span>
<span id="cb179-5"><a href="#cb179-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-6"><a href="#cb179-6" aria-hidden="true" tabindex="-1"></a>plt.semilogx(clean_path1_w[i]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), clean_path1_mag[i],<span class="st">'-b'</span>,label<span class="op">=</span><span class="st">'Clean path 1, P1 @ </span><span class="sc">{:.0f}</span><span class="st">%'</span>.<span class="bu">format</span>(gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb179-7"><a href="#cb179-7" aria-hidden="true" tabindex="-1"></a>plt.semilogx(clean_path2_w[i]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), clean_path2_mag[i],<span class="st">'-m'</span>,label<span class="op">=</span><span class="st">'Clean path 2, P1 @ </span><span class="sc">{:.0f}</span><span class="st">%'</span>.<span class="bu">format</span>(gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb179-8"><a href="#cb179-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-9"><a href="#cb179-9" aria-hidden="true" tabindex="-1"></a>plt.semilogx(diode_pathA_w[i]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), diode_pathA_mag[i],<span class="st">'-.r'</span>,label<span class="op">=</span><span class="st">'Distortion path A, P1 @ </span><span class="sc">{:.0f}</span><span class="st">%'</span>.<span class="bu">format</span>(gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb179-10"><a href="#cb179-10" aria-hidden="true" tabindex="-1"></a>plt.semilogx(diode_pathB_w[i]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), diode_pathB_mag[i],<span class="st">'-.g'</span>,label<span class="op">=</span><span class="st">'Distortion path B, P1 @ </span><span class="sc">{:.0f}</span><span class="st">%'</span>.<span class="bu">format</span>(gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb179-11"><a href="#cb179-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-12"><a href="#cb179-12" aria-hidden="true" tabindex="-1"></a><span class="co"># cascade of diode path part A and B</span></span>
<span id="cb179-13"><a href="#cb179-13" aria-hidden="true" tabindex="-1"></a>plt.semilogx(diode_pathB_w[i]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), diode_pathB_mag[i]<span class="op">+</span>diode_pathA_mag[i],<span class="st">'-k'</span>,label<span class="op">=</span><span class="st">'Cascade of A and B @ </span><span class="sc">{:.0f}</span><span class="st">%'</span>.<span class="bu">format</span>(gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb179-14"><a href="#cb179-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-15"><a href="#cb179-15" aria-hidden="true" tabindex="-1"></a>plt.tick_params(axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb179-16"><a href="#cb179-16" aria-hidden="true" tabindex="-1"></a>plt.xlim((<span class="dv">10</span>,<span class="fl">100e3</span>))</span>
<span id="cb179-17"><a href="#cb179-17" aria-hidden="true" tabindex="-1"></a>plt.ylim((<span class="op">-</span><span class="dv">40</span>,<span class="dv">30</span>))</span>
<span id="cb179-18"><a href="#cb179-18" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb179-19"><a href="#cb179-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-20"><a href="#cb179-20" aria-hidden="true" tabindex="-1"></a><span class="co"># highlight the guitar audio band, 80 to 8kHz</span></span>
<span id="cb179-21"><a href="#cb179-21" aria-hidden="true" tabindex="-1"></a>plt.axvspan(<span class="dv">80</span>, <span class="fl">8e3</span>, color<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb179-22"><a href="#cb179-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-23"><a href="#cb179-23" aria-hidden="true" tabindex="-1"></a>plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb179-24"><a href="#cb179-24" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Magnitude and phase response'</span>)</span>
<span id="cb179-25"><a href="#cb179-25" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Klon Centaur part 1_files/figure-html/cell-153-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The gains on the clean paths are not high enough to compete with the gain of the distortion path at a gain setting of 25%.</p>
<div id="f77c7e05-b36b-4df0-9861-ffbf599f780d" class="cell" data-execution_count="312">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'clean path 1 maximum gain </span><span class="sc">{:.1f}</span><span class="st"> dB at </span><span class="sc">{:.2f}</span><span class="st">%'</span>.<span class="bu">format</span>(clean_path1_mag[i].<span class="bu">max</span>(),gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'clean path 2 maximum gain </span><span class="sc">{:.1f}</span><span class="st"> dB at </span><span class="sc">{:.2f}</span><span class="st">%'</span>.<span class="bu">format</span>(clean_path2_mag[i].<span class="bu">max</span>(),gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'cascade of A and B maximum gain </span><span class="sc">{:.1f}</span><span class="st"> dB at </span><span class="sc">{:.2f}</span><span class="st">%'</span>.<span class="bu">format</span>((diode_pathB_mag[i]<span class="op">+</span>diode_pathA_mag[i]).<span class="bu">max</span>(),gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-5"><a href="#cb180-5" aria-hidden="true" tabindex="-1"></a>max_gain_dB <span class="op">=</span> diode_pathA_mag[i].<span class="bu">max</span>()</span>
<span id="cb180-6"><a href="#cb180-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'path A maximum gain </span><span class="sc">{:.1f}</span><span class="st"> dB at </span><span class="sc">{:.0f}</span><span class="st">%'</span>.<span class="bu">format</span>(max_gain_dB,gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb180-7"><a href="#cb180-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'peak signal for diode conduction threshold: </span><span class="sc">{:.3f}</span><span class="st"> Vp'</span>.<span class="bu">format</span>(Diode_knee_1N34A<span class="op">/</span>(<span class="dv">10</span><span class="op">**</span>(max_gain_dB<span class="op">/</span><span class="dv">10</span>))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>clean path 1 maximum gain 6.9 dB at 25.00%
clean path 2 maximum gain 3.1 dB at 25.00%
cascade of A and B maximum gain 22.1 dB at 25.00%
path A maximum gain 9.1 dB at 25%
peak signal for diode conduction threshold: 0.031 Vp</code></pre>
</div>
</div>
<p>An input signal of greater than about 0.03 volts peak is needed to drive the diodes into conduction.</p>
</section>
<section id="gain-setting-50" class="level3" data-number="37.12.5">
<h3 data-number="37.12.5" class="anchored" data-anchor-id="gain-setting-50"><span class="header-section-number">37.12.5</span> gain setting 50%</h3>
<p>The frequency response plots are plotted for a gain setting of 50%. At this gain setting, it appears that the distortion path will dominate the output.</p>
<div id="b1e6f816-9356-40b8-9718-11f39c240656" class="cell" data-execution_count="313">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'magnitude, dB'</span>)</span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'frequency, Hz'</span>)</span>
<span id="cb182-3"><a href="#cb182-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-4"><a href="#cb182-4" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">4</span> <span class="co"># set the index for the gain setting of interest</span></span>
<span id="cb182-5"><a href="#cb182-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-6"><a href="#cb182-6" aria-hidden="true" tabindex="-1"></a>plt.semilogx(clean_path1_w[i]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), clean_path1_mag[i],<span class="st">'-b'</span>,label<span class="op">=</span><span class="st">'Clean path 1, P1 @ </span><span class="sc">{:.0f}</span><span class="st">%'</span>.<span class="bu">format</span>(gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb182-7"><a href="#cb182-7" aria-hidden="true" tabindex="-1"></a>plt.semilogx(clean_path2_w[i]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), clean_path2_mag[i],<span class="st">'-m'</span>,label<span class="op">=</span><span class="st">'Clean path 2,P1 @ </span><span class="sc">{:.0f}</span><span class="st">%'</span>.<span class="bu">format</span>(gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb182-8"><a href="#cb182-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-9"><a href="#cb182-9" aria-hidden="true" tabindex="-1"></a>plt.semilogx(diode_pathA_w[i]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), diode_pathA_mag[i],<span class="st">'-.r'</span>,label<span class="op">=</span><span class="st">'Distortion path A, P1 @ </span><span class="sc">{:.0f}</span><span class="st">%'</span>.<span class="bu">format</span>(gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb182-10"><a href="#cb182-10" aria-hidden="true" tabindex="-1"></a>plt.semilogx(diode_pathB_w[i]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), diode_pathB_mag[i],<span class="st">'-.g'</span>,label<span class="op">=</span><span class="st">'Distortion path B, P1 @ </span><span class="sc">{:.0f}</span><span class="st">%'</span>.<span class="bu">format</span>(gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb182-11"><a href="#cb182-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-12"><a href="#cb182-12" aria-hidden="true" tabindex="-1"></a><span class="co"># cascade of diode path part A and B</span></span>
<span id="cb182-13"><a href="#cb182-13" aria-hidden="true" tabindex="-1"></a>plt.semilogx(diode_pathB_w[i]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), diode_pathB_mag[i]<span class="op">+</span>diode_pathA_mag[i],<span class="st">'-k'</span>,label<span class="op">=</span><span class="st">'Cascade of A and B @ </span><span class="sc">{:.0f}</span><span class="st">%'</span>.<span class="bu">format</span>(gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb182-14"><a href="#cb182-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-15"><a href="#cb182-15" aria-hidden="true" tabindex="-1"></a>plt.tick_params(axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb182-16"><a href="#cb182-16" aria-hidden="true" tabindex="-1"></a>plt.xlim((<span class="dv">10</span>,<span class="fl">100e3</span>))</span>
<span id="cb182-17"><a href="#cb182-17" aria-hidden="true" tabindex="-1"></a>plt.ylim((<span class="op">-</span><span class="dv">40</span>,<span class="dv">30</span>))</span>
<span id="cb182-18"><a href="#cb182-18" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb182-19"><a href="#cb182-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-20"><a href="#cb182-20" aria-hidden="true" tabindex="-1"></a><span class="co"># highlight the guitar audio band, 80 to 8kHz</span></span>
<span id="cb182-21"><a href="#cb182-21" aria-hidden="true" tabindex="-1"></a>plt.axvspan(<span class="dv">80</span>, <span class="fl">8e3</span>, color<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb182-22"><a href="#cb182-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-23"><a href="#cb182-23" aria-hidden="true" tabindex="-1"></a>plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb182-24"><a href="#cb182-24" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Magnitude and phase response'</span>)</span>
<span id="cb182-25"><a href="#cb182-25" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Klon Centaur part 1_files/figure-html/cell-155-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The gains on the clean paths are not high enough to compete with the gain of the distortion path at a gain setting of 50%.</p>
<div id="d8ac221d-c885-4f68-9aee-c25bf48cd36f" class="cell" data-execution_count="314">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'clean path 1 maximum gain </span><span class="sc">{:.1f}</span><span class="st"> dB at </span><span class="sc">{:.2f}</span><span class="st">%'</span>.<span class="bu">format</span>(clean_path1_mag[i].<span class="bu">max</span>(),gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'clean path 2 maximum gain </span><span class="sc">{:.1f}</span><span class="st"> dB at </span><span class="sc">{:.2f}</span><span class="st">%'</span>.<span class="bu">format</span>(clean_path2_mag[i].<span class="bu">max</span>(),gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb183-3"><a href="#cb183-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'cascade of A and B maximum gain </span><span class="sc">{:.1f}</span><span class="st"> dB at </span><span class="sc">{:.2f}</span><span class="st">%'</span>.<span class="bu">format</span>((diode_pathB_mag[i]<span class="op">+</span>diode_pathA_mag[i]).<span class="bu">max</span>(),gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb183-4"><a href="#cb183-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-5"><a href="#cb183-5" aria-hidden="true" tabindex="-1"></a>max_gain_dB <span class="op">=</span> diode_pathA_mag[i].<span class="bu">max</span>()</span>
<span id="cb183-6"><a href="#cb183-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'path A maximum gain </span><span class="sc">{:.1f}</span><span class="st"> dB at </span><span class="sc">{:.0f}</span><span class="st">%'</span>.<span class="bu">format</span>(max_gain_dB,gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb183-7"><a href="#cb183-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'peak signal for diode conduction threshold: </span><span class="sc">{:.3f}</span><span class="st"> Vp'</span>.<span class="bu">format</span>(Diode_knee_1N34A<span class="op">/</span>(<span class="dv">10</span><span class="op">**</span>(max_gain_dB<span class="op">/</span><span class="dv">10</span>))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>clean path 1 maximum gain 7.1 dB at 50.00%
clean path 2 maximum gain -1.5 dB at 50.00%
cascade of A and B maximum gain 25.5 dB at 50.00%
path A maximum gain 12.2 dB at 50%
peak signal for diode conduction threshold: 0.015 Vp</code></pre>
</div>
</div>
<p>An input signal of greater than about 0.015 volts peak is needed to drive the diodes into conduction.</p>
<p>Based on my research of how guitar players set up their Klons, a 40% to 60% gain position seems to be common to achieve the tone they desire. At this point clean path 2 is more than 3 dB less than Diode path B and probably not very audible. In the lower half of the guitar band, clean path 1 is about 2 to 3 dB less than diode path B and becoming less audible.</p>
</section>
<section id="gain-setting-75" class="level3" data-number="37.12.6">
<h3 data-number="37.12.6" class="anchored" data-anchor-id="gain-setting-75"><span class="header-section-number">37.12.6</span> gain setting 75%</h3>
<p>The frequency response plots are plotted for a gain setting of 75%.</p>
<div id="caabcbbe-672b-499d-b1ac-967de86f9ec4" class="cell" data-execution_count="315">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'magnitude, dB'</span>)</span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'frequency, Hz'</span>)</span>
<span id="cb185-3"><a href="#cb185-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-4"><a href="#cb185-4" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">5</span> <span class="co"># set the index for the gain setting of interest</span></span>
<span id="cb185-5"><a href="#cb185-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-6"><a href="#cb185-6" aria-hidden="true" tabindex="-1"></a>plt.semilogx(clean_path1_w[i]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), clean_path1_mag[i],<span class="st">'-b'</span>,label<span class="op">=</span><span class="st">'Clean path 1, P1 @ </span><span class="sc">{:.0f}</span><span class="st">%'</span>.<span class="bu">format</span>(gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb185-7"><a href="#cb185-7" aria-hidden="true" tabindex="-1"></a>plt.semilogx(clean_path2_w[i]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), clean_path2_mag[i],<span class="st">'-m'</span>,label<span class="op">=</span><span class="st">'Clean path 2, P1 @ </span><span class="sc">{:.0f}</span><span class="st">%'</span>.<span class="bu">format</span>(gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb185-8"><a href="#cb185-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-9"><a href="#cb185-9" aria-hidden="true" tabindex="-1"></a>plt.semilogx(diode_pathA_w[i]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), diode_pathA_mag[i],<span class="st">'-.r'</span>,label<span class="op">=</span><span class="st">'Distortion path A, P1 @ </span><span class="sc">{:.0f}</span><span class="st">%'</span>.<span class="bu">format</span>(gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb185-10"><a href="#cb185-10" aria-hidden="true" tabindex="-1"></a>plt.semilogx(diode_pathB_w[i]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), diode_pathB_mag[i],<span class="st">'-.g'</span>,label<span class="op">=</span><span class="st">'Distortion path B, P1 @ </span><span class="sc">{:.0f}</span><span class="st">%'</span>.<span class="bu">format</span>(gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb185-11"><a href="#cb185-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-12"><a href="#cb185-12" aria-hidden="true" tabindex="-1"></a><span class="co"># cascade of diode path part A and B</span></span>
<span id="cb185-13"><a href="#cb185-13" aria-hidden="true" tabindex="-1"></a>plt.semilogx(diode_pathB_w[i]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), diode_pathB_mag[i]<span class="op">+</span>diode_pathA_mag[i],<span class="st">'-k'</span>,label<span class="op">=</span><span class="st">'Cascade of A and B @ </span><span class="sc">{:.0f}</span><span class="st">%'</span>.<span class="bu">format</span>(gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb185-14"><a href="#cb185-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-15"><a href="#cb185-15" aria-hidden="true" tabindex="-1"></a>plt.tick_params(axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb185-16"><a href="#cb185-16" aria-hidden="true" tabindex="-1"></a>plt.xlim((<span class="dv">10</span>,<span class="fl">100e3</span>))</span>
<span id="cb185-17"><a href="#cb185-17" aria-hidden="true" tabindex="-1"></a>plt.ylim((<span class="op">-</span><span class="dv">40</span>,<span class="dv">40</span>))</span>
<span id="cb185-18"><a href="#cb185-18" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb185-19"><a href="#cb185-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-20"><a href="#cb185-20" aria-hidden="true" tabindex="-1"></a><span class="co"># highlight the guitar audio band, 80 to 8kHz</span></span>
<span id="cb185-21"><a href="#cb185-21" aria-hidden="true" tabindex="-1"></a>plt.axvspan(<span class="dv">80</span>, <span class="fl">8e3</span>, color<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb185-22"><a href="#cb185-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-23"><a href="#cb185-23" aria-hidden="true" tabindex="-1"></a>plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb185-24"><a href="#cb185-24" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Magnitude and phase response'</span>)</span>
<span id="cb185-25"><a href="#cb185-25" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Klon Centaur part 1_files/figure-html/cell-157-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The gains on the clean paths are not high enough to compete with the gain of the distortion path at a gain setting of 75%.</p>
<div id="de2ea7d7-a11a-4ffe-818f-42e653e18a8a" class="cell" data-execution_count="316">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'clean path 1 maximum gain </span><span class="sc">{:.1f}</span><span class="st"> dB at </span><span class="sc">{:.2f}</span><span class="st">%'</span>.<span class="bu">format</span>(clean_path1_mag[i].<span class="bu">max</span>(),gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'clean path 2 maximum gain </span><span class="sc">{:.1f}</span><span class="st"> dB at </span><span class="sc">{:.2f}</span><span class="st">%'</span>.<span class="bu">format</span>(clean_path2_mag[i].<span class="bu">max</span>(),gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'cascade of A and B maximum gain </span><span class="sc">{:.1f}</span><span class="st"> dB at </span><span class="sc">{:.2f}</span><span class="st">%'</span>.<span class="bu">format</span>((diode_pathB_mag[i]<span class="op">+</span>diode_pathA_mag[i]).<span class="bu">max</span>(),gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb186-4"><a href="#cb186-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-5"><a href="#cb186-5" aria-hidden="true" tabindex="-1"></a>max_gain_dB <span class="op">=</span> diode_pathA_mag[i].<span class="bu">max</span>()</span>
<span id="cb186-6"><a href="#cb186-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'path A maximum gain </span><span class="sc">{:.1f}</span><span class="st"> dB at </span><span class="sc">{:.0f}</span><span class="st">%'</span>.<span class="bu">format</span>(max_gain_dB,gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb186-7"><a href="#cb186-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'peak signal for diode conduction threshold: </span><span class="sc">{:.2f}</span><span class="st"> mVp'</span>.<span class="bu">format</span>(<span class="dv">1000</span><span class="op">*</span>Diode_knee_1N34A<span class="op">/</span>(<span class="dv">10</span><span class="op">**</span>(max_gain_dB<span class="op">/</span><span class="dv">10</span>))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>clean path 1 maximum gain 7.2 dB at 75.00%
clean path 2 maximum gain -6.3 dB at 75.00%
cascade of A and B maximum gain 30.6 dB at 75.00%
path A maximum gain 17.4 dB at 75%
peak signal for diode conduction threshold: 4.52 mVp</code></pre>
</div>
</div>
<p>An input signal of greater than about 0.005 volts peak is needed to drive the diodes into conduction.</p>
</section>
<section id="gain-setting-99" class="level3" data-number="37.12.7">
<h3 data-number="37.12.7" class="anchored" data-anchor-id="gain-setting-99"><span class="header-section-number">37.12.7</span> gain setting 99%</h3>
<p>Setting the gain control to 99% of full scale and plotting the frequency response of the paths to compare the relative gains.</p>
<div id="e6b3c230-7728-4c4e-865f-b21c88bb528c" class="cell" data-execution_count="317">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'magnitude, dB'</span>)</span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'frequency, Hz'</span>)</span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-4"><a href="#cb188-4" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">6</span> <span class="co"># set the index for the gain setting of interest</span></span>
<span id="cb188-5"><a href="#cb188-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-6"><a href="#cb188-6" aria-hidden="true" tabindex="-1"></a>plt.semilogx(clean_path1_w[i]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), clean_path1_mag[i],<span class="st">'-b'</span>,label<span class="op">=</span><span class="st">'Clean path 1, P1 @ </span><span class="sc">{:.0f}</span><span class="st">%'</span>.<span class="bu">format</span>(gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb188-7"><a href="#cb188-7" aria-hidden="true" tabindex="-1"></a>plt.semilogx(clean_path2_w[i]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), clean_path2_mag[i],<span class="st">'-m'</span>,label<span class="op">=</span><span class="st">'Clean path 2, P1 @ </span><span class="sc">{:.0f}</span><span class="st">%'</span>.<span class="bu">format</span>(gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb188-8"><a href="#cb188-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-9"><a href="#cb188-9" aria-hidden="true" tabindex="-1"></a>plt.semilogx(diode_pathA_w[i]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), diode_pathA_mag[i],<span class="st">'-.r'</span>,label<span class="op">=</span><span class="st">'Distortion path A, P1 @ </span><span class="sc">{:.0f}</span><span class="st">%'</span>.<span class="bu">format</span>(gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb188-10"><a href="#cb188-10" aria-hidden="true" tabindex="-1"></a>plt.semilogx(diode_pathB_w[i]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), diode_pathB_mag[i],<span class="st">'-.g'</span>,label<span class="op">=</span><span class="st">'Distortion path B, P1 @ </span><span class="sc">{:.0f}</span><span class="st">%'</span>.<span class="bu">format</span>(gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb188-11"><a href="#cb188-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-12"><a href="#cb188-12" aria-hidden="true" tabindex="-1"></a><span class="co"># cascade of diode path part A and B</span></span>
<span id="cb188-13"><a href="#cb188-13" aria-hidden="true" tabindex="-1"></a>plt.semilogx(diode_pathB_w[i]<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), diode_pathB_mag[i]<span class="op">+</span>diode_pathA_mag[i],<span class="st">'-k'</span>,label<span class="op">=</span><span class="st">'Cascade of A and B @ </span><span class="sc">{:.0f}</span><span class="st">%'</span>.<span class="bu">format</span>(gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb188-14"><a href="#cb188-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-15"><a href="#cb188-15" aria-hidden="true" tabindex="-1"></a>plt.tick_params(axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb188-16"><a href="#cb188-16" aria-hidden="true" tabindex="-1"></a>plt.xlim((<span class="dv">10</span>,<span class="fl">100e3</span>))</span>
<span id="cb188-17"><a href="#cb188-17" aria-hidden="true" tabindex="-1"></a>plt.ylim((<span class="op">-</span><span class="dv">40</span>,<span class="dv">50</span>))</span>
<span id="cb188-18"><a href="#cb188-18" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb188-19"><a href="#cb188-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-20"><a href="#cb188-20" aria-hidden="true" tabindex="-1"></a><span class="co"># highlight the guitar audio band, 80 to 8kHz</span></span>
<span id="cb188-21"><a href="#cb188-21" aria-hidden="true" tabindex="-1"></a>plt.axvspan(<span class="dv">80</span>, <span class="fl">8e3</span>, color<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb188-22"><a href="#cb188-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-23"><a href="#cb188-23" aria-hidden="true" tabindex="-1"></a>plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb188-24"><a href="#cb188-24" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Magnitude and phase response'</span>)</span>
<span id="cb188-25"><a href="#cb188-25" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Klon Centaur part 1_files/figure-html/cell-159-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The signal on the distortion path will be the most prominent signal in the output when the gain is at 99%. As calculated below, the distortion path has sufficient gain that a peak signal of about 85 <span class="math inline">\(\mu V\)</span> will drive the diodes into conduction and generate harmonics. Signals on clean paths 1 and 2 probably are not discernible in the output.</p>
<div id="5075a596-7922-413a-8b54-e9c8b03dc7d5" class="cell" data-execution_count="318">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'clean path 1 maximum gain </span><span class="sc">{:.1f}</span><span class="st"> dB at </span><span class="sc">{:.2f}</span><span class="st">%'</span>.<span class="bu">format</span>(clean_path1_mag[i].<span class="bu">max</span>(),gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'clean path 2 maximum gain </span><span class="sc">{:.1f}</span><span class="st"> dB at </span><span class="sc">{:.2f}</span><span class="st">%'</span>.<span class="bu">format</span>(clean_path2_mag[i].<span class="bu">max</span>(),gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'cascade of A and B maximum gain </span><span class="sc">{:.1f}</span><span class="st"> dB at </span><span class="sc">{:.2f}</span><span class="st">%'</span>.<span class="bu">format</span>((diode_pathB_mag[i]<span class="op">+</span>diode_pathA_mag[i]).<span class="bu">max</span>(),gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb189-4"><a href="#cb189-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-5"><a href="#cb189-5" aria-hidden="true" tabindex="-1"></a>max_gain_dB <span class="op">=</span> diode_pathA_mag[i].<span class="bu">max</span>()</span>
<span id="cb189-6"><a href="#cb189-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'path A maximum gain </span><span class="sc">{:.1f}</span><span class="st"> dB at </span><span class="sc">{:.0f}</span><span class="st">%'</span>.<span class="bu">format</span>(max_gain_dB,gain_setting[i]<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb189-7"><a href="#cb189-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'peak signal for diode conduction threshold: </span><span class="sc">{:.2f}</span><span class="st"> uVp'</span>.<span class="bu">format</span>(<span class="fl">1e6</span><span class="op">*</span>Diode_knee_1N34A<span class="op">/</span>(<span class="dv">10</span><span class="op">**</span>(max_gain_dB<span class="op">/</span><span class="dv">10</span>))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>clean path 1 maximum gain 7.2 dB at 99.00%
clean path 2 maximum gain -27.4 dB at 99.00%
cascade of A and B maximum gain 45.6 dB at 99.00%
path A maximum gain 34.7 dB at 99%
peak signal for diode conduction threshold: 84.67 uVp</code></pre>
</div>
</div>
<p>The gains on the clean paths are not high enough to compete with the gain of the distortion path at a gain setting of 99%.</p>
<p>At this point in the analysis, I wonder why clean path 1 is part of the design. At low gain, clean path 2 has a gain greater than clean path 1. At a gain setting of about 10%, clean path 1 and 2 have gains along parts of the frequency response curve that are about the same, however both clean paths are overshadowed by the distortion path. It seems like clean path 1 never contributes to the output in a meaningful way. Perhaps clean path 1 was in the initial attempt to blend clean and distortion together, then clean path 2 added later.</p>
</section>
</section>
<section id="summary-for-part-1" class="level2" data-number="37.13">
<h2 data-number="37.13" class="anchored" data-anchor-id="summary-for-part-1"><span class="header-section-number">37.13</span> Summary for part 1</h2>
<p>Part 1 of the analysis used SMNA and the principle of superposition to perform a linear analysis of the Klon. In part 2, a comparison of results from LTSpice with diodes included are made with the linear analysis and the results are nearly identical. Here are a few comments:</p>
<ul>
<li>Clean path 1 is not contributing to the output at a discernible level.</li>
<li>The mix and placement of the reactive branches in clean path 2 is a bit unusual when viewed as a filter.</li>
<li>The use of the dual gang pot, P1, could have been replaced by a signal pot by changing the topology of the circuits and paths. This is something that would have been discussed during a preliminary design review.</li>
<li>The use of a preamp before the Klon is recommended to better control the gain through the guitar signal chain. A variable gain preamp can set the drive level to the Klon and then the Klon’s gain pot can be used to set the desired level of distortion.</li>
</ul>
<p>Parts 2 and 3 are under construction.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./mech-sys.html" class="pagination-link  aria-label=" &lt;span="" systems&lt;="" span&gt;"="">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title">Mechanical systems</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Klon Centaur part 2 temp.html" class="pagination-link" aria-label="<span class='chapter-number'>38</span>&nbsp; <span class='chapter-title'>Klon Centaur, part 2</span>">
        <span class="nav-page-text"><span class="chapter-number">38</span>&nbsp; <span class="chapter-title">Klon Centaur, part 2</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>