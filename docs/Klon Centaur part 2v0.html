<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>26&nbsp; Klon Centaur, part 2 – Symbolic Modified Nodal Analysis&lt;br&gt;using Python</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Klon Centaur part 3v1.html" rel="next">
<link href="./Klon Centaur part 1.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-d6667c7b59069bf82d0268b148e64a53.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js" integrity="sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Example-problems.html">Example problems</a></li><li class="breadcrumb-item"><a href="./Klon Centaur part 2v0.html"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Klon Centaur, part 2</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Symbolic Modified Nodal Analysis<br>using Python</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/Tiburonboy/Symbolic-Modified-Nodal-Analysis-using-Python" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Basic_concepts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Basic Concepts</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Modified_Nodal_Analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Modified Nodal Analysis</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MNA_with_python.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">MNA with Python</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Resistive_networks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Resistive Networks</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./RLC_networks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">RLC Networks</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Transfer_function.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Transfer Function</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Transient_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Transient Analysis</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Mutual_inductance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Mutual Inductance</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Initial_conditions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Initial conditions</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./Example-problems.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Example problems</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Two port parameters.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Two port parameters</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Thevenin equivalent circuit.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Thevenin equivalent circuit</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./State-variable-filter.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">State Variable Filter</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Superposition.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Superposition</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2nd_order_BRF.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">2nd Order BRF</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Elliptic-function-LPF.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Elliptic Function LPF</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Bridge-T.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Bridge-T</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Pi-Filter.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Pi Filter</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./SIDO-low-pass-filter.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">SIDO-low-pass-filter</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Super-node.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Super node</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Modeling Op Amps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Modeling Op Amps</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Op Amp circuits.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Op Amp circuits</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Two amplifier RIAA Phono Preamp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Two amplifier RIAA phono preamp</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mech-sys.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Mechanical systems</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Klon Centaur part 1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Klon Centaur, part 1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Klon Centaur part 2v0.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Klon Centaur, part 2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Klon Centaur part 3v1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Klon Centaur, part 3</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Wien bridge oscillator.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Wien Bridge Oscillator</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Diode Circuit.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Diode Circuit</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Bridged-T-coil_v2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Bridged T Coil</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./Validation-tests.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Validation Tests</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./test_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Test 1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./test_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">Test 2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./test_3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Test 3</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./test_4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">Test 4</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./test_5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Test 5</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./test_6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title">Test 6</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./test_7.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">37</span>&nbsp; <span class="chapter-title">Test 7</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./test_8.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">38</span>&nbsp; <span class="chapter-title">Test 8</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./test_9.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">39</span>&nbsp; <span class="chapter-title">Test 9</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./test_10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">40</span>&nbsp; <span class="chapter-title">Test 10</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./test_11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">41</span>&nbsp; <span class="chapter-title">Test 11</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./test_12.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">42</span>&nbsp; <span class="chapter-title">Test 12</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./test_13.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">43</span>&nbsp; <span class="chapter-title">Test 13</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./test_14.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">44</span>&nbsp; <span class="chapter-title">Test 14</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./test_15.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">45</span>&nbsp; <span class="chapter-title">Test 15</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./References.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./SymMNA_py.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">SymMNA.py</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Change-log.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Change Log</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Google Colab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Google Colab</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./SMNA_mobile.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">SMNA mobile</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./EasyEDA_schematic_editor.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">E</span>&nbsp; <span class="chapter-title">EasyEDA</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./History_of_Electric_Circuit_Analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">F</span>&nbsp; <span class="chapter-title">History of Electric Circuit Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Quick_ref.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">G</span>&nbsp; <span class="chapter-title">Quick Reference</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Project_notes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">H</span>&nbsp; <span class="chapter-title">Project Notes</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sec-nonlinear_analysis" id="toc-sec-nonlinear_analysis" class="nav-link active" data-scroll-target="#sec-nonlinear_analysis"><span class="header-section-number">26.1</span> Non-linear analysis with LTSpice</a></li>
  <li><a href="#semiconductor-components" id="toc-semiconductor-components" class="nav-link" data-scroll-target="#semiconductor-components"><span class="header-section-number">26.2</span> Semiconductor components</a>
  <ul class="collapse">
  <li><a href="#dual-high-slew-rate-jfet-input-op-amp---tl072" id="toc-dual-high-slew-rate-jfet-input-op-amp---tl072" class="nav-link" data-scroll-target="#dual-high-slew-rate-jfet-input-op-amp---tl072"><span class="header-section-number">26.2.1</span> Dual High Slew Rate JFET Input Op Amp - TL072</a></li>
  <li><a href="#general-purpose-germanium-diode---1n34a" id="toc-general-purpose-germanium-diode---1n34a" class="nav-link" data-scroll-target="#general-purpose-germanium-diode---1n34a"><span class="header-section-number">26.2.2</span> General Purpose Germanium Diode - 1N34A</a></li>
  <li><a href="#cmos-switched-capacitor-voltage-converter---icl7660" id="toc-cmos-switched-capacitor-voltage-converter---icl7660" class="nav-link" data-scroll-target="#cmos-switched-capacitor-voltage-converter---icl7660"><span class="header-section-number">26.2.3</span> CMOS Switched Capacitor Voltage Converter - ICL7660</a></li>
  </ul></li>
  <li><a href="#input-voltage-and-gain-sweep" id="toc-input-voltage-and-gain-sweep" class="nav-link" data-scroll-target="#input-voltage-and-gain-sweep"><span class="header-section-number">26.3</span> Input Voltage and Gain Sweep</a>
  <ul class="collapse">
  <li><a href="#op-amp-saturation-at-node-14---u_1b-output" id="toc-op-amp-saturation-at-node-14---u_1b-output" class="nav-link" data-scroll-target="#op-amp-saturation-at-node-14---u_1b-output"><span class="header-section-number">26.3.1</span> Op Amp saturation at Node 14 - <span class="math inline">\(U_{1B}\)</span> output</a></li>
  <li><a href="#guitar-output-signal-levels" id="toc-guitar-output-signal-levels" class="nav-link" data-scroll-target="#guitar-output-signal-levels"><span class="header-section-number">26.3.2</span> Guitar Output Signal Levels</a></li>
  </ul></li>
  <li><a href="#sinusoidal-input" id="toc-sinusoidal-input" class="nav-link" data-scroll-target="#sinusoidal-input"><span class="header-section-number">26.4</span> Sinusoidal Input</a></li>
  <li><a href="#actual-signals" id="toc-actual-signals" class="nav-link" data-scroll-target="#actual-signals"><span class="header-section-number">26.5</span> Actual Signals</a></li>
  <li><a href="#sec-Comparison_of_MNA_and_LTSpice_results" id="toc-sec-Comparison_of_MNA_and_LTSpice_results" class="nav-link" data-scroll-target="#sec-Comparison_of_MNA_and_LTSpice_results"><span class="header-section-number">26.6</span> Comparison of MNA and LTSpice results</a>
  <ul class="collapse">
  <li><a href="#numerical-solution" id="toc-numerical-solution" class="nav-link" data-scroll-target="#numerical-solution"><span class="header-section-number">26.6.1</span> Numerical Solution</a></li>
  <li><a href="#magnitude-and-phase-response" id="toc-magnitude-and-phase-response" class="nav-link" data-scroll-target="#magnitude-and-phase-response"><span class="header-section-number">26.6.2</span> Magnitude and Phase Response</a></li>
  </ul></li>
  <li><a href="#summary-for-part-2" id="toc-summary-for-part-2" class="nav-link" data-scroll-target="#summary-for-part-2"><span class="header-section-number">26.7</span> Summary for part 2</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Example-problems.html">Example problems</a></li><li class="breadcrumb-item"><a href="./Klon Centaur part 2v0.html"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Klon Centaur, part 2</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Klon Centaur, part 2</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this chapter, LTSpice will be used to analyze the operation of the pedal using device models for the Op Amps and diodes. The Op Amp and diode device models describe the nonlinear operation of these devices and LTSpice is capable of performing nonlinear analysis, something that the Python MNA can’t do.</p>
<p>The results from LTSpice are saved as a comma separated value (<em>csv</em>) file and imported into this notebook for plotting and comparison with the Python results. <a href="#fig-Klon-Centaur_v2_sch" class="quarto-xref">Figure&nbsp;<span>26.1</span></a> shows the schematic used in the LTSpice analysis. The circuit is a redrawn version of Martin Chittum’s Klon Centaur schematic shown in <a href="Klon Centaur part 1.html#fig-Chittum_Klon_sch" class="quarto-xref">Figure&nbsp;<span>25.2</span></a> except that the ICL7660 and its associated components have been replaced by fixed voltage sources, <span class="math inline">\(V2\)</span>, <span class="math inline">\(V3\)</span>, <span class="math inline">\(V4\)</span> and <span class="math inline">\(V5\)</span>.</p>
<p>The motivating reason for employing LTSpice for this part of the analysis is to explore the effects of the non-linear components. The Diodes, <span class="math inline">\(D_2\)</span> and <span class="math inline">\(D_3\)</span>, are the primary components that introduce distortion into the signal path. Under the combined conditions of moderate gain setting on <span class="math inline">\(P_1\)</span> and relatively large drive input, the Op Amp <span class="math inline">\(U_{1B}\)</span> can be driven into saturation. When this occurs the output tone will be a combination of non-linearities produced by the clipping of the signal by the Op Amp as the signal levels are driven beyond the power supply rails for <span class="math inline">\(U_{1B}\)</span> and the signal limiting resulting from the diodes.</p>
<p>Given the mystic and alleged magical ability of some types of Germanium diodes to produce superior musical sounds, it seems that Op Amp saturation should be avoided, otherwise the sound will be muddled and negating the point and argument for “special” Germanium diodes.</p>
<p>The analysis presented in this chapter will start with a description of the schematic in <a href="Klon Centaur part 1.html#fig-Chittum_Klon_sch" class="quarto-xref">Figure&nbsp;<span>25.2</span></a>. The Op Amps and Germanium diodes are discussed. Then LTSpice was used to do a parameter sweep where the input signal level was varied from 0.1 volts to 1.5 volts while the gain was varied from 1<span class="math inline">\(\Omega\)</span> to 99 k<span class="math inline">\(\Omega\)</span>. The voltages at various points in the circuit were plotted versus these parameters. Next the circuit was examined with sinusoidal input signals of various amplitudes and the harmonic content of the diode limiting was examined. Actual musical signals were also used as input to the simulation since LTSpice has the ability to read <em>wav</em> files. Finally a comparison of LTSpice results versious Python MNA circuit analysis results is presented to validate the Python MNA analysis.</p>
<p>The following Python modules are used in this notebook.</p>
<!--

Last update: 26 July 2025  

$\large{\color {red} {\text{Note for author:}}}$

What is the value of doing MNA of this circuit?  
pros and cons  

- if the operation is basically non linear why bother with MNA? Because we can get some insight into the frequency shaping paths, they could be equally analyzed in LTSpice. But analytic expressions for the reactive branches can be developed and with the expressions modifications to the design can be considered.


- Klon Centaur, part 2: Effects path non-linear analysis
- circuit description
- Op Amp and Diode description
- Pedal gain, Op Amp saturation and Diode saturation
- sine wave input
- actual signals
- Comparison of MNA and LTSpice results

ToDo

- work on FFT y-axis scaling and units.
  

-->
<div id="97b4256d-9962-49d7-beff-8265d55b7cdb" class="cell" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sympy <span class="im">import</span> <span class="op">*</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> signal</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">#from scipy.signal import blackman</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy.fft</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.ticker</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> SymMNA</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> display, Markdown, Math, Latex</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>init_printing()</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tabulate <span class="im">import</span> tabulate</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<section id="sec-nonlinear_analysis" class="level2" data-number="26.1">
<h2 data-number="26.1" class="anchored" data-anchor-id="sec-nonlinear_analysis"><span class="header-section-number">26.1</span> Non-linear analysis with LTSpice</h2>
<p>The schematic shown below was drawn in LTSpice. The voltage converter, U3, in <a href="Klon Centaur part 1.html#fig-Chittum_Klon_sch" class="quarto-xref">Figure&nbsp;<span>25.2</span></a>, has been replaced by the voltage sources, <span class="math inline">\(V2\)</span>, <span class="math inline">\(V3\)</span>, <span class="math inline">\(V4\)</span> and <span class="math inline">\(V5\)</span>. Voltage source, <span class="math inline">\(V1\)</span>, is the guitar input signal. The effects bypass switch modeled by setting <span class="math inline">\(R_{26}\)</span> to 68k <span class="math inline">\(\Omega\)</span> and <span class="math inline">\(R_{27}\)</span> to 0.01 <span class="math inline">\(\Omega\)</span>, which models switch S1A shorting <span class="math inline">\(R_{27}\)</span> to the wiper terminal of P3. All of the resistors and capacitors are assumed to be ideal. The schematic includes power supply connections for the Op Amps. In the analysis that follows, I’ll be looking at conditions where the Op Amps might be driven into saturation.</p>
<div id="fig-Klon-Centaur_v2_sch" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-Klon-Centaur_v2_sch-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Klon-Centaur_v2.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-Klon-Centaur_v2_sch-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;26.1: Schematic of the Klon Centaur used for the LTSpice nonlinear analysis.
</figcaption>
</figure>
</div>
</section>
<section id="semiconductor-components" class="level2" data-number="26.2">
<h2 data-number="26.2" class="anchored" data-anchor-id="semiconductor-components"><span class="header-section-number">26.2</span> Semiconductor components</h2>
<p>Within the Klon Centaur’s circuits there are several semiconductor devices used. These are the diodes, Op Amps and voltage converter. This section will describe these components and their use in the circuit.</p>
<section id="dual-high-slew-rate-jfet-input-op-amp---tl072" class="level3" data-number="26.2.1">
<h3 data-number="26.2.1" class="anchored" data-anchor-id="dual-high-slew-rate-jfet-input-op-amp---tl072"><span class="header-section-number">26.2.1</span> Dual High Slew Rate JFET Input Op Amp - TL072</h3>
<p>The operational amplifier (Op Amp) used in the pedal is the <a href="https://www.ti.com/product/TL072?bm-verify=AAQAAAAJ_____4l2d6J1dP-up0vwzV75bF018toeB6LvlnsE608z6iBbtlasxEASuWLQUYtzLESDjkX0dSsHD60J9zGYP0c54tzWogKch76Q4F0jkyRIy1M6yC_v9XfTRzpoIY_OO1AZMjCPP2TX-ZhA0f0IQH4K51wgft8CjuH6gbEF7DTNCQYFlJUKVsc0gvaEJpaTaAomByzKNyQf00fndw_mtFdOnFJ5NWqeafPGWHyOvVfL32vIDhFOZ5bHShMDSWaNUvjfcX4dZHJ6q5rSV19vIAJ8RrT9ZTdFzS-t6HtxLmXoF4DHwg">TL072</a>, available from Texas Instruments. The TL072 is a dual, high slew rate, JFET-input Op Amp and is part of a family of industry-standard devices (TL071, TL072, and TL074). There are next-generation versions available (TL071H, TL072H, and TL074H). The TL072 product continues to be available for existing customers, but new designs should consider an alternate product.</p>
<p>The TL072 provides outstanding value for cost-sensitive applications, and features include: low offset (1 mV, typical), high slew rate (20 V/µs), and common-mode input to the positive supply. High ESD (1.5 kV, HBM), integrated EMI and RF filters, and operation across the full –40°C to 125°C enable the TL07xH devices to be used in the most rugged and demanding applications.</p>
<p>The TL072 is available from Digikey from two manufacturers, <a href="https://www.digikey.com/en/products/filter/instrumentation-op-amps-buffer-amps/687?s=N4IgjCBcoLQdIDGUBmBDANgZwKYBoQB7KAbRACYBOANhAF0BfBg80kAFwwAYB2VxoA">Texas Instruments</a> and <a href="https://www.digikey.com/en/products/filter/instrumentation-op-amps-buffer-amps/687?s=N4IgjCBcoLQdIDGUBmBDANgZwKYBoQB7KAbRABYBOAdhAF0BfBggJlJABcMAGatxoA">STMicroelectronics</a>.</p>
<p>The in LTSpice circuit simulations that follow, the following <a href="https://www.ti.com/product/TL072?bm-verify=AAQAAAAJ_____-lTe0JulZ9CqD5uoWAVyNnjsrL88hHq1vTru3T9CqLbfuaSyDLIOOpld10D0GSD9kvMmc1SIOS_B4yZl2__HuJmwsX4W7hXggYazZRQuYuQegllzmDro9t5E_gCIMIqZrGSbZvjrU33jzkVcyOEV0FzFtD9sW-WcIaexAXWykgbLqWmO-3IkAqOuFuHutaWX_SEf0gOZASn23dYYQitU4qrudYAGx_Lj3xIBKe7Jb-z4oKmxI5M7riaPhBJ3hTxnAj-S72-AY7OeTxKtwmZ3IwkjE0BOG__IEnDF6BUVrNJIw#design-development">PSpice Model</a> model from Texas Instruments was used:</p>
<pre><code>* TL072 OPERATIONAL AMPLIFIER "MACROMODEL" SUBCIRCUIT
* CREATED USING PARTS RELEASE 4.01 ON 06/16/89 AT 13:08
* (REV N/A)      SUPPLY VOLTAGE: +/-15V
* CONNECTIONS:   NON-INVERTING INPUT
*                | INVERTING INPUT
*                | | POSITIVE POWER SUPPLY
*                | | | NEGATIVE POWER SUPPLY
*                | | | | OUTPUT
*                | | | | |
.SUBCKT TL072    1 2 3 4 5
*
  C1   11 12 3.498E-12
  C2    6  7 15.00E-12
  DC    5 53 DX
  DE   54  5 DX
  DLP  90 91 DX
  DLN  92 90 DX
  DP    4  3 DX
  EGND 99  0 POLY(2) (3,0) (4,0) 0 .5 .5
  FB    7 99 POLY(5) VB VC VE VLP VLN 0 4.715E6 -5E6 5E6 5E6 -5E6
  GA    6  0 11 12 282.8E-6
  GCM   0  6 10 99 8.942E-9
  ISS   3 10 DC 195.0E-6
  HLIM 90  0 VLIM 1K
  J1   11  2 10 JX
  J2   12  1 10 JX
  R2    6  9 100.0E3
  RD1   4 11 3.536E3
  RD2   4 12 3.536E3
  RO1   8  5 150
  RO2   7 99 150
  RP    3  4 2.143E3
  RSS  10 99 1.026E6
  VB    9  0 DC 0
  VC    3 53 DC 2.200
  VE   54  4 DC 2.200
  VLIM  7  8 DC 0
  VLP  91  0 DC 25
  VLN   0 92 DC 25
.MODEL DX D(IS=800.0E-18)
.MODEL JX PJF(IS=15.00E-12 BETA=270.1E-6 VTO=-1)
.ENDS</code></pre>
<p>The following informative references are recommended:</p>
<ul>
<li><a href="https://www.eetimes.com/op-amps-in-small-signal-audio-design-part-1-op-amp-history-properties/">Op amps in small-signal audio design – Part 1: Op amp history, properties</a></li>
<li><a href="https://www.eetimes.com/Op-amps-in-small-signal-audio-design---Part-2--Distortion-in-bipolar-and-JFET-input-op-amps/?Ecosystem=audio-design/">Op amps in small-signal audio design – Part 2: Distortion in bipolar and JFET input op-amps</a></li>
<li><a href="https://www.eetimes.com/op-amps-in-small-signal-audio-design-part-3-selecting-the-right-op-amp/">Op amps in small-signal audio design – Part 3: Selecting the right op amp</a></li>
</ul>
</section>
<section id="general-purpose-germanium-diode---1n34a" class="level3" data-number="26.2.2">
<h3 data-number="26.2.2" class="anchored" data-anchor-id="general-purpose-germanium-diode---1n34a"><span class="header-section-number">26.2.2</span> General Purpose Germanium Diode - 1N34A</h3>
<p>The clipping diodes, <span class="math inline">\(D_2\)</span> and <span class="math inline">\(D_3\)</span>, are type 1N34A, a general purpose point contact Germanium diode. As recounted in interviews with Bill Finnegan, many versions of the 1N34A from various vendors were evaluated and 1N34A diodes from one particular source were selected based on listening tests. Bill has not disclosed the exact source of the 1N34A diodes he used, so this aspect of the Klon Centaur has remained a trade secret. It has been reported that Bill’s initial stock of Germanium diodes have been depleted and new production uses diodes from a new source.</p>
<p>While the electrical characteristics of Germanium semiconductor devices is well understood, the sonic properties of audio circuits using Germanium semiconductor devices have been described as being warm and more musical. Accordingly, some mystic and urban lour have come to be associated with the use of Germanium diodes and transistors. Most online commentators seem to focus on the forward voltage drop of Germanium diodes along with some sonic qualities. Here are two excerpts:</p>
<p><a href="https://therepaircafe.wordpress.com/2019/10/24/forward-voltage-of-various-diodes/">Forward voltage of various diodes</a>:</p>
<blockquote class="blockquote">
<p>Me and Dylan and David from the DIY guitar pedal/effects community decided to see for ourselves what the fuzz is about regarding diodes and their “softness”. Why do people like Germaniums over Silicons? What is the effect of multiple diodes in series? How exactly does the PN junction of a MOSFET look like? All these questions and more will be answered.</p>
</blockquote>
<p><a href="https://therepaircafe.wordpress.com/2020/07/14/emulating-germanium-diodes/">Emulating germanium diodes</a></p>
<blockquote class="blockquote">
<p>When you get into vintage effect pedals etc. you might get to know the amazing germanium diode. These diodes are truly worse in every way compared to silicon diodes, and thus aren’t being produced anymore. This makes them a treasure for those who are chasing the vintage tone. Luckily here and there germanium diode surpluses are still being sold with nice profit margins.</p>
</blockquote>
<blockquote class="blockquote">
<p>But what is so special about germanium? Well, people claim that they clip “softer” than silicon diodes. This makes your tone sound “smoother” and whatever. In my post about testing diodes it is clear that the knee (slope) of germanium diodes is indeed smoother than those of silicon diodes so that’s one way to prove that it has “some” impact on your tone. But can’t we emulate this soft knee in some way?</p>
</blockquote>
<blockquote class="blockquote">
<p>The blogpost also showed how you can simply put diodes in series to double the forward voltage, but also make the knee softer. Putting 4 or more silicons in series gets you close to the softness of a germanium, but with a forward voltage of 2.8V.</p>
</blockquote>
<p>My analysis of the circuits used in the Klon Centaur cannot evaluate the sonic aspects of Germanium diodes, something that could be properly investigated by building prototype circuits and doing blind listen tests, but instead will focus on the general electrical characteristics of the 1N34A. The 1N34A diode model used in the LTSpice simulations is:</p>
<pre><code>.model 1N34A D(bv=75 cjo=0.5e-12 eg=0.67 ibv=18e-3 is=2e-7 rs=7 n=1.3 vj=0.1 m=0.27)</code></pre>
<p>The circuit shown below is used to evaluate the 1N34A model.</p>
<div id="fig-diode-test-jig" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-diode-test-jig-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="diode_test_jig.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-diode-test-jig-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;26.2: Schematic of LTSpice diode test jig.
</figcaption>
</figure>
</div>
<p>The following code loads the voltage versus current data for the 1N34A Germanium diode and the 1N914 Silicon diode models.</p>
<div id="cad40a0f-9989-4d02-a315-e706f7555a00" class="cell" data-execution_count="51">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>fn <span class="op">=</span> <span class="st">'Diode-vi-curve.csv'</span> <span class="co"># data from LTSpice</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>LTSpice_data <span class="op">=</span> np.genfromtxt(fn, delimiter<span class="op">=</span><span class="st">','</span>,skip_header<span class="op">=</span><span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Copy the data from the <em>csv</em> file into NumPy arrays.</p>
<div id="376a9cfd-6df4-4bfc-8f69-9fad58ca6e3a" class="cell" data-execution_count="52">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize some empty arrays</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>D_1N34A_voltage <span class="op">=</span> np.zeros(<span class="bu">len</span>(LTSpice_data))</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>D_1N34A_diode_current <span class="op">=</span> np.zeros(<span class="bu">len</span>(LTSpice_data))</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>D_1N914_voltage <span class="op">=</span> np.zeros(<span class="bu">len</span>(LTSpice_data))</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>D_1N914_diode_current <span class="op">=</span> np.zeros(<span class="bu">len</span>(LTSpice_data))</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># load csv data into the array</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(LTSpice_data)):</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    D_1N34A_voltage[i] <span class="op">=</span> LTSpice_data[i][<span class="dv">0</span>]</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    D_1N34A_diode_current[i] <span class="op">=</span> LTSpice_data[i][<span class="dv">1</span>]<span class="op">*</span><span class="dv">1000</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    D_1N914_voltage[i] <span class="op">=</span> LTSpice_data[i][<span class="dv">2</span>]</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    D_1N914_diode_current[i] <span class="op">=</span> LTSpice_data[i][<span class="dv">3</span>]<span class="op">*</span><span class="dv">1000</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Plot the LTSpice simulated forward voltage versus current relationship for 1N34A and 1N914 diode models.</p>
<div id="cell-fig-diode_volts_current_plot" class="cell" data-execution_count="53">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>fig1, ax1 <span class="op">=</span> plt.subplots()</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>ax1.plot([<span class="dv">10</span>, <span class="dv">100</span>, <span class="dv">1000</span>], [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>])</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>ax1.text(D_1N34A_voltage[<span class="dv">1375</span>], D_1N34A_diode_current[<span class="dv">1375</span>], <span class="st">'</span><span class="sc">{:.2f}</span><span class="st"> volts, </span><span class="sc">{:.2f}</span><span class="st"> mA   '</span>.<span class="bu">format</span>(D_1N34A_voltage[<span class="dv">1375</span>], D_1N34A_diode_current[<span class="dv">1375</span>]), fontsize<span class="op">=</span><span class="dv">8</span>, horizontalalignment<span class="op">=</span><span class="st">'right'</span>, verticalalignment<span class="op">=</span><span class="st">'center'</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>ax1.plot(D_1N34A_voltage, D_1N34A_diode_current,<span class="st">'-b'</span>,label<span class="op">=</span><span class="st">'1N34A'</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>ax1.plot(D_1N34A_voltage[<span class="dv">1375</span>], D_1N34A_diode_current[<span class="dv">1375</span>],<span class="st">'xb'</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>ax1.plot(D_1N914_voltage, D_1N914_diode_current,<span class="st">'-r'</span>,label<span class="op">=</span><span class="st">'1N914'</span>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>ax1.set_xlim(<span class="fl">0.1</span>,<span class="dv">1</span>)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>ax1.set_ylim(<span class="dv">0</span>,<span class="dv">10</span>)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'volts'</span>)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'current. mA'</span>)</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>ax1.set_xscale(<span class="st">'log'</span>)</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>ax1.set_xticks([<span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.5</span>, <span class="fl">0.6</span>, <span class="fl">1.0</span>])</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>ax1.get_xaxis().set_major_formatter(matplotlib.ticker.ScalarFormatter())</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>ax1.get_xaxis().set_tick_params(which<span class="op">=</span><span class="st">'minor'</span>, size<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>ax1.get_xaxis().set_tick_params(which<span class="op">=</span><span class="st">'minor'</span>, width<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>ax1.grid()</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>ax1.legend()</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Forward voltage versus current for 1N34A and 1N914 diode models'</span>)</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="fig-diode_volts_current_plot" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-diode_volts_current_plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Klon Centaur part 2v0_files/figure-html/fig-diode_volts_current_plot-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-diode_volts_current_plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;26.3: Voltage vs current plot for 1N34A and 1N914 diodes.
</figcaption>
</figure>
</div>
</div>
</div>
<p>As shown in the plot above, the VI curves for the 1N34A and 1N914 diode models are different. The 1N34A has a forward voltage of 0.38 volts at 5mA, whereas the 1N914 had a forward voltage of about 0.62 volts at 5mA. The shape of the two curves is also different with the 1N34A curve being a bit more rounded. The harmonics generated in audio circuits using the 1N34A will have a different set of amplitude coefficients and a different sound.</p>
</section>
<section id="cmos-switched-capacitor-voltage-converter---icl7660" class="level3" data-number="26.2.3">
<h3 data-number="26.2.3" class="anchored" data-anchor-id="cmos-switched-capacitor-voltage-converter---icl7660"><span class="header-section-number">26.2.3</span> CMOS Switched Capacitor Voltage Converter - ICL7660</h3>
<p>The electrical power to operate the Klon Centaur comes from the DC jack or the internal 9 volt battery. Nominally both the DC jack or the battery are 9 volt sources, however as the battery drains, the voltage will be less than 9 volts and the power source connected to the DC jack might be slightly different than 9 volts. The 9 volt power source is filtered by <span class="math inline">\(C_{17}\)</span> and <span class="math inline">\(D_4\)</span> provides reverse voltage protection. Internal to the Klon Centaur there are four power supply rails derived from the 9 volt battery or the DC jack. The 9 volts is divided by two using resistors R29 and R30 to produce +4.5V and C18 stabilizes this voltage.</p>
<p><span class="math inline">\(U_3\)</span> is a CMOS switched capacitor voltage converter, part number ICL7660, which converts positive 9 volts into -9 and +18 volts. The ICL7660, with a few external components, can double, divide, or multiply a positive input voltage. The ICL7660 will operate from 1.5V to 10V input voltage and can deliver upto 10mA with a 0.5V output drop. The ICL7660 is currently produced by Renesas Electronics Corporation and Analog Devices Inc./Maxim Integrated, and distributed by Digikey under the part numbers, <a href="https://www.digikey.com/en/products/detail/renesas-electronics-corporation/ICL7660CPAZ/1034926">ICL7660CPAZ</a> and <a href="https://www.digikey.com/en/products/detail/analog-devices-inc-maxim-integrated/ICL7660CPA/1303023">ICL7660CPA+</a>.</p>
<p>The Op Amps <span class="math inline">\(U_1\)</span> and <span class="math inline">\(U_2\)</span> are connected to different supply rails. <span class="math inline">\(U_{1A}\)</span> and <span class="math inline">\(U_{1B}\)</span> power supply voltages are 9 volts and ground. The signal ground is a virtual ground with a voltage of 4.5 volts. This allows audio signals processed by <span class="math inline">\(U_1\)</span> to swing between about 2 volts and 7 volts peak to peak without clipping. The power supply levels for <span class="math inline">\(U_{2A}\)</span> and <span class="math inline">\(U_{2B}\)</span> are 18 volts and -9 volts. This allows signals processed by <span class="math inline">\(U_2\)</span> to swing between about -7 to +16 volts peak to peak without clipping.</p>
</section>
</section>
<section id="input-voltage-and-gain-sweep" class="level2" data-number="26.3">
<h2 data-number="26.3" class="anchored" data-anchor-id="input-voltage-and-gain-sweep"><span class="header-section-number">26.3</span> Input Voltage and Gain Sweep</h2>
<p>LTSpice was set up to run a series of simulations which stepped though a list of <span class="math inline">\(V1\)</span> amplitudes and values for <span class="math inline">\(R_{gain}\)</span>. The frequency of <span class="math inline">\(V1\)</span> was set to 1 kHz since this is the frequency where some resonant paths peak. The voltage range used for <span class="math inline">\(V1\)</span> is 0.1 volts to 1.5 volts. The following SPICE commands were used:</p>
<pre><code>.tran 0 5m 0
.param Rtone=5k
.param Routput=99.999k
.step param Rgain list 1 250 500 750 1k 2.5k 5k 7.5k 10k 15k 20k 25k 30k 35k 40k 45k 50k 55k 60k 65k 70k 75k 80k 85k 90k 92.5k 95k 97.5k 99.9k
.step param V1_amp list 0.1 0.25 0.5 0.75 1.0 1.25 1.5</code></pre>
<p>The following Python reads in the data file generated by LTSpice.</p>
<div id="cb5d351d-431e-40ed-9c64-15acc5981d8e" class="cell" data-execution_count="54">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>LTSpice_data_fn <span class="op">=</span> <span class="st">'Sweep_Vin_&amp;_Rgain.csv'</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>LTSpice_sweep_df <span class="op">=</span> pd.read_csv(LTSpice_data_fn)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>There are about 354,000 records in the Pandas dataframe. Voltage data was collected from the nodes listed in <a href="#tbl-sweep-node-table" class="quarto-xref">Table&nbsp;<span>26.1</span></a> and a short description of the node’s location in the circuit is provided.</p>
<div id="tbl-sweep-node-table" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-sweep-node-table-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;26.1: Nodes and connections
</figcaption>
<div aria-describedby="tbl-sweep-node-table-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<thead>
<tr class="header">
<th>Node</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>7</td>
<td>U1A output</td>
</tr>
<tr class="even">
<td>14</td>
<td>U1B output</td>
</tr>
<tr class="odd">
<td>17</td>
<td>right side of C10</td>
</tr>
<tr class="even">
<td>19</td>
<td>U2A output</td>
</tr>
<tr class="odd">
<td>21</td>
<td>U2B output</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>A sample of the first 5 records in the dataframe are displayed below. Each simulation run for the various <span class="math inline">\(V1\)</span> gains and <span class="math inline">\(R_{gain}\)</span> setting is delimited by <em>Step Information: …</em>.</p>
<div id="86380933-f2fb-4ae7-9033-13b76e359d60" class="cell" data-execution_count="55">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>LTSpice_sweep_df.head(<span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="55">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">time</th>
<th data-quarto-table-cell-role="th">V(7)</th>
<th data-quarto-table-cell-role="th">V(14)</th>
<th data-quarto-table-cell-role="th">V(17)</th>
<th data-quarto-table-cell-role="th">V(19)</th>
<th data-quarto-table-cell-role="th">V(21)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>Step Information: V1_amp=100m Rgain=1 (Step: ...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>0</td>
<td>4.499977</td>
<td>4.500065</td>
<td>4.500011</td>
<td>4.50035</td>
<td>4.499677</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>1.25000001460762E-08</td>
<td>4.499977</td>
<td>4.500065</td>
<td>4.500011</td>
<td>4.50035</td>
<td>4.499677</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>2.50000002921524E-08</td>
<td>4.499977</td>
<td>4.500065</td>
<td>4.500011</td>
<td>4.50035</td>
<td>4.499677</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>5.00000005843049E-08</td>
<td>4.499977</td>
<td>4.500065</td>
<td>4.500011</td>
<td>4.50035</td>
<td>4.499677</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>In the <em>csv</em> file, there are lines of text for each new step in the simulation. For example:</p>
<p><em>Step Information: V1_amp=100m Rgain=1K (Step: 29/203)</em></p>
<p>These lines of text are used to locate the index of the start of the data from each simulation sweep by looking at each record for the word ‘Step’ and a list of index values is created.</p>
<div id="5e53341d-fd58-4d2c-9f7f-0522a9d0832d" class="cell" data-execution_count="56">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>lst <span class="op">=</span> LTSpice_sweep_df[<span class="st">'time'</span>].tolist()</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>step_index <span class="op">=</span> []</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>row_cnt <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> lst:</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'Step'</span> <span class="kw">in</span> i:</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>        step_index.append(row_cnt)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    row_cnt <span class="op">+=</span> <span class="dv">1</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A new dataframe called <em>sweep_df</em> is created. The following code finds the peak to peak voltage at each node for each sweep and loads the values into the dataframe.</p>
<div id="c7d62ae6-f2aa-40b2-b4bd-5a2b620ceb2b" class="cell" data-execution_count="57">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>sweep_df <span class="op">=</span> pd.DataFrame(columns<span class="op">=</span>[<span class="st">'V1amp'</span>,<span class="st">'Rgain'</span>,<span class="st">'V7pp'</span>,<span class="st">'V14pp'</span>,<span class="st">'V17pp'</span>,<span class="st">'V19pp'</span>,<span class="st">'V21pp'</span>])</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="bu">len</span>(step_index)):</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">#</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    row_elements <span class="op">=</span> LTSpice_sweep_df[<span class="st">'time'</span>][step_index[i]].split()</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">#</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    Rgain_str <span class="op">=</span> row_elements[<span class="dv">3</span>][<span class="dv">6</span>:]</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    Rgain_value <span class="op">=</span> <span class="bu">float</span>(Rgain_str.replace(<span class="st">'K'</span>, <span class="st">'e3'</span>))</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    Rgain_percent <span class="op">=</span> Rgain_value<span class="op">/</span><span class="fl">100e3</span><span class="op">*</span><span class="dv">100</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    V1_amp_str <span class="op">=</span> row_elements[<span class="dv">2</span>][<span class="dv">7</span>:]</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    V1_amp_value <span class="op">=</span> <span class="bu">float</span>(V1_amp_str.replace(<span class="st">'m'</span>, <span class="st">'e-3'</span>))</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">#</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>        v7_pp_value <span class="op">=</span> LTSpice_sweep_df[<span class="st">'V(7)'</span>][<span class="dv">0</span>:step_index[i<span class="op">+</span><span class="dv">1</span>]].<span class="bu">max</span>() <span class="op">-</span> LTSpice_sweep_df[<span class="st">'V(7)'</span>][<span class="dv">0</span>:step_index[i<span class="op">+</span><span class="dv">1</span>]].<span class="bu">min</span>()</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>        v14_pp_value <span class="op">=</span> LTSpice_sweep_df[<span class="st">'V(14)'</span>][<span class="dv">0</span>:step_index[i<span class="op">+</span><span class="dv">1</span>]].<span class="bu">max</span>() <span class="op">-</span> LTSpice_sweep_df[<span class="st">'V(14)'</span>][<span class="dv">0</span>:step_index[i<span class="op">+</span><span class="dv">1</span>]].<span class="bu">min</span>()</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>        v17_pp_value <span class="op">=</span> LTSpice_sweep_df[<span class="st">'V(17)'</span>][<span class="dv">0</span>:step_index[i<span class="op">+</span><span class="dv">1</span>]].<span class="bu">max</span>() <span class="op">-</span> LTSpice_sweep_df[<span class="st">'V(17)'</span>][<span class="dv">0</span>:step_index[i<span class="op">+</span><span class="dv">1</span>]].<span class="bu">min</span>()</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>        v19_pp_value <span class="op">=</span> LTSpice_sweep_df[<span class="st">'V(19)'</span>][<span class="dv">0</span>:step_index[i<span class="op">+</span><span class="dv">1</span>]].<span class="bu">max</span>() <span class="op">-</span> LTSpice_sweep_df[<span class="st">'V(19)'</span>][<span class="dv">0</span>:step_index[i<span class="op">+</span><span class="dv">1</span>]].<span class="bu">min</span>()</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>        v21_pp_value <span class="op">=</span> LTSpice_sweep_df[<span class="st">'V(21)'</span>][<span class="dv">0</span>:step_index[i<span class="op">+</span><span class="dv">1</span>]].<span class="bu">max</span>() <span class="op">-</span> LTSpice_sweep_df[<span class="st">'V(21)'</span>][<span class="dv">0</span>:step_index[i<span class="op">+</span><span class="dv">1</span>]].<span class="bu">min</span>()</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> i <span class="op">&lt;</span> <span class="bu">len</span>(step_index)<span class="op">-</span><span class="dv">1</span>:</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>        v7_pp_value <span class="op">=</span> LTSpice_sweep_df[<span class="st">'V(7)'</span>][step_index[i]:step_index[i<span class="op">+</span><span class="dv">1</span>]].<span class="bu">max</span>() <span class="op">-</span> LTSpice_sweep_df[<span class="st">'V(7)'</span>][step_index[i]:step_index[i<span class="op">+</span><span class="dv">1</span>]].<span class="bu">min</span>()</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>        v14_pp_value <span class="op">=</span> LTSpice_sweep_df[<span class="st">'V(14)'</span>][step_index[i]:step_index[i<span class="op">+</span><span class="dv">1</span>]].<span class="bu">max</span>() <span class="op">-</span> LTSpice_sweep_df[<span class="st">'V(14)'</span>][step_index[i]:step_index[i<span class="op">+</span><span class="dv">1</span>]].<span class="bu">min</span>()</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>        v17_pp_value <span class="op">=</span> LTSpice_sweep_df[<span class="st">'V(17)'</span>][step_index[i]:step_index[i<span class="op">+</span><span class="dv">1</span>]].<span class="bu">max</span>() <span class="op">-</span> LTSpice_sweep_df[<span class="st">'V(17)'</span>][step_index[i]:step_index[i<span class="op">+</span><span class="dv">1</span>]].<span class="bu">min</span>()</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>        v19_pp_value <span class="op">=</span> LTSpice_sweep_df[<span class="st">'V(19)'</span>][step_index[i]:step_index[i<span class="op">+</span><span class="dv">1</span>]].<span class="bu">max</span>() <span class="op">-</span> LTSpice_sweep_df[<span class="st">'V(19)'</span>][step_index[i]:step_index[i<span class="op">+</span><span class="dv">1</span>]].<span class="bu">min</span>()        </span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>        v21_pp_value <span class="op">=</span> LTSpice_sweep_df[<span class="st">'V(21)'</span>][step_index[i]:step_index[i<span class="op">+</span><span class="dv">1</span>]].<span class="bu">max</span>() <span class="op">-</span> LTSpice_sweep_df[<span class="st">'V(21)'</span>][step_index[i]:step_index[i<span class="op">+</span><span class="dv">1</span>]].<span class="bu">min</span>()        </span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>        v7_pp_value <span class="op">=</span> LTSpice_sweep_df[<span class="st">'V(7)'</span>][step_index[i]:<span class="op">-</span><span class="dv">1</span>].<span class="bu">max</span>() <span class="op">-</span> LTSpice_sweep_df[<span class="st">'V(7)'</span>][step_index[i]:<span class="op">-</span><span class="dv">1</span>].<span class="bu">min</span>()        </span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>        v14_pp_value <span class="op">=</span> LTSpice_sweep_df[<span class="st">'V(14)'</span>][step_index[i]:<span class="op">-</span><span class="dv">1</span>].<span class="bu">max</span>() <span class="op">-</span> LTSpice_sweep_df[<span class="st">'V(14)'</span>][step_index[i]:<span class="op">-</span><span class="dv">1</span>].<span class="bu">min</span>()  </span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>        v17_pp_value <span class="op">=</span> LTSpice_sweep_df[<span class="st">'V(17)'</span>][step_index[i]:<span class="op">-</span><span class="dv">1</span>].<span class="bu">max</span>() <span class="op">-</span> LTSpice_sweep_df[<span class="st">'V(17)'</span>][step_index[i]:<span class="op">-</span><span class="dv">1</span>].<span class="bu">min</span>()  </span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>        v19_pp_value <span class="op">=</span> LTSpice_sweep_df[<span class="st">'V(19)'</span>][step_index[i]:<span class="op">-</span><span class="dv">1</span>].<span class="bu">max</span>() <span class="op">-</span> LTSpice_sweep_df[<span class="st">'V(19)'</span>][step_index[i]:<span class="op">-</span><span class="dv">1</span>].<span class="bu">min</span>()   </span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>        v21_pp_value <span class="op">=</span> LTSpice_sweep_df[<span class="st">'V(21)'</span>][step_index[i]:<span class="op">-</span><span class="dv">1</span>].<span class="bu">max</span>() <span class="op">-</span> LTSpice_sweep_df[<span class="st">'V(21)'</span>][step_index[i]:<span class="op">-</span><span class="dv">1</span>].<span class="bu">min</span>()          </span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># load values into new dataframe</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>    sweep_df.loc[i] <span class="op">=</span> [V1_amp_value, Rgain_percent, v7_pp_value,v14_pp_value,v17_pp_value,v19_pp_value,v21_pp_value]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The first five lines of the dataframe are displayed below.</p>
<div id="87d08c8f-eef2-45c5-9db6-7d78d62e9e81" class="cell" data-execution_count="58">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>sweep_df.head(<span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="58">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">V1amp</th>
<th data-quarto-table-cell-role="th">Rgain</th>
<th data-quarto-table-cell-role="th">V7pp</th>
<th data-quarto-table-cell-role="th">V14pp</th>
<th data-quarto-table-cell-role="th">V17pp</th>
<th data-quarto-table-cell-role="th">V19pp</th>
<th data-quarto-table-cell-role="th">V21pp</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>0.10</td>
<td>0.001</td>
<td>0.197555</td>
<td>0.000146</td>
<td>0.000140</td>
<td>0.138082</td>
<td>0.161292</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>0.25</td>
<td>0.001</td>
<td>0.493868</td>
<td>0.000367</td>
<td>0.000352</td>
<td>0.345193</td>
<td>0.403173</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>0.50</td>
<td>0.001</td>
<td>0.987762</td>
<td>0.000732</td>
<td>0.000703</td>
<td>0.690350</td>
<td>0.806184</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>0.75</td>
<td>0.001</td>
<td>1.481557</td>
<td>0.001101</td>
<td>0.001054</td>
<td>1.035477</td>
<td>1.209899</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>1.00</td>
<td>0.001</td>
<td>1.975554</td>
<td>0.001466</td>
<td>0.001405</td>
<td>1.380598</td>
<td>1.612327</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>A list of the amplitudes of <span class="math inline">\(V1\)</span> used for each sweep is created from the dataframe as well as a list of the <span class="math inline">\(R_{gain}\)</span> sweep values.</p>
<div id="89ad504b-d735-4a8c-8c0f-d186eafb5a04" class="cell" data-execution_count="59">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>V1_amp_list <span class="op">=</span> sweep_df[<span class="st">'V1amp'</span>].unique()</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>Rgain_list <span class="op">=</span> sweep_df[<span class="st">'Rgain'</span>].unique()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<section id="op-amp-saturation-at-node-14---u_1b-output" class="level3" data-number="26.3.1">
<h3 data-number="26.3.1" class="anchored" data-anchor-id="op-amp-saturation-at-node-14---u_1b-output"><span class="header-section-number">26.3.1</span> Op Amp saturation at Node 14 - <span class="math inline">\(U_{1B}\)</span> output</h3>
<p>Node V14 is the output of <span class="math inline">\(U_{1B}\)</span>. This is the distortion path part A. As can be seen, an input of 1.5 volts is needed to saturate the Op Amp at the lowest gain setting. At a gain setting of 50%, an input of 0.75 volts peak will drive the Op Amp into saturation. Supply rail voltages for <span class="math inline">\(U_1\)</span> are 9 volts and ground, with a virtual ground reference of 4.5 volts. This means that at some gain settings, it is likely that guitar signals with even small peak to peak amplitudes will drive <span class="math inline">\(U_{1B}\)</span> into saturation.</p>
<p>The peak to peak values for <span class="math inline">\(v_{14}\)</span> are plotted versus <span class="math inline">\(R_{gain}\)</span> and <span class="math inline">\(V1\)</span>.</p>
<div id="cell-fig-node-14-Vpp" class="cell" data-execution_count="60">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> V1_amp_list:</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    plt.plot(sweep_df[sweep_df[<span class="st">'V1amp'</span>] <span class="op">==</span> i][<span class="st">'Rgain'</span>].to_numpy(),sweep_df[sweep_df[<span class="st">'V1amp'</span>] <span class="op">==</span> i][<span class="st">'V14pp'</span>].to_numpy(),<span class="st">'-'</span>,label <span class="op">=</span> <span class="st">'V1=</span><span class="sc">{:.2f}</span><span class="st">'</span>.<span class="bu">format</span>(i))</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># position legend outside the graph</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.3</span>,<span class="dv">1</span>)) <span class="co"># V1 legend position: relative (horizontal position, vertical position) </span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'U1 output, Vpp'</span>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Rgain value, k</span><span class="ch">\u03A9</span><span class="st">'</span>)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>ax1.set_ylim((<span class="op">-</span><span class="fl">0.5</span>,<span class="dv">6</span>))</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Node 14 Vpp levels versus $R_</span><span class="sc">{gain}</span><span class="st">$ and $V1$'</span>)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="fig-node-14-vpp" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-node-14-vpp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Klon Centaur part 2v0_files/figure-html/fig-node-14-vpp-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-node-14-vpp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;26.4: Node 14 peak to peak voltage versus <span class="math inline">\(R_{gain}\)</span> and <span class="math inline">\(V1\)</span> input.
</figcaption>
</figure>
</div>
</div>
</div>
<p>As shown above, <span class="math inline">\(U_{1B}\)</span>, maximum output swing is about 6Vpp. This is because the power rails for <span class="math inline">\(U_1\)</span> are 0 and 9V and <span class="math inline">\(U_1\)</span> is not rail-to-rail capable. The SPICE model used for the TLO72 Op Amp reproduces the maximum output signal swing. If the gain pot, <span class="math inline">\(P_1\)</span> is set midpoint, signal inputs greater than 0.75V will drive U1B’s output into saturation as shown on the red curve above. This likely means that for mid range gain settings and loud guitar inputs, the guitar signal is first clipped by <span class="math inline">\(U_{1B}\)</span> and then again by the diodes. Any large harmonics generated by <span class="math inline">\(U_{1B}\)</span> will be mostly altered by <span class="math inline">\(D_2\)</span> and <span class="math inline">\(D_3\)</span>.</p>
</section>
<section id="guitar-output-signal-levels" class="level3" data-number="26.3.2">
<h3 data-number="26.3.2" class="anchored" data-anchor-id="guitar-output-signal-levels"><span class="header-section-number">26.3.2</span> Guitar Output Signal Levels</h3>
<p>Since I don’t own a guitar and I’m not a guitar player, I searched online to find typical guitar signal levels. Various references such as <a href="https://instrumentinsight.com/how-many-volts-does-an-electric-guitar-output/">Electric Guitar Output</a> and <a href="https://tomsguitarprojects.blogspot.com/2014/12/electric-guitar-output-voltage-levels.html">Electric Guitar Output Voltage Levels</a> placed the guitar output level in the range of 15<span class="math inline">\(\mu\)</span>V to 740mV depending on playing style, string gauge and pickup type.</p>
<p>The reference, <a href="https://www.sound-au.com/articles/guitar-voltage.htm">Guitar &amp; Bass Pickup Output Voltages</a>, provided the following table with comments:</p>
<div id="tbl-pickup-output-voltage1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-pickup-output-voltage1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;26.2: Pickup Output Voltage - Averaged RMS (Peak)
</figcaption>
<div aria-describedby="tbl-pickup-output-voltage1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<thead>
<tr class="header">
<th>Modified Maton</th>
<th>Neck (2.0kΩ)</th>
<th>Middle (N/A)</th>
<th>Bridge (2.0kΩ)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>E1</td>
<td>40 mV (150mV)</td>
<td></td>
<td>32 mV (200mV)</td>
</tr>
<tr class="even">
<td>E2</td>
<td>12 mV (120mV)</td>
<td></td>
<td>20 mV (300mV)</td>
</tr>
<tr class="odd">
<td>Chord</td>
<td>36 mV (200mV)</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>Average</td>
<td>29 mV (156 mV)</td>
<td></td>
<td>29 mV (267 mV)</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<div id="tbl-pickup-output-voltage1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-pickup-output-voltage1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;26.3: More Pickup Output Voltages
</figcaption>
<div aria-describedby="tbl-pickup-output-voltage1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Samick ‘TV Twenty’</th>
<th>Neck (11.5kΩ)</th>
<th>Middle (11.3kΩ)</th>
<th>Bridge (15.3kΩ)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>E1</td>
<td>44 mV (250mV)</td>
<td>76 mV (300 mV)</td>
<td>120 mV (800 mV)</td>
</tr>
<tr class="even">
<td>E2</td>
<td>12 mV (50 mV)</td>
<td>12 mV (159 mV)</td>
<td>16 mV (200 mV)</td>
</tr>
<tr class="odd">
<td>Chord</td>
<td>76 mV (450 mV)</td>
<td>72 mV (400 mV)</td>
<td>128 mV (850 mV)</td>
</tr>
<tr class="even">
<td>Average</td>
<td>44 mV (250 mV)</td>
<td>53 mV (283 mV)</td>
<td>88 mV (617 mV)</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<blockquote class="blockquote">
<p>Tabulated results aren’t especially useful, for the simple reason that there will be huge variations due to playing style, and what’s being played. However, I did summarize the results. All numbers are millivolts (RMS) taken from the scope captures shown below. I didn’t include the bass, only the two guitars. Note that I use light gauge strings, and you will get more level with thicker ones. I don’t have a set for comparison, but I’d expect that you could get at least 6dB (×2) more when played hard. The pickup resistance is also shown in the table, not because it’s especially useful on its own, but you can make comparisons. It includes the parallel resistance of the volume control, as I didn’t feel like dismantling my guitars for a more accurate measurement.</p>
</blockquote>
<p>So it would seem possible that when playing chords, some relatively high signal levels are produced by the guitar and that saturation of <span class="math inline">\(U_{1B}\)</span>’s output is likely. It seems likely to me that over driving <span class="math inline">\(U_{1B}\)</span> was a design oversight since the tone of the pedal is claimed to emanate from the hand selected Germanium diodes.</p>
</section>
</section>
<section id="sinusoidal-input" class="level2" data-number="26.4">
<h2 data-number="26.4" class="anchored" data-anchor-id="sinusoidal-input"><span class="header-section-number">26.4</span> Sinusoidal Input</h2>
<p>In this section the transient analysis simulation results from LTSpice for the voltages at the diodes, <span class="math inline">\(v_{17}\)</span>, is examined by using NumPy and SciPy functions. The input stimulus to the Klon Centaur circuit is a 1kHz sine wave. The LTSpice simulation was run with various gain settings and input amplitude values.</p>
<p>A new Pandas data frame is declared with the column names shown below. In this dataframe the node voltage versus time is tabulated for each input level and gain setting.</p>
<div id="48cbe5be-6704-4368-92d9-d8952493979d" class="cell" data-execution_count="61">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>td_node_voltage_df <span class="op">=</span> pd.DataFrame(columns<span class="op">=</span>[<span class="st">'V1amp'</span>,<span class="st">'Rgain'</span>,<span class="st">'time'</span>,<span class="st">'V7'</span>,<span class="st">'V14'</span>,<span class="st">'V17'</span>,<span class="st">'V19'</span>,<span class="st">'V21'</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Data is loaded into the new dataframe with the following code.</p>
<div id="1bf3fbec-9b2e-44ca-8592-fbf8eebe6687" class="cell" data-execution_count="62">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="bu">len</span>(step_index)):</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">#</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    row_elements <span class="op">=</span> LTSpice_sweep_df[<span class="st">'time'</span>][step_index[i]].split()</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># convert the units of 'K' and 'm' to float</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    Rgain_str <span class="op">=</span> row_elements[<span class="dv">3</span>][<span class="dv">6</span>:]</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    Rgain_value <span class="op">=</span> <span class="bu">float</span>(Rgain_str.replace(<span class="st">'K'</span>, <span class="st">'e3'</span>))</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    Rgain_percent <span class="op">=</span> Rgain_value<span class="op">/</span><span class="fl">100e3</span><span class="op">*</span><span class="dv">100</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    V1_amp_str <span class="op">=</span> row_elements[<span class="dv">2</span>][<span class="dv">7</span>:]</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    V1_amp_value <span class="op">=</span> <span class="bu">float</span>(V1_amp_str.replace(<span class="st">'m'</span>, <span class="st">'e-3'</span>))</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">#</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>        time_values <span class="op">=</span> LTSpice_sweep_df[<span class="st">'time'</span>][<span class="dv">1</span>:step_index[i<span class="op">+</span><span class="dv">1</span>]].to_numpy()</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>        v7_values <span class="op">=</span> LTSpice_sweep_df[<span class="st">'V(7)'</span>][<span class="dv">1</span>:step_index[i<span class="op">+</span><span class="dv">1</span>]].to_numpy()</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>        v14_values <span class="op">=</span> LTSpice_sweep_df[<span class="st">'V(14)'</span>][<span class="dv">1</span>:step_index[i<span class="op">+</span><span class="dv">1</span>]].to_numpy()</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>        v17_values <span class="op">=</span> LTSpice_sweep_df[<span class="st">'V(17)'</span>][<span class="dv">1</span>:step_index[i<span class="op">+</span><span class="dv">1</span>]].to_numpy()</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>        v19_values <span class="op">=</span> LTSpice_sweep_df[<span class="st">'V(19)'</span>][<span class="dv">1</span>:step_index[i<span class="op">+</span><span class="dv">1</span>]].to_numpy()</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>        v21_values <span class="op">=</span> LTSpice_sweep_df[<span class="st">'V(21)'</span>][<span class="dv">1</span>:step_index[i<span class="op">+</span><span class="dv">1</span>]].to_numpy()</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> (i <span class="op">!=</span> <span class="dv">0</span>) <span class="kw">and</span> (i <span class="op">&lt;</span> <span class="bu">len</span>(step_index)<span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>        time_values <span class="op">=</span> LTSpice_sweep_df[<span class="st">'time'</span>][step_index[i]<span class="op">+</span><span class="dv">1</span>:step_index[i<span class="op">+</span><span class="dv">1</span>]].to_numpy()</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>        v7_values <span class="op">=</span> LTSpice_sweep_df[<span class="st">'V(7)'</span>][step_index[i]<span class="op">+</span><span class="dv">1</span>:step_index[i<span class="op">+</span><span class="dv">1</span>]].to_numpy()</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>        v14_values <span class="op">=</span> LTSpice_sweep_df[<span class="st">'V(14)'</span>][step_index[i]<span class="op">+</span><span class="dv">1</span>:step_index[i<span class="op">+</span><span class="dv">1</span>]].to_numpy()</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>        v17_values <span class="op">=</span> LTSpice_sweep_df[<span class="st">'V(17)'</span>][step_index[i]<span class="op">+</span><span class="dv">1</span>:step_index[i<span class="op">+</span><span class="dv">1</span>]].to_numpy()</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>        v19_values <span class="op">=</span> LTSpice_sweep_df[<span class="st">'V(19)'</span>][step_index[i]<span class="op">+</span><span class="dv">1</span>:step_index[i<span class="op">+</span><span class="dv">1</span>]].to_numpy()</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>        v21_values <span class="op">=</span> LTSpice_sweep_df[<span class="st">'V(21)'</span>][step_index[i]<span class="op">+</span><span class="dv">1</span>:step_index[i<span class="op">+</span><span class="dv">1</span>]].to_numpy()</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>        time_values <span class="op">=</span> LTSpice_sweep_df[<span class="st">'time'</span>][step_index[i]<span class="op">+</span><span class="dv">1</span>:<span class="op">-</span><span class="dv">1</span>].to_numpy()</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>        v7_values <span class="op">=</span> LTSpice_sweep_df[<span class="st">'V(7)'</span>][step_index[i]<span class="op">+</span><span class="dv">1</span>:<span class="op">-</span><span class="dv">1</span>].to_numpy()</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>        v14_values <span class="op">=</span> LTSpice_sweep_df[<span class="st">'V(14)'</span>][step_index[i]<span class="op">+</span><span class="dv">1</span>:<span class="op">-</span><span class="dv">1</span>].to_numpy()</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>        v17_values <span class="op">=</span> LTSpice_sweep_df[<span class="st">'V(17)'</span>][step_index[i]<span class="op">+</span><span class="dv">1</span>:<span class="op">-</span><span class="dv">1</span>].to_numpy()</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>        v19_values <span class="op">=</span> LTSpice_sweep_df[<span class="st">'V(19)'</span>][step_index[i]<span class="op">+</span><span class="dv">1</span>:<span class="op">-</span><span class="dv">1</span>].to_numpy()</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>        v21_values <span class="op">=</span> LTSpice_sweep_df[<span class="st">'V(21)'</span>][step_index[i]<span class="op">+</span><span class="dv">1</span>:<span class="op">-</span><span class="dv">1</span>].to_numpy()</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># load values into new dataframe</span></span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>    td_node_voltage_df.loc[i] <span class="op">=</span> [V1_amp_value, Rgain_percent,time_values,v7_values,v14_values,v17_values,v19_values,v21_values]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The first five records in the dataframe are displayed below.</p>
<div id="5dbb878f-9703-4660-8b39-fde634906887" class="cell" data-execution_count="63">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>td_node_voltage_df.head(<span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="63">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">V1amp</th>
<th data-quarto-table-cell-role="th">Rgain</th>
<th data-quarto-table-cell-role="th">time</th>
<th data-quarto-table-cell-role="th">V7</th>
<th data-quarto-table-cell-role="th">V14</th>
<th data-quarto-table-cell-role="th">V17</th>
<th data-quarto-table-cell-role="th">V19</th>
<th data-quarto-table-cell-role="th">V21</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>0.10</td>
<td>0.001</td>
<td>[0, 1.25000001460762E-08, 2.50000002921524E-08...</td>
<td>[4.499977, 4.499977, 4.499977, 4.499977, 4.499...</td>
<td>[4.500065, 4.500065, 4.500065, 4.500065, 4.500...</td>
<td>[4.500011, 4.500011, 4.500011, 4.500011, 4.500...</td>
<td>[4.50035, 4.50035, 4.50035, 4.50035, 4.50035, ...</td>
<td>[4.499677, 4.499677, 4.499677, 4.499677, 4.499...</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>0.25</td>
<td>0.001</td>
<td>[0, 6.25000007303811E-09, 1.25000001460762E-08...</td>
<td>[4.499977, 4.499977, 4.499977, 4.499977, 4.499...</td>
<td>[4.500065, 4.500065, 4.500065, 4.500065, 4.500...</td>
<td>[4.500011, 4.500011, 4.500011, 4.500011, 4.500...</td>
<td>[4.50035, 4.50035, 4.50035, 4.50035, 4.50035, ...</td>
<td>[4.499677, 4.499677, 4.499677, 4.499677, 4.499...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>0.50</td>
<td>0.001</td>
<td>[0, 6.25000007303811E-09, 1.25000001460762E-08...</td>
<td>[4.499977, 4.499977, 4.499977, 4.499977, 4.499...</td>
<td>[4.500065, 4.500065, 4.500065, 4.500065, 4.500...</td>
<td>[4.500011, 4.500011, 4.500011, 4.500011, 4.500...</td>
<td>[4.50035, 4.50035, 4.50035, 4.50035, 4.50035, ...</td>
<td>[4.499677, 4.499677, 4.499677, 4.499677, 4.499...</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>0.75</td>
<td>0.001</td>
<td>[0, 6.25000007303811E-09, 1.25000001460762E-08...</td>
<td>[4.499977, 4.499977, 4.499977, 4.499977, 4.499...</td>
<td>[4.500065, 4.500065, 4.500065, 4.500065, 4.500...</td>
<td>[4.500011, 4.500011, 4.500011, 4.500011, 4.500...</td>
<td>[4.50035, 4.50035, 4.50035, 4.50035, 4.50035, ...</td>
<td>[4.499677, 4.499677, 4.499677, 4.499677, 4.499...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>1.00</td>
<td>0.001</td>
<td>[0, 6.25000007303811E-09, 1.25000001460762E-08...</td>
<td>[4.499977, 4.499977, 4.499977, 4.499977, 4.499...</td>
<td>[4.500065, 4.500065, 4.500065, 4.500065, 4.500...</td>
<td>[4.500011, 4.500011, 4.500011, 4.500011, 4.500...</td>
<td>[4.50035, 4.50035, 4.50035, 4.50035, 4.50035, ...</td>
<td>[4.499677, 4.499677, 4.499677, 4.499677, 4.499...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>At an offset of 127 in the dataframe, the gain setting is 60% and the input amplitude is 0.25 volts. This will produce a signal at the diodes a bit larger than the conduction threshold and the signal will be slightly voltage limited as shown in the plot below.</p>
<div id="11ecc3d5-82c3-4e87-9120-ee5e8a1764af" class="cell" data-execution_count="64">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>i<span class="op">=</span><span class="dv">127</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Node 17, voltage vs input level V1amp=</span><span class="sc">{:.3f}</span><span class="st">, Rgain=</span><span class="sc">{:.0f}</span><span class="st">'</span>.<span class="bu">format</span>(td_node_voltage_df.loc[i][<span class="st">'V1amp'</span>],td_node_voltage_df.loc[i][<span class="st">'Rgain'</span>]))</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>num_samples <span class="op">=</span> <span class="bu">len</span>(td_node_voltage_df.loc[i][<span class="st">'time'</span>])</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Number of samples in the simulation: </span><span class="sc">{</span>num_samples<span class="sc">:,d}</span><span class="ss">'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Node 17, voltage vs input level V1amp=0.250, Rgain=60
Number of samples in the simulation: 1,280</code></pre>
</div>
</div>
<p>The bias voltage of 4.5 has been subtracted from the values in the plot.</p>
<div id="cell-fig-node-17-voltage" class="cell" data-execution_count="65">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>plt.plot(np.asarray(td_node_voltage_df.loc[i][<span class="st">'time'</span>], dtype<span class="op">=</span><span class="bu">float</span>),</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>         np.asarray(td_node_voltage_df.loc[i][<span class="st">'V17'</span>], dtype<span class="op">=</span><span class="bu">float</span>) <span class="op">-</span> <span class="fl">4.5</span>,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>         <span class="st">'-'</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Node voltage, volts'</span>)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'time'</span>)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.grid()</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Node 17 voltage, offset removed'</span>)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="fig-node-17-voltage" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-node-17-voltage-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Klon Centaur part 2v0_files/figure-html/fig-node-17-voltage-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-node-17-voltage-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;26.5: Node 17, voltage at input level V1=0.25 and Rgain=60
</figcaption>
</figure>
</div>
</div>
</div>
<p>The plot above shows the voltage at node 17. Somewhat evident is the rounding of the peaks of the waveform.</p>
<p>LTSpice returns the node voltages versus time where the sample interval is not uniform. LTSpice varies the time step to aid in the solution convergence. By plotting time data versus sample number we can see in the plot below, the function is not a straight line, but somewhat stair cased.</p>
<div id="cell-fig-node_17_sample_interval" class="cell" data-execution_count="66">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>t_data <span class="op">=</span> np.asarray(td_node_voltage_df.loc[i][<span class="st">'time'</span>], dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>y_data <span class="op">=</span> np.asarray(td_node_voltage_df.loc[i][<span class="st">'V17'</span>], dtype<span class="op">=</span><span class="bu">float</span>) <span class="op">-</span> <span class="fl">4.5</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the data</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>plt.plot(t_data[<span class="dv">0</span>:<span class="dv">300</span>])</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'time samples'</span>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'time, sec'</span>)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Title'</span>)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="fig-node_17_sample_interval" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-node_17_sample_interval-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Klon Centaur part 2v0_files/figure-html/fig-node_17_sample_interval-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-node_17_sample_interval-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;26.6: Node 17, sample time plotted
</figcaption>
</figure>
</div>
</div>
</div>
<p>We can use NumPy’s function <a href="https://numpy.org/doc/stable/reference/generated/numpy.interp.html">interp</a> to resample the data so that the sample intervals are uniform.</p>
<div id="e02ce536-79a9-4502-b117-352144e51db3" class="cell" data-execution_count="67">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>stop_time <span class="op">=</span> <span class="fl">20e-3</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>xnew <span class="op">=</span> np.linspace(<span class="dv">0</span>, stop_time, <span class="bu">int</span>(<span class="bu">len</span>(t_data))) <span class="co">#np.linspace(0, 10, num=1001)</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>ynew <span class="op">=</span> np.interp(xnew, t_data, y_data)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The harmonic content of the signal plotted in <a href="#fig-node-17-voltage" class="quarto-xref">Figure&nbsp;<span>26.5</span></a> can be examined by the use of <a href="https://en.wikipedia.org/wiki/Fast_Fourier_transform">Fast Fourier transform (FFT)</a>. Since the simulation data ends abruptly, there is typically a non-zero value for the last data point in the simulation. A window function is typically used to minimize the “spectral leakage” associated with any discontinuities at the ends of the data set and helps to produce a more accurate representation of the signal’s true frequency content.</p>
<p>There are many <a href="https://en.wikipedia.org/wiki/Window_function">window functions</a> described in the signal processing literature. The window function used in this analysis is the <a href="https://en.wikipedia.org/wiki/Hann_function">Hann function</a> and implemented by the NumPy function <a href="https://numpy.org/doc/stable/reference/generated/numpy.hanning.html">hanning</a>. The Hann function is a taper formed by using a weighted cosine. The window is named after Julius von Hann, often referred to as Hanning. It is also known as the raised cosine, because of its similarity to a raised-cosine distribution.</p>
<p>The data, window and windowed data is plotted below.</p>
<div id="cell-fig-node-17-window-and-data" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;outputs_hidden&quot;:false}}" data-execution_count="68">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>fft_window <span class="op">=</span> np.hanning(<span class="bu">len</span>(xnew))</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>yw <span class="op">=</span> ynew<span class="op">*</span>fft_window</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the data</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>plt.plot(xnew,ynew)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>plt.plot(xnew ,yw)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>plt.plot(xnew,fft_window)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Time, sec'</span>)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Voltage, volts'</span>)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>plt.legend([<span class="st">'Node 17 voltage'</span>, <span class="st">'windowed data'</span>, <span class="st">'window function'</span>], loc<span class="op">=</span><span class="st">'best'</span>)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Title'</span>)</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="fig-node-17-window-and-data" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-node-17-window-and-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Klon Centaur part 2v0_files/figure-html/fig-node-17-window-and-data-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-node-17-window-and-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;26.7: Node 17 voltage, window and windowed data
</figcaption>
</figure>
</div>
</div>
</div>
<p>The plot above overlays the voltage at node 17, the window function and the windowed data.</p>
<p>The following code displays various parameters about the signal sample being analyzed.</p>
<div id="a734502e-8d67-427f-83a9-e1dff2a886f3" class="cell" data-execution_count="69">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>num_samples <span class="op">=</span> <span class="bu">len</span>(ynew)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'The number of samples is: </span><span class="sc">{</span>num_samples<span class="sc">:,.0f}</span><span class="ss">'</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>sps <span class="op">=</span> num_samples<span class="op">/</span>stop_time</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'The sample rate is: </span><span class="sc">{</span>sps<span class="sc">:,.0f}</span><span class="ss"> samples per second'</span>)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>nyquist_freq <span class="op">=</span> sps<span class="op">/</span><span class="dv">2</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'The Nyquist frequency: </span><span class="sc">{</span>nyquist_freq<span class="sc">:,.0f}</span><span class="ss"> Hz'</span>)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>dt <span class="op">=</span> stop_time<span class="op">/</span><span class="bu">len</span>(xnew)</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'The sample interval: </span><span class="sc">{</span>dt<span class="op">*</span><span class="fl">1e6</span><span class="sc">}</span><span class="ss"> </span><span class="ch">\u03BC</span><span class="ss">s'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>The number of samples is: 1,280
The sample rate is: 64,000 samples per second
The Nyquist frequency: 32,000 Hz
The sample interval: 15.625 μs</code></pre>
</div>
</div>
<p>The SciPy library includes functions to compute <a href="https://docs.scipy.org/doc/scipy/reference/fft.html">discrete Fourier transforms</a>, which are used in the code below to find the frequency components of the voltage at node 17. The SciPy function <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.fft.fft.html">fft</a> computes the one dimensional discrete Fourier Transform (DFT) using the Fast Fourier Transform (FFT) algorithm.</p>
<div id="ec8f0c0c-07b2-4659-a037-9db903fcf5f9" class="cell" data-execution_count="70">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>yw_fft <span class="op">=</span> scipy.fft.fft(yw)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The following code displays the frequency components of node 17 voltage. To display the amplitude spectrum in volts rms, take the two-sided amplitude amplitude spectrum and multiply the non-DC components by the square root of two and discard the second half of the array. The following equations show the calculations from a two-sided FFT to a single-sided amplitude spectrum.</p>
<div id="cell-fig-node_17_fft" class="cell" data-execution_count="71">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>yw_fft_ss <span class="op">=</span> yw_fft[<span class="dv">0</span>:<span class="bu">int</span>(num_samples<span class="op">/</span><span class="dv">2</span>)] <span class="co"># use lower half of the array</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>freq <span class="op">=</span> np.arange(<span class="bu">int</span>(num_samples<span class="op">/</span><span class="dv">2</span>))<span class="op">*</span>sps<span class="op">/</span>num_samples</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>k <span class="op">=</span> np.ones(<span class="bu">len</span>(freq)) <span class="co"># Scaling factor is sqrt(2) except for at DC when it is 1</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>k[<span class="dv">1</span>:] <span class="op">=</span> k[<span class="dv">1</span>:]<span class="op">*</span>sqrt(<span class="dv">2</span>)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>ywf_ss_Vrms_dB <span class="op">=</span> <span class="dv">20</span><span class="op">*</span>np.log10(<span class="bu">abs</span>(<span class="dv">2</span><span class="op">*</span>k<span class="op">*</span>yw_fft_ss<span class="op">/</span>num_samples)) <span class="co"># 2 is the Hann window correction factor</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>plt.plot(freq,ywf_ss_Vrms_dB)</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>plt.xlim(<span class="dv">0</span>,<span class="dv">10000</span>)</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>plt.ylim(<span class="op">-</span><span class="dv">100</span>,<span class="op">-</span><span class="dv">10</span>)</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'amplitude, dBVrms'</span>)</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'frequency, Hz'</span>)</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'FFT of the voltage at node 17'</span>)</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.legend(loc='best')</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="fig-node_17_fft" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-node_17_fft-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Klon Centaur part 2v0_files/figure-html/fig-node_17_fft-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-node_17_fft-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;26.8: Node 17, frequency spectrum.
</figcaption>
</figure>
</div>
</div>
</div>
<p>The frequency plot shows that odd harmonics are generated by the clipping action of the diodes.</p>
<p>Although LTSpice can calculate the FFT of voltages or currents, Python can also be used to display the simulation results and perform additional analysis. As shown above, node voltages and branch currents can be extracted from LTSpice and brought into JupyterLab.</p>
</section>
<section id="actual-signals" class="level2" data-number="26.5">
<h2 data-number="26.5" class="anchored" data-anchor-id="actual-signals"><span class="header-section-number">26.5</span> Actual Signals</h2>
<p>A useful feature of LTSpice is capability to use <em>wav</em> files as input signals to a circuit simulation. Actual guitar signals in the form of <em>wav</em> files were obtained from <a href="https://samplefocus.com/">Sample Focus</a>. The <em>wav</em> files are availabe under their <a href="https://samplefocus.com/license">Standard License</a> and are free to use. I chose the file <em>clean-electric-guitar-harmonic-reality.wav</em> since I thought it represented someting close to the type of signals that a player would run through their Klon Centaur.</p>
<p>A transient analysis was performed using the file <em>Klon-Centaur_v2_wavefile.asc</em> and the input source, V1, <em>wavefile = clean-electric-guitar-harmonic-reality.wav</em> was declared as the value of V1. The simulation output was written to a <em>wav</em> file with the directive, <em>.wave “klon_out.wav” 16 44.1k V(2)</em>. Using this file, the output of the circuit can be listened to on a computers audio player. The node voltages a several places were written to a <em>csv</em> file to be processed and plotted by Python in this notebook. The schematic includes a pre-amp labeled as U1. The gain as been set to unity, but other gains can be obtained by adjusting the values of resistors <span class="math inline">\(R_{19}\)</span> and <span class="math inline">\(R_{14}\)</span>.</p>
<p>The following Python modules are loaded into the JupyterLab environment in order to read <em>wav</em> files.</p>
<div id="3b1b45a6-481d-46b2-b2a4-95cd77320335" class="cell" data-execution_count="72">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.io <span class="im">import</span> wavfile</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy.io</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The simulation input file, <em>clean-electric-guitar-harmonic-reality.wav</em>, is loaded to the variable <em>wav_input</em>. The input file has two channels since it’s a stereo recording and these are the left and right channels. The length of the audio sample and the sample rate is displayed below.</p>
<div id="fc255d7c-0116-4336-98b9-c7eafe6e737d" class="cell" data-execution_count="73">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>samplerate_input, wav_input <span class="op">=</span> wavfile.read(<span class="st">'clean-electric-guitar-harmonic-reality.wav'</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>length_in <span class="op">=</span> wav_input.shape[<span class="dv">0</span>] <span class="op">/</span> samplerate_input</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"length = </span><span class="sc">{</span>length_in<span class="sc">}</span><span class="ss"> seconds"</span>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"sample rate = </span><span class="sc">{</span>samplerate_input<span class="sc">:,.0f}</span><span class="ss"> sps"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>length = 6.4 seconds
sample rate = 44,100 sps</code></pre>
</div>
</div>
<p>Since the wave file contains stereo data, each channel is extracted, but only channel 0 is displayed.</p>
<div id="84562097-eae8-47b8-a92c-a896a5fa8fbb" class="cell" data-execution_count="74">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># split the data in channels</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>chan0 <span class="op">=</span> np.zeros(<span class="bu">len</span>(wav_input))</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>chan1 <span class="op">=</span> np.zeros(<span class="bu">len</span>(wav_input))</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(wav_input)):</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    chan0[i] <span class="op">=</span>  wav_input[i][<span class="dv">0</span>]</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    chan1[i] <span class="op">=</span>  wav_input[i][<span class="dv">1</span>]    </span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>time <span class="op">=</span> np.linspace(<span class="dv">0</span>, length_in, <span class="bu">len</span>(wav_input))</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>plt.plot(time, chan0, label<span class="op">=</span><span class="st">"channel 0"</span>)</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Time [s]"</span>)</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Amplitude"</span>)</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Klon Centaur part 2v0_files/figure-html/cell-26-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>As you can see in the plot above, the input signal consists of five strums on the guitar. The amplitude of the signal in the plot above is the value of the 16 bit binary data. LTSpice converts the binary data to volts.</p>
<p>The following code reads the csv file saved after the simulation and places the data into a Python dataframe. Notice that the node voltage at <span class="math inline">\(v_{14}\)</span> has had the 4.5V offset removed.</p>
<div id="aeb8ce48-a5b2-43c7-92a4-e280d8e70de0" class="cell" data-execution_count="75">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>LTSpice_wavefile_df <span class="op">=</span> pd.read_csv(<span class="st">'wavefile_Vin.csv'</span>,delimiter<span class="op">=</span><span class="st">'</span><span class="ch">\t</span><span class="st">'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The first ten lines in the dataframe are:</p>
<div id="c88e02f1-e228-40f0-8ec9-a33b6d14666b" class="cell" data-execution_count="76">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>LTSpice_wavefile_df.head(<span class="dv">10</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="76">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">time</th>
<th data-quarto-table-cell-role="th">V(1)</th>
<th data-quarto-table-cell-role="th">V(2)</th>
<th data-quarto-table-cell-role="th">V(14)-4.5</th>
<th data-quarto-table-cell-role="th">V(16)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>0.000000</td>
<td>4.499921e-24</td>
<td>6.839725e-13</td>
<td>0.000218</td>
<td>7.566022e-13</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>0.000386</td>
<td>-3.242693e-07</td>
<td>-5.593652e-08</td>
<td>0.000217</td>
<td>-2.294244e-07</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>0.000392</td>
<td>-8.991888e-06</td>
<td>-2.135811e-06</td>
<td>0.000205</td>
<td>-1.153911e-05</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>0.000399</td>
<td>-1.766024e-05</td>
<td>-6.099190e-06</td>
<td>0.000190</td>
<td>-2.611201e-05</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>0.000405</td>
<td>-2.632934e-05</td>
<td>-1.194607e-05</td>
<td>0.000171</td>
<td>-4.394813e-05</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">5</th>
<td>0.000412</td>
<td>-3.499917e-05</td>
<td>-1.967646e-05</td>
<td>0.000149</td>
<td>-6.504747e-05</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">6</th>
<td>0.000418</td>
<td>-4.366974e-05</td>
<td>-2.929036e-05</td>
<td>0.000123</td>
<td>-8.941003e-05</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">7</th>
<td>0.000424</td>
<td>-5.234105e-05</td>
<td>-4.078776e-05</td>
<td>0.000094</td>
<td>-1.170358e-04</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">8</th>
<td>0.000431</td>
<td>-6.101310e-05</td>
<td>-5.416866e-05</td>
<td>0.000061</td>
<td>-1.479248e-04</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">9</th>
<td>0.000437</td>
<td>-7.730443e-05</td>
<td>-7.190395e-05</td>
<td>0.000018</td>
<td>-1.888111e-04</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The data is saved to several NumPy arrays to be processed and displayed using Python. Of interest are the input and output nodes, <span class="math inline">\(v_1\)</span> and <span class="math inline">\(v_2\)</span>, as well as the nodes <span class="math inline">\(v_{14}\)</span> and <span class="math inline">\(v_{16}\)</span>.</p>
<div id="879c13b4-3316-46af-988f-4a03cb568a87" class="cell" data-execution_count="77">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>t_data <span class="op">=</span> np.asarray(LTSpice_wavefile_df[<span class="st">'time'</span>], dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>v1_data <span class="op">=</span> np.asarray(LTSpice_wavefile_df[<span class="st">'V(1)'</span>], dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>v2_data <span class="op">=</span> np.asarray(LTSpice_wavefile_df[<span class="st">'V(2)'</span>], dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>v14_data <span class="op">=</span> np.asarray(LTSpice_wavefile_df[<span class="st">'V(14)-4.5'</span>], dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>v16_data <span class="op">=</span> np.asarray(LTSpice_wavefile_df[<span class="st">'V(16)'</span>], dtype<span class="op">=</span><span class="bu">float</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The following code plots the voltage at nodes <span class="math inline">\(v_1\)</span> and <span class="math inline">\(v_2\)</span>, which are the input and output nodes of the Klon Centaur. Only the first 54 ms or so is plotted.</p>
<div id="cell-fig-actual-signals-node-voltage-plot" class="cell" data-execution_count="78">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>start_index <span class="op">=</span> <span class="dv">3500</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>stop_index <span class="op">=</span> <span class="dv">10000</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>plt.plot(t_data[start_index:stop_index]<span class="op">*</span><span class="dv">1000</span>,v1_data[start_index:stop_index],<span class="st">'-r'</span>,label<span class="op">=</span><span class="st">'V1'</span>)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.plot(t_data[start_index:stop_index]*1000,v16_data[start_index:stop_index],'-',label='V16')</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.plot(t_data[start_index:stop_index]*1000,v14_data[start_index:stop_index],'-',label='V14')</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>plt.plot(t_data[start_index:stop_index]<span class="op">*</span><span class="dv">1000</span>,v2_data[start_index:stop_index],<span class="st">'-b'</span>,label<span class="op">=</span><span class="st">'V2'</span>)</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Node voltage, volts'</span>)</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'time,ms'</span>)</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'title'</span>)</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.legend(loc="lower right")</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.2</span>,<span class="dv">1</span>))</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="fig-actual-signals-node-voltage-plot" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-actual-signals-node-voltage-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Klon Centaur part 2v0_files/figure-html/fig-actual-signals-node-voltage-plot-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-actual-signals-node-voltage-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;26.9: Actual signals caption
</figcaption>
</figure>
</div>
</div>
</div>
<p>The plot above shows the pedal has some gain applied to the signal. The fundamental frequency appears the same, but the overall waveform is much different, as would be expected since the pedal is modifying the input signal with filtering and amplitude clipping by the diodes.</p>
<p>The plot below shows the voltage plots for node <span class="math inline">\(v_{14}\)</span>, the output terminal of <span class="math inline">\(U_{1B}\)</span> and <span class="math inline">\(v_{16}\)</span>, the voltage on <span class="math inline">\(D_2\)</span>.</p>
<div id="9ee514d8-bce5-4152-a201-31977ece918c" class="cell" data-execution_count="79">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>start_index <span class="op">=</span> <span class="dv">3500</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>stop_index <span class="op">=</span> <span class="dv">10000</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.plot(t_data[start_index:stop_index]*1000,v1_data[start_index:stop_index],'-',label='V1')</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>plt.plot(t_data[start_index:stop_index]<span class="op">*</span><span class="dv">1000</span>,v16_data[start_index:stop_index],<span class="st">'-k'</span>, linewidth<span class="op">=</span><span class="dv">1</span>, label<span class="op">=</span><span class="st">'V14'</span>)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>plt.plot(t_data[start_index:stop_index]<span class="op">*</span><span class="dv">1000</span>,v14_data[start_index:stop_index],<span class="st">'-r'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">'V16'</span>)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.plot(t_data[start_index:stop_index]*1000,v2_data[start_index:stop_index],'-',label='V2')</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Node voltage, volts'</span>)</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'time,ms'</span>)</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'title'</span>)</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.legend(loc="lower right")</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.2</span>,<span class="dv">1</span>))</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Klon Centaur part 2v0_files/figure-html/cell-31-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The plot above shows the amplitude limiting caused by the diodes on the signal.</p>
<p>From here additional numerical analysis of the node voltages can be performed within the JupyterLab notebook using the signal processing code of NumPy and SciPy. Python’s numerical analysis capability can be combined with circuit simulation results from LTSpice and actual physical measurements of prototype circuits to aid the designer in the analysis and development of electronic circuits.</p>
</section>
<section id="sec-Comparison_of_MNA_and_LTSpice_results" class="level2" data-number="26.6">
<h2 data-number="26.6" class="anchored" data-anchor-id="sec-Comparison_of_MNA_and_LTSpice_results"><span class="header-section-number">26.6</span> Comparison of MNA and LTSpice results</h2>
<p>In this section the solutions obtained from MNA and LTSpice will be compared to each other. As shown below the two solutions are very comparable which allows us to have a high degree of confidence in the accuracy of the MNA solution.</p>
<p>The netlist for the MNA solution was obtained from <a href="Klon Centaur part 1.html#fig-Klon-Centaur_sch" class="quarto-xref">Figure&nbsp;<span>25.3</span></a> and the schematic of <a href="#fig-Klon-Centaur_v2_sch" class="quarto-xref">Figure&nbsp;<span>26.1</span></a> was used for the LTSpice simulation. For the MNA solution, the diodes, <span class="math inline">\(D_2\)</span> and <span class="math inline">\(D_3\)</span> were removed from the netlist by inserting an asterisk at the start of those lines which turn the lines into comments, shown below. Additionally, the MNA netlist treats the Op Amps as ideal Op Amps. In the LTSpice simulation, device modules are used for the diodes and Op Amps. This will add some accuracy to the simulation. The amplitude of the input signal, <span class="math inline">\(V1\)</span>, in the LTSpice simulation was chosen to be <span class="math inline">\(\pm25 mV\)</span> in the transient simulations, so that the diodes would not be conducting. This keeps both the MNA and the LTSpice solutions in the linear domain.</p>
<p>The MNA solution is presented first, followed by loading and reading the exported LTSpice simulation results which were exported as a <em>csv</em> file. The two solutions are plotted on the same graph so that the results can be compared.</p>
<p>The netlist for the circuit in <a href="Klon Centaur part 1.html#fig-Klon-Centaur_sch" class="quarto-xref">Figure&nbsp;<span>25.3</span></a>, was exported and shown below.</p>
<div id="4840458f-3380-4e4b-9efd-80aab6f4bff8" class="cell" data-execution_count="80">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>net_list <span class="op">=</span> <span class="st">'''</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="st">* Klon-Centaur_v1.asc</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="st">V1 1 0 1</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="st">R1 3 1 10e3</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="st">R2 0 4 1000e3</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="st">C1 4 3 100e-9</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="st">R5 7 25 5.1e3</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="st">R8 25 0 1.5e3</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="st">C3 8 7 100e-9</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="st">C4 7 25 68e-9</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="st">C6 25 26 390e-9</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="st">R9 26 0 1e3</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="st">R6 9 8 10e3</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a><span class="st">C5 9 8 68e-9</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a><span class="st">Rp1b2 25 27 50e3</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a><span class="st">Rp1a2 27 0 50e3</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a><span class="st">Rp1b1 11 0 50e3</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a><span class="st">Rp1a1 0 9 50e3</span></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a><span class="st">R10 12 11 2e3</span></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a><span class="st">R11 13 12 15e3</span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a><span class="st">C7 13 12 82e-9</span></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a><span class="st">C8 14 13 390e-12</span></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a><span class="st">R12 14 13 422e3</span></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a><span class="st">R13 16 15 1e3</span></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a><span class="st">C11 17 28 2.2e-9</span></span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a><span class="st">R15 28 27 22e3</span></span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a><span class="st">R17 18 27 27e3</span></span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a><span class="st">R18 29 27 12e3</span></span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a><span class="st">C12 18 29 27e-9</span></span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a><span class="st">R16 18 17 47e3</span></span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a><span class="st">R7 8 10 1.5e3</span></span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a><span class="st">R24 18 10 15e3</span></span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a><span class="st">R20 19 18 392e3</span></span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a><span class="st">C13 19 18 820e-12</span></span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a><span class="st">R21 19 32 1.8e3</span></span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a><span class="st">R22 20 19 100e3</span></span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a><span class="st">Rp2a 32 30 5e3</span></span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a><span class="st">Rp2b 30 31 5e3</span></span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a><span class="st">C14 20 30 3.9e-9</span></span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a><span class="st">R241 21 20 100e3</span></span>
<span id="cb37-41"><a href="#cb37-41" aria-hidden="true" tabindex="-1"></a><span class="st">R25 23 22 560</span></span>
<span id="cb37-42"><a href="#cb37-42" aria-hidden="true" tabindex="-1"></a><span class="st">R23 21 31 4.7e3</span></span>
<span id="cb37-43"><a href="#cb37-43" aria-hidden="true" tabindex="-1"></a><span class="st">O1a 7 4 7</span></span>
<span id="cb37-44"><a href="#cb37-44" aria-hidden="true" tabindex="-1"></a><span class="st">O1b 13 9 14</span></span>
<span id="cb37-45"><a href="#cb37-45" aria-hidden="true" tabindex="-1"></a><span class="st">O2a 18 0 19</span></span>
<span id="cb37-46"><a href="#cb37-46" aria-hidden="true" tabindex="-1"></a><span class="st">O2b 20 0 21</span></span>
<span id="cb37-47"><a href="#cb37-47" aria-hidden="true" tabindex="-1"></a><span class="st">R3 5 0 100e3</span></span>
<span id="cb37-48"><a href="#cb37-48" aria-hidden="true" tabindex="-1"></a><span class="st">R4 6 5 560</span></span>
<span id="cb37-49"><a href="#cb37-49" aria-hidden="true" tabindex="-1"></a><span class="st">*D2 0 16 1N34A</span></span>
<span id="cb37-50"><a href="#cb37-50" aria-hidden="true" tabindex="-1"></a><span class="st">*D3 16 0 1N34A</span></span>
<span id="cb37-51"><a href="#cb37-51" aria-hidden="true" tabindex="-1"></a><span class="st">C2 7 5 4.7e-6</span></span>
<span id="cb37-52"><a href="#cb37-52" aria-hidden="true" tabindex="-1"></a><span class="st">C16 10 0 1e-6</span></span>
<span id="cb37-53"><a href="#cb37-53" aria-hidden="true" tabindex="-1"></a><span class="st">C9 14 15 1e-6</span></span>
<span id="cb37-54"><a href="#cb37-54" aria-hidden="true" tabindex="-1"></a><span class="st">C10 17 16 1e-6</span></span>
<span id="cb37-55"><a href="#cb37-55" aria-hidden="true" tabindex="-1"></a><span class="st">C15 21 22 4.7e-6</span></span>
<span id="cb37-56"><a href="#cb37-56" aria-hidden="true" tabindex="-1"></a><span class="st">R26 2 6 68e3</span></span>
<span id="cb37-57"><a href="#cb37-57" aria-hidden="true" tabindex="-1"></a><span class="st">R28 2 0 100e3</span></span>
<span id="cb37-58"><a href="#cb37-58" aria-hidden="true" tabindex="-1"></a><span class="st">Rp3a 23 24 50e3</span></span>
<span id="cb37-59"><a href="#cb37-59" aria-hidden="true" tabindex="-1"></a><span class="st">Rp3b 24 0 50e3</span></span>
<span id="cb37-60"><a href="#cb37-60" aria-hidden="true" tabindex="-1"></a><span class="st">R27 2 24 0.01</span></span>
<span id="cb37-61"><a href="#cb37-61" aria-hidden="true" tabindex="-1"></a><span class="st">'''</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The symbolic modified nodal analysis function is called with the netlist and the MNA results are returned.</p>
<div id="f8ec6071-fa33-455b-bb30-36d2c2e631ba" class="cell" data-execution_count="81">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>report, network_df, i_unk_df, A, X, Z <span class="op">=</span> SymMNA.smna(net_list)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The netlist report provides some statistics about the circuit, which are printed below.</p>
<div id="80c8a8eb-17d7-4498-915c-ec8f974c4dd0" class="cell" data-execution_count="82">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(report)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Net list report
number of lines in netlist: 56
number of branches: 52
number of nodes: 32
number of unknown currents: 5
number of RLC (passive components): 51
number of resistors: 35
number of capacitors: 16
number of inductors: 0
number of independent voltage sources: 1
number of independent current sources: 0
number of Op Amps: 4
number of E - VCVS: 0
number of G - VCCS: 0
number of F - CCCS: 0
number of H - CCVS: 0
number of K - Coupled inductors: 0
</code></pre>
</div>
</div>
<p>There are 32 nodes and 5 unknown currents in the circuit. This means that the MNA technique will generate a system of 37 equations for SymPy to solve.</p>
<p>The network equations are assembled with the following lines of Python code.</p>
<div id="ea44133c-ae93-4fcb-aa92-5dfc1c84cfb5" class="cell" data-execution_count="83">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Put matrices into SymPy </span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> Matrix(X)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>Z <span class="op">=</span> Matrix(Z)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>NE_sym <span class="op">=</span> Eq(A<span class="op">*</span>X,Z)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The system of equations is displayed with the following code using the markdown function.</p>
<div id="cd51e089-f617-4f1f-b335-c1d0983207fd" class="cell" data-execution_count="84">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># display the equations</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>temp <span class="op">=</span> <span class="st">''</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(shape(NE_sym.lhs)[<span class="dv">0</span>]):</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">+=</span> <span class="st">'$</span><span class="sc">{:s}</span><span class="st"> = </span><span class="sc">{:s}</span><span class="st">$&lt;br&gt;'</span>.<span class="bu">format</span>(latex(NE_sym.rhs[i]),latex(NE_sym.lhs[i]))</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>Markdown(temp)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="84">
<p><span class="math inline">\(0 = I_{V1} + \frac{v_{1}}{R_{1}} - \frac{v_{3}}{R_{1}}\)</span><br><span class="math inline">\(0 = v_{2} \cdot \left(\frac{1}{R_{28}} + \frac{1}{R_{27}} + \frac{1}{R_{26}}\right) - \frac{v_{24}}{R_{27}} - \frac{v_{6}}{R_{26}}\)</span><br><span class="math inline">\(0 = - C_{1} s v_{4} + v_{3} \left(C_{1} s + \frac{1}{R_{1}}\right) - \frac{v_{1}}{R_{1}}\)</span><br><span class="math inline">\(0 = - C_{1} s v_{3} + v_{4} \left(C_{1} s + \frac{1}{R_{2}}\right)\)</span><br><span class="math inline">\(0 = - C_{2} s v_{7} + v_{5} \left(C_{2} s + \frac{1}{R_{4}} + \frac{1}{R_{3}}\right) - \frac{v_{6}}{R_{4}}\)</span><br><span class="math inline">\(0 = v_{6} \cdot \left(\frac{1}{R_{4}} + \frac{1}{R_{26}}\right) - \frac{v_{5}}{R_{4}} - \frac{v_{2}}{R_{26}}\)</span><br><span class="math inline">\(0 = - C_{2} s v_{5} - C_{3} s v_{8} + I_{O1a} + v_{25} \left(- C_{4} s - \frac{1}{R_{5}}\right) + v_{7} \left(C_{2} s + C_{3} s + C_{4} s + \frac{1}{R_{5}}\right)\)</span><br><span class="math inline">\(0 = - C_{3} s v_{7} + v_{8} \left(C_{3} s + C_{5} s + \frac{1}{R_{7}} + \frac{1}{R_{6}}\right) + v_{9} \left(- C_{5} s - \frac{1}{R_{6}}\right) - \frac{v_{10}}{R_{7}}\)</span><br><span class="math inline">\(0 = v_{8} \left(- C_{5} s - \frac{1}{R_{6}}\right) + v_{9} \left(C_{5} s + \frac{1}{Rp1a1} + \frac{1}{R_{6}}\right)\)</span><br><span class="math inline">\(0 = v_{10} \left(C_{16} s + \frac{1}{R_{7}} + \frac{1}{R_{24}}\right) - \frac{v_{8}}{R_{7}} - \frac{v_{18}}{R_{24}}\)</span><br><span class="math inline">\(0 = v_{11} \cdot \left(\frac{1}{Rp1b1} + \frac{1}{R_{10}}\right) - \frac{v_{12}}{R_{10}}\)</span><br><span class="math inline">\(0 = v_{12} \left(C_{7} s + \frac{1}{R_{11}} + \frac{1}{R_{10}}\right) + v_{13} \left(- C_{7} s - \frac{1}{R_{11}}\right) - \frac{v_{11}}{R_{10}}\)</span><br><span class="math inline">\(0 = v_{12} \left(- C_{7} s - \frac{1}{R_{11}}\right) + v_{13} \left(C_{7} s + C_{8} s + \frac{1}{R_{12}} + \frac{1}{R_{11}}\right) + v_{14} \left(- C_{8} s - \frac{1}{R_{12}}\right)\)</span><br><span class="math inline">\(0 = - C_{9} s v_{15} + I_{O1b} + v_{13} \left(- C_{8} s - \frac{1}{R_{12}}\right) + v_{14} \left(C_{8} s + C_{9} s + \frac{1}{R_{12}}\right)\)</span><br><span class="math inline">\(0 = - C_{9} s v_{14} + v_{15} \left(C_{9} s + \frac{1}{R_{13}}\right) - \frac{v_{16}}{R_{13}}\)</span><br><span class="math inline">\(0 = - C_{10} s v_{17} + v_{16} \left(C_{10} s + \frac{1}{R_{13}}\right) - \frac{v_{15}}{R_{13}}\)</span><br><span class="math inline">\(0 = - C_{10} s v_{16} - C_{11} s v_{28} + v_{17} \left(C_{10} s + C_{11} s + \frac{1}{R_{16}}\right) - \frac{v_{18}}{R_{16}}\)</span><br><span class="math inline">\(0 = - C_{12} s v_{29} + v_{18} \left(C_{12} s + C_{13} s + \frac{1}{R_{24}} + \frac{1}{R_{20}} + \frac{1}{R_{17}} + \frac{1}{R_{16}}\right) + v_{19} \left(- C_{13} s - \frac{1}{R_{20}}\right) - \frac{v_{10}}{R_{24}} - \frac{v_{27}}{R_{17}} - \frac{v_{17}}{R_{16}}\)</span><br><span class="math inline">\(0 = I_{O2a} + v_{18} \left(- C_{13} s - \frac{1}{R_{20}}\right) + v_{19} \left(C_{13} s + \frac{1}{R_{22}} + \frac{1}{R_{21}} + \frac{1}{R_{20}}\right) - \frac{v_{20}}{R_{22}} - \frac{v_{32}}{R_{21}}\)</span><br><span class="math inline">\(0 = - C_{14} s v_{30} + v_{20} \left(C_{14} s + \frac{1}{R_{241}} + \frac{1}{R_{22}}\right) - \frac{v_{21}}{R_{241}} - \frac{v_{19}}{R_{22}}\)</span><br><span class="math inline">\(0 = - C_{15} s v_{22} + I_{O2b} + v_{21} \left(C_{15} s + \frac{1}{R_{241}} + \frac{1}{R_{23}}\right) - \frac{v_{20}}{R_{241}} - \frac{v_{31}}{R_{23}}\)</span><br><span class="math inline">\(0 = - C_{15} s v_{21} + v_{22} \left(C_{15} s + \frac{1}{R_{25}}\right) - \frac{v_{23}}{R_{25}}\)</span><br><span class="math inline">\(0 = v_{23} \cdot \left(\frac{1}{Rp3a} + \frac{1}{R_{25}}\right) - \frac{v_{24}}{Rp3a} - \frac{v_{22}}{R_{25}}\)</span><br><span class="math inline">\(0 = v_{24} \cdot \left(\frac{1}{Rp3b} + \frac{1}{Rp3a} + \frac{1}{R_{27}}\right) - \frac{v_{23}}{Rp3a} - \frac{v_{2}}{R_{27}}\)</span><br><span class="math inline">\(0 = - C_{6} s v_{26} + v_{25} \left(C_{4} s + C_{6} s + \frac{1}{Rp1b2} + \frac{1}{R_{8}} + \frac{1}{R_{5}}\right) + v_{7} \left(- C_{4} s - \frac{1}{R_{5}}\right) - \frac{v_{27}}{Rp1b2}\)</span><br><span class="math inline">\(0 = - C_{6} s v_{25} + v_{26} \left(C_{6} s + \frac{1}{R_{9}}\right)\)</span><br><span class="math inline">\(0 = v_{27} \cdot \left(\frac{1}{Rp1b2} + \frac{1}{Rp1a2} + \frac{1}{R_{18}} + \frac{1}{R_{17}} + \frac{1}{R_{15}}\right) - \frac{v_{25}}{Rp1b2} - \frac{v_{29}}{R_{18}} - \frac{v_{18}}{R_{17}} - \frac{v_{28}}{R_{15}}\)</span><br><span class="math inline">\(0 = - C_{11} s v_{17} + v_{28} \left(C_{11} s + \frac{1}{R_{15}}\right) - \frac{v_{27}}{R_{15}}\)</span><br><span class="math inline">\(0 = - C_{12} s v_{18} + v_{29} \left(C_{12} s + \frac{1}{R_{18}}\right) - \frac{v_{27}}{R_{18}}\)</span><br><span class="math inline">\(0 = - C_{14} s v_{20} + v_{30} \left(C_{14} s + \frac{1}{Rp2b} + \frac{1}{Rp2a}\right) - \frac{v_{31}}{Rp2b} - \frac{v_{32}}{Rp2a}\)</span><br><span class="math inline">\(0 = v_{31} \cdot \left(\frac{1}{Rp2b} + \frac{1}{R_{23}}\right) - \frac{v_{30}}{Rp2b} - \frac{v_{21}}{R_{23}}\)</span><br><span class="math inline">\(0 = v_{32} \cdot \left(\frac{1}{Rp2a} + \frac{1}{R_{21}}\right) - \frac{v_{30}}{Rp2a} - \frac{v_{19}}{R_{21}}\)</span><br><span class="math inline">\(V_{1} = v_{1}\)</span><br><span class="math inline">\(0 = - v_{4} + v_{7}\)</span><br><span class="math inline">\(0 = v_{13} - v_{9}\)</span><br><span class="math inline">\(0 = v_{18}\)</span><br><span class="math inline">\(0 = v_{20}\)</span><br></p>
</div>
</div>
<p>There are too many equations and symbols for SymPy to obtain a symbolic solution and symbolic results would not be useful.</p>
<p>The following code is used to turn the free symbols into SymPy variables and the numeric values for the components are put into a Python dictionary.</p>
<div id="89301ba1-9a10-4a70-b9bb-81f44c2a5f6c" class="cell" data-execution_count="85">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>var(<span class="bu">str</span>(NE_sym.free_symbols).replace(<span class="st">'{'</span>,<span class="st">''</span>).replace(<span class="st">'}'</span>,<span class="st">''</span>))</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>element_values <span class="op">=</span> SymMNA.get_part_values(network_df)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<section id="numerical-solution" class="level3" data-number="26.6.1">
<h3 data-number="26.6.1" class="anchored" data-anchor-id="numerical-solution"><span class="header-section-number">26.6.1</span> Numerical Solution</h3>
<p>As shown below, the value of <span class="math inline">\(V1\)</span> is set to one. The value of <span class="math inline">\(V1\)</span> gets canceled in the voltage transfer function, so this value does not affect the solution. The bypass switch is put into the effects position by setting the values of <span class="math inline">\(R_{26}\)</span> and <span class="math inline">\(R_{27}\)</span>. The controls on the Klon Centaur are set to mid position.</p>
<div id="ae3c5e10-5bc4-49f6-b9c1-23c1320835be" class="cell" data-execution_count="86">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>element_values[V1] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="co"># bypass switch in effects position</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>element_values[R26] <span class="op">=</span> <span class="fl">68e3</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>element_values[R27] <span class="op">=</span> <span class="fl">0.01</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="co"># gain pot, P1</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>P1_value <span class="op">=</span> <span class="fl">100e3</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>P1_setting <span class="op">=</span> <span class="fl">0.5</span> <span class="co"># a percent of full scale</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>element_values[Rp1b2] <span class="op">=</span> P1_setting<span class="op">*</span>P1_value</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>element_values[Rp1a2] <span class="op">=</span> P1_value <span class="op">-</span> P1_setting<span class="op">*</span>P1_value</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>element_values[Rp1b1] <span class="op">=</span> P1_setting<span class="op">*</span>P1_value</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>element_values[Rp1a1] <span class="op">=</span> P1_value <span class="op">-</span> P1_setting<span class="op">*</span>P1_value</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a><span class="co"># treble pot, P2</span></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>P2_value <span class="op">=</span> <span class="fl">10e3</span></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>P2_setting <span class="op">=</span> <span class="fl">0.5</span></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>element_values[Rp2b] <span class="op">=</span> P2_setting<span class="op">*</span>P2_value</span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>element_values[Rp2a] <span class="op">=</span> P2_value <span class="op">-</span> P2_setting<span class="op">*</span>P2_value</span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a><span class="co">#output pot, P3</span></span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>P3_value <span class="op">=</span> <span class="fl">100e3</span></span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>P3_setting <span class="op">=</span> <span class="fl">0.5</span></span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>element_values[Rp3b] <span class="op">=</span> P3_setting<span class="op">*</span>P3_value</span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a>element_values[Rp3a] <span class="op">=</span> P3_value <span class="op">-</span> P3_setting<span class="op">*</span>P3_value</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The following code replaces the symbols in the network equations with numerical values and displays the equations.</p>
<div id="ed6bb4ad-2d20-4d94-b4ee-db943a2cd633" class="cell" data-execution_count="87">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>NE <span class="op">=</span> NE_sym.subs(element_values)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>temp <span class="op">=</span> <span class="st">''</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(shape(NE.lhs)[<span class="dv">0</span>]):</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">+=</span> <span class="st">'$</span><span class="sc">{:s}</span><span class="st"> = </span><span class="sc">{:s}</span><span class="st">$&lt;br&gt;'</span>.<span class="bu">format</span>(latex(NE.rhs[i]),latex(NE.lhs[i]))</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>Markdown(temp)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="87">
<p><span class="math inline">\(0 = I_{V1} + 0.0001 v_{1} - 0.0001 v_{3}\)</span><br><span class="math inline">\(0 = 100.000024705882 v_{2} - 100.0 v_{24} - 1.47058823529412 \cdot 10^{-5} v_{6}\)</span><br><span class="math inline">\(0 = - 1.0 \cdot 10^{-7} s v_{4} - 0.0001 v_{1} + v_{3} \cdot \left(1.0 \cdot 10^{-7} s + 0.0001\right)\)</span><br><span class="math inline">\(0 = - 1.0 \cdot 10^{-7} s v_{3} + v_{4} \cdot \left(1.0 \cdot 10^{-7} s + 1.0 \cdot 10^{-6}\right)\)</span><br><span class="math inline">\(0 = - 4.7 \cdot 10^{-6} s v_{7} + v_{5} \cdot \left(4.7 \cdot 10^{-6} s + 0.00179571428571429\right) - 0.00178571428571429 v_{6}\)</span><br><span class="math inline">\(0 = - 1.47058823529412 \cdot 10^{-5} v_{2} - 0.00178571428571429 v_{5} + 0.00180042016806723 v_{6}\)</span><br><span class="math inline">\(0 = I_{O1a} - 4.7 \cdot 10^{-6} s v_{5} - 1.0 \cdot 10^{-7} s v_{8} + v_{25} \left(- 6.8 \cdot 10^{-8} s - 0.000196078431372549\right) + v_{7} \cdot \left(4.868 \cdot 10^{-6} s + 0.000196078431372549\right)\)</span><br><span class="math inline">\(0 = - 1.0 \cdot 10^{-7} s v_{7} - 0.000666666666666667 v_{10} + v_{8} \cdot \left(1.68 \cdot 10^{-7} s + 0.000766666666666667\right) + v_{9} \left(- 6.8 \cdot 10^{-8} s - 0.0001\right)\)</span><br><span class="math inline">\(0 = v_{8} \left(- 6.8 \cdot 10^{-8} s - 0.0001\right) + v_{9} \cdot \left(6.8 \cdot 10^{-8} s + 0.00012\right)\)</span><br><span class="math inline">\(0 = v_{10} \cdot \left(1.0 \cdot 10^{-6} s + 0.000733333333333333\right) - 6.66666666666667 \cdot 10^{-5} v_{18} - 0.000666666666666667 v_{8}\)</span><br><span class="math inline">\(0 = 0.00052 v_{11} - 0.0005 v_{12}\)</span><br><span class="math inline">\(0 = - 0.0005 v_{11} + v_{12} \cdot \left(8.2 \cdot 10^{-8} s + 0.000566666666666667\right) + v_{13} \left(- 8.2 \cdot 10^{-8} s - 6.66666666666667 \cdot 10^{-5}\right)\)</span><br><span class="math inline">\(0 = v_{12} \left(- 8.2 \cdot 10^{-8} s - 6.66666666666667 \cdot 10^{-5}\right) + v_{13} \cdot \left(8.239 \cdot 10^{-8} s + 6.90363349131122 \cdot 10^{-5}\right) + v_{14} \left(- 3.9 \cdot 10^{-10} s - 2.3696682464455 \cdot 10^{-6}\right)\)</span><br><span class="math inline">\(0 = I_{O1b} - 1.0 \cdot 10^{-6} s v_{15} + v_{13} \left(- 3.9 \cdot 10^{-10} s - 2.3696682464455 \cdot 10^{-6}\right) + v_{14} \cdot \left(1.00039 \cdot 10^{-6} s + 2.3696682464455 \cdot 10^{-6}\right)\)</span><br><span class="math inline">\(0 = - 1.0 \cdot 10^{-6} s v_{14} + v_{15} \cdot \left(1.0 \cdot 10^{-6} s + 0.001\right) - 0.001 v_{16}\)</span><br><span class="math inline">\(0 = - 1.0 \cdot 10^{-6} s v_{17} - 0.001 v_{15} + v_{16} \cdot \left(1.0 \cdot 10^{-6} s + 0.001\right)\)</span><br><span class="math inline">\(0 = - 1.0 \cdot 10^{-6} s v_{16} - 2.2 \cdot 10^{-9} s v_{28} + v_{17} \cdot \left(1.0022 \cdot 10^{-6} s + 2.12765957446809 \cdot 10^{-5}\right) - 2.12765957446809 \cdot 10^{-5} v_{18}\)</span><br><span class="math inline">\(0 = - 2.7 \cdot 10^{-8} s v_{29} - 6.66666666666667 \cdot 10^{-5} v_{10} - 2.12765957446809 \cdot 10^{-5} v_{17} + v_{18} \cdot \left(2.782 \cdot 10^{-8} s + 0.000127531319856548\right) + v_{19} \left(- 8.2 \cdot 10^{-10} s - 2.55102040816327 \cdot 10^{-6}\right) - 3.7037037037037 \cdot 10^{-5} v_{27}\)</span><br><span class="math inline">\(0 = I_{O2a} + v_{18} \left(- 8.2 \cdot 10^{-10} s - 2.55102040816327 \cdot 10^{-6}\right) + v_{19} \cdot \left(8.2 \cdot 10^{-10} s + 0.000568106575963719\right) - 1.0 \cdot 10^{-5} v_{20} - 0.000555555555555556 v_{32}\)</span><br><span class="math inline">\(0 = - 3.9 \cdot 10^{-9} s v_{30} - 1.0 \cdot 10^{-5} v_{19} + v_{20} \cdot \left(3.9 \cdot 10^{-9} s + 2.0 \cdot 10^{-5}\right) - 1.0 \cdot 10^{-5} v_{21}\)</span><br><span class="math inline">\(0 = I_{O2b} - 4.7 \cdot 10^{-6} s v_{22} - 1.0 \cdot 10^{-5} v_{20} + v_{21} \cdot \left(4.7 \cdot 10^{-6} s + 0.000222765957446809\right) - 0.000212765957446809 v_{31}\)</span><br><span class="math inline">\(0 = - 4.7 \cdot 10^{-6} s v_{21} + v_{22} \cdot \left(4.7 \cdot 10^{-6} s + 0.00178571428571429\right) - 0.00178571428571429 v_{23}\)</span><br><span class="math inline">\(0 = - 0.00178571428571429 v_{22} + 0.00180571428571429 v_{23} - 2.0 \cdot 10^{-5} v_{24}\)</span><br><span class="math inline">\(0 = - 100.0 v_{2} - 2.0 \cdot 10^{-5} v_{23} + 100.00004 v_{24}\)</span><br><span class="math inline">\(0 = - 3.9 \cdot 10^{-7} s v_{26} + v_{25} \cdot \left(4.58 \cdot 10^{-7} s + 0.000882745098039216\right) - 2.0 \cdot 10^{-5} v_{27} + v_{7} \left(- 6.8 \cdot 10^{-8} s - 0.000196078431372549\right)\)</span><br><span class="math inline">\(0 = - 3.9 \cdot 10^{-7} s v_{25} + v_{26} \cdot \left(3.9 \cdot 10^{-7} s + 0.001\right)\)</span><br><span class="math inline">\(0 = - 3.7037037037037 \cdot 10^{-5} v_{18} - 2.0 \cdot 10^{-5} v_{25} + 0.000205824915824916 v_{27} - 4.54545454545455 \cdot 10^{-5} v_{28} - 8.33333333333333 \cdot 10^{-5} v_{29}\)</span><br><span class="math inline">\(0 = - 2.2 \cdot 10^{-9} s v_{17} - 4.54545454545455 \cdot 10^{-5} v_{27} + v_{28} \cdot \left(2.2 \cdot 10^{-9} s + 4.54545454545455 \cdot 10^{-5}\right)\)</span><br><span class="math inline">\(0 = - 2.7 \cdot 10^{-8} s v_{18} - 8.33333333333333 \cdot 10^{-5} v_{27} + v_{29} \cdot \left(2.7 \cdot 10^{-8} s + 8.33333333333333 \cdot 10^{-5}\right)\)</span><br><span class="math inline">\(0 = - 3.9 \cdot 10^{-9} s v_{20} + v_{30} \cdot \left(3.9 \cdot 10^{-9} s + 0.0004\right) - 0.0002 v_{31} - 0.0002 v_{32}\)</span><br><span class="math inline">\(0 = - 0.000212765957446809 v_{21} - 0.0002 v_{30} + 0.000412765957446809 v_{31}\)</span><br><span class="math inline">\(0 = - 0.000555555555555556 v_{19} - 0.0002 v_{30} + 0.000755555555555556 v_{32}\)</span><br><span class="math inline">\(1 = v_{1}\)</span><br><span class="math inline">\(0 = - v_{4} + v_{7}\)</span><br><span class="math inline">\(0 = v_{13} - v_{9}\)</span><br><span class="math inline">\(0 = v_{18}\)</span><br><span class="math inline">\(0 = v_{20}\)</span><br></p>
</div>
</div>
<p>Solve for voltages and currents and display the results.</p>
<div id="a4f64d3b-2134-400c-b09e-0bed0d8bc130" class="cell" data-execution_count="88">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>U <span class="op">=</span> solve(NE,X)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>temp <span class="op">=</span> <span class="st">''</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> U.keys():</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">+=</span> <span class="st">'$</span><span class="sc">{:s}</span><span class="st"> = </span><span class="sc">{:s}</span><span class="st">$&lt;br&gt;'</span>.<span class="bu">format</span>(latex(i),latex(U[i]))</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>Markdown(temp)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="88">
<p><span class="math inline">\(v_{1} = 1.0\)</span><br><span class="math inline">\(v_{2} = \frac{1.60460486959839 \cdot 10^{204} s^{15} + 3.27859737275232 \cdot 10^{209} s^{14} + 2.24239224921523 \cdot 10^{214} s^{13} + 6.17846960611372 \cdot 10^{218} s^{12} + 6.98631389088568 \cdot 10^{222} s^{11} + 3.84144613823827 \cdot 10^{226} s^{10} + 1.14176089090876 \cdot 10^{230} s^{9} + 1.9487479169721 \cdot 10^{233} s^{8} + 1.9264469914375 \cdot 10^{236} s^{7} + 1.04007382786928 \cdot 10^{239} s^{6} + 2.4949612511751 \cdot 10^{241} s^{5} + 8.71156576910649 \cdot 10^{242} s^{4} + 1.59377116458413 \cdot 10^{244} s^{3} + 5.83569842526406 \cdot 10^{244} s^{2}}{7.15162708944972 \cdot 10^{204} s^{15} + 5.22082517544816 \cdot 10^{209} s^{14} + 1.46041562741045 \cdot 10^{214} s^{13} + 2.09213705503726 \cdot 10^{218} s^{12} + 1.72594223118152 \cdot 10^{222} s^{11} + 8.6526522592516 \cdot 10^{225} s^{10} + 2.69139767992792 \cdot 10^{229} s^{9} + 5.18883010414778 \cdot 10^{232} s^{8} + 6.05076928322552 \cdot 10^{235} s^{7} + 3.99892189278975 \cdot 10^{238} s^{6} + 1.28045462753876 \cdot 10^{241} s^{5} + 1.26937201271651 \cdot 10^{243} s^{4} + 4.49019318895868 \cdot 10^{244} s^{3} + 5.35281780941488 \cdot 10^{245} s^{2} + 2.32475885320685 \cdot 10^{246} s + 3.10810663331814 \cdot 10^{246}}\)</span><br><span class="math inline">\(v_{3} = \frac{100.0 s + 1000.0}{101.0 s + 1000.0}\)</span><br><span class="math inline">\(v_{4} = \frac{100.0 s}{101.0 s + 1000.0}\)</span><br><span class="math inline">\(v_{5} = \frac{7.08081890044526 \cdot 10^{204} s^{15} + 5.16811216386491 \cdot 10^{209} s^{14} + 1.44527574255849 \cdot 10^{214} s^{13} + 2.06993156176013 \cdot 10^{218} s^{12} + 1.70763881138264 \cdot 10^{222} s^{11} + 8.56283170735283 \cdot 10^{225} s^{10} + 2.66372688771691 \cdot 10^{229} s^{9} + 5.13265459135094 \cdot 10^{232} s^{8} + 5.97388273658386 \cdot 10^{235} s^{7} + 3.92904920853072 \cdot 10^{238} s^{6} + 1.24088217015922 \cdot 10^{241} s^{5} + 1.14762193670536 \cdot 10^{243} s^{4} + 2.99189745426633 \cdot 10^{244} s^{3} + 9.40378060745908 \cdot 10^{244} s^{2}}{7.15162708944972 \cdot 10^{204} s^{15} + 5.22082517544816 \cdot 10^{209} s^{14} + 1.46041562741045 \cdot 10^{214} s^{13} + 2.09213705503726 \cdot 10^{218} s^{12} + 1.72594223118152 \cdot 10^{222} s^{11} + 8.6526522592516 \cdot 10^{225} s^{10} + 2.69139767992792 \cdot 10^{229} s^{9} + 5.18883010414778 \cdot 10^{232} s^{8} + 6.05076928322552 \cdot 10^{235} s^{7} + 3.99892189278975 \cdot 10^{238} s^{6} + 1.28045462753876 \cdot 10^{241} s^{5} + 1.26937201271651 \cdot 10^{243} s^{4} + 4.49019318895868 \cdot 10^{244} s^{3} + 5.35281780941488 \cdot 10^{245} s^{2} + 2.32475885320685 \cdot 10^{246} s + 3.10810663331814 \cdot 10^{246}}\)</span><br><span class="math inline">\(v_{6} = \frac{7.03608903088174 \cdot 10^{204} s^{15} + 5.15267855413586 \cdot 10^{209} s^{14} + 1.45178661250784 \cdot 10^{214} s^{13} + 2.10349021556464 \cdot 10^{218} s^{12} + 1.75075517725956 \cdot 10^{222} s^{11} + 8.80666065452342 \cdot 10^{225} s^{10} + 2.73522884121702 \cdot 10^{229} s^{9} + 5.24990520050914 \cdot 10^{232} s^{8} + 6.08244062485052 \cdot 10^{235} s^{7} + 3.9819101460933 \cdot 10^{238} s^{6} + 1.25112552321302 \cdot 10^{241} s^{5} + 1.14536375990424 \cdot 10^{243} s^{4} + 2.98047751957814 \cdot 10^{244} s^{3} + 9.37463641227194 \cdot 10^{244} s^{2}}{7.15162708944972 \cdot 10^{204} s^{15} + 5.22082517544816 \cdot 10^{209} s^{14} + 1.46041562741045 \cdot 10^{214} s^{13} + 2.09213705503726 \cdot 10^{218} s^{12} + 1.72594223118152 \cdot 10^{222} s^{11} + 8.6526522592516 \cdot 10^{225} s^{10} + 2.69139767992792 \cdot 10^{229} s^{9} + 5.18883010414778 \cdot 10^{232} s^{8} + 6.05076928322552 \cdot 10^{235} s^{7} + 3.99892189278975 \cdot 10^{238} s^{6} + 1.28045462753876 \cdot 10^{241} s^{5} + 1.26937201271651 \cdot 10^{243} s^{4} + 4.49019318895868 \cdot 10^{244} s^{3} + 5.35281780941488 \cdot 10^{245} s^{2} + 2.32475885320685 \cdot 10^{246} s + 3.10810663331814 \cdot 10^{246}}\)</span><br><span class="math inline">\(v_{7} = \frac{100.0 s}{101.0 s + 1000.0}\)</span><br><span class="math inline">\(v_{8} = \frac{1.53 \cdot 10^{27} s^{4} + 3.822 \cdot 10^{30} s^{3} + 1.98 \cdot 10^{33} s^{2}}{1.5453 \cdot 10^{27} s^{4} + 1.448658 \cdot 10^{31} s^{3} + 2.1691024 \cdot 10^{34} s^{2} + 1.758644 \cdot 10^{36} s + 1.53 \cdot 10^{37}}\)</span><br><span class="math inline">\(v_{9} = \frac{1.53 \cdot 10^{27} s^{4} + 3.372 \cdot 10^{30} s^{3} + 1.65 \cdot 10^{33} s^{2}}{1.5453 \cdot 10^{27} s^{4} + 1.448658 \cdot 10^{31} s^{3} + 2.1691024 \cdot 10^{34} s^{2} + 1.758644 \cdot 10^{36} s + 1.53 \cdot 10^{37}}\)</span><br><span class="math inline">\(v_{10} = \frac{1.02 \cdot 10^{30} s^{3} + 1.8 \cdot 10^{33} s^{2}}{1.5453 \cdot 10^{27} s^{4} + 1.448658 \cdot 10^{31} s^{3} + 2.1691024 \cdot 10^{34} s^{2} + 1.758644 \cdot 10^{36} s + 1.53 \cdot 10^{37}}\)</span><br><span class="math inline">\(v_{11} = \frac{1.56825 \cdot 10^{39} s^{5} + 4.7313 \cdot 10^{42} s^{4} + 4.50125 \cdot 10^{45} s^{3} + 1.375 \cdot 10^{48} s^{2}}{1.6472898 \cdot 10^{39} s^{5} + 1.716827928 \cdot 10^{43} s^{4} + 3.92993125840001 \cdot 10^{46} s^{3} + 2.60963579706668 \cdot 10^{49} s^{2} + 1.98012893333334 \cdot 10^{51} s + 1.70850000000001 \cdot 10^{52}}\)</span><br><span class="math inline">\(v_{12} = \frac{1.63098 \cdot 10^{39} s^{5} + 4.920552 \cdot 10^{42} s^{4} + 4.6813 \cdot 10^{45} s^{3} + 1.43 \cdot 10^{48} s^{2}}{1.6472898 \cdot 10^{39} s^{5} + 1.716827928 \cdot 10^{43} s^{4} + 3.92993125840001 \cdot 10^{46} s^{3} + 2.60963579706668 \cdot 10^{49} s^{2} + 1.98012893333334 \cdot 10^{51} s + 1.70850000000001 \cdot 10^{52}}\)</span><br><span class="math inline">\(v_{13} = \frac{1.53 \cdot 10^{27} s^{4} + 3.372 \cdot 10^{30} s^{3} + 1.65 \cdot 10^{33} s^{2}}{1.5453 \cdot 10^{27} s^{4} + 1.448658 \cdot 10^{31} s^{3} + 2.1691024 \cdot 10^{34} s^{2} + 1.758644 \cdot 10^{36} s + 1.53 \cdot 10^{37}}\)</span><br><span class="math inline">\(v_{14} = \frac{1.2721644 \cdot 10^{48} s^{6} + 7.45961435931766 \cdot 10^{52} s^{5} + 2.18693901867302 \cdot 10^{56} s^{4} + 2.07668666587681 \cdot 10^{59} s^{3} + 6.37322274881527 \cdot 10^{61} s^{2}}{1.284886044 \cdot 10^{48} s^{6} + 2.11983185019071 \cdot 10^{52} s^{5} + 1.12019716327369 \cdot 10^{56} s^{4} + 2.06607825492002 \cdot 10^{59} s^{3} + 1.25223922229928 \cdot 10^{62} s^{2} + 9.39782361437604 \cdot 10^{63} s + 8.09715639810431 \cdot 10^{64}}\)</span><br><span class="math inline">\(v_{15} = \frac{6.12932264586913 \cdot 10^{102} s^{11} + 6.51555635737714 \cdot 10^{107} s^{10} + 2.17603109429572 \cdot 10^{112} s^{9} + 2.68844248892112 \cdot 10^{116} s^{8} + 1.13053821227643 \cdot 10^{120} s^{7} + 2.23994746250022 \cdot 10^{123} s^{6} + 2.30739995895308 \cdot 10^{126} s^{5} + 1.20420010870915 \cdot 10^{129} s^{4} + 2.58996550003362 \cdot 10^{131} s^{3} + 4.88678797757097 \cdot 10^{132} s^{2}}{6.19061587232783 \cdot 10^{102} s^{11} + 3.97511216027823 \cdot 10^{107} s^{10} + 9.03793448719941 \cdot 10^{111} s^{9} + 9.46160582014616 \cdot 10^{115} s^{8} + 5.02228017639945 \cdot 10^{119} s^{7} + 1.39853830638757 \cdot 10^{123} s^{6} + 2.09746585223746 \cdot 10^{126} s^{5} + 1.64529982131778 \cdot 10^{129} s^{4} + 5.85337403644487 \cdot 10^{131} s^{3} + 5.68067815391911 \cdot 10^{133} s^{2} + 1.75983146094313 \cdot 10^{135} s + 1.24078374816534 \cdot 10^{136}}\)</span><br><span class="math inline">\(v_{16} = \frac{5.82609631815901 \cdot 10^{102} s^{11} + 6.20459033050087 \cdot 10^{107} s^{10} + 2.08899742179437 \cdot 10^{112} s^{9} + 2.61237691738473 \cdot 10^{116} s^{8} + 1.1029219023253 \cdot 10^{120} s^{7} + 2.18945780465391 \cdot 10^{123} s^{6} + 2.25814621576051 \cdot 10^{126} s^{5} + 1.17971076699241 \cdot 10^{129} s^{4} + 2.54117204265127 \cdot 10^{131} s^{3} + 4.88678797757097 \cdot 10^{132} s^{2}}{6.19061587232783 \cdot 10^{102} s^{11} + 3.97511216027823 \cdot 10^{107} s^{10} + 9.03793448719941 \cdot 10^{111} s^{9} + 9.46160582014616 \cdot 10^{115} s^{8} + 5.02228017639945 \cdot 10^{119} s^{7} + 1.39853830638757 \cdot 10^{123} s^{6} + 2.09746585223746 \cdot 10^{126} s^{5} + 1.64529982131778 \cdot 10^{129} s^{4} + 5.85337403644487 \cdot 10^{131} s^{3} + 5.68067815391911 \cdot 10^{133} s^{2} + 1.75983146094313 \cdot 10^{135} s + 1.24078374816534 \cdot 10^{136}}\)</span><br><span class="math inline">\(v_{17} = \frac{5.82609631815901 \cdot 10^{102} s^{11} + 6.20155806722377 \cdot 10^{107} s^{10} + 2.08588776152561 \cdot 10^{112} s^{9} + 2.6036735501346 \cdot 10^{116} s^{8} + 1.09531534517166 \cdot 10^{120} s^{7} + 2.16184149470277 \cdot 10^{123} s^{6} + 2.2076565579142 \cdot 10^{126} s^{5} + 1.13045702379984 \cdot 10^{129} s^{4} + 2.2962786254839 \cdot 10^{131} s^{3} + 7.44223933649292 \cdot 10^{129} s^{2}}{6.19061587232783 \cdot 10^{102} s^{11} + 3.97511216027823 \cdot 10^{107} s^{10} + 9.03793448719941 \cdot 10^{111} s^{9} + 9.46160582014616 \cdot 10^{115} s^{8} + 5.02228017639945 \cdot 10^{119} s^{7} + 1.39853830638757 \cdot 10^{123} s^{6} + 2.09746585223746 \cdot 10^{126} s^{5} + 1.64529982131778 \cdot 10^{129} s^{4} + 5.85337403644487 \cdot 10^{131} s^{3} + 5.68067815391911 \cdot 10^{133} s^{2} + 1.75983146094313 \cdot 10^{135} s + 1.24078374816534 \cdot 10^{136}}\)</span><br><span class="math inline">\(v_{18} = 0.0\)</span><br><span class="math inline">\(v_{19} = \frac{- 7.729048460181 \cdot 10^{111} s^{11} - 6.70683975958242 \cdot 10^{116} s^{10} - 1.81971363059071 \cdot 10^{121} s^{9} - 1.67621479136811 \cdot 10^{125} s^{8} - 6.52036854696871 \cdot 10^{128} s^{7} - 1.29707240532995 \cdot 10^{132} s^{6} - 1.40520092072882 \cdot 10^{135} s^{5} - 7.99228974825901 \cdot 10^{137} s^{4} - 1.93754865846681 \cdot 10^{140} s^{3} - 4.5595739475291 \cdot 10^{141} s^{2} - 5.87797755461241 \cdot 10^{142} s}{1.11932525587559 \cdot 10^{107} s^{12} + 7.53562243981751 \cdot 10^{111} s^{11} + 1.85774899364618 \cdot 10^{116} s^{10} + 2.21913676324559 \cdot 10^{120} s^{9} + 1.44029380607801 \cdot 10^{124} s^{8} + 5.35372971100406 \cdot 10^{127} s^{7} + 1.16592059808606 \cdot 10^{131} s^{6} + 1.47731120257604 \cdot 10^{134} s^{5} + 1.03131600544421 \cdot 10^{137} s^{4} + 3.39523523720125 \cdot 10^{139} s^{3} + 3.22720097422481 \cdot 10^{141} s^{2} + 9.92148657875569 \cdot 10^{142} s + 6.97940858343004 \cdot 10^{143}}\)</span><br><span class="math inline">\(v_{20} = 0.0\)</span><br><span class="math inline">\(v_{21} = \frac{3.95481784029325 \cdot 10^{142} s^{12} + 3.59328293991187 \cdot 10^{147} s^{11} + 1.07126591160631 \cdot 10^{152} s^{10} + 1.2379488657562 \cdot 10^{156} s^{9} + 6.83908611414043 \cdot 10^{159} s^{8} + 2.02622810355854 \cdot 10^{163} s^{7} + 3.42946419411261 \cdot 10^{166} s^{6} + 3.34535147697467 \cdot 10^{169} s^{5} + 1.76926228708653 \cdot 10^{172} s^{4} + 4.0721594196483 \cdot 10^{174} s^{3} + 9.55806164763192 \cdot 10^{175} s^{2} + 1.22830078078907 \cdot 10^{177} s}{4.12410117110505 \cdot 10^{137} s^{13} + 3.0103661400075 \cdot 10^{142} s^{12} + 8.41948178298009 \cdot 10^{146} s^{11} + 1.20583791200201 \cdot 10^{151} s^{10} + 9.94394854727057 \cdot 10^{154} s^{9} + 4.98228898678412 \cdot 10^{158} s^{8} + 1.54832846094415 \cdot 10^{162} s^{7} + 2.98069258113566 \cdot 10^{165} s^{6} + 3.4670700029695 \cdot 10^{168} s^{5} + 2.28020147721265 \cdot 10^{171} s^{4} + 7.21381116019837 \cdot 10^{173} s^{3} + 6.78032628263838 \cdot 10^{175} s^{2} + 2.07583050373503 \cdot 10^{177} s + 1.4584630398505 \cdot 10^{178}}\)</span><br><span class="math inline">\(v_{22} = \frac{6.85813943594846 \cdot 10^{209} s^{14} + 6.23149200163213 \cdot 10^{214} s^{13} + 1.85798416714712 \cdot 10^{219} s^{12} + 2.14759495200953 \cdot 10^{223} s^{11} + 1.18695802863377 \cdot 10^{227} s^{10} + 3.51914477074802 \cdot 10^{230} s^{9} + 5.96321503551836 \cdot 10^{233} s^{8} + 5.82860517934846 \cdot 10^{236} s^{7} + 3.09491694101256 \cdot 10^{239} s^{6} + 7.20414774924852 \cdot 10^{241} s^{5} + 1.98864584585651 \cdot 10^{243} s^{4} + 2.98014618856633 \cdot 10^{244} s^{3} + 1.20559813397992 \cdot 10^{245} s^{2}}{7.15162708944972 \cdot 10^{204} s^{15} + 5.22082517544816 \cdot 10^{209} s^{14} + 1.46041562741045 \cdot 10^{214} s^{13} + 2.09213705503726 \cdot 10^{218} s^{12} + 1.72594223118152 \cdot 10^{222} s^{11} + 8.6526522592516 \cdot 10^{225} s^{10} + 2.69139767992792 \cdot 10^{229} s^{9} + 5.18883010414778 \cdot 10^{232} s^{8} + 6.05076928322552 \cdot 10^{235} s^{7} + 3.99892189278975 \cdot 10^{238} s^{6} + 1.28045462753876 \cdot 10^{241} s^{5} + 1.26937201271651 \cdot 10^{243} s^{4} + 4.49019318895868 \cdot 10^{244} s^{3} + 5.35281780941488 \cdot 10^{245} s^{2} + 2.32475885320685 \cdot 10^{246} s + 3.10810663331814 \cdot 10^{246}}\)</span><br><span class="math inline">\(v_{23} = \frac{1.7772515220219 \cdot 10^{202} s^{15} + 6.81849260987794 \cdot 10^{209} s^{14} + 6.18730893852549 \cdot 10^{214} s^{13} + 1.84424847158735 \cdot 10^{219} s^{12} + 2.13154630657843 \cdot 10^{223} s^{11} + 1.17806610880784 \cdot 10^{227} s^{10} + 3.49281298994759 \cdot 10^{230} s^{9} + 5.91875100545495 \cdot 10^{233} s^{8} + 5.78538507711761 \cdot 10^{236} s^{7} + 3.07215760493155 \cdot 10^{239} s^{6} + 7.15198904282505 \cdot 10^{241} s^{5} + 1.97626859181365 \cdot 10^{243} s^{4} + 2.96479076850346 \cdot 10^{244} s^{3} + 1.19870858018881 \cdot 10^{245} s^{2}}{7.15162708944972 \cdot 10^{204} s^{15} + 5.22082517544816 \cdot 10^{209} s^{14} + 1.46041562741045 \cdot 10^{214} s^{13} + 2.09213705503726 \cdot 10^{218} s^{12} + 1.72594223118152 \cdot 10^{222} s^{11} + 8.6526522592516 \cdot 10^{225} s^{10} + 2.69139767992792 \cdot 10^{229} s^{9} + 5.18883010414778 \cdot 10^{232} s^{8} + 6.05076928322552 \cdot 10^{235} s^{7} + 3.99892189278975 \cdot 10^{238} s^{6} + 1.28045462753876 \cdot 10^{241} s^{5} + 1.26937201271651 \cdot 10^{243} s^{4} + 4.49019318895868 \cdot 10^{244} s^{3} + 5.35281780941488 \cdot 10^{245} s^{2} + 2.32475885320685 \cdot 10^{246} s + 3.10810663331814 \cdot 10^{246}}\)</span><br><span class="math inline">\(v_{24} = \frac{1.6046042313112 \cdot 10^{204} s^{15} + 3.27859742501188 \cdot 10^{209} s^{14} + 2.24239258971998 \cdot 10^{214} s^{13} + 6.17847082322234 \cdot 10^{218} s^{12} + 6.98631535945215 \cdot 10^{222} s^{11} + 3.8414469577917 \cdot 10^{226} s^{10} + 1.1417611327669 \cdot 10^{230} s^{9} + 1.94874832122297 \cdot 10^{233} s^{8} + 1.92644737793556 \cdot 10^{236} s^{7} + 1.04007402627119 \cdot 10^{239} s^{6} + 2.49496168358823 \cdot 10^{241} s^{5} + 8.71156623701718 \cdot 10^{242} s^{4} + 1.59377112003383 \cdot 10^{244} s^{3} + 5.83569848840183 \cdot 10^{244} s^{2}}{7.15162708944972 \cdot 10^{204} s^{15} + 5.22082517544816 \cdot 10^{209} s^{14} + 1.46041562741045 \cdot 10^{214} s^{13} + 2.09213705503726 \cdot 10^{218} s^{12} + 1.72594223118152 \cdot 10^{222} s^{11} + 8.6526522592516 \cdot 10^{225} s^{10} + 2.69139767992792 \cdot 10^{229} s^{9} + 5.18883010414778 \cdot 10^{232} s^{8} + 6.05076928322552 \cdot 10^{235} s^{7} + 3.99892189278975 \cdot 10^{238} s^{6} + 1.28045462753876 \cdot 10^{241} s^{5} + 1.26937201271651 \cdot 10^{243} s^{4} + 4.49019318895868 \cdot 10^{244} s^{3} + 5.35281780941488 \cdot 10^{245} s^{2} + 2.32475885320685 \cdot 10^{246} s + 3.10810663331814 \cdot 10^{246}}\)</span><br><span class="math inline">\(v_{25} = \frac{2.45172905834765 \cdot 10^{103} s^{11} + 9.68148531052587 \cdot 10^{107} s^{10} + 1.4606354787583 \cdot 10^{112} s^{9} + 1.1118010386943 \cdot 10^{116} s^{8} + 4.74470229541557 \cdot 10^{119} s^{7} + 1.18318963185146 \cdot 10^{123} s^{6} + 1.71551739396071 \cdot 10^{126} s^{5} + 1.36079544612597 \cdot 10^{129} s^{4} + 4.9599835245097 \cdot 10^{131} s^{3} + 4.50843208510485 \cdot 10^{133} s^{2} + 1.10895177447563 \cdot 10^{135} s}{2.47624634893113 \cdot 10^{103} s^{11} + 1.59004486411129 \cdot 10^{108} s^{10} + 3.61517379487977 \cdot 10^{112} s^{9} + 3.78464232805846 \cdot 10^{116} s^{8} + 2.00891207055978 \cdot 10^{120} s^{7} + 5.59415322555028 \cdot 10^{123} s^{6} + 8.38986340894985 \cdot 10^{126} s^{5} + 6.58119928527113 \cdot 10^{129} s^{4} + 2.34134961457795 \cdot 10^{132} s^{3} + 2.27227126156765 \cdot 10^{134} s^{2} + 7.03932584377252 \cdot 10^{135} s + 4.96313499266136 \cdot 10^{136}}\)</span><br><span class="math inline">\(v_{26} = \frac{1.8859454294982 \cdot 10^{102} s^{11} + 6.96372064155883 \cdot 10^{106} s^{10} + 9.4500881336385 \cdot 10^{110} s^{9} + 6.12921616081805 \cdot 10^{114} s^{8} + 2.07817710908427 \cdot 10^{118} s^{7} + 3.77279945248749 \cdot 10^{121} s^{6} + 3.52244289588368 \cdot 10^{124} s^{5} + 1.43575241665188 \cdot 10^{127} s^{4} + 1.33955488977009 \cdot 10^{129} s^{3} + 3.3268553234269 \cdot 10^{130} s^{2}}{1.90480488379318 \cdot 10^{102} s^{11} + 1.22311143393176 \cdot 10^{107} s^{10} + 2.78090291913828 \cdot 10^{111} s^{9} + 2.91126332927574 \cdot 10^{115} s^{8} + 1.54531697735368 \cdot 10^{119} s^{7} + 4.30319478888483 \cdot 10^{122} s^{6} + 6.45374108380758 \cdot 10^{125} s^{5} + 5.0624609886701 \cdot 10^{128} s^{4} + 1.80103816505996 \cdot 10^{131} s^{3} + 1.74790097043665 \cdot 10^{133} s^{2} + 5.41486603367117 \cdot 10^{134} s + 3.81779614820105 \cdot 10^{135}}\)</span><br><span class="math inline">\(v_{27} = \frac{1.88222602341909 \cdot 10^{102} s^{11} + 1.44831320913199 \cdot 10^{107} s^{10} + 3.33801857194441 \cdot 10^{111} s^{9} + 2.10195340190251 \cdot 10^{115} s^{8} + 6.09908734298142 \cdot 10^{118} s^{7} + 1.03118401308102 \cdot 10^{122} s^{6} + 1.15158862697664 \cdot 10^{125} s^{5} + 8.34202083067121 \cdot 10^{127} s^{4} + 3.11019048617547 \cdot 10^{130} s^{3} + 2.89886444198637 \cdot 10^{132} s^{2} + 7.19752353626009 \cdot 10^{133} s}{6.19061587232783 \cdot 10^{102} s^{11} + 3.97511216027823 \cdot 10^{107} s^{10} + 9.03793448719941 \cdot 10^{111} s^{9} + 9.46160582014616 \cdot 10^{115} s^{8} + 5.02228017639945 \cdot 10^{119} s^{7} + 1.39853830638757 \cdot 10^{123} s^{6} + 2.09746585223746 \cdot 10^{126} s^{5} + 1.64529982131778 \cdot 10^{129} s^{4} + 5.85337403644487 \cdot 10^{131} s^{3} + 5.68067815391911 \cdot 10^{133} s^{2} + 1.75983146094313 \cdot 10^{135} s + 1.24078374816534 \cdot 10^{136}}\)</span><br><span class="math inline">\(v_{28} = \frac{5.82609631815901 \cdot 10^{102} s^{11} + 5.38670883277337 \cdot 10^{107} s^{10} + 1.27216965746747 \cdot 10^{112} s^{9} + 6.64897103289498 \cdot 10^{115} s^{8} + 1.55848892487266 \cdot 10^{119} s^{7} + 2.0196506789592 \cdot 10^{122} s^{6} + 1.65370058165892 \cdot 10^{125} s^{5} + 9.3035629828195 \cdot 10^{127} s^{4} + 3.09621286334538 \cdot 10^{130} s^{3} + 2.89538084059482 \cdot 10^{132} s^{2} + 7.19752353626009 \cdot 10^{133} s}{6.19061587232783 \cdot 10^{102} s^{11} + 3.97511216027823 \cdot 10^{107} s^{10} + 9.03793448719941 \cdot 10^{111} s^{9} + 9.46160582014616 \cdot 10^{115} s^{8} + 5.02228017639945 \cdot 10^{119} s^{7} + 1.39853830638757 \cdot 10^{123} s^{6} + 2.09746585223746 \cdot 10^{126} s^{5} + 1.64529982131778 \cdot 10^{129} s^{4} + 5.85337403644487 \cdot 10^{131} s^{3} + 5.68067815391911 \cdot 10^{133} s^{2} + 1.75983146094313 \cdot 10^{135} s + 1.24078374816534 \cdot 10^{136}}\)</span><br><span class="math inline">\(v_{29} = \frac{5.80933957845398 \cdot 10^{105} s^{10} + 4.29080189304769 \cdot 10^{110} s^{9} + 8.97820488469026 \cdot 10^{114} s^{8} + 3.71645960936262 \cdot 10^{118} s^{7} + 7.3537893012926 \cdot 10^{121} s^{6} + 9.12978651085666 \cdot 10^{124} s^{5} + 7.36450542873379 \cdot 10^{127} s^{4} + 3.01702284548585 \cdot 10^{130} s^{3} + 2.87554446572889 \cdot 10^{132} s^{2} + 7.19752353626009 \cdot 10^{133} s}{6.19061587232783 \cdot 10^{102} s^{11} + 3.97511216027823 \cdot 10^{107} s^{10} + 9.03793448719941 \cdot 10^{111} s^{9} + 9.46160582014616 \cdot 10^{115} s^{8} + 5.02228017639945 \cdot 10^{119} s^{7} + 1.39853830638757 \cdot 10^{123} s^{6} + 2.09746585223746 \cdot 10^{126} s^{5} + 1.64529982131778 \cdot 10^{129} s^{4} + 5.85337403644487 \cdot 10^{131} s^{3} + 5.68067815391911 \cdot 10^{133} s^{2} + 1.75983146094313 \cdot 10^{135} s + 1.24078374816534 \cdot 10^{136}}\)</span><br><span class="math inline">\(v_{30} = \frac{- 8.51604883530572 \cdot 10^{145} s^{11} - 7.38975505425107 \cdot 10^{150} s^{10} - 2.00500362033169 \cdot 10^{155} s^{9} - 1.84689319717609 \cdot 10^{159} s^{8} - 7.18429665129523 \cdot 10^{162} s^{7} - 1.42914512745319 \cdot 10^{166} s^{6} - 1.54828368925286 \cdot 10^{169} s^{5} - 8.80609432748894 \cdot 10^{171} s^{4} - 2.13483704770277 \cdot 10^{174} s^{3} - 5.02384667470906 \cdot 10^{175} s^{2} - 6.47649502597865 \cdot 10^{176} s}{1.23723035133151 \cdot 10^{138} s^{13} + 9.03109842002251 \cdot 10^{142} s^{12} + 2.52584453489403 \cdot 10^{147} s^{11} + 3.61751373600603 \cdot 10^{151} s^{10} + 2.98318456418117 \cdot 10^{155} s^{9} + 1.49468669603524 \cdot 10^{159} s^{8} + 4.64498538283244 \cdot 10^{162} s^{7} + 8.94207774340698 \cdot 10^{165} s^{6} + 1.04012100089085 \cdot 10^{169} s^{5} + 6.84060443163796 \cdot 10^{171} s^{4} + 2.16414334805951 \cdot 10^{174} s^{3} + 2.03409788479151 \cdot 10^{176} s^{2} + 6.22749151120508 \cdot 10^{177} s + 4.3753891195515 \cdot 10^{178}}\)</span><br><span class="math inline">\(v_{31} = \frac{6.11569769117515 \cdot 10^{142} s^{12} + 5.51535977354834 \cdot 10^{147} s^{11} + 1.62079074088092 \cdot 10^{152} s^{10} + 1.81720425616362 \cdot 10^{156} s^{9} + 9.68101996756486 \cdot 10^{159} s^{8} + 2.78523733270819 \cdot 10^{163} s^{7} + 4.61082276419168 \cdot 10^{166} s^{6} + 4.42302462011667 \cdot 10^{169} s^{5} + 2.3092855641627 \cdot 10^{172} s^{4} + 5.26274816190945 \cdot 10^{174} s^{3} + 1.23462727158089 \cdot 10^{176} s^{2} + 1.58562464429135 \cdot 10^{177} s}{1.23723035133151 \cdot 10^{138} s^{13} + 9.03109842002251 \cdot 10^{142} s^{12} + 2.52584453489403 \cdot 10^{147} s^{11} + 3.61751373600603 \cdot 10^{151} s^{10} + 2.98318456418117 \cdot 10^{155} s^{9} + 1.49468669603524 \cdot 10^{159} s^{8} + 4.64498538283244 \cdot 10^{162} s^{7} + 8.94207774340698 \cdot 10^{165} s^{6} + 1.04012100089085 \cdot 10^{169} s^{5} + 6.84060443163796 \cdot 10^{171} s^{4} + 2.16414334805951 \cdot 10^{174} s^{3} + 2.03409788479151 \cdot 10^{176} s^{2} + 6.22749151120508 \cdot 10^{177} s + 4.3753891195515 \cdot 10^{178}}\)</span><br><span class="math inline">\(v_{32} = \frac{- 2.09392021448787 \cdot 10^{142} s^{12} - 1.94326032460412 \cdot 10^{147} s^{11} - 6.02561137520802 \cdot 10^{151} s^{10} - 7.51406465858297 \cdot 10^{155} s^{9} - 4.5049667155391 \cdot 10^{159} s^{8} - 1.41665499765086 \cdot 10^{163} s^{7} - 2.4997681836795 \cdot 10^{166} s^{6} - 2.51225462752033 \cdot 10^{169} s^{5} - 1.35822245396784 \cdot 10^{172} s^{4} - 3.17780063580552 \cdot 10^{174} s^{3} - 7.46507632725237 \cdot 10^{175} s^{2} - 9.6030788316236 \cdot 10^{176} s}{4.12410117110505 \cdot 10^{137} s^{13} + 3.0103661400075 \cdot 10^{142} s^{12} + 8.41948178298009 \cdot 10^{146} s^{11} + 1.20583791200201 \cdot 10^{151} s^{10} + 9.94394854727057 \cdot 10^{154} s^{9} + 4.98228898678412 \cdot 10^{158} s^{8} + 1.54832846094415 \cdot 10^{162} s^{7} + 2.98069258113566 \cdot 10^{165} s^{6} + 3.4670700029695 \cdot 10^{168} s^{5} + 2.28020147721265 \cdot 10^{171} s^{4} + 7.21381116019837 \cdot 10^{173} s^{3} + 6.78032628263838 \cdot 10^{175} s^{2} + 2.07583050373503 \cdot 10^{177} s + 1.4584630398505 \cdot 10^{178}}\)</span><br><span class="math inline">\(I_{V1} = - \frac{s}{1010000.0 s + 10000000.0}\)</span><br><span class="math inline">\(I_{O1a} = \frac{- 2.70597410328679 \cdot 10^{219} s^{15} - 1.40952219736433 \cdot 10^{224} s^{14} - 2.89506196813579 \cdot 10^{228} s^{13} - 3.04164245258279 \cdot 10^{232} s^{12} - 1.83147809274918 \cdot 10^{236} s^{11} - 6.73574545204554 \cdot 10^{239} s^{10} - 1.5665738047603 \cdot 10^{243} s^{9} - 2.32141567625824 \cdot 10^{246} s^{8} - 2.14477529599212 \cdot 10^{249} s^{7} - 1.16030830949982 \cdot 10^{252} s^{6} - 3.18519845024456 \cdot 10^{254} s^{5} - 3.09847396565709 \cdot 10^{256} s^{4} - 8.94956428372171 \cdot 10^{257} s^{3} - 5.14067180787152 \cdot 10^{258} s^{2} - 7.57219841131285 \cdot 10^{258} s}{1.14426033431195 \cdot 10^{222} s^{15} + 8.35332028071706 \cdot 10^{226} s^{14} + 2.33666500385672 \cdot 10^{231} s^{13} + 3.34741928805962 \cdot 10^{235} s^{12} + 2.76150756989043 \cdot 10^{239} s^{11} + 1.38442436148026 \cdot 10^{243} s^{10} + 4.30623628788468 \cdot 10^{246} s^{9} + 8.30212816663644 \cdot 10^{249} s^{8} + 9.68123085316084 \cdot 10^{252} s^{7} + 6.3982750284636 \cdot 10^{255} s^{6} + 2.04872740406202 \cdot 10^{258} s^{5} + 2.03099522034642 \cdot 10^{260} s^{4} + 7.18430910233388 \cdot 10^{261} s^{3} + 8.56450849506381 \cdot 10^{262} s^{2} + 3.71961416513097 \cdot 10^{263} s + 4.97297061330902 \cdot 10^{263}}\)</span><br><span class="math inline">\(I_{O1b} = \frac{- 4.21097917053769 \cdot 10^{104} s^{11} - 3.77924980566261 \cdot 10^{109} s^{10} - 9.92997441757908 \cdot 10^{113} s^{9} - 8.50908134662235 \cdot 10^{117} s^{8} - 3.06757906646461 \cdot 10^{121} s^{7} - 5.59206863004313 \cdot 10^{124} s^{6} - 5.45154925766715 \cdot 10^{127} s^{5} - 2.71561053418032 \cdot 10^{130} s^{4} - 5.46266159572619 \cdot 10^{132} s^{3} - 1.99716435906042 \cdot 10^{133} s^{2}}{6.19061587232783 \cdot 10^{108} s^{11} + 3.97511216027823 \cdot 10^{113} s^{10} + 9.03793448719942 \cdot 10^{117} s^{9} + 9.46160582014616 \cdot 10^{121} s^{8} + 5.02228017639945 \cdot 10^{125} s^{7} + 1.39853830638757 \cdot 10^{129} s^{6} + 2.09746585223746 \cdot 10^{132} s^{5} + 1.64529982131778 \cdot 10^{135} s^{4} + 5.85337403644487 \cdot 10^{137} s^{3} + 5.68067815391911 \cdot 10^{139} s^{2} + 1.75983146094313 \cdot 10^{141} s + 1.24078374816534 \cdot 10^{142}}\)</span><br><span class="math inline">\(I_{O2a} = \frac{3.3626013454035 \cdot 10^{136} s^{13} + 9.65376563272377 \cdot 10^{141} s^{12} + 6.94781520560786 \cdot 10^{146} s^{11} + 1.92876721384856 \cdot 10^{151} s^{10} + 2.22164463155264 \cdot 10^{155} s^{9} + 1.24858671565291 \cdot 10^{159} s^{8} + 3.76102357261743 \cdot 10^{162} s^{7} + 6.4489486322457 \cdot 10^{165} s^{6} + 6.35343543582645 \cdot 10^{168} s^{5} + 3.38584747530741 \cdot 10^{171} s^{4} + 7.83854999479935 \cdot 10^{173} s^{3} + 1.8403929052726 \cdot 10^{175} s^{2} + 2.36593974661912 \cdot 10^{176} s}{5.93870568639127 \cdot 10^{140} s^{13} + 4.3349272416108 \cdot 10^{145} s^{12} + 1.21240537674913 \cdot 10^{150} s^{11} + 1.73640659328289 \cdot 10^{154} s^{10} + 1.43192859080696 \cdot 10^{158} s^{9} + 7.17449614096913 \cdot 10^{161} s^{8} + 2.22959298375957 \cdot 10^{165} s^{7} + 4.29219731683535 \cdot 10^{168} s^{6} + 4.99258080427609 \cdot 10^{171} s^{5} + 3.28349012718622 \cdot 10^{174} s^{4} + 1.03878880706857 \cdot 10^{177} s^{3} + 9.76366984699927 \cdot 10^{178} s^{2} + 2.98919592537844 \cdot 10^{180} s + 2.10018677738472 \cdot 10^{181}}\)</span><br><span class="math inline">\(I_{O2b} = \frac{2.03114459659645 \cdot 10^{202} s^{15} - 5.41693661192227 \cdot 10^{208} s^{14} - 5.04785253855921 \cdot 10^{213} s^{13} - 1.53008409272363 \cdot 10^{218} s^{12} - 1.81469537957374 \cdot 10^{222} s^{11} - 1.03167063298355 \cdot 10^{226} s^{10} - 3.12503707997176 \cdot 10^{229} s^{9} - 5.37863302316374 \cdot 10^{232} s^{8} - 5.31943071374497 \cdot 10^{235} s^{7} - 2.85232586842996 \cdot 10^{238} s^{6} - 6.71226680183562 \cdot 10^{240} s^{5} - 1.97687215290958 \cdot 10^{242} s^{4} - 3.0724877848804 \cdot 10^{243} s^{3} - 1.58099876055239 \cdot 10^{244} s^{2} - 2.1981591906048 \cdot 10^{244} s}{4.57704133724782 \cdot 10^{207} s^{15} + 3.34132811228682 \cdot 10^{212} s^{14} + 9.34666001542689 \cdot 10^{216} s^{13} + 1.33896771522385 \cdot 10^{221} s^{12} + 1.10460302795617 \cdot 10^{225} s^{11} + 5.53769744592102 \cdot 10^{228} s^{10} + 1.72249451515387 \cdot 10^{232} s^{9} + 3.32085126665458 \cdot 10^{235} s^{8} + 3.87249234126433 \cdot 10^{238} s^{7} + 2.55931001138544 \cdot 10^{241} s^{6} + 8.19490961624807 \cdot 10^{243} s^{5} + 8.12398088138566 \cdot 10^{245} s^{4} + 2.87372364093355 \cdot 10^{247} s^{3} + 3.42580339802553 \cdot 10^{248} s^{2} + 1.48784566605239 \cdot 10^{249} s + 1.98918824532361 \cdot 10^{249}}\)</span><br></p>
</div>
</div>
</section>
<section id="magnitude-and-phase-response" class="level3" data-number="26.6.2">
<h3 data-number="26.6.2" class="anchored" data-anchor-id="magnitude-and-phase-response"><span class="header-section-number">26.6.2</span> Magnitude and Phase Response</h3>
<p>The voltage transfer function, <span class="math inline">\(\frac{v2(s)}{v1(s)}\)</span>, is calculated below.</p>
<div id="cabcb1c9-8031-4548-80d0-c4ce5460af45" class="cell" data-execution_count="89">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>H <span class="op">=</span> U[v2]<span class="op">/</span>U[v1]</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>H</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="89">
<p><span class="math inline">\(\displaystyle \frac{1.0 \cdot \left(1.60460486959839 \cdot 10^{204} s^{15} + 3.27859737275232 \cdot 10^{209} s^{14} + 2.24239224921523 \cdot 10^{214} s^{13} + 6.17846960611372 \cdot 10^{218} s^{12} + 6.98631389088568 \cdot 10^{222} s^{11} + 3.84144613823827 \cdot 10^{226} s^{10} + 1.14176089090876 \cdot 10^{230} s^{9} + 1.9487479169721 \cdot 10^{233} s^{8} + 1.9264469914375 \cdot 10^{236} s^{7} + 1.04007382786928 \cdot 10^{239} s^{6} + 2.4949612511751 \cdot 10^{241} s^{5} + 8.71156576910649 \cdot 10^{242} s^{4} + 1.59377116458413 \cdot 10^{244} s^{3} + 5.83569842526406 \cdot 10^{244} s^{2}\right)}{7.15162708944972 \cdot 10^{204} s^{15} + 5.22082517544816 \cdot 10^{209} s^{14} + 1.46041562741045 \cdot 10^{214} s^{13} + 2.09213705503726 \cdot 10^{218} s^{12} + 1.72594223118152 \cdot 10^{222} s^{11} + 8.6526522592516 \cdot 10^{225} s^{10} + 2.69139767992792 \cdot 10^{229} s^{9} + 5.18883010414778 \cdot 10^{232} s^{8} + 6.05076928322552 \cdot 10^{235} s^{7} + 3.99892189278975 \cdot 10^{238} s^{6} + 1.28045462753876 \cdot 10^{241} s^{5} + 1.26937201271651 \cdot 10^{243} s^{4} + 4.49019318895868 \cdot 10^{244} s^{3} + 5.35281780941488 \cdot 10^{245} s^{2} + 2.32475885320685 \cdot 10^{246} s + 3.10810663331814 \cdot 10^{246}}\)</span></p>
</div>
</div>
<p>The SciPy function <code>bode</code> is used to calculate the magnitude and phase of the transfer function.</p>
<div id="b1dc4063-ecf6-4be0-9d29-922a751de5e4" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;outputs_hidden&quot;:false}}" data-execution_count="90">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>num, denom <span class="op">=</span> fraction(H) <span class="co">#returns numerator and denominator</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="co"># convert symbolic to NumPy polynomial</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> np.array(Poly(num, s).all_coeffs(), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> np.array(Poly(denom, s).all_coeffs(), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.logspace(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">2000</span>, endpoint<span class="op">=</span><span class="va">False</span>)<span class="op">*</span><span class="dv">2</span><span class="op">*</span>np.pi</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>w, mag, phase <span class="op">=</span> signal.bode((a, b), w<span class="op">=</span>x) <span class="co"># returns: rad/s, mag in dB, phase in deg</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Read the frequency response data from LTSpice so the LTSpice and Python results plots can be overlaid for comparison.</p>
<div id="e030440f-4e37-42bd-96c3-eaf4b8be4c44" class="cell" data-execution_count="91">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>fn <span class="op">=</span> <span class="st">'Klon-Centaur_v2_freq_resp.csv'</span> <span class="co"># data from LTSpice</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>LTSpice_data <span class="op">=</span> np.genfromtxt(fn, delimiter<span class="op">=</span><span class="st">','</span>,skip_header<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="co"># initaliaze some empty arrays</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>frequency <span class="op">=</span> np.zeros(<span class="bu">len</span>(LTSpice_data))</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>H_v2 <span class="op">=</span> np.zeros(<span class="bu">len</span>(LTSpice_data)).astype(<span class="bu">complex</span>)</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="co"># convert the csv data to complex numbers and store in the array</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(LTSpice_data)):</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>    frequency[i] <span class="op">=</span> LTSpice_data[i][<span class="dv">0</span>]</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>    H_v2[i] <span class="op">=</span> LTSpice_data[i][<span class="dv">1</span>] <span class="op">+</span> LTSpice_data[i][<span class="dv">2</span>]<span class="op">*</span><span class="ot">1j</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Plot the results using <code>np.unwrap(2 * phase) / 2)</code> to keep the phase plots the same.</p>
<div id="cell-fig-ltspice-mna-freq-plot" class="cell" data-execution_count="92">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>fig, ax1 <span class="op">=</span> plt.subplots()</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'magnitude, dB'</span>)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'frequency, Hz'</span>)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>plt.semilogx(frequency[<span class="dv">0</span>:<span class="op">-</span><span class="dv">1</span>], <span class="dv">20</span><span class="op">*</span>np.log10(np.<span class="bu">abs</span>(H_v2)[<span class="dv">0</span>:<span class="op">-</span><span class="dv">1</span>]),<span class="st">'-k'</span>,label<span class="op">=</span><span class="st">'LTSpice sch v2 mag'</span>)    <span class="co"># LTSpice magnitude plot</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>plt.semilogx(w<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), mag,<span class="st">'-r'</span>,label<span class="op">=</span><span class="st">'MNA mag, dB'</span>)    <span class="co"># MNA magnitude plot</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>ax1.tick_params(axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="co">#ax1.set_ylim((-30,20))</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">'upper right'</span>)</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a><span class="co"># instantiate a second y-axes that shares the same x-axis</span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> ax1.twinx()</span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>color <span class="op">=</span> <span class="st">'tab:blue'</span></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>plt.semilogx(frequency[<span class="dv">0</span>:<span class="op">-</span><span class="dv">1</span>], np.unwrap(<span class="dv">2</span><span class="op">*</span>np.angle(H_v2)[<span class="dv">0</span>:<span class="op">-</span><span class="dv">1</span>]<span class="op">/</span><span class="dv">2</span>) <span class="op">*</span><span class="dv">180</span><span class="op">/</span>np.pi,<span class="st">':'</span>,color<span class="op">=</span><span class="st">'k'</span>,label<span class="op">=</span><span class="st">'LTSpice phase'</span>)  <span class="co"># LTSpice phase plot</span></span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>plt.semilogx(w<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>np.pi), phase,<span class="st">':'</span>,color<span class="op">=</span><span class="st">'r'</span>,label<span class="op">=</span><span class="st">'MNA phase'</span>)  <span class="co"># MNA phase plot</span></span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">'lower right'</span>)</span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'phase, deg'</span>,color<span class="op">=</span>color)</span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a>ax2.tick_params(axis<span class="op">=</span><span class="st">'y'</span>, labelcolor<span class="op">=</span>color)</span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a><span class="co">#ax2.set_ylim((-5,25))</span></span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a><span class="co"># highlight the guitar audio band, 80 to 8kHz</span></span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a>plt.axvspan(<span class="dv">80</span>, <span class="fl">8e3</span>, color<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Magnitude and phase response'</span>)</span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="fig-ltspice-mna-freq-plot" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ltspice-mna-freq-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Klon Centaur part 2v0_files/figure-html/fig-ltspice-mna-freq-plot-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ltspice-mna-freq-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;26.10: LTSpice and MNA data magnitude and phase response plotted for comparison
</figcaption>
</figure>
</div>
</div>
</div>
<p>As shown above, there is a slight difference between the MNA results and the LTSpice simulation, but generally there is good agreement. The LTSpice simulation is using device models for the diodes and Op Amps which accounts for the slight differences.</p>
<p>The poles and zeros of the transfer function can easily be obtained with the following code:</p>
<div id="7ff829a0-265c-442b-bf3f-791f0ab72977" class="cell" data-execution_count="93">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>sys_tf <span class="op">=</span> signal.TransferFunction(a,b)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>sys_zeros <span class="op">=</span> np.roots(sys_tf.num)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>sys_poles <span class="op">=</span> np.roots(sys_tf.den)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The poles and zeros of the voltage transfer function are plotted on the complex frequency plane.</p>
<div id="18a260ec-61aa-4f4a-ae22-61f26a3db1e5" class="cell" data-execution_count="94">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>plt.plot(np.real(sys_zeros), np.imag(sys_zeros), <span class="st">'ob'</span>, markerfacecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>plt.plot(np.real(sys_poles), np.imag(sys_poles), <span class="st">'xr'</span>)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>plt.legend([<span class="st">'Zeros'</span>, <span class="st">'Poles'</span>], loc<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Complex plane Pole / Zero Plot'</span>)</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'real part, </span><span class="ch">\u03C3</span><span class="st">'</span>)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'imaginary part, j</span><span class="ch">\u03C9</span><span class="st">'</span>)</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Klon Centaur part 2v0_files/figure-html/cell-46-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Poles and zeros of the transfer function plotted on the complex plane and the units are in radian frequency. These values are printed in the following table.</p>
<div id="72373625-2aed-44eb-a91d-7218202fe612" class="cell" data-execution_count="95">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>table_header <span class="op">=</span> [<span class="st">'Zeros, rad/s'</span>, <span class="st">'Poles, rad/s'</span>]</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>num_table_rows <span class="op">=</span> <span class="bu">max</span>(<span class="bu">len</span>(sys_zeros),<span class="bu">len</span>(sys_poles))</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>table_row <span class="op">=</span> []</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(num_table_rows):</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="op">&lt;</span> <span class="bu">len</span>(sys_zeros):</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>        z <span class="op">=</span> <span class="st">'</span><span class="sc">{:,.2f}</span><span class="st">'</span>.<span class="bu">format</span>(sys_zeros[i])</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>        z <span class="op">=</span> <span class="st">''</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="op">&lt;</span> <span class="bu">len</span>(sys_poles):</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> <span class="st">'</span><span class="sc">{:,.2f}</span><span class="st">'</span>.<span class="bu">format</span>(sys_poles[i])</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> <span class="st">''</span></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>    table_row.append([z,p])</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(table_row, headers<span class="op">=</span>table_header,colalign <span class="op">=</span> (<span class="st">'left'</span>,<span class="st">'left'</span>),tablefmt<span class="op">=</span><span class="st">"simple"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Zeros, rad/s       Poles, rad/s
-----------------  --------------
-95,456.35+0.00j   -29,089.84
-60,141.16+0.00j   -15,995.02
-31,576.17+0.00j   -7,530.71
-7,000.27+0.00j    -6,076.07
-4,086.01+0.00j    -5,671.58
-1,544.35+0.00j    -3,111.00
-1,226.10+53.30j   -1,758.48
-1,226.10-53.30j   -1,455.33
-1,015.01+250.67j  -1,132.02
-1,015.01-250.67j  -1,047.53
-16.52+17.66j      -75.51
-16.52-17.66j      -41.49
-4.72+0.00j        -9.90
0.00+0.00j         -4.97
0.00+0.00j         -2.47</code></pre>
</div>
</div>
<section id="square-wave-response" class="level4" data-number="26.6.2.1">
<h4 data-number="26.6.2.1" class="anchored" data-anchor-id="square-wave-response"><span class="header-section-number">26.6.2.1</span> Square Wave Response</h4>
<p>The SciPy function <code>lsim</code> was used to calculate the time domain response to a 10 Hz square wave. The input amplitude is scaled and level shifted to produce a 0 to 50 mV signal which keeps the levels at node 16 below the diode conduction level.</p>
<div id="3afc7e55-00d0-4bde-90e5-d9aacc81d6f1" class="cell" data-execution_count="96">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="fl">0.2</span>, <span class="dv">500</span>, endpoint<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>sqr_signal <span class="op">=</span> signal.square(<span class="dv">2</span><span class="op">*</span>np.pi<span class="op">*</span><span class="dv">10</span><span class="op">*</span>t, duty<span class="op">=</span><span class="fl">0.5</span>)<span class="op">/</span><span class="dv">40</span><span class="op">+</span><span class="dv">1</span><span class="op">/</span><span class="dv">40</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>t_step, y_step, x_step <span class="op">=</span> signal.lsim(sys_tf, U<span class="op">=</span>sqr_signal, T<span class="op">=</span>t)</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>plt.plot(t_step<span class="op">*</span><span class="fl">1e3</span>, sqr_signal, <span class="st">'r'</span>, alpha<span class="op">=</span><span class="fl">0.75</span>, linewidth<span class="op">=</span><span class="dv">1</span>, label<span class="op">=</span><span class="st">'input'</span>)</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>plt.plot(t_step<span class="op">*</span><span class="fl">1e3</span>, y_step,<span class="st">'b'</span>, linewidth<span class="op">=</span><span class="fl">1.25</span>, label<span class="op">=</span><span class="st">'output'</span>)</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Step response'</span>)</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'volts'</span>)</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'time, msec'</span>)</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>plt.ylim((<span class="op">-</span><span class="fl">.4</span>,<span class="fl">.4</span>))</span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">'best'</span>)</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a><span class="co"># show plot</span></span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Klon Centaur part 2v0_files/figure-html/cell-48-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The plot above shows the input square wave in red and the out signal in blue. The signal path is AC coupled as indicated by the lack of DC response in the plot. The decay time is a bit over 25 ms.</p>
<p>At the leading edge of the square wave input, there is about a 250 mV spike, which suggests a large AC gain in the circuit because the abrupt change in the input signal at the leading edge of steps of the square wave produces substantial harmonic components within the pass band of the pedal’s frequency response.</p>
<p>The square wave simulation data from LTSpice was loaded in the JupyterLab notebook so that the data could be overlaid along with the NMA solution.</p>
<div id="485f03cf-3556-4f90-8616-396277eb4556" class="cell" data-execution_count="97">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>fn <span class="op">=</span> <span class="st">'Klon-Centaur_v2_square_wave.csv'</span> <span class="co"># data from LTSpice</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>LTSpice_data <span class="op">=</span> np.genfromtxt(fn, delimiter<span class="op">=</span><span class="st">','</span>,skip_header<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize some empty arrays</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>time <span class="op">=</span> np.zeros(<span class="bu">len</span>(LTSpice_data))</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>voltage1 <span class="op">=</span> np.zeros(<span class="bu">len</span>(LTSpice_data))</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>voltage2 <span class="op">=</span> np.zeros(<span class="bu">len</span>(LTSpice_data))</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a><span class="co"># convert the csv data to complex numbers and store in the array</span></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(LTSpice_data)):</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>    time[i] <span class="op">=</span> LTSpice_data[i][<span class="dv">0</span>]</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>    voltage1[i] <span class="op">=</span> LTSpice_data[i][<span class="dv">1</span>]</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>    voltage2[i] <span class="op">=</span> LTSpice_data[i][<span class="dv">2</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The code below generates the plots for the LTSpice and Python MNA data.</p>
<div id="6bed09c2-7073-4609-b85e-062f06ec8a94" class="cell" data-execution_count="98">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'LTSpice and Python MNA results'</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.plot(time, voltage1, 'g', alpha = 1.0, linewidth=1, label='LTSpice v1(t)')</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>plt.plot(time, voltage2, <span class="st">'-.r'</span>, alpha <span class="op">=</span> <span class="fl">1.0</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'LTSpice v2(t)'</span>)</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.plot(t_step, sqr_signal, 'r', alpha = 1.0, linewidth=1, label='input')</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>plt.plot(t_step, y_step,<span class="st">'b'</span>, alpha <span class="op">=</span> <span class="fl">1.0</span>, linewidth <span class="op">=</span> <span class="fl">1.0</span>, label<span class="op">=</span><span class="st">'Python MNA result'</span>)</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'v(t), volts'</span>)</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'time, sec'</span>)</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Klon Centaur part 2v0_files/figure-html/cell-50-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>As shown above, there is close agreement between the two solutions in both the frequency and time domain for input signal levels and gain settings that do not produce node voltages at node 16 with levels that would drive the diodes into conduction.</p>
</section>
</section>
</section>
<section id="summary-for-part-2" class="level2" data-number="26.7">
<h2 data-number="26.7" class="anchored" data-anchor-id="summary-for-part-2"><span class="header-section-number">26.7</span> Summary for part 2</h2>
<p>The semiconductor parts used in the pedal were described as well as the SPICE device models used in the LTSpice simulations. The MNA method can not easily handle the non-linear operation resulting from saturated Op Amp outputs or forwarded biased diodes. LTSpice was used to examine the operating point where the Op Amps would be driven into saturation.</p>
<p>From the analysis it appears that output of <span class="math inline">\(U_{1A}\)</span> could be clipping the signal at some combinations of input level and gain. Python was used to display the results of LTSpice transient analysis and the harmonic content of the distorted signal was plotted. The operation of the pedal with actual music signals as inputs was simulated. This illustrates how MNA can be used in conjunction with LTSpice to do circuit analysis and generate reports.</p>
<p>Finally analysis results obtained from LTSpice were compared to the Python MNA results. The magnitude, phase and time domain plots superimpose giving us confidence that the Python analysis results are correct.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Klon Centaur part 1.html" class="pagination-link" aria-label="Klon Centaur, part 1">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Klon Centaur, part 1</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Klon Centaur part 3v1.html" class="pagination-link" aria-label="Klon Centaur, part 3">
        <span class="nav-page-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Klon Centaur, part 3</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>